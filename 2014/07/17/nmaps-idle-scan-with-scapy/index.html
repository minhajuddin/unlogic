<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Unlogic</title>
        <meta name="author">
        <meta name="description" content="I have a keyboard, a compiler, and a whole load of luck">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.15" />
          <link href="http://unlogic.co.ukpost/index.xml" rel="alternate" type="application/rss+xml" title="Unlogic" />
          <link href="http://unlogic.co.ukpost/index.xml" rel="feed" type="application/rss+xml" title="Unlogic" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://unlogic.co.ukcss/styles.css">
        <link rel="icon" href="http://unlogic.co.ukfavicon.ico">
        <link rel="apple-touch-icon" href="http://unlogic.co.ukapple-touch-icon.png" />
        <link rel="stylesheet" href="http://unlogic.co.ukcss/highlightjs/monokai.css">
        <script src="http://unlogic.co.ukjs/vendor/modernizr-2.8.0.min.js"></script>
        <style>
        .site-header h2 .logo {
        background: url(http://unlogic.co.ukimages/keyboard-feature.jpg) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://unlogic.co.ukimages/keyboard-feature.jpg);
        }}
       .site-header {
         background: #2a373d url(http://unlogic.co.ukimages/keyboard-feature.jpg) no-repeat center center;
         z-index: -1;
         color: #BBB;
         height: 170px;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2><a style="color: #EEE" href="http://unlogic.co.uk">Unlogic</a></h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn" href="http://unlogic.co.uk" title="">&laquo; </a>
            
<h1><a href="http://unlogic.co.uk/2014/07/17/nmaps-idle-scan-with-scapy/" title="nmap&#39;s idle scan with scapy">nmap&#39;s idle scan with scapy</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2014.07.17">2014.07.17</time>
&middot; 
    
    <a href="http://unlogic.co.uktags/hack">hack</a>, 
    
    <a href="http://unlogic.co.uktags/idle-scan">idle scan</a>, 
    
    <a href="http://unlogic.co.uktags/scapy">scapy</a>, 
    
    <a href="http://unlogic.co.uktags/nmap">nmap</a>
    

</span>
</footer>

            
            <p>If you&rsquo;ve used nmap before you are probably familiar with its idle scan feature.
Should you not be, go and <a href="http://nmap.org/book/idlescan.html">skim the docs</a>.
I&rsquo;ll quickly cover the basics here anyway.</p>

<p>Basically it will allow us to conduct a port scan of a remote host without revealing
our IP address. This is done by making use of the fact that IP IDs are sequential.
The images below (courtesy of the namp project documentation) explain this very
well.</p>

<p><strong>Open Port</strong>
<a href="http://i.imgur.com/MajmRTH.png">
<figure >
    
        <img src="http://i.imgur.com/MajmRTH.png" />
    
    
</figure>
</a></p>

<p><strong>Closed Port</strong>
<a href="http://i.imgur.com/2UALzzd.png">
<figure >
    
        <img src="http://i.imgur.com/2UALzzd.png" />
    
    
</figure>
</a></p>

<p><strong>Filtered Port</strong>
<a href="http://i.imgur.com/Yv6hbwL.png">
<figure >
    
        <img src="http://i.imgur.com/Yv6hbwL.png" />
    
    
</figure>
</a></p>

<p>Ok, so that&rsquo;s the short version of the theory and it&rsquo;s relatively painless
to implement with scapy. Let&rsquo;s take a look at the script:</p>

<p>{% gist e377713b90525e842266 %}</p>

<p>You provide the script with a <code>zombie ip</code>, <code>target ip</code>, and <code>target port</code>.
These should be self explanatory. Then we use scapy to assemble our packets to
conduct our scan. The <code>p1</code> SYN/ACK packet will be sent to the zombie so we can
obtain a current IP ID from the RST response as a reference.</p>

<p><code>p2</code> is a SYN packet which we send to the target with a return address of the
zombie host. When the target receives this packet it will reply to
the zombie instead of the source machine (us). The target will respond with a
SYN/ACK to the <code>p2</code> packet, but send its response to the zombie instead of us.
Thus increasing the zobmies IP ID value by one.</p>

<p>Then we probe the zombie again with a further SYN/ACK packet (this is <code>p3</code>) to
find out what the new IP ID is.</p>

<p>Now we have enough information to determine if the remote port is open or not.
We subtract the initial IP ID from the final one and print out the status of the port.</p>

<p>So how do you use it? The important thing is to find a relative inactive machine to
use as a zombie, as you don&rsquo;t want the IP ID to change while you are conducting
your probe. I&rsquo;ve had the best results with using networked printers as zombie hosts.
Unless there&rsquo;s a lot of print jobs going on, they are fairly idle. The printer
is at <code>10.20.7.1</code> and I&rsquo;m probing port 80 on <code>10.16.70.8</code>.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$<span style="color: #f92672">]</span> sudo ./idle_scan.py 10.20.7.1 0.16.70.8 80
WARNING: No route found for IPv6 destination :: (no default route?)

[*] Scan 10.16.70.8 port 80 using 10.20.7.1 as zombie
[+] Zombie initial IP id 57319
[+] Zombie final IP id 57321
[+] Port 80 : open

sudo ./idle_scan.py 10.20.7.1 0.16.70.8 90
WARNING: No route found for IPv6 destination :: (no default route?)

[*] Scan 10.16.70.8 port 90 using 10.20.7.1 as zombie
[+] Zombie initial IP id 57341
[+] Zombie final IP id 57342
[+] Port 90 : closed
 
</pre></div>
</p>

<p>And to be sure, let&rsquo;s verify our findings with a proper nmap scan.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$<span style="color: #f92672">]</span> nmap 10.16.70.8 -p80,90

Starting Nmap 5.51 ( http://nmap.org ) at 2014-07-17 13:07 BST
Nmap scan report for 10.16.70.8 (10.16.70.8)
Host is up (0.00013s latency).
PORT   STATE  SERVICE
80/tcp open   http
90/tcp closed dnsix

Nmap done: 1 IP address (1 host up) scanned in 0.04 seconds
</pre></div>
</p>

<p>Approved.</p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2funlogic.co.uk%2f2014%2f07%2f17%2fnmaps-idle-scan-with-scapy%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=nmap%27s%20idle%20scan%20with%20scapy&amp;url=http%3a%2f%2funlogic.co.uk%2f2014%2f07%2f17%2fnmaps-idle-scan-with-scapy%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2funlogic.co.uk%2f2014%2f07%2f17%2fnmaps-idle-scan-with-scapy%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2funlogic.co.uk%2f2014%2f07%2f17%2fnmaps-idle-scan-with-scapy%2f&title=nmap%27s%20idle%20scan%20with%20scapy" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'unlogic';
    var disqus_identifier = 'http:\/\/unlogic.co.uk\/2014\/07\/17\/nmaps-idle-scan-with-scapy\/';
    var disqus_title = 'nmap\x27s idle scan with scapy';
    var disqus_url = 'http:\/\/unlogic.co.uk\/2014\/07\/17\/nmaps-idle-scan-with-scapy\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </main>
    <aside class="author">
  <img class="profile-image" src="http://unlogic.co.ukimages/avatar.jpg" alt="Sven Steinbauer" />
  <p class="name"> 
  <strong>Sven Steinbauer</strong></p>
  <p class="address"></p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/binaryheadache" class="icon-twitter" target="_blank" title="Twitter"></a></li>













<li><a href="//github.com/svenito" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://unlogic.co.ukpost/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://unlogic.co.ukpost/index.xml" title="RSS"></a>
        <p>&copy; 2016 &middot; Sven Steinbauer</p>
  </div>
</footer>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/unlogic.co.ukjs/vendor/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://unlogic.co.ukjs/plugins.js"></script>

</body>
</html>

