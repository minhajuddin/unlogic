<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Leviathan on Unlogic</title>
    <link>http://unlogic.co.uk/tags/leviathan/</link>
    <description>Recent content in Leviathan on Unlogic</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Mon, 23 Mar 2015 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://unlogic.co.uk/tags/leviathan/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Solving Leviathan</title>
      <link>http://unlogic.co.uk/2015/03/23/solving-leviathan/</link>
      <pubDate>Mon, 23 Mar 2015 00:00:00 +0000</pubDate>
      
      <guid>http://unlogic.co.uk/2015/03/23/solving-leviathan/</guid>
      <description>

&lt;p&gt;After having done &lt;a href=&#34;http://overthewire.org/wargames/bandit/&#34;&gt;Bandit&lt;/a&gt;, let&amp;rsquo;s move
on to &lt;a href=&#34;http://overthewire.org/wargames/leviathan/&#34;&gt;Leviathan&lt;/a&gt;. None of the levels
have hints, so there won&amp;rsquo;t be any links to each of the levels.&lt;/p&gt;

&lt;p&gt;Without further ado, let&amp;rsquo;s get cracking.&lt;/p&gt;

&lt;h1 id=&#34;level-0-1:233d21a5a4a7da288bb6120215cbabbb&#34;&gt;Level 0 -&amp;gt; 1&lt;/h1&gt;

&lt;p&gt;Logging in with &lt;code&gt;leviathan0:leviathan0&lt;/code&gt; we take a quick look around to see
what we have to work with, if anything&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan0@melinda:~$ ls -la
total 24
drwxr-xr-x   3 root       root       4096 Nov 14 10:32 .
drwxr-xr-x 167 root       root       4096 Mar 21 06:46 ..
drwxr-x---   2 leviathan1 leviathan0 4096 Feb 10 18:08 .backup
-rw-r--r--   1 root       root        220 Apr  9  2014 .bash_logout
-rw-r--r--   1 root       root       3637 Apr  9  2014 .bashrc
-rw-r--r--   1 root       root        675 Apr  9  2014 .profile
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Let&amp;rsquo;s take a look in that &lt;code&gt;.backup&lt;/code&gt; folder.&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan0@melinda:~$ ls .backup/
bookmarks.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Checking the contents of the file, we see it really is a list of bookmarks.
Going on the assumption that the password for the next level is in there, let&amp;rsquo;s
grep for &lt;em&gt;leviathan&lt;/em&gt; in this file&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan0@melinda:~$ grep leviathan .backup/bookmarks.html 
&amp;lt;DT&amp;gt;&amp;lt;A HREF=&amp;quot;http://leviathan.labs.overthewire.org/passwordus.html | This will be fixed later, the password for leviathan1 is rioGegei8m&amp;quot; ADD_DATE=&amp;quot;1155384634&amp;quot; LAST_CHARSET=&amp;quot;ISO-8859-1&amp;quot; ID=&amp;quot;rdf:#$2wIU71&amp;quot;&amp;gt;password to leviathan1&amp;lt;/A&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And there it is&lt;/p&gt;

&lt;h1 id=&#34;level-1-2:233d21a5a4a7da288bb6120215cbabbb&#34;&gt;Level 1 -&amp;gt; 2&lt;/h1&gt;

&lt;p&gt;As usual we login, do a &lt;code&gt;ls -la&lt;/code&gt; and see a &lt;code&gt;check&lt;/code&gt; binary that is setuid &lt;code&gt;leviathan2&lt;/code&gt;.
Let&amp;rsquo;s run it and see what happens&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan1@melinda:~$ ./check 
password: test
Wrong password, Good Bye ...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Trying the usual &lt;code&gt;strings check&lt;/code&gt; shows us a couple of interesting strings: &lt;code&gt;secret&lt;/code&gt; and &lt;code&gt;love&lt;/code&gt;.
Neither one or both will return success. Hrmm. Ok, let&amp;rsquo;s take a look at the
disassembly&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;(gdb) disass main
Dump of assembler code for function main:
   0x0804852d &amp;lt;+0&amp;gt;:	push   %ebp
   0x0804852e &amp;lt;+1&amp;gt;:	mov    %esp,%ebp
   0x08048530 &amp;lt;+3&amp;gt;:	and    $0xfffffff0,%esp
   0x08048533 &amp;lt;+6&amp;gt;:	sub    $0x30,%esp
   0x08048536 &amp;lt;+9&amp;gt;:	mov    %gs:0x14,%eax
   0x0804853c &amp;lt;+15&amp;gt;:	mov    %eax,0x2c(%esp)
   0x08048540 &amp;lt;+19&amp;gt;:	xor    %eax,%eax
   0x08048542 &amp;lt;+21&amp;gt;:	movl   $0x786573,0x18(%esp)
   0x0804854a &amp;lt;+29&amp;gt;:	movl   $0x72636573,0x25(%esp)
   0x08048552 &amp;lt;+37&amp;gt;:	movw   $0x7465,0x29(%esp)
   0x08048559 &amp;lt;+44&amp;gt;:	movb   $0x0,0x2b(%esp)
   0x0804855e &amp;lt;+49&amp;gt;:	movl   $0x646f67,0x1c(%esp)
   0x08048566 &amp;lt;+57&amp;gt;:	movl   $0x65766f6c,0x20(%esp)
   0x0804856e &amp;lt;+65&amp;gt;:	movb   $0x0,0x24(%esp)
   0x08048573 &amp;lt;+70&amp;gt;:	movl   $0x8048680,(%esp)
   0x0804857a &amp;lt;+77&amp;gt;:	call   0x80483c0 &amp;lt;printf@plt&amp;gt;
   0x0804857f &amp;lt;+82&amp;gt;:	call   0x80483d0 &amp;lt;getchar@plt&amp;gt;
   0x08048584 &amp;lt;+87&amp;gt;:	mov    %al,0x14(%esp)
   0x08048588 &amp;lt;+91&amp;gt;:	call   0x80483d0 &amp;lt;getchar@plt&amp;gt;
   0x0804858d &amp;lt;+96&amp;gt;:	mov    %al,0x15(%esp)
   0x08048591 &amp;lt;+100&amp;gt;:	call   0x80483d0 &amp;lt;getchar@plt&amp;gt;
   0x08048596 &amp;lt;+105&amp;gt;:	mov    %al,0x16(%esp)
   0x0804859a &amp;lt;+109&amp;gt;:	movb   $0x0,0x17(%esp)
   0x0804859f &amp;lt;+114&amp;gt;:	lea    0x18(%esp),%eax
   0x080485a3 &amp;lt;+118&amp;gt;:	mov    %eax,0x4(%esp)
   0x080485a7 &amp;lt;+122&amp;gt;:	lea    0x14(%esp),%eax
   0x080485ab &amp;lt;+126&amp;gt;:	mov    %eax,(%esp)
   0x080485ae &amp;lt;+129&amp;gt;:	call   0x80483b0 &amp;lt;strcmp@plt&amp;gt;
   0x080485b3 &amp;lt;+134&amp;gt;:	test   %eax,%eax
   0x080485b5 &amp;lt;+136&amp;gt;:	jne    0x80485c5 &amp;lt;main+152&amp;gt;
   0x080485b7 &amp;lt;+138&amp;gt;:	movl   $0x804868b,(%esp)
   0x080485be &amp;lt;+145&amp;gt;:	call   0x8048400 &amp;lt;system@plt&amp;gt;
   0x080485c3 &amp;lt;+150&amp;gt;:	jmp    0x80485d1 &amp;lt;main+164&amp;gt;
   0x080485c5 &amp;lt;+152&amp;gt;:	movl   $0x8048693,(%esp)
   0x080485cc &amp;lt;+159&amp;gt;:	call   0x80483f0 &amp;lt;puts@plt&amp;gt;
   0x080485d1 &amp;lt;+164&amp;gt;:	mov    $0x0,%eax
   0x080485d6 &amp;lt;+169&amp;gt;:	mov    0x2c(%esp),%edx
   0x080485da &amp;lt;+173&amp;gt;:	xor    %gs:0x14,%edx
   0x080485e1 &amp;lt;+180&amp;gt;:	je     0x80485e8 &amp;lt;main+187&amp;gt;
   0x080485e3 &amp;lt;+182&amp;gt;:	call   0x80483e0 &amp;lt;__stack_chk_fail@plt&amp;gt;
   0x080485e8 &amp;lt;+187&amp;gt;:	leave  
   0x080485e9 &amp;lt;+188&amp;gt;:	ret    
End of assembler dump.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So it uses &lt;code&gt;strcmp&lt;/code&gt; to compare our input to whatever the right pass is (&lt;code&gt;0x080485ae&lt;/code&gt;)
I&amp;rsquo;m going to use &lt;code&gt;ltrace&lt;/code&gt; to trace through the library call and see what that reveals&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan1@melinda:~$ ltrace ./check 
__libc_start_main(0x804852d, 1, 0xffffd794, 0x80485f0 &amp;lt;unfinished ...&amp;gt;
printf(&amp;quot;password: &amp;quot;)                                       = 10
getchar(0x8048680, 47, 0x804a000, 0x8048642password: test
)               = 116
getchar(0x8048680, 47, 0x804a000, 0x8048642)               = 101
getchar(0x8048680, 47, 0x804a000, 0x8048642)               = 115
strcmp(&amp;quot;tes&amp;quot;, &amp;quot;sex&amp;quot;)                                       = 1
puts(&amp;quot;Wrong password, Good Bye ...&amp;quot;Wrong password, Good Bye ...
)                       = 29
+++ exited (status 0) +++
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And there we have it.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan1@melinda:~$ ./check 
password: sex
$ whoami
leviathan2
$ cat /etc/leviathan_pass/leviathan2
ougahZi8Ta
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;h1 id=&#34;level-2-3:233d21a5a4a7da288bb6120215cbabbb&#34;&gt;Level 2 -&amp;gt; 3&lt;/h1&gt;

&lt;p&gt;This time we are given a file called &lt;code&gt;printfile&lt;/code&gt; that is setuid &lt;code&gt;leviathan3&lt;/code&gt;.
Initially you&amp;rsquo;d think we can just print the contents of the &lt;code&gt;leviathan3&lt;/code&gt; password
file. Nope, there&amp;rsquo;s a check in the binary preventing us from doing so.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s find out what that check is with &lt;code&gt;ltrace&lt;/code&gt; once again&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan2@melinda:~$ ltrace ./printfile /tmp/unlogic
__libc_start_main(0x804852d, 2, 0xffffd764, 0x8048600 &amp;lt;unfinished ...&amp;gt;
access(&amp;quot;/tmp/unlogic&amp;quot;, 4)                                  = 0
snprintf(&amp;quot;/bin/cat /tmp/unlogic&amp;quot;, 511, &amp;quot;/bin/cat %s&amp;quot;, &amp;quot;/tmp/unlogic&amp;quot;) = 21
system(&amp;quot;/bin/cat /tmp/unlogic&amp;quot;testing
 &amp;lt;no return ...&amp;gt;
--- SIGCHLD (Child exited) ---
&amp;lt;... system resumed&amp;gt; )                                     = 0
+++ exited (status 0) +++
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;We can see that it checks access to the file, then runs &lt;code&gt;cat&lt;/code&gt; on the file if it&amp;rsquo;s
ok for us to access it. Symlinks won&amp;rsquo;t work here, as the &lt;code&gt;access&lt;/code&gt; call dereferences
the symlink. So what can we do? We exploit spaces. By creating a file that is a symlink to
the &lt;code&gt;leviathan3&lt;/code&gt; password file, along with another file, that has the same name followed
by a space and another name, we can trick &lt;code&gt;access&lt;/code&gt; into allowing it to carry on, and
then &lt;code&gt;cat&lt;/code&gt; to print the files. let me show you&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan2@melinda:~$ ln -s /etc/leviathan_pass/leviathan3 /tmp/levpass3
leviathan2@melinda:~$ touch /tmp/levpass3&lt;span style=&#34;color: #ae81ff&#34;&gt;\ &lt;/span&gt;other
leviathan2@melinda:~$ ./printfile /tmp/levpass3&lt;span style=&#34;color: #ae81ff&#34;&gt;\ &lt;/span&gt;other
Ahdiemoo1j
/bin/cat: other: No such file or directory
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;So access checks &lt;code&gt;/tmp/levpass3\ other&lt;/code&gt; and deems it ok. Then that string gets
passed to &lt;code&gt;cat&lt;/code&gt; which interprets it as two files, hence the &lt;code&gt;/bin/cat: other: No such file or directory&lt;/code&gt;&lt;/p&gt;

&lt;h1 id=&#34;level-3-4:233d21a5a4a7da288bb6120215cbabbb&#34;&gt;Level 3 -&amp;gt; 4&lt;/h1&gt;

&lt;p&gt;Another program that prompts for a pass. Usual approaches of &lt;code&gt;strings&lt;/code&gt; and checking
the &lt;em&gt;disass&lt;/em&gt; doesn&amp;rsquo;t reveal much, but the function &lt;code&gt;do_stuff&lt;/code&gt; does call &lt;code&gt;strcmp&lt;/code&gt;
and we know now that we can use &lt;code&gt;ltrace&lt;/code&gt; to help us out&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan3@melinda:~$ ltrace ./level3 
__libc_start_main(0x80485fe, 1, 0xffffd794, 0x80486d0 &amp;lt;unfinished ...&amp;gt;
strcmp(&amp;quot;h0no33&amp;quot;, &amp;quot;kakaka&amp;quot;)                                 = -1
printf(&amp;quot;Enter the password&amp;gt; &amp;quot;)                             = 20
fgets(Enter the password&amp;gt; d
&amp;quot;d\n&amp;quot;, 256, 0xf7fcac20)                              = 0xffffd58c
strcmp(&amp;quot;d\n&amp;quot;, &amp;quot;snlprintf\n&amp;quot;)                               = -1
puts(&amp;quot;bzzzzzzzzap. WRONG&amp;quot;bzzzzzzzzap. WRONG
)                                 = 19
+++ exited (status 0) +++
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;A little bit of obfuscation here, but to our keen eyes, we see where the test
is happening &lt;code&gt;strcmp(&amp;quot;d\n&amp;quot;, &amp;quot;snlprintf\n&amp;quot;)&lt;/code&gt;. Our password is &lt;code&gt;snlprintf&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan3@melinda:~$ ./level3 
Enter the password&amp;gt; snlprintf  
[You&amp;#39;ve got shell]!
$ whoami
leviathan4
$ cat /etc/leviathan_pass/leviathan4
vuH0coox6m
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;h1 id=&#34;level-4-5:233d21a5a4a7da288bb6120215cbabbb&#34;&gt;Level 4 -&amp;gt; 5&lt;/h1&gt;

&lt;p&gt;Inside the hidden directory (you always run &lt;code&gt;ls -la&lt;/code&gt;, right?) we have a bin file.
It&amp;rsquo;s executable, so let&amp;rsquo;s run it&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan4@melinda:~$ ./.trash/bin 
01010100 01101001 01110100 01101000 00110100 01100011 01101111 01101011 01100101 01101001 00001010 
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;m guessing we need to decode that from the current binary encoded string to text. This
gives us &lt;code&gt;Tith4cokei&lt;/code&gt;. Testing it out takes us to&lt;/p&gt;

&lt;h1 id=&#34;level-5-6:233d21a5a4a7da288bb6120215cbabbb&#34;&gt;Level 5 -&amp;gt; 6&lt;/h1&gt;

&lt;p&gt;We have a binary called &lt;code&gt;leviathan5&lt;/code&gt; that is suid &lt;code&gt;leviathan6&lt;/code&gt;. Upon running it,
we get a message that file &lt;code&gt;tmp/file.log&lt;/code&gt; cannot be found. If you create one, it
will open it, print its contents, close it, and then delete it. So let&amp;rsquo;s give the
old symlink method a try:&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan5@melinda:~$ ln -s /etc/leviathan_pass/leviathan6 /tmp/file.log
leviathan5@melinda:~$ ./leviathan5 
UgaoFee4li
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;Result.&lt;/p&gt;

&lt;h1 id=&#34;level-6-7:233d21a5a4a7da288bb6120215cbabbb&#34;&gt;Level 6 -&amp;gt; 7&lt;/h1&gt;

&lt;p&gt;We need a 4 digit pass code to access this. I opted for brute force. For 4 digits
that&amp;rsquo;s by far the simplest and quickest way. After looking at the disassembly, we
see that it will call &lt;code&gt;/bin/sh&lt;/code&gt; and drop us to a shell, so we don&amp;rsquo;t need an exit condition.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan6@melinda:~$ &lt;span style=&#34;color: #66d9ef&#34;&gt;for&lt;/span&gt; i in &lt;span style=&#34;color: #66d9ef&#34;&gt;$(&lt;/span&gt;seq -f &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;quot;%04g&amp;quot;&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; 9999&lt;span style=&#34;color: #66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;$i&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ./leviathan6 &lt;span style=&#34;color: #f8f8f2&#34;&gt;$i&lt;/span&gt; &amp;gt; /dev/null&lt;span style=&#34;color: #f8f8f2&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef&#34;&gt;done&lt;/span&gt;
0000
0001
.
.
7123
&lt;/pre&gt;&lt;/div&gt;

It stops there. Because we redirect to /dev/null, we need to ctrl+c and then enter
the last printed number to get the password&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #272822&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;leviathan6@melinda:~$ ./leviathan6  7123
$ cat /etc/leviathan_pass/leviathan7
ahy7MaeBo9
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;The final flag for level 7 is&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Well Done, you seem to have used a *nix system before, now try something more serious.
(Please don&#39;t post writeups, solutions or spoilers about the games on the web. Thank you!)  
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I understand the reasons, but this is not the only write up out there, and it is a fairly old
wargame too. IMO I feel that providing these walkthroughs will help those who are stuck.
If you are however just following this so that you can complete Leviathan, then you should
sit down and have a go at this, or other war games without a guide. Challenge yourself.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>